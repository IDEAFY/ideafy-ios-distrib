/*! Socket.IO.min.js build:0.9.10, production. Copyright(c) 2011 LearnBoost <dev@learnboost.com> MIT Licensed */

/*
 Emily <VERSION> http://flams.github.com/emily

 The MIT License (MIT)

 Copyright (c) 2012 Olivier Scherrer <pode.fr@gmail.com>
*/

/*
 Olives 1.1.9 http://flams.github.com/olives
 The MIT License (MIT)
 Copyright (c) 2012 Olivier Scherrer <pode.fr@gmail.com> - Olivier Wietrich <olivier.wietrich@gmail.com>
*/

/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Author: Vincent Weyl <vincent.weyl@taiaut.com>
 * Copyright (c) 2012-2013 TAIAUT
 */

/**
 * https://github.com/TAIAUT/Ideafy
 * Proprietary License - All rights reserved
 * Authors: Vincent Weyl <vincent.weyl@taiaut.com> - Olivier Wietrich <Olivier.Wietrich@taiaut.com
 * Copyright (c) 2012-2013 TAIAUT
 */

var io="undefined"==typeof module?{}:module.exports;(function(){(function(e,t){var n=e;n.version="0.9.10",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(e,r){var i=n.util.parseUri(e),s,o;t&&t.location&&(i.protocol=i.protocol||t.location.protocol.slice(0,-1),i.host=i.host||(t.document?t.document.domain:t.location.hostname),i.port=i.port||t.location.port),s=n.util.uniqueUri(i);var u={host:i.host,secure:"https"==i.protocol,port:i.port||("https"==i.protocol?443:80),query:i.query||""};n.util.merge(u,r);if(u["force new connection"]||!n.sockets[s])o=new n.Socket(u);return!u["force new connection"]&&o&&(n.sockets[s]=o),o=o||n.sockets[s],o.of(i.path.length>1?i.path:"")}})("object"==typeof module?module.exports:this.io={},this),function(e,t){var n=e.util={},r=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){var t=r.exec(e||""),n={},s=14;while(s--)n[i[s]]=t[s]||"";return n},n.uniqueUri=function(e){var n=e.protocol,r=e.host,i=e.port;return"document"in t?(r=r||document.domain,i=i||(n=="https"&&document.location.protocol!=="https:"?443:document.location.port)):(r=r||"localhost",!i&&n=="https"&&(i=443)),(n||"http")+"://"+r+":"+(i||80)},n.query=function(e,t){var r=n.chunkQuery(e||""),i=[];n.merge(r,n.chunkQuery(t||""));for(var s in r)r.hasOwnProperty(s)&&i.push(s+"="+r[s]);return i.length?"?"+i.join("&"):""},n.chunkQuery=function(e){var t={},n=e.split("&"),r=0,i=n.length,s;for(;r<i;++r)s=n[r].split("="),s[0]&&(t[s[0]]=s[1]);return t};var s=!1;n.load=function(e){if("document"in t&&document.readyState==="complete"||s)return e();n.on(t,"load",e,!1)},n.on=function(e,t,n,r){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,r)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}return null},"undefined"!=typeof window&&n.load(function(){s=!0}),n.defer=function(e){if(!n.ua.webkit||"undefined"!=typeof importScripts)return e();n.load(function(){setTimeout(e,100)})},n.merge=function(e,t,r,i){var s=i||[],o=typeof r=="undefined"?2:r,u;for(u in t)t.hasOwnProperty(u)&&n.indexOf(s,u)<0&&(typeof e[u]!="object"||!o?(e[u]=t[u],s.push(t[u])):n.merge(e[u],t[u],o-1,s));return e},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},n.intersect=function(e,t){var r=[],i=e.length>t.length?e:t,s=e.length>t.length?t:e;for(var o=0,u=s.length;o<u;o++)~n.indexOf(i,s[o])&&r.push(s[o]);return r},n.indexOf=function(e,t,n){for(var r=e.length,n=n<0?n+r<0?0:n+r:n||0;n<r&&e[n]!==t;n++);return r<=n?-1:n},n.toArray=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(t){return!1}return e.withCredentials!=undefined}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),n.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function n(){r.removeListener(e,n),t.apply(this,arguments)}var r=this;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var r=this.$events[e];if(t.util.isArray(r)){var i=-1;for(var s=0,o=r.length;s<o;s++)if(r[s]===n||r[s].listener&&r[s].listener===n){i=s;break}if(i<0)return this;r.splice(i,1),r.length||delete this.$events[e]}else(r===n||r.listener&&r.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return e===undefined?(this.$events={},this):(this.$events&&this.$events[e]&&(this.$events[e]=null),this)},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var r=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,r);else{if(!t.util.isArray(n))return!1;var i=n.slice();for(var s=0,o=i.length;s<o;s++)i[s].apply(this,r)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,nativeJSON){function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a instanceof Date&&(a=date(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")},JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}("undefined"!=typeof io?io:module.exports,typeof JSON!="undefined"?JSON:undefined),function(e,t){var n=e.parser={},r=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],i=n.reasons=["transport not supported","client not handshaken","unauthorized"],s=n.advice=["reconnect"],o=t.JSON,u=t.util.indexOf;n.encodePacket=function(e){var t=u(r,e.type),n=e.id||"",a=e.endpoint||"",l=e.ack,c=null;switch(e.type){case"error":var p=e.reason?u(i,e.reason):"",v=e.advice?u(s,e.advice):"";if(p!==""||v!=="")c=p+(v!==""?"+"+v:"");break;case"message":e.data!==""&&(c=e.data);break;case"event":var m={name:e.name};e.args&&e.args.length&&(m.args=e.args),c=o.stringify(m);break;case"json":c=o.stringify(e.data);break;case"connect":e.qs&&(c=e.qs);break;case"ack":c=e.ackId+(e.args&&e.args.length?"+"+o.stringify(e.args):"")}var y=[t,n+(l=="data"?"+":""),a];return c!==null&&c!==undefined&&y.push(c),y.join(":")},n.encodePayload=function(e){var t="";if(e.length==1)return e[0];for(var n=0,r=e.length;n<r;n++){var i=e[n];t+="�"+i.length+"�"+e[n]}return t};var a=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){var t=e.match(a);if(!t)return{};var n=t[2]||"",e=t[5]||"",u={type:r[t[1]],endpoint:t[4]||""};n&&(u.id=n,t[3]?u.ack="data":u.ack=!0);switch(u.type){case"error":var t=e.split("+");u.reason=i[t[0]]||"",u.advice=s[t[1]]||"";break;case"message":u.data=e||"";break;case"event":try{var l=o.parse(e);u.name=l.name,u.args=l.args}catch(c){}u.args=u.args||[];break;case"json":try{u.data=o.parse(e)}catch(c){}break;case"connect":u.qs=e||"";break;case"ack":var t=e.match(/^([0-9]+)(\+)?(.*)/);if(t){u.ackId=t[1],u.args=[];if(t[3])try{u.args=t[3]?o.parse(t[3]):[]}catch(c){}}break;case"disconnect":case"heartbeat":}return u},n.decodePayload=function(e){if(e.charAt(0)=="�"){var t=[];for(var r=1,i="";r<e.length;r++)e.charAt(r)=="�"?(t.push(n.decodePacket(e.substr(r+1).substr(0,i))),r+=Number(i)+1,i=""):i+=e.charAt(r);return t}return[n.decodePacket(e)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.heartbeats=function(){return!0},n.prototype.onData=function(e){this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout();if(e!==""){var n=t.parser.decodePayload(e);if(n&&n.length)for(var r=0,i=n.length;r<i;r++)this.onPacket(n[r])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),e.type=="heartbeat"?this.onHeartbeat():(e.type=="connect"&&e.endpoint==""&&this.onConnect(),e.type=="error"&&e.advice=="reconnect"&&(this.isOpen=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){var e=this;this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(e,t){t.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function r(e){this.options={port:80,secure:!1,document:"document"in n?document:!1,resource:"socket.io",transports:t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":Infinity,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1;if(this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var r=this;t.util.on(n,"beforeunload",function(){r.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function i(){}e.Socket=r,t.util.mixin(r,t.EventEmitter),r.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),e!==""&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},r.prototype.publish=function(){this.emit.apply(this,arguments);var e;for(var t in this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t),e.$emit.apply(e,arguments))},r.prototype.handshake=function(e){function n(t){t instanceof Error?(r.connecting=!1,r.onError(t.message)):e.apply(null,t.split(":"))}var r=this,s=this.options,o=["http"+(s.secure?"s":"")+":/",s.host+":"+s.port,s.resource,t.protocol,t.util.query(this.options.query,"t="+ +(new Date))].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var u=document.getElementsByTagName("script")[0],a=document.createElement("script");a.src=o+"&jsonp="+t.j.length,u.parentNode.insertBefore(a,u),t.j.push(function(e){n(e),a.parentNode.removeChild(a)})}else{var f=t.util.request();f.open("GET",o,!0),this.isXDomain()&&(f.withCredentials=!0),f.onreadystatechange=function(){f.readyState==4&&(f.onreadystatechange=i,f.status==200?n(f.responseText):f.status==403?r.onError(f.responseText):(r.connecting=!1,!r.reconnecting&&r.onError(f.responseText)))},f.send(null)}},r.prototype.getTransport=function(e){var n=e||this.transports,r;for(var i=0,s;s=n[i];i++)if(t.Transport[s]&&t.Transport[s].check(this)&&(!this.isXDomain()||t.Transport[s].xdomainCheck(this)))return new t.Transport[s](this,this.sessionid);return null},r.prototype.connect=function(e){if(this.connecting)return this;var n=this;return n.connecting=!0,this.handshake(function(r,i,s,o){function u(e){n.transport&&n.transport.clearTimeouts(),n.transport=n.getTransport(e);if(!n.transport)return n.publish("connect_failed");n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){if(!n.connected){n.connecting=!1;if(n.options["try multiple transports"]){var e=n.transports;while(e.length>0&&e.splice(0,1)[0]!=n.transport.name);e.length?u(e):n.publish("connect_failed")}}},n.options["connect timeout"]))})}n.sessionid=r,n.closeTimeout=s*1e3,n.heartbeatTimeout=i*1e3,n.transports||(n.transports=n.origTransports=o?t.util.intersect(o.split(","),n.options.transports):n.options.transports),n.setHeartbeatTimeout(),u(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),e&&typeof e=="function"&&e()})}),this},r.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);if(this.transport&&!this.transport.heartbeats())return;var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)},r.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},r.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},r.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},r.prototype.disconnect=function(){if(this.connected||this.connecting)this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted");return this},r.prototype.disconnectSync=function(){var e=t.util.request(),n=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,t.protocol,"",this.sessionid].join("/")+"/?disconnect=1";e.open("GET",n,!1),e.send(null),this.onDisconnect("booted")},r.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},r.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},r.prototype.onOpen=function(){this.open=!0},r.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},r.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},r.prototype.onError=function(e){e&&e.advice&&e.advice==="reconnect"&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},r.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1;if(t||n)this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect())},r.prototype.reconnect=function(){function e(){if(n.connected){for(var e in n.namespaces)n.namespaces.hasOwnProperty(e)&&""!==e&&n.namespaces[e].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",t),n.removeListener("connect",t),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=i}function t(){if(!n.reconnecting)return;if(n.connected)return e();if(n.connecting&&n.reconnecting)return n.reconnectionTimer=setTimeout(t,1e3);n.reconnectionAttempts++>=r?n.redoTransports?(n.publish("reconnect_failed"),e()):(n.on("connect_failed",t),n.options["try multiple transports"]=!0,n.transports=n.origTransports,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(n.reconnectionDelay<s&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(t,n.reconnectionDelay))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,r=this.options["max reconnection attempts"],i=this.options["try multiple transports"],s=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new r(this,"json"),this.ackPackets=0,this.acks={}}function r(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],r={type:"event",name:e};return"function"==typeof n&&(r.id=++this.ackPackets,r.ack="data",this.acks[r.id]=n,t=t.slice(0,t.length-1)),r.args=t,this.packet(r)},n.prototype.disconnect=function(){return this.name===""?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function n(){r.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var r=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":this.name===""?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var i=["message",e.data];e.ack=="data"?i.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,i);break;case"event":var i=[e.name].concat(e.args);e.ack=="data"&&i.push(n),this.$emit.apply(this,i);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):e.reason=="unauthorized"?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},r.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},r.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function r(e){t.Transport.apply(this,arguments)}e.websocket=r,t.util.inherit(r,t.Transport),r.prototype.name="websocket",r.prototype.open=function(){var e=t.util.query(this.socket.options.query),r=this,i;return i||(i=n.MozWebSocket||n.WebSocket),this.websocket=new i(this.prepareUrl()+e),this.websocket.onopen=function(){r.onOpen(),r.socket.setBuffer(!1)},this.websocket.onmessage=function(e){r.onData(e.data)},this.websocket.onclose=function(){r.onClose(),r.socket.setBuffer(!0)},this.websocket.onerror=function(e){r.onError(e)},this},t.util.ua.iDevice?r.prototype.send=function(e){var t=this;return setTimeout(function(){t.websocket.send(e)},0),this}:r.prototype.send=function(e){return this.websocket.send(e),this},r.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this},r.prototype.close=function(){return this.websocket.close(),this},r.prototype.onError=function(e){this.socket.onError(e)},r.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},r.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},r.xdomainCheck=function(){return!0},t.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(){t.Transport.websocket.apply(this,arguments)}e.flashsocket=n,t.util.inherit(n,t.Transport.websocket),n.prototype.name="flashsocket",n.prototype.open=function(){var e=this,n=arguments;return WebSocket.__addTask(function(){t.Transport.websocket.prototype.open.apply(e,n)}),this},n.prototype.send=function(){var e=this,n=arguments;return WebSocket.__addTask(function(){t.Transport.websocket.prototype.send.apply(e,n)}),this},n.prototype.close=function(){return WebSocket.__tasks.length=0,t.Transport.websocket.prototype.close.call(this),this},n.prototype.ready=function(e,r){function i(){var t=e.options,i=t["flash policy port"],o=["http"+(t.secure?"s":"")+":/",t.host+":"+t.port,t.resource,"static/flashsocket","WebSocketMain"+(e.isXDomain()?"Insecure":"")+".swf"];n.loaded||(typeof WEB_SOCKET_SWF_LOCATION=="undefined"&&(WEB_SOCKET_SWF_LOCATION=o.join("/")),i!==843&&WebSocket.loadFlashPolicyFile("xmlsocket://"+t.host+":"+i),WebSocket.__initialize(),n.loaded=!0),r.call(s)}var s=this;if(document.body)return i();t.util.load(i)},n.check=function(){return typeof WebSocket!="undefined"&&"__initialize"in WebSocket&&!!swfobject?swfobject.getFlashPlayerVersion().major>=10:!1},n.xdomainCheck=function(){return!0},typeof window!="undefined"&&(WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0),t.transports.push("flashsocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports);if("undefined"!=typeof window)var swfobject=function(){function e(){if(R)return;try{var e=O.getElementsByTagName("body")[0].appendChild(m("span"));e.parentNode.removeChild(e)}catch(t){return}R=!0;var n=D.length;for(var r=0;r<n;r++)D[r]()}function t(e){R?e():D[D.length]=e}function n(e){if(typeof A.addEventListener!=S)A.addEventListener("load",e,!1);else if(typeof O.addEventListener!=S)O.addEventListener("load",e,!1);else if(typeof A.attachEvent!=S)g(A,"onload",e);else if(typeof A.onload=="function"){var t=A.onload;A.onload=function(){t(),e()}}else A.onload=e}function r(){_?i():s()}function i(){var e=O.getElementsByTagName("body")[0],t=m(x);t.setAttribute("type",C);var n=e.appendChild(t);if(n){var r=0;(function(){if(typeof n.GetVariable!=S){var i=n.GetVariable("$version");i&&(i=i.split(" ")[1].split(","),V.pv=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)])}else if(r<10){r++,setTimeout(arguments.callee,10);return}e.removeChild(t),n=null,s()})()}else s()}function s(){var e=P.length;if(e>0)for(var t=0;t<e;t++){var n=P[t].id,r=P[t].callbackFn,i={success:!1,id:n};if(V.pv[0]>0){var s=v(n);if(s)if(y(P[t].swfVersion)&&!(V.wk&&V.wk<312))w(n,!0),r&&(i.success=!0,i.ref=o(n),r(i));else if(P[t].expressInstall&&u()){var l={};l.data=P[t].expressInstall,l.width=s.getAttribute("width")||"0",l.height=s.getAttribute("height")||"0",s.getAttribute("class")&&(l.styleclass=s.getAttribute("class")),s.getAttribute("align")&&(l.align=s.getAttribute("align"));var c={},h=s.getElementsByTagName("param"),p=h.length;for(var d=0;d<p;d++)h[d].getAttribute("name").toLowerCase()!="movie"&&(c[h[d].getAttribute("name")]=h[d].getAttribute("value"));a(l,c,n,r)}else f(s),r&&r(i)}else{w(n,!0);if(r){var m=o(n);m&&typeof m.SetVariable!=S&&(i.success=!0,i.ref=m),r(i)}}}}function o(e){var t=null,n=v(e);if(n&&n.nodeName=="OBJECT")if(typeof n.SetVariable!=S)t=n;else{var r=n.getElementsByTagName(x)[0];r&&(t=r)}return t}function u(){return!U&&y("6.0.65")&&(V.win||V.mac)&&!(V.wk&&V.wk<312)}function a(e,t,n,r){U=!0,I=r||null,q={success:!1,id:n};var i=v(n);if(i){i.nodeName=="OBJECT"?(j=l(i),F=null):(j=i,F=n),e.id=k;if(typeof e.width==S||!/%$/.test(e.width)&&parseInt(e.width,10)<310)e.width="310";if(typeof e.height==S||!/%$/.test(e.height)&&parseInt(e.height,10)<137)e.height="137";O.title=O.title.slice(0,47)+" - Flash Player Installation";var s=V.ie&&V.win?["Active"].concat("").join("X"):"PlugIn",o="MMredirectURL="+A.location.toString().replace(/&/g,"%26")+"&MMplayerType="+s+"&MMdoctitle="+O.title;typeof t.flashvars!=S?t.flashvars+="&"+o:t.flashvars=o;if(V.ie&&V.win&&i.readyState!=4){var u=m("div");n+="SWFObjectNew",u.setAttribute("id",n),i.parentNode.insertBefore(u,i),i.style.display="none",function(){i.readyState==4?i.parentNode.removeChild(i):setTimeout(arguments.callee,10)}()}c(e,t,n)}}function f(e){if(V.ie&&V.win&&e.readyState!=4){var t=m("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(l(e),t),e.style.display="none",function(){e.readyState==4?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(l(e),e)}function l(e){var t=m("div");if(V.win&&V.ie)t.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(x)[0];if(n){var r=n.childNodes;if(r){var i=r.length;for(var s=0;s<i;s++)(r[s].nodeType!=1||r[s].nodeName!="PARAM")&&r[s].nodeType!=8&&t.appendChild(r[s].cloneNode(!0))}}}return t}function c(e,t,n){var r,i=v(n);if(V.wk&&V.wk<312)return r;if(i){typeof e.id==S&&(e.id=n);if(V.ie&&V.win){var s="";for(var o in e)e[o]!=Object.prototype[o]&&(o.toLowerCase()=="data"?t.movie=e[o]:o.toLowerCase()=="styleclass"?s+=' class="'+e[o]+'"':o.toLowerCase()!="classid"&&(s+=" "+o+'="'+e[o]+'"'));var u="";for(var a in t)t[a]!=Object.prototype[a]&&(u+='<param name="'+a+'" value="'+t[a]+'" />');i.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+s+">"+u+"</object>",H[H.length]=e.id,r=v(e.id)}else{var f=m(x);f.setAttribute("type",C);for(var l in e)e[l]!=Object.prototype[l]&&(l.toLowerCase()=="styleclass"?f.setAttribute("class",e[l]):l.toLowerCase()!="classid"&&f.setAttribute(l,e[l]));for(var c in t)t[c]!=Object.prototype[c]&&c.toLowerCase()!="movie"&&h(f,c,t[c]);i.parentNode.replaceChild(f,i),r=f}}return r}function h(e,t,n){var r=m("param");r.setAttribute("name",t),r.setAttribute("value",n),e.appendChild(r)}function p(e){var t=v(e);t&&t.nodeName=="OBJECT"&&(V.ie&&V.win?(t.style.display="none",function(){t.readyState==4?d(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function d(e){var t=v(e);if(t){for(var n in t)typeof t[n]=="function"&&(t[n]=null);t.parentNode.removeChild(t)}}function v(e){var t=null;try{t=O.getElementById(e)}catch(n){}return t}function m(e){return O.createElement(e)}function g(e,t,n){e.attachEvent(t,n),B[B.length]=[e,t,n]}function y(e){var t=V.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function b(e,t,n,r){if(V.ie&&V.mac)return;var i=O.getElementsByTagName("head")[0];if(!i)return;var s=n&&typeof n=="string"?n:"screen";r&&(z=null,W=null);if(!z||W!=s){var o=m("style");o.setAttribute("type","text/css"),o.setAttribute("media",s),z=i.appendChild(o),V.ie&&V.win&&typeof O.styleSheets!=S&&O.styleSheets.length>0&&(z=O.styleSheets[O.styleSheets.length-1]),W=s}V.ie&&V.win?z&&typeof z.addRule==x&&z.addRule(e,t):z&&typeof O.createTextNode!=S&&z.appendChild(O.createTextNode(e+" {"+t+"}"))}function w(e,t){if(!X)return;var n=t?"visible":"hidden";R&&v(e)?v(e).style.visibility=n:b("#"+e,"visibility:"+n)}function E(e){var t=/[\\\"<>\.;]/,n=t.exec(e)!=null;return n&&typeof encodeURIComponent!=S?encodeURIComponent(e):e}var S="undefined",x="object",T="Shockwave Flash",N="ShockwaveFlash.ShockwaveFlash",C="application/x-shockwave-flash",k="SWFObjectExprInst",L="onreadystatechange",A=window,O=document,M=navigator,_=!1,D=[r],P=[],H=[],B=[],j,F,I,q,R=!1,U=!1,z,W,X=!0,V=function(){var e=typeof O.getElementById!=S&&typeof O.getElementsByTagName!=S&&typeof O.createElement!=S,t=M.userAgent.toLowerCase(),n=M.platform.toLowerCase(),r=n?/win/.test(n):/win/.test(t),i=n?/mac/.test(n):/mac/.test(t),s=/webkit/.test(t)?parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,o=!1,u=[0,0,0],a=null;if(typeof M.plugins!=S&&typeof M.plugins[T]==x)a=M.plugins[T].description,a&&(typeof M.mimeTypes==S||!M.mimeTypes[C]||!!M.mimeTypes[C].enabledPlugin)&&(_=!0,o=!1,a=a.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),u[0]=parseInt(a.replace(/^(.*)\..*$/,"$1"),10),u[1]=parseInt(a.replace(/^.*\.(.*)\s.*$/,"$1"),10),u[2]=/[a-zA-Z]/.test(a)?parseInt(a.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof A[["Active"].concat("Object").join("X")]!=S)try{var f=new(window[["Active"].concat("Object").join("X")])(N);f&&(a=f.GetVariable("$version"),a&&(o=!0,a=a.split(" ")[1].split(","),u=[parseInt(a[0],10),parseInt(a[1],10),parseInt(a[2],10)]))}catch(l){}return{w3:e,pv:u,wk:s,ie:o,win:r,mac:i}}(),$=function(){if(!V.w3)return;(typeof O.readyState!=S&&O.readyState=="complete"||typeof O.readyState==S&&(O.getElementsByTagName("body")[0]||O.body))&&e(),R||(typeof O.addEventListener!=S&&O.addEventListener("DOMContentLoaded",e,!1),V.ie&&V.win&&(O.attachEvent(L,function(){O.readyState=="complete"&&(O.detachEvent(L,arguments.callee),e())}),A==top&&function(){if(R)return;try{O.documentElement.doScroll("left")}catch(t){setTimeout(arguments.callee,0);return}e()}()),V.wk&&function(){if(R)return;if(!/loaded|complete/.test(O.readyState)){setTimeout(arguments.callee,0);return}e()}(),n(e))}(),J=function(){V.ie&&V.win&&window.attachEvent("onunload",function(){var e=B.length;for(var t=0;t<e;t++)B[t][0].detachEvent(B[t][1],B[t][2]);var n=H.length;for(var r=0;r<n;r++)p(H[r]);for(var i in V)V[i]=null;V=null;for(var s in swfobject)swfobject[s]=null;swfobject=null})}();return{registerObject:function(e,t,n,r){if(V.w3&&e&&t){var i={};i.id=e,i.swfVersion=t,i.expressInstall=n,i.callbackFn=r,P[P.length]=i,w(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){if(V.w3)return o(e)},embedSWF:function(e,n,r,i,s,o,f,l,h,p){var d={success:!1,id:n};V.w3&&!(V.wk&&V.wk<312)&&e&&n&&r&&i&&s?(w(n,!1),t(function(){r+="",i+="";var t={};if(h&&typeof h===x)for(var v in h)t[v]=h[v];t.data=e,t.width=r,t.height=i;var m={};if(l&&typeof l===x)for(var g in l)m[g]=l[g];if(f&&typeof f===x)for(var b in f)typeof m.flashvars!=S?m.flashvars+="&"+b+"="+f[b]:m.flashvars=b+"="+f[b];if(y(s)){var E=c(t,m,n);t.id==n&&w(n,!0),d.success=!0,d.ref=E}else{if(o&&u()){t.data=o,a(t,m,n,p);return}w(n,!0)}p&&p(d)})):p&&p(d)},switchOffAutoHideShow:function(){X=!1},ua:V,getFlashPlayerVersion:function(){return{major:V.pv[0],minor:V.pv[1],release:V.pv[2]}},hasFlashPlayerVersion:y,createSWF:function(e,t,n){return V.w3?c(e,t,n):undefined},showExpressInstall:function(e,t,n,r){V.w3&&u()&&a(e,t,n,r)},removeSWF:function(e){V.w3&&p(e)},createCSS:function(e,t,n,r){V.w3&&b(e,t,n,r)},addDomLoadEvent:t,addLoadEvent:n,getQueryParamValue:function(e){var t=O.location.search||O.location.hash;if(t){/\?/.test(t)&&(t=t.split("?")[1]);if(e==null)return E(t);var n=t.split("&");for(var r=0;r<n.length;r++)if(n[r].substring(0,n[r].indexOf("="))==e)return E(n[r].substring(n[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(U){var e=v(k);e&&j&&(e.parentNode.replaceChild(j,e),F&&(w(F,!0),V.ie&&V.win&&(j.style.display="block")),I&&I(q)),U=!1}}}}();(function(){if("undefined"==typeof window||window.WebSocket)return;var e=window.console;if(!e||!e.log||!e.error)e={log:function(){},error:function(){}};if(!swfobject.hasFlashPlayerVersion("10.0.0")){e.error("Flash Player >= 10.0.0 is required.");return}location.protocol=="file:"&&e.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(e,t,n,r,i){var s=this;s.__id=WebSocket.__nextId++,WebSocket.__instances[s.__id]=s,s.readyState=WebSocket.CONNECTING,s.bufferedAmount=0,s.__events={},t?typeof t=="string"&&(t=[t]):t=[],setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(s.__id,e,t,n||null,r||0,i||null)})},0)},WebSocket.prototype.send=function(e){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";var t=WebSocket.__flash.send(this.__id,encodeURIComponent(e));return t<0?!0:(this.bufferedAmount+=t,!1)},WebSocket.prototype.close=function(){if(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING)return;this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id)},WebSocket.prototype.addEventListener=function(e,t,n){e in this.__events||(this.__events[e]=[]),this.__events[e].push(t)},WebSocket.prototype.removeEventListener=function(e,t,n){if(!(e in this.__events))return;var r=this.__events[e];for(var i=r.length-1;i>=0;--i)if(r[i]===t){r.splice(i,1);break}},WebSocket.prototype.dispatchEvent=function(e){var t=this.__events[e.type]||[];for(var n=0;n<t.length;++n)t[n](e);var r=this["on"+e.type];r&&r(e)},WebSocket.prototype.__handleEvent=function(e){"readyState"in e&&(this.readyState=e.readyState),"protocol"in e&&(this.protocol=e.protocol);var t;if(e.type=="open"||e.type=="error")t=this.__createSimpleEvent(e.type);else if(e.type=="close")t=this.__createSimpleEvent("close");else{if(e.type!="message")throw"unknown event type: "+e.type;var n=decodeURIComponent(e.message);t=this.__createMessageEvent("message",n)}this.dispatchEvent(t)},WebSocket.prototype.__createSimpleEvent=function(e){if(document.createEvent&&window.Event){var t=document.createEvent("Event");return t.initEvent(e,!1,!1),t}return{type:e,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(e,t){if(document.createEvent&&window.MessageEvent&&!window.opera){var n=document.createEvent("MessageEvent");return n.initMessageEvent("message",!1,!1,t,null,null,window,null),n}return{type:e,data:t,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(e){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(e)})},WebSocket.__initialize=function(){if(WebSocket.__flash)return;WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation);if(!window.WEB_SOCKET_SWF_LOCATION){e.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");return}var t=document.createElement("div");t.id="webSocketContainer",t.style.position="absolute",WebSocket.__isFlashLite()?(t.style.left="0px",t.style.top="0px"):(t.style.left="-100px",t.style.top="-100px");var n=document.createElement("div");n.id="webSocketFlash",t.appendChild(n),document.body.appendChild(t),swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(t){t.success||e.error("[WebSocket] swfobject.embedSWF failed")})},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var e=0;e<WebSocket.__tasks.length;++e)WebSocket.__tasks[e]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){try{var t=WebSocket.__flash.receiveEvents();for(var n=0;n<t.length;++n)WebSocket.__instances[t[n].webSocketId].__handleEvent(t[n])}catch(r){e.error(r)}},0),!0},WebSocket.__log=function(t){e.log(decodeURIComponent(t))},WebSocket.__error=function(t){e.error(decodeURIComponent(t))},WebSocket.__addTask=function(e){WebSocket.__flash?e():WebSocket.__tasks.push(e)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var e=window.navigator.mimeTypes["application/x-shockwave-flash"];return!e||!e.enabledPlugin||!e.enabledPlugin.filename?!1:e.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()}))})(),function(e,t,n){function r(e){if(!e)return;t.Transport.apply(this,arguments),this.sendBuffer=[]}function i(){}e.XHR=r,t.util.inherit(r,t.Transport),r.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},r.prototype.payload=function(e){var n=[];for(var r=0,i=e.length;r<i;r++)n.push(t.parser.encodePacket(e[r]));this.send(t.parser.encodePayload(n))},r.prototype.send=function(e){return this.post(e),this},r.prototype.post=function(e){function t(){this.readyState==4&&(this.onreadystatechange=i,s.posting=!1,this.status==200?s.socket.setBuffer(!1):s.onClose())}function r(){this.onload=i,s.socket.setBuffer(!1)}var s=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=r:this.sendXHR.onreadystatechange=t,this.sendXHR.send(e)},r.prototype.close=function(){return this.onClose(),this},r.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),r=t.util.query(this.socket.options.query,"t="+ +(new Date));n.open(e||"GET",this.prepareUrl()+r,!0);if(e=="POST")try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(i){}return n},r.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},r.check=function(e,r){try{var i=t.util.request(r),s=n.XDomainRequest&&i instanceof XDomainRequest,o=e&&e.options&&e.options.secure?"https:":"http:",u=o!=n.location.protocol;if(i&&(!s||!u))return!0}catch(a){}return!1},r.xdomainCheck=function(e){return r.check(e,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(e){t.Transport.XHR.apply(this,arguments)}e.htmlfile=n,t.util.inherit(n,t.Transport.XHR),n.prototype.name="htmlfile",n.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var e=this.doc.createElement("div");e.className="socketio",this.doc.body.appendChild(e),this.iframe=this.doc.createElement("iframe"),e.appendChild(this.iframe);var n=this,r=t.util.query(this.socket.options.query,"t="+ +(new Date));this.iframe.src=this.prepareUrl()+r,t.util.on(window,"unload",function(){n.destroy()})},n.prototype._=function(e,t){this.onData(e);try{var n=t.getElementsByTagName("script")[0];n.parentNode.removeChild(n)}catch(r){}},n.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(e){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},n.prototype.close=function(){return this.destroy(),t.Transport.XHR.prototype.close.call(this)},n.check=function(e){if(typeof window!="undefined"&&["Active"].concat("Object").join("X")in window)try{var n=new(window[["Active"].concat("Object").join("X")])("htmlfile");return n&&t.Transport.XHR.check(e)}catch(r){}return!1},n.xdomainCheck=function(){return!1},t.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function r(){t.Transport.XHR.apply(this,arguments)}function i(){}e["xhr-polling"]=r,t.util.inherit(r,t.Transport.XHR),t.util.merge(r,t.Transport.XHR),r.prototype.name="xhr-polling",r.prototype.heartbeats=function(){return!1},r.prototype.open=function(){var e=this;return t.Transport.XHR.prototype.open.call(e),!1},r.prototype.get=function(){function e(){this.readyState==4&&(this.onreadystatechange=i,this.status==200?(s.onData(this.responseText),s.get()):s.onClose())}function t(){this.onload=i,this.onerror=i,s.onData(this.responseText),s.get()}function r(){s.onClose()}if(!this.isOpen)return;var s=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=t,this.xhr.onerror=r):this.xhr.onreadystatechange=e,this.xhr.send(null)},r.prototype.onClose=function(){t.Transport.XHR.prototype.onClose.call(this);if(this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(e){}this.xhr=null}},r.prototype.ready=function(e,n){var r=this;t.util.defer(function(){n.call(r)})},t.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t,n){function r(e){t.Transport["xhr-polling"].apply(this,arguments),this.index=t.j.length;var n=this;t.j.push(function(e){n._(e)})}var i=n.document&&"MozAppearance"in n.document.documentElement.style;e["jsonp-polling"]=r,t.util.inherit(r,t.Transport["xhr-polling"]),r.prototype.name="jsonp-polling",r.prototype.post=function(e){function n(){r(),i.socket.setBuffer(!1)}function r(){i.iframe&&i.form.removeChild(i.iframe);try{f=document.createElement('<iframe name="'+i.iframeId+'">')}catch(e){f=document.createElement("iframe"),f.name=i.iframeId}f.id=i.iframeId,i.form.appendChild(f),i.iframe=f}var i=this,s=t.util.query(this.socket.options.query,"t="+ +(new Date)+"&i="+this.index);if(!this.form){var o=document.createElement("form"),u=document.createElement("textarea"),a=this.iframeId="socketio_iframe_"+this.index,f;o.className="socketio",o.style.position="absolute",o.style.top="0px",o.style.left="0px",o.style.display="none",o.target=a,o.method="POST",o.setAttribute("accept-charset","utf-8"),u.name="d",o.appendChild(u),document.body.appendChild(o),this.form=o,this.area=u}this.form.action=this.prepareUrl()+s,r(),this.area.value=t.JSON.stringify(e);try{this.form.submit()}catch(l){}this.iframe.attachEvent?f.onreadystatechange=function(){i.iframe.readyState=="complete"&&n()}:this.iframe.onload=n,this.socket.setBuffer(!0)},r.prototype.get=function(){var e=this,n=document.createElement("script"),r=t.util.query(this.socket.options.query,"t="+ +(new Date)+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),n.async=!0,n.src=this.prepareUrl()+r,n.onerror=function(){e.onClose()};var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(n,s),this.script=n,i&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},r.prototype._=function(e){return this.onData(e),this.isOpen&&this.get(),this},r.prototype.ready=function(e,n){var r=this;if(!i)return n.call(this);t.util.load(function(){n.call(r)})},r.check=function(){return"document"in n},r.xdomainCheck=function(){return!0},t.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this)})(),define("lib/socket.io.min",function(){}),define("CouchDBSecurity",["CouchDBStore"],function(t){function n(){var e="_security";this.setName=function(n){return n?(e=n,!0):!1},this.getName=function(){return e},this.load=function(n){return this.sync(n,e)}}return function(){return n.prototype=new t,new n}}),define("CouchDBStore",["Store","StateMachine","Tools","Promise"],function(t,n,r,i){function s(){var e="CouchDB",t=null,s={},o=new i,u={getView:function(){s.query=s.query||{},t.request(e,{method:"GET",path:"/"+s.database+"/_design/"+s.design+"/"+s.view,query:s.query},function(e){var t=JSON.parse(e);if(!t.rows)throw new Error("CouchDBStore ["+s.database+", "+s.design+", "+s.view+"].sync() failed: "+e);this.reset(t.rows),typeof t.total_rows=="undefined"&&this.setReducedViewInfo(!0),f.event("subscribeToViewChanges")},this)},getDocument:function(){t.request(e,{method:"GET",path:"/"+s.database+"/"+s.document,query:s.query},function(e){var t=JSON.parse(e);t._id?(this.reset(t),f.event("subscribeToDocumentChanges")):o.reject(e)},this)},getBulkDocuments:function(){var n={path:"/"+s.database+"/_all_docs",query:s.query},r;s.keys instanceof Array?(n.method="POST",n.data=JSON.stringify({keys:s.keys}),n.headers={"Content-Type":"application/json"},r=n.data):(n.method="GET",r=JSON.stringify(s.query)),s.query.include_docs=!0,t.request(e,n,function(e){var t=JSON.parse(e);if(!t.rows)throw new Error('CouchDBStore.sync("'+s.database+'", '+r+") failed: "+e);this.reset(t.rows),f.event("subscribeToBulkChanges")},this)},createDocument:function(n){t.request(e,{method:"PUT",path:"/"+s.database+"/"+s.document,headers:{"Content-Type":"application/json"},data:this.toJSON()},function(e){var t=JSON.parse(e);t.ok?f.event("subscribeToDocumentChanges"):n.reject(t)})},subscribeToViewChanges:function(){r.mixin({feed:"continuous",heartbeat:1e4,descending:!0},s.query),this.stopListening=t.listen(e,{path:"/"+s.database+"/_changes",query:s.query},function(e){if(e=="\n")return!1;var t=JSON.parse(e),n;s.reducedView?n="updateReduced":t.deleted?n="delete":t.changes&&t.changes[0].rev.search("1-")==0?n="add":n="change",f.event(n,t.id)},this)},subscribeToDocumentChanges:function(){this.stopListening=t.listen(e,{path:"/"+s.database+"/_changes",query:{feed:"continuous",heartbeat:1e4,descending:!0}},function(e){var t;if(e=="\n")return!1;t=JSON.parse(e),t.id==s.document&&t.changes.pop().rev!=this.get("_rev")&&(t.deleted?f.event("deleteDoc"):f.event("updateDoc"))},this)},subscribeToBulkChanges:function(){r.mixin({feed:"continuous",heartbeat:1e4,descending:!0,include_docs:!0},s.query),this.stopListening=t.listen(e,{path:"/"+s.database+"/_changes",query:s.query},function(e){var t;if(e=="\n")return!1;var t=JSON.parse(e),n;t.changes[0].rev.search("1-")==0?n="bulkAdd":t.deleted?n="delete":n="bulkChange",f.event(n,t.id,t.doc)},this)},updateDocInStore:function(n){t.request(e,{method:"GET",path:"/"+s.database+"/_design/"+s.design+"/"+s.view,query:s.query},function(e){var t=JSON.parse(e);t.rows.length==this.getNbItems()?t.rows.some(function(e,t){e.id==n&&this.set(t,e)},this):this.actions.evenDocsInStore.call(this,t.rows,n)},this)},evenDocsInStore:function(e,t){var n=this.getNbItems();e.length<n?this.loop(function(e,n){e.id==t&&this.del(n)},this):e.length>n&&e.some(function(e,n){if(e.id==t)return this.alter("splice",n,0,e)},this)},addBulkDocInStore:function(n){if(!s.query.startkey&&!s.query.endkey)return!1;s.query.include_docs=!0,s.query.update_seq=!0,t.request(e,{method:"GET",path:"/"+s.database+"/_all_docs",query:s.query},function(e){var t=JSON.parse(e);t.rows.forEach(function(e,t){e.id==n&&this.alter("splice",t,0,e.doc)},this)},this)},updateBulkDocInStore:function(e,t){this.loop(function(n,r){n.id==e&&this.set(r,t)},this)},removeDocInStore:function(e){this.loop(function(t,n){t.id==e&&this.del(n)},this)},addDocInStore:function(n){t.request(e,{method:"GET",path:"/"+s.database+"/_design/"+s.design+"/"+s.view,query:s.query},function(e){var t=JSON.parse(e);t.rows.some(function(e,t){e.id==n&&this.alter("splice",t,0,e)},this)},this)},updateReduced:function(){t.request(e,{method:"GET",path:"/"+s.database+"/_design/"+s.design+"/"+s.view,query:s.query},function(e){var t=JSON.parse(e);this.set(0,t.rows[0])},this)},updateDoc:function(){t.request(e,{method:"GET",path:"/"+s.database+"/"+s.document},function(e){this.reset(JSON.parse(e))},this)},deleteDoc:function(){this.reset({})},updateDatabase:function(n){t.request(e,{method:"PUT",path:"/"+s.database+"/"+s.document,headers:{"Content-Type":"application/json"},data:this.toJSON()},function(e){var t=JSON.parse(e);t.ok?(this.set("_rev",t.rev),n.resolve(t)):(console.log("DOCUMENT UPLOAD FAILED",this.toJSON()),n.reject(t))},this)},updateDatabaseWithBulkDoc:function(n){var r=[];this.loop(function(e){r.push(e.doc)}),t.request(e,{method:"POST",path:"/"+s.database+"/_bulk_docs",headers:{"Content-Type":"application/json"},data:JSON.stringify({docs:r})},function(e){n.resolve(JSON.parse(e))})},removeFromDatabase:function(){t.request(e,{method:"DELETE",path:"/"+s.database+"/"+s.document,query:{rev:this.get("_rev")}})},unsync:function(){this.stopListening(),delete this.stopListening}},f=new n("Unsynched",{Unsynched:[["getView",u.getView,this,"Synched"],["getDocument",u.getDocument,this,"Synched"],["getBulkDocuments",u.getBulkDocuments,this,"Synched"]],Synched:[["updateDatabase",u.createDocument,this],["subscribeToViewChanges",u.subscribeToViewChanges,this,"Listening"],["subscribeToDocumentChanges",u.subscribeToDocumentChanges,this,"Listening"],["subscribeToBulkChanges",u.subscribeToBulkChanges,this,"Listening"],["unsync",function(){},"Unsynched"]],Listening:[["entry",function(){o.resolve(this)}],["change",u.updateDocInStore,this],["bulkAdd",u.addBulkDocInStore,this],["bulkChange",u.updateBulkDocInStore,this],["delete",u.removeDocInStore,this],["add",u.addDocInStore,this],["updateReduced",u.updateReduced,this],["updateDoc",u.updateDoc,this],["deleteDoc",u.deleteDoc,this],["updateDatabase",u.updateDatabase,this],["updateDatabaseWithBulkDoc",u.updateDatabaseWithBulkDoc,this],["removeFromDatabase",u.removeFromDatabase,this],["unsync",u.unsync,this,"Unsynched"]]});this.sync=function(){return o=new i,typeof arguments[0]=="string"&&typeof arguments[1]=="string"&&typeof arguments[2]=="string"?(this.setSyncInfo(arguments[0],arguments[1],arguments[2],arguments[3]),f.event("getView"),o):typeof arguments[0]=="string"&&typeof arguments[1]=="string"&&typeof arguments[2]!="string"?(this.setSyncInfo(arguments[0],arguments[1],arguments[2]),f.event("getDocument"),o):typeof arguments[0]=="string"&&arguments[1]instanceof Object?(this.setSyncInfo(arguments[0],arguments[1]),f.event("getBulkDocuments"),o):!1},this.setSyncInfo=function(){return this.clearSyncInfo(),typeof arguments[0]=="string"&&typeof arguments[1]=="string"&&typeof arguments[2]=="string"?(s.database=arguments[0],s.design=arguments[1],s.view=arguments[2],s.query=arguments[3],!0):typeof arguments[0]=="string"&&typeof arguments[1]=="string"&&typeof arguments[2]!="string"?(s.database=arguments[0],s.document=arguments[1],s.query=arguments[2],!0):typeof arguments[0]=="string"&&arguments[1]instanceof Object?(s.database=arguments[0],s.query=arguments[1],s.query.keys instanceof Array&&(s.keys=s.query.keys,delete s.query.keys),!0):!1},this.clearSyncInfo=function(){return s={},!0},this.setReducedViewInfo=function(t){return typeof t=="boolean"?(s.reducedView=t,!0):!1},this.getSyncInfo=function(){return s},this.unsync=function(){return f.event("unsync")},this.upload=function(){var t=new i;return s.document?(f.event("updateDatabase",t),t):s.view?!1:(f.event("updateDatabaseWithBulkDoc",t),t)},this.remove=function(){return s.document?f.event("removeFromDatabase"):!1},this.setTransport=function(n){return n&&typeof n.listen=="function"&&typeof n.request=="function"?(t=n,!0):!1},this.getStateMachine=function(){return f},this.getTransport=function(){return t},this.actions=u}return function(n){return s.prototype=new t(n),new s}}),define("CouchDBUser",["CouchDBStore","Promise"],function(t,n){function r(){var e="_users",t="org.couchdb.user:";this.getUserDB=function(){return e},this.setUserDB=function(n){return n?(e=n,!0):!1},this.getIdPrefix=function(){return t},this.setIdPrefix=function(n){return n?(t=n,!0):!1},this.setId=function(n){return n?(this.set("_id",t+n),!0):!1},this.getId=function(){return this.get("_id")},this.load=function(r){return this.sync(e,t+r)},this.login=function(){var t=new n,r=this.get("name"),i=this.get("password");return r&&typeof r=="string"&&typeof i=="string"?this.getTransport().request("CouchDB",{method:"GET",path:"/_users/org.couchdb.user:"+r,auth:r+":"+i},t.resolve,t):t.reject({error:"name & password must be strings"}),t},this.create=function(){var t=new n;return this.get("type")||this.set("type","user"),this.get("roles")||this.set("roles",[]),this.load(this.get("name")).then(function(){t.reject({error:"Failed to create user. The user already exists"})},function(){this.upload().then(function(e){t.resolve(e)},function(e){t.reject(e)})},this),t}}return function(){return r.prototype=new t,new r}}),define("lib/couchdbtools.min",function(){}),define("Observable",["Tools"],function(e){return function(){var t={};this.watch=function(e,n,r){if(typeof n=="function"){var i=t[e]=t[e]||[],n=[n,r];return i.push(n),[e,i.indexOf(n)]}return!1},this.unwatch=function(e){var n=e[0],e=e[1];return t[n]&&t[n][e]?(delete t[n][e],t[n].some(function(e){return!!e})||delete t[n],!0):!1},this.notify=function(n){var r=t[n],i=e.toArray(arguments).slice(1);return r?(e.loop(r,function(e){try{e&&e[0].apply(e[1]||null,i)}catch(t){}}),!0):!1},this.hasObserver=function(e){return!(!e||!t[e[0]]||!t[e[0]][e[1]])},this.hasTopic=function(e){return!!t[e]},this.unwatchAll=function(e){return t[e]?delete t[e]:t={},!0}}}),define("Promise",["Observable","StateMachine"],function(e,t){return function(){var n,r,i=new t("Unresolved",{Unresolved:[["resolve",function(e){n=e,s.notify("success",e)},"Resolved"],["reject",function(e){r=e,s.notify("fail",e)},"Rejected"],["addSuccess",function(e,t){s.watch("success",e,t)}],["addFail",function(e,t){s.watch("fail",e,t)}]],Resolved:[["addSuccess",function(e,t){e.call(t,n)}]],Rejected:[["addFail",function(e,t){e.call(t,r)}]]}),s=new e;this.resolve=function(e){return i.event("resolve",e)},this.reject=function(e){return i.event("reject",e)},this.then=function(e,t,n,r){return e instanceof Function&&(t instanceof Function?i.event("addSuccess",e):i.event("addSuccess",e,t)),t instanceof Function&&i.event("addFail",t,n),n instanceof Function&&i.event("addFail",n,r),this},this.getObservable=function(){return s},this.getStateMachine=function(){return i}}}),define("StateMachine",["Tools"],function(e){function t(){var t={};this.add=function(e,n,r,i){var s=[];return t[e]?!1:typeof e=="string"&&typeof n=="function"?(s[0]=n,typeof r=="object"&&(s[1]=r),typeof r=="string"&&(s[2]=r),typeof i=="string"&&(s[2]=i),t[e]=s,!0):!1},this.has=function(e){return!!t[e]},this.get=function(e){return t[e]||!1},this.event=function n(n){var r=t[n];return r?(r[0].apply(r[1],e.toArray(arguments).slice(1)),r[2]):!1}}return function(n,r){var i={},s="";this.init=function(e){return i[e]?(s=e,!0):!1},this.add=function(e){return i[e]?!1:i[e]=new t},this.get=function(e){return i[e]},this.getCurrent=function(){return s},this.event=function(t){var n;return n=i[s].event.apply(i[s].event,e.toArray(arguments)),n===!1?!1:(n&&(i[s].event("exit"),s=n,i[s].event("entry")),!0)},e.loop(r,function(e,t){var n=this.add(t);e.forEach(function(e){n.add.apply(null,e)})},this),this.init(n)}}),define("Store",["Observable","Tools"],function(e,t){return function(n){var r=t.clone(n)||{},i=new e,s=new e,o=function(e){var n=t.objectsDiffs(e,r);["updated","deleted","added"].forEach(function(e){n[e].forEach(function(t){i.notify(e,t,r[t]),s.notify(t,r[t],e)})})};this.getNbItems=function(){return r instanceof Array?r.length:t.count(r)},this.get=function(e){return r[e]},this.has=function(e){return r.hasOwnProperty(e)},this.set=function(e,t){var n;return typeof e!="undefined"?(n=this.has(e),r[e]=t,n=n?"updated":"added",i.notify(n,e,r[e]),s.notify(e,r[e],n),!0):!1},this.update=function(e,n,r){var o;return this.has(e)?(o=this.get(e),t.setNestedProperty(o,n,r),i.notify("updated",n,r),s.notify(e,o,"updated"),!0):!1},this.del=function(e){return this.has(e)?(this.alter("splice",e,1)||(delete r[e],i.notify("deleted",e),s.notify(e,r[e],"deleted")),!0):!1},this.delAll=function(e){return e instanceof Array?(e.sort(t.compareNumbers).reverse().forEach(this.del,this),!0):!1},this.alter=function(e){var n,i;return r[e]?(i=t.clone(r),n=r[e].apply(r,Array.prototype.slice.call(arguments,1)),o(i),n):!1},this.watch=function(e,t,n){return i.watch(e,t,n)},this.unwatch=function(e){return i.unwatch(e)},this.getStoreObservable=function(){return i},this.watchValue=function(e,t,n){return s.watch(e,t,n)},this.unwatchValue=function(e){return s.unwatch(e)},this.getValueObservable=function(){return s},this.loop=function(e,n){t.loop(r,e,n)},this.reset=function(e){if(e instanceof Object){var n=t.clone(r);return r=t.clone(e)||{},o(n),!0}return!1},this.toJSON=function(){return JSON.stringify(r)}}}),define("Tools",[],function(){return{getGlobal:function(){return function(){return this}.call(null)},mixin:function(e,t,n){return this.loop(e,function(r,i){if(!t[i]||!n)t[i]=e[i]}),t},count:function(e){var t=0;return this.loop(e,function(){t++}),t},compareObjects:function(e,t){return Object.getOwnPropertyNames(e).sort().join("")==Object.getOwnPropertyNames(t).sort().join("")},compareNumbers:function(e,t){return e>t?1:e<t?-1:0},toArray:function(e){return Array.prototype.slice.call(e)},loop:function(e,t,n){var r;if(e instanceof Object&&t instanceof Function){if(e instanceof Array)for(r=0;r<e.length;r++)t.call(n,e[r],r,e);else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e);return!0}return!1},objectsDiffs:function(e,t){if(e instanceof Object&&t instanceof Object){var n=[],r=[],i=[],s=[];return this.loop(t,function(t,i){typeof e[i]=="undefined"?s.push(i):t!==e[i]?r.push(i):t===e[i]&&n.push(i)}),this.loop(e,function(e,n){typeof t[n]=="undefined"&&i.push(n)}),{updated:r,unchanged:n,added:s,deleted:i}}return!1},jsonify:function(e){return e instanceof Object?JSON.parse(JSON.stringify(e)):!1},clone:function(e){return e instanceof Array?e.slice(0):typeof e!="object"||e===null||e instanceof RegExp?!1:this.mixin(e,{})},getNestedProperty:function(e,t){return e&&e instanceof Object?typeof t=="string"&&t!=""?t.split(".").reduce(function(e,t){return e&&e[t]},e):typeof t=="number"?e[t]:e:e},setNestedProperty:function(e,t,n){if(e&&e instanceof Object){if(typeof t=="string"&&t!=""){var r=t.split(".");return r.reduce(function(e,t,i){return e[t]=e[t]||{},r.length==i+1&&(e[t]=n),e[t]},e)}return typeof t=="number"?(e[t]=n,e[t]):e}return e}}}),define("Transport",["Store"],function(){return function(e){var t=null;this.setReqHandlers=function(e){return e instanceof Object?(t=e,!0):!1},this.getReqHandlers=function(){return t},this.request=function(e,n,r,i){return t.has(e)&&typeof n!="undefined"?(t.get(e)(n,function(){r&&r.apply(i,arguments)}),!0):!1},this.listen=function(e,n,r,i){if(t.has(e)&&typeof n!="undefined"&&typeof r=="function"){var s=function(){r.apply(i,arguments)},o;return o=t.get(e)(n,s,s),function(){o.func.call(o.scope)}}return!1},this.setReqHandlers(e)}}),define("lib/emily.min",function(){}),define("Olives/DomUtils",function(){return{getNodes:function(e,t){return this.isAcceptedType(e)?(e.parentNode||document.createDocumentFragment().appendChild(e),e.parentNode.querySelectorAll(t||"*")):!1},getDataset:function(e){var t=0,n,r={},i,s;if(this.isAcceptedType(e)){if(e.hasOwnProperty("dataset"))return e.dataset;for(n=e.attributes.length;t<n;t++)i=e.attributes[t].name.split("-"),i.shift()=="data"&&(r[s=i.join("-")]=e.getAttribute("data-"+s));return r}return!1},isAcceptedType:function(e){return e instanceof HTMLElement||e instanceof SVGElement?!0:!1},setAttribute:function(e,t,n){return e instanceof HTMLElement?(e[t]=n,!0):e instanceof SVGElement?(e.setAttribute(t,n),!0):!1}}}),define("Olives/Event-plugin",function(){return function(e){this.listen=function(t,n,r,i){t.addEventListener(n,function(n){e[r].call(e,n,t)},i=="true")}}}),define("Olives/LocalStore",["Store","Tools"],function(e,t){function n(){var e=null,n=localStorage,r=function(){n.setItem(e,this.toJSON())};this.setLocalStorage=function(e){return e&&e.setItem instanceof Function?(n=e,!0):!1},this.getLocalStorage=function(){return n},this.sync=function(i){return typeof i=="string"?(e=i,i=JSON.parse(n.getItem(i)),t.loop(i,function(e,t){this.has(t)||this.set(t,e)},this),r.call(this),this.watch("added",r,this),this.watch("updated",r,this),this.watch("deleted",r,this),!0):!1}}return function(t){return n.prototype=new e(t),new n}}),define("Olives/Model-plugin",["Store","Observable","Tools","Olives/DomUtils"],function(e,t,n,r){return function(t,i){var s=null,o={},u={};this.observers={},this.setModel=function(t){return t instanceof e?(s=t,!0):!1},this.getModel=function(){return s},this.ItemRenderer=function(t,i){var o=null,u=null,a=null,l=null,h=null;this.setRenderer=function(e){return o=e,!0},this.getRenderer=function(){return o},this.setRootNode=function(e){return r.isAcceptedType(e)?(a=e,e=a.querySelector("*"),this.setRenderer(e),e&&a.removeChild(e),!0):!1},this.getRootNode=function(){return a},this.setPlugins=function(e){return u=e,!0},this.getPlugins=function(){return u},this.items=new e([]),this.setStart=function(e){return l=parseInt(e,10)},this.getStart=function(){return l},this.setNb=function(e){return h=e=="*"?e:parseInt(e,10)},this.getNb=function(){return h},this.addItem=function(e){var t;return typeof e=="number"&&!this.items.get(e)?(t=this.create(e))?((e=this.getNextItem(e))?a.insertBefore(t,e):a.appendChild(t),!0):!1:!1},this.getNextItem=function(e){return this.items.alter("slice",e+1).filter(function(e){if(r.isAcceptedType(e))return!0})[0]},this.removeItem=function(e){var t=this.items.get(e);return t?(a.removeChild(t),this.items.set(e),!0):!1},this.create=function(e){if(s.has(e)){var t=o.cloneNode(!0),i=r.getNodes(t);return n.toArray(i).forEach(function(t){t.setAttribute("data-"+u.name+"_id",e)}),this.items.set(e,t),u.apply(t),t}},this.render=function(){var e=h=="*"?s.getNbItems():h,t=[];if(h!==null&&l!==null){this.items.loop(function(n,r){(r<l||r>=l+e||!s.has(r))&&t.push(r)},this),t.sort(n.compareNumbers).reverse().forEach(this.removeItem,this);for(var r=l,i=e+l;r<i;r++)this.addItem(r);return!0}return!1},this.setPlugins(t),this.setRootNode(i)},this.setItemRenderer=function(e,t){u[e||"default"]=t},this.getItemRenderer=function(e){return u[e]},this.foreach=function(e,t,n,r){var i=new this.ItemRenderer(this.plugins,e);i.setStart(n||0),i.setNb(r||"*"),i.render(),s.watch("added",i.render,i),s.watch("deleted",function(e){i.render(),this.observers[e]&&this.observers[e].forEach(function(e){s.unwatchValue(e)},this),delete this.observers[e]},this),this.setItemRenderer(t,i)},this.updateStart=function(e,t){var n=this.getItemRenderer(e);return n?(n.setStart(t),!0):!1},this.updateNb=function(e,t){var n=this.getItemRenderer(e);return n?(n.setNb(t),!0):!1},this.refresh=function(e){return(e=this.getItemRenderer(e))?(e.render(),!0):!1},this.bind=function(e,t,i){var i=i||"",o=e.getAttribute("data-"+this.plugins.name+"_id"),u=i.split("."),a=o||u.shift(),l=o?i:u.join("."),o=n.getNestedProperty(s.get(a),l),c=n.toArray(arguments).slice(3);if(o||o===0||o===!1)this.execBinding.apply(this,[e,t,o].concat(c))||r.setAttribute(e,t,o);this.hasBinding(t)||e.addEventListener("change",function(){s.has(a)&&(l?s.update(a,i,e[t]):s.set(a,e[t]))},!0),this.observers[a]=this.observers[a]||[],this.observers[a].push(s.watchValue(a,function(i){this.execBinding.apply(this,[e,t,n.getNestedProperty(i,l)].concat(c))||r.setAttribute(e,t,n.getNestedProperty(i,l))},this))},this.set=function(e){return r.isAcceptedType(e)&&e.name?(s.set(e.name,e.value),!0):!1},this.form=function a(a){if(a&&a.nodeName=="FORM"){var e=this;return a.addEventListener("submit",function(t){n.toArray(a.querySelectorAll("[name]")).forEach(e.set,e),t.preventDefault()},!0),!0}return!1},this.addBinding=function(e,t){return e&&typeof e=="string"&&typeof t=="function"?(o[e]=t,!0):!1},this.execBinding=function(e,t){return this.hasBinding(t)?(o[t].apply(e,Array.prototype.slice.call(arguments,2)),!0):!1},this.hasBinding=function(e){return o.hasOwnProperty(e)},this.getBinding=function(e){return o[e]},this.addBindings=function(e){return n.loop(e,function(e,t){this.addBinding(t,e)},this)},this.setModel(t),this.addBindings(i)}}),define("Olives/OObject",["StateMachine","Store","Olives/Plugins","Olives/DomUtils","Tools"],function(e,t,n,r,i){return function(s){var o=function(e){var t=a||document.createElement("div");if(!e.template)throw Error("UI.template must be set prior to render");typeof e.template=="string"?t.innerHTML=e.template.trim():r.isAcceptedType(e.template)&&t.appendChild(e.template);if(t.childNodes.length>1)throw Error("UI.template should have only one parent node");e.dom=t.childNodes[0],e.plugins.apply(e.dom)},u=function h(e,h,t){h&&(t?h.insertBefore(e.dom,t):h.appendChild(e.dom),a=h)},a=null,l=new e("Init",{Init:[["render",o,this,"Rendered"],["place",function(e,t){o(e),u.apply(null,i.toArray(arguments))},this,"Rendered"]],Rendered:[["place",u,this],["render",o,this]]});this.model=s instanceof t?s:new t,this.plugins=new n,this.dom=this.template=null,this.place=function(e,t){l.event("place",this,e,t)},this.render=function(){l.event("render",this)},this.setTemplateFromDom=function(e){return r.isAcceptedType(e)?(this.template=e,!0):!1},this.alive=function(e){return r.isAcceptedType(e)?(this.setTemplateFromDom(e),this.place(e.parentNode,e.nextElementSibling),!0):!1},this.getCurrentPlace=function(){return a}}}),define("Olives/Plugins",["Tools","Olives/DomUtils"],function(e,t){return function(){var n={},r=function(e){return e.trim()},i=function(e,t,i){t.split(";").forEach(function(t){var s=t.split(":"),t=s[0].trim(),s=s[1]?s[1].split(",").map(r):[];s.unshift(e),n[i]&&n[i][t]&&n[i][t].apply(n[i],s)})};this.add=function(e,t){var r=this;return typeof e=="string"&&typeof t=="object"&&t?(n[e]=t,t.plugins={name:e,apply:function(){return r.apply.apply(r,arguments)}},!0):!1},this.addAll=function(t){return e.loop(t,function(e,t){this.add(t,e)},this)},this.get=function(e){return n[e]},this.del=function(e){return delete n[e]},this.apply=function(n){var r;return t.isAcceptedType(n)?(r=t.getNodes(n),e.loop(e.toArray(r),function(n){e.loop(t.getDataset(n),function(e,t){i(n,e,t)})}),n):!1}}}),define("Olives/Transport",["Observable","Tools"],function(e){return function(t,n){var r=null,i=null;new e,this.setIO=function(e){return e&&typeof e.connect=="function"?(i=e,!0):!1},this.getIO=function(){return i},this.connect=function(e){return typeof e=="string"?(r=i.connect(e),!0):!1},this.getSocket=function(){return r},this.on=function(e,t){return r.on(e,t)},this.once=function(e,t){return r.once(e,t)},this.emit=function(e,t,n){return r.emit(e,t,n)},this.removeListener=function(e,t,n){return r.removeListener(e,t,n)},this.request=function(e,t,n,r){return typeof e=="string"&&typeof t!="undefined"?(t={eventId:Date.now()+Math.floor(Math.random()*1e6),data:t},this.once(t.eventId,function(){n&&n.apply(r||null,arguments)}),this.emit(e,t),!0):!1},this.listen=function(e,t,n,r){if(typeof e=="string"&&typeof t!="undefined"&&typeof n=="function"){var i={eventId:Date.now()+Math.floor(Math.random()*1e6),data:t,keepAlive:!0},s=function(){n&&n.apply(r||null,arguments)},o=this;return this.on(i.eventId,s),this.emit(e,i),function(){o.emit("disconnect-"+i.eventId),o.removeListener(i.eventId,s)}}return!1},this.setIO(t),this.connect(n)}}),define("Olives/UI-plugin",["Olives/OObject","Tools"],function(e,t){return function(n){var r={};this.place=function(t,n){if(!(r[n]instanceof e))throw Error(n+" is not an OObject UI in place:"+n);r[n].place(t)},this.set=function(t,n){return typeof t=="string"&&n instanceof e?(r[t]=n,!0):!1},this.setAll=function(e){t.loop(e,function(e,t){this.set(t,e)},this)},this.get=function(e){return r[e]},this.setAll(n)}}),define("Olives/DomUtils",function(){return{getNodes:function(t,n){return this.isAcceptedType(t)?(t.parentNode||document.createDocumentFragment().appendChild(t),t.parentNode.querySelectorAll(n||"*")):!1},getDataset:function(t){var n=0,r,i={},s,o;if(this.isAcceptedType(t)){if(t.hasOwnProperty("dataset"))return t.dataset;for(r=t.attributes.length;n<r;n++)s=t.attributes[n].name.split("-"),s.shift()=="data"&&(i[o=s.join("-")]=t.getAttribute("data-"+o));return i}return!1},isAcceptedType:function(t){return t instanceof HTMLElement||t instanceof SVGElement?!0:!1},setAttribute:function(t,n,r){return t instanceof HTMLElement?(t[n]=r,!0):t instanceof SVGElement?(t.setAttribute(n,r),!0):!1}}}),define("Olives/Event-plugin",function(){return function(t){this.listen=function(e,n,r,i){e.addEventListener(n,function(n){t[r].call(t,n,e)},i=="true")}}}),define("Olives/LocalStore",["Store","Tools"],function(t,n){function r(){var e=null,t=localStorage,r=function(){t.setItem(e,this.toJSON())};this.setLocalStorage=function(n){return n&&n.setItem instanceof Function?(t=n,!0):!1},this.getLocalStorage=function(){return t},this.sync=function(s){var o;return typeof s=="string"?(e=s,o=JSON.parse(t.getItem(s)),n.loop(o,function(e,t){this.has(t)||this.set(t,e)},this),r.call(this),this.watch("added",r,this),this.watch("updated",r,this),this.watch("deleted",r,this),!0):!1}}return function(n){return r.prototype=new t(n),new r}}),define("Olives/Model-plugin",["Store","Observable","Tools","Olives/DomUtils"],function(t,n,r,s){return function(n,o){var u=null,f={},c={};this.observers={},this.setModel=function(n){return n instanceof t?(u=n,!0):!1},this.getModel=function(){return u},this.ItemRenderer=function(n,o){var f=null,c=null,h=null,p=null,m=null;this.setRenderer=function(t){return f=t,!0},this.getRenderer=function(){return f},this.setRootNode=function(t){var n;return s.isAcceptedType(t)?(h=t,n=h.querySelector("*"),this.setRenderer(n),n&&h.removeChild(n),!0):!1},this.getRootNode=function(){return h},this.setPlugins=function(t){return c=t,!0},this.getPlugins=function(){return c},this.items=new t([]),this.setStart=function(t){return p=parseInt(t,10),p},this.getStart=function(){return p},this.setNb=function(t){return m=t=="*"?t:parseInt(t,10),m},this.getNb=function(){return m},this.addItem=function(t){var n,r;return typeof t=="number"&&!this.items.get(t)?(n=this.create(t),n?(r=this.getNextItem(t),r?h.insertBefore(n,r):h.appendChild(n),!0):!1):!1},this.getNextItem=function(t){return this.items.alter("slice",t+1).filter(function(e){if(s.isAcceptedType(e))return!0})[0]},this.removeItem=function(t){var n=this.items.get(t);return n?(h.removeChild(n),this.items.set(t),!0):!1},this.create=function(t){if(u.has(t)){var n=f.cloneNode(!0),i=s.getNodes(n);return r.toArray(i).forEach(function(e){e.setAttribute("data-"+c.name+"_id",t)}),this.items.set(t,n),c.apply(n),n}},this.render=function(){var t=m=="*"?u.getNbItems():m,n=[];if(m!==null&&p!==null){this.items.loop(function(e,r){(r<p||r>=p+t||!u.has(r))&&n.push(r)},this),n.sort(r.compareNumbers).reverse().forEach(this.removeItem,this);for(i=p,l=t+p;i<l;i++)this.addItem(i);return!0}return!1},this.setPlugins(n),this.setRootNode(o)},this.setItemRenderer=function(t,n){t=t||"default",c[t]=n},this.getItemRenderer=function(t){return c[t]},this.foreach=function(t,n,r,i){var s=new this.ItemRenderer(this.plugins,t);s.setStart(r||0),s.setNb(i||"*"),s.render(),u.watch("added",s.render,s),u.watch("deleted",function(e){s.render(),this.observers[e]&&this.observers[e].forEach(function(e){u.unwatchValue(e)},this),delete this.observers[e]},this),this.setItemRenderer(n,s)},this.updateStart=function(t,n){var r=this.getItemRenderer(t);return r?(r.setStart(n),!0):!1},this.updateNb=function(t,n){var r=this.getItemRenderer(t);return r?(r.setNb(n),!0):!1},this.refresh=function(t){var n=this.getItemRenderer(t);return n?(n.render(),!0):!1},this.bind=function(t,n,i){i=i||"";var o=t.getAttribute("data-"+this.plugins.name+"_id"),f=i.split("."),l=o||f.shift(),c=o?i:f.join("."),h=r.getNestedProperty(u.get(l),c),p=r.toArray(arguments).slice(3);if(h||h===0||h===!1)this.execBinding.apply(this,[t,n,h].concat(p))||s.setAttribute(t,n,h);this.hasBinding(n)||t.addEventListener("change",function(e){u.has(l)&&(c?u.update(l,i,t[n]):u.set(l,t[n]))},!0),this.observers[l]=this.observers[l]||[],this.observers[l].push(u.watchValue(l,function(e){this.execBinding.apply(this,[t,n,r.getNestedProperty(e,c)].concat(p))||s.setAttribute(t,n,r.getNestedProperty(e,c))},this))},this.set=function(t){return s.isAcceptedType(t)&&t.name?(u.set(t.name,t.value),!0):!1},this.form=function(t){if(t&&t.nodeName=="FORM"){var n=this;return t.addEventListener("submit",function(e){r.toArray(t.querySelectorAll("[name]")).forEach(n.set,n),e.preventDefault()},!0),!0}return!1},this.addBinding=function(t,n){return t&&typeof t=="string"&&typeof n=="function"?(f[t]=n,!0):!1},this.execBinding=function(t,n){return this.hasBinding(n)?(f[n].apply(t,Array.prototype.slice.call(arguments,2)),!0):!1},this.hasBinding=function(t){return f.hasOwnProperty(t)},this.getBinding=function(t){return f[t]},this.addBindings=function(t){return r.loop(t,function(e,t){this.addBinding(t,e)},this)},this.setModel(n),this.addBindings(o)}}),define("Olives/OObject",["StateMachine","Store","Olives/Plugins","Olives/DomUtils","Tools"],function(t,n,r,i,s){return function(o){var u=function(t){var n=p||document.createElement("div");if(!t.template)throw Error("UI.template must be set prior to render");typeof t.template=="string"?n.innerHTML=t.template.trim():i.isAcceptedType(t.template)&&n.appendChild(t.template);if(n.childNodes.length>1)throw Error("UI.template should have only one parent node");t.dom=n.childNodes[0],t.plugins.apply(t.dom)},l=function(t,n,r){n&&(r?n.insertBefore(t.dom,r):n.appendChild(t.dom),p=n)},h=function(t,n){u(t),l.apply(null,s.toArray(arguments))},p=null,d=new t("Init",{Init:[["render",u,this,"Rendered"],["place",h,this,"Rendered"]],Rendered:[["place",l,this],["render",u,this]]});this.model=o instanceof n?o:new n,this.plugins=new r,this.template=null,this.dom=null,this.place=function(t,n){d.event("place",this,t,n)},this.render=function(){d.event("render",this)},this.setTemplateFromDom=function(t){return i.isAcceptedType(t)?(this.template=t,!0):!1},this.alive=function(t){return i.isAcceptedType(t)?(this.setTemplateFromDom(t),this.place(t.parentNode,t.nextElementSibling),!0):!1},this.getCurrentPlace=function(){return p}}}),define("Olives/Plugins",["Tools","Olives/DomUtils"],function(t,n){return function(){var r={},i=function(t){return t.trim()},s=function(t,n,s){n.split(";").forEach(function(e){var n=e.split(":"),u=n[0].trim(),a=n[1]?n[1].split(",").map(i):[];a.unshift(t),r[s]&&r[s][u]&&r[s][u].apply(r[s],a)})};this.add=function(t,n){var i=this,s="plugins";return typeof t=="string"&&typeof n=="object"&&n?(r[t]=n,n[s]={name:t,apply:function(){return i.apply.apply(i,arguments)}},!0):!1},this.addAll=function(n){return t.loop(n,function(e,t){this.add(t,e)},this)},this.get=function(t){return r[t]},this.del=function(t){return delete r[t]},this.apply=function(r){var i;return n.isAcceptedType(r)?(i=n.getNodes(r),t.loop(t.toArray(i),function(e){t.loop(n.getDataset(e),function(t,n){s(e,t,n)})}),r):!1}}}),define("Olives/Transport",["Observable","Tools"],function(t,n){return function(n,r){var i=null,s=null,o=new t,u={};this.setIO=function(t){return t&&typeof t.connect=="function"?(s=t,!0):!1},this.getIO=function(){return s},this.connect=function(t){return typeof t=="string"?(i=s.connect(t),!0):!1},this.getSocket=function(){return i},this.on=function(t,n){return i.on(t,n)},this.once=function(t,n){return i.once(t,n)},this.emit=function(t,n,r){return i.emit(t,n,r)},this.removeListener=function(t,n,r){return i.removeListener(t,n,r)},this.request=function(t,n,r,i){if(typeof t=="string"&&typeof n!="undefined"){var s={eventId:Date.now()+Math.floor(Math.random()*1e6),data:n},o=function(){r&&r.apply(i||null,arguments)};return this.once(s.eventId,o),this.emit(t,s),!0}return!1},this.listen=function(t,n,r,i){if(typeof t=="string"&&typeof n!="undefined"&&typeof r=="function"){var s={eventId:Date.now()+Math.floor(Math.random()*1e6),data:n,keepAlive:!0},o=function(){r&&r.apply(i||null,arguments)},u=this;return this.on(s.eventId,o),this.emit(t,s),function(){u.emit("disconnect-"+s.eventId),u.removeListener(s.eventId,o)}}return!1},this.setIO(n),this.connect(r)}}),define("Olives/UI-plugin",["Olives/OObject","Tools"],function(e,t){return function(r){var i={};this.place=function(n,r){if(!(i[r]instanceof e))throw new Error(r+" is not an OObject UI in place:"+r);i[r].place(n)},this.set=function(n,r){return typeof n=="string"&&r instanceof e?(i[n]=r,!0):!1},this.setAll=function(n){t.loop(n,function(e,t){this.set(t,e)},this)},this.get=function(t){return i[t]},this.setAll(r)}}),define("Olives/DomUtils",function(){return{getNodes:function(t,n){return this.isAcceptedType(t)?(t.parentNode||document.createDocumentFragment().appendChild(t),t.parentNode.querySelectorAll(n||"*")):!1},getDataset:function(t){var n=0,r,i={},s,o;if(this.isAcceptedType(t)){if(t.hasOwnProperty("dataset"))return t.dataset;for(r=t.attributes.length;n<r;n++)s=t.attributes[n].name.split("-"),s.shift()=="data"&&(i[o=s.join("-")]=t.getAttribute("data-"+o));return i}return!1},isAcceptedType:function(t){return t instanceof HTMLElement||t instanceof SVGElement?!0:!1},setAttribute:function(t,n,r){return t instanceof HTMLElement?(t[n]=r,!0):t instanceof SVGElement?(t.setAttribute(n,r),!0):!1}}}),define("Olives/Event-plugin",function(){return function(t){this.listen=function(e,n,r,i){e.addEventListener(n,function(n){t[r].call(t,n,e)},i=="true")}}}),define("Olives/LocalStore",["Store","Tools"],function(t,n){function r(){var e=null,t=localStorage,r=function(){t.setItem(e,this.toJSON())};this.setLocalStorage=function(n){return n&&n.setItem instanceof Function?(t=n,!0):!1},this.getLocalStorage=function(){return t},this.sync=function(s){var o;return typeof s=="string"?(e=s,o=JSON.parse(t.getItem(s)),n.loop(o,function(e,t){this.has(t)||this.set(t,e)},this),r.call(this),this.watch("added",r,this),this.watch("updated",r,this),this.watch("deleted",r,this),!0):!1}}return function(n){return r.prototype=new t(n),new r}}),define("Olives/Model-plugin",["Store","Observable","Tools","Olives/DomUtils"],function(t,n,r,s){return function(n,o){var u=null,f={},c={};this.observers={},this.setModel=function(n){return n instanceof t?(u=n,!0):!1},this.getModel=function(){return u},this.ItemRenderer=function(n,o){var f=null,c=null,h=null,p=null,m=null;this.setRenderer=function(t){return f=t,!0},this.getRenderer=function(){return f},this.setRootNode=function(t){var n;return s.isAcceptedType(t)?(h=t,n=h.querySelector("*"),this.setRenderer(n),n&&h.removeChild(n),!0):!1},this.getRootNode=function(){return h},this.setPlugins=function(t){return c=t,!0},this.getPlugins=function(){return c},this.items=new t([]),this.setStart=function(t){return p=parseInt(t,10),p},this.getStart=function(){return p},this.setNb=function(t){return m=t=="*"?t:parseInt(t,10),m},this.getNb=function(){return m},this.addItem=function(t){var n,r;return typeof t=="number"&&!this.items.get(t)?(n=this.create(t),n?(r=this.getNextItem(t),r?h.insertBefore(n,r):h.appendChild(n),!0):!1):!1},this.getNextItem=function(t){return this.items.alter("slice",t+1).filter(function(e){if(s.isAcceptedType(e))return!0})[0]},this.removeItem=function(t){var n=this.items.get(t);return n?(h.removeChild(n),this.items.set(t),!0):!1},this.create=function(t){if(u.has(t)){var n=f.cloneNode(!0),i=s.getNodes(n);return r.toArray(i).forEach(function(e){e.setAttribute("data-"+c.name+"_id",t)}),this.items.set(t,n),c.apply(n),n}},this.render=function(){var t=m=="*"?u.getNbItems():m,n=[];if(m!==null&&p!==null){this.items.loop(function(e,r){(r<p||r>=p+t||!u.has(r))&&n.push(r)},this),n.sort(r.compareNumbers).reverse().forEach(this.removeItem,this);for(i=p,l=t+p;i<l;i++)this.addItem(i);return!0}return!1},this.setPlugins(n),this.setRootNode(o)},this.setItemRenderer=function(t,n){t=t||"default",c[t]=n},this.getItemRenderer=function(t){return c[t]},this.foreach=function(t,n,r,i){var s=new this.ItemRenderer(this.plugins,t);s.setStart(r||0),s.setNb(i||"*"),s.render(),u.watch("added",s.render,s),u.watch("deleted",function(e){s.render(),this.observers[e]&&this.observers[e].forEach(function(e){u.unwatchValue(e)},this),delete this.observers[e]},this),this.setItemRenderer(n,s)},this.updateStart=function(t,n){var r=this.getItemRenderer(t);return r?(r.setStart(n),!0):!1},this.updateNb=function(t,n){var r=this.getItemRenderer(t);return r?(r.setNb(n),!0):!1},this.refresh=function(t){var n=this.getItemRenderer(t);return n?(n.render(),!0):!1},this.bind=function(t,n,i){i=i||"";var o=t.getAttribute("data-"+this.plugins.name+"_id"),f=i.split("."),l=o||f.shift(),c=o?i:f.join("."),h=r.getNestedProperty(u.get(l),c),p=r.toArray(arguments).slice(3);if(h||h===0||h===!1)this.execBinding.apply(this,[t,n,h].concat(p))||s.setAttribute(t,n,h);this.hasBinding(n)||t.addEventListener("change",function(e){u.has(l)&&(c?u.update(l,i,t[n]):u.set(l,t[n]))},!0),this.observers[l]=this.observers[l]||[],this.observers[l].push(u.watchValue(l,function(e){this.execBinding.apply(this,[t,n,r.getNestedProperty(e,c)].concat(p))||s.setAttribute(t,n,r.getNestedProperty(e,c))},this))},this.set=function(t){return s.isAcceptedType(t)&&t.name?(u.set(t.name,t.value),!0):!1},this.form=function(t){if(t&&t.nodeName=="FORM"){var n=this;return t.addEventListener("submit",function(e){r.toArray(t.querySelectorAll("[name]")).forEach(n.set,n),e.preventDefault()},!0),!0}return!1},this.addBinding=function(t,n){return t&&typeof t=="string"&&typeof n=="function"?(f[t]=n,!0):!1},this.execBinding=function(t,n){return this.hasBinding(n)?(f[n].apply(t,Array.prototype.slice.call(arguments,2)),!0):!1},this.hasBinding=function(t){return f.hasOwnProperty(t)},this.getBinding=function(t){return f[t]},this.addBindings=function(t){return r.loop(t,function(e,t){this.addBinding(t,e)},this)},this.setModel(n),this.addBindings(o)}}),define("Olives/OObject",["StateMachine","Store","Olives/Plugins","Olives/DomUtils","Tools"],function(t,n,r,i,s){return function(o){var u=function(t){var n=p||document.createElement("div");if(!t.template)throw Error("UI.template must be set prior to render");typeof t.template=="string"?n.innerHTML=t.template.trim():i.isAcceptedType(t.template)&&n.appendChild(t.template);if(n.childNodes.length>1)throw Error("UI.template should have only one parent node");t.dom=n.childNodes[0],t.plugins.apply(t.dom)},l=function(t,n,r){n&&(r?n.insertBefore(t.dom,r):n.appendChild(t.dom),p=n)},h=function(t,n){u(t),l.apply(null,s.toArray(arguments))},p=null,d=new t("Init",{Init:[["render",u,this,"Rendered"],["place",h,this,"Rendered"]],Rendered:[["place",l,this],["render",u,this]]});this.model=o instanceof n?o:new n,this.plugins=new r,this.template=null,this.dom=null,this.place=function(t,n){d.event("place",this,t,n)},this.render=function(){d.event("render",this)},this.setTemplateFromDom=function(t){return i.isAcceptedType(t)?(this.template=t,!0):!1},this.alive=function(t){return i.isAcceptedType(t)?(this.setTemplateFromDom(t),this.place(t.parentNode,t.nextElementSibling),!0):!1},this.getCurrentPlace=function(){return p}}}),define("Olives/Plugins",["Tools","Olives/DomUtils"],function(t,n){return function(){var r={},i=function(t){return t.trim()},s=function(t,n,s){n.split(";").forEach(function(e){var n=e.split(":"),u=n[0].trim(),a=n[1]?n[1].split(",").map(i):[];a.unshift(t),r[s]&&r[s][u]&&r[s][u].apply(r[s],a)})};this.add=function(t,n){var i=this,s="plugins";return typeof t=="string"&&typeof n=="object"&&n?(r[t]=n,n[s]={name:t,apply:function(){return i.apply.apply(i,arguments)}},!0):!1},this.addAll=function(n){return t.loop(n,function(e,t){this.add(t,e)},this)},this.get=function(t){return r[t]},this.del=function(t){return delete r[t]},this.apply=function(r){var i;return n.isAcceptedType(r)?(i=n.getNodes(r),t.loop(t.toArray(i),function(e){t.loop(n.getDataset(e),function(t,n){s(e,t,n)})}),r):!1}}}),define("Olives/Transport",["Observable","Tools"],function(t,n){return function(n,r){var i=null,s=null,o=new t,u={};this.setIO=function(t){return t&&typeof t.connect=="function"?(s=t,!0):!1},this.getIO=function(){return s},this.connect=function(t){return typeof t=="string"?(i=s.connect(t),!0):!1},this.getSocket=function(){return i},this.on=function(t,n){return i.on(t,n)},this.once=function(t,n){return i.once(t,n)},this.emit=function(t,n,r){return i.emit(t,n,r)},this.removeListener=function(t,n,r){return i.removeListener(t,n,r)},this.request=function(t,n,r,i){if(typeof t=="string"&&typeof n!="undefined"){var s={eventId:Date.now()+Math.floor(Math.random()*1e6),data:n},o=function(){r&&r.apply(i||null,arguments)};return this.once(s.eventId,o),this.emit(t,s),!0}return!1},this.listen=function(t,n,r,i){if(typeof t=="string"&&typeof n!="undefined"&&typeof r=="function"){var s={eventId:Date.now()+Math.floor(Math.random()*1e6),data:n,keepAlive:!0},o=function(){r&&r.apply(i||null,arguments)},u=this;return this.on(s.eventId,o),this.emit(t,s),function(){u.emit("disconnect-"+s.eventId),u.removeListener(s.eventId,o)}}return!1},this.setIO(n),this.connect(r)}}),define("Olives/UI-plugin",["Olives/OObject","Tools"],function(e,t){return function(r){var i={};this.place=function(n,r){if(!(i[r]instanceof e))throw new Error(r+" is not an OObject UI in place:"+r);i[r].place(n)},this.set=function(n,r){return typeof n=="string"&&r instanceof e?(i[n]=r,!0):!1},this.setAll=function(n){t.loop(n,function(e,t){this.set(t,e)},this)},this.get=function(t){return i[t]},this.setAll(r)}}),define("lib/olives.min",function(){}),define("Amy/DomUtils",["Olives/DomUtils","Tools"],function(e,t){return{hasQuerySelector:function(n,r,i){return t.toArray(e.getNodes(n,i)).indexOf(r)>-1}}}),define("Amy/TestUtils",[],function(){var e=function(e){return typeof e=="string"},t=function(t,n){throw new Error(e(n)?n:t)};return{assertIsObject:function(e,n){return e instanceof Object||t("Is not Object",n),!0},assertIsObservable:function(e,n){return(!e||typeof e.watch!="function"||typeof e.notify!="function")&&t("Is not Observable",n),!0},assertIsString:function(n,r){return e(n)||t("Is not String",r),!0}}}),define("Amy/Stack-plugin",["Amy/Stack-service"],function(e){return function(n,r){var i=new e(n,r);this.getStack=function(){return i},this.destination=function(e){i.setDestination(e)},this.hide=function(){i.hide()},this.show=function(e,t,n,r){e.addEventListener(t,function(e){i.show(e.target.getAttribute(n))},r=="true")}}}),define("Amy/Event-controller",["Amy/TestUtils","Tools"],function(e,t){return function(n,r){var i=n instanceof Object?n:null,s=function(e){return typeof e=="boolean"?e:!1},o=function(){var e=!0,t;for(t=arguments.length;t>=0;t--)e=e&&typeof arguments[t]=="string";return e},u=s(r),a={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};this.addListener=function(e,t,n,r){e.addEventListener(this.map(t),n,r)},this.call=function(e){i[e].apply(i,t.toArray(arguments).slice(1))},this.isTouch=function(){return u},this.setTouch=function(e){return s(e)?(u=e,!0):!1},this.setMap=function(e,t){return o(e,t)?(a[e]=t,!0):!1},this.map=function(e){var t=a[e];return t&&u?t:e},this.setScope=function(e){return i=e,!0},this.scope=function(){return i}}}),define("Amy/Delegate-plugin",["Amy/Event-controller","Amy/DomUtils"],function(e,t){function n(){this.listen=function(e,t,n,r){var i=this;this.addListener(e,t,function(t){i.call(n,t,e)},r=="true")},this.selector=function(e,n,r,i,s){var o=this;this.addListener(e,r,function(r){t.hasQuerySelector(e,r.target,n)&&o.call(i,r,e)},s=="true")}}return function(r,i){return n.prototype=new e(r,i),new n}}),define("Amy/Control-plugin",["Amy/Event-controller","Amy/DomUtils"],function(e,t){function n(){var e=null;this.init=function(t){e=t},this.radio=function(n,r,i,s,o,u){var a=this;this.addListener(n,s,function(s){var u=s.target;t.hasQuerySelector(n,u,r)&&(a.radioClass(u,e,i),e=u,a.call(o,s))},u=="true")},this.radioClass=function(e,t,n){e.classList.add(n),t&&t!=e&&t.classList.remove(n)},this.toggleClass=function(e,t){return e.classList.toggle(t)},this.toggle=function(e,n,r,i,s,o){var u=this;this.addListener(e,i,function(i){var o=i.target;t.hasQuerySelector(e,o,n)&&(u.toggleClass(o,r),u.call(s,i))},o=="true")}}return function(r,i){return n.prototype=new e(r,i),new n}}),define("Amy/Stack-service",["Store","Olives/OObject","Olives/DomUtils","Tools"],function(t,n,r,i){return function(i,s){var o=new t(i),u=s,f="",l=null;this.setDestination=function(t){return r.isAcceptedType(t)?(u=t,!0):!1},this.getDestination=function(){return u},this.setCurrentScreen=function(t){l=t},this.getCurrentScreen=function(){return l},this.add=function(t,r){return typeof t=="string"&&r instanceof n?(o.set(t,r),this.hide(r),!0):!1},this.get=function(t){return o.get(t)},this.getCurrentName=function(){return f},this.show=function(t){var n=this.get(t);return n&&t!==f?(n.place(u),l&&this.hide(l),this.setCurrentScreen(n),f=t,!0):!1},this.hide=function(t){t.place(document.createDocumentFragment())}}}),define("lib/amy2.min",function(){}),require(["lib/socket.io.min","lib/couchdbtools.min","lib/emily.min","lib/olives.min","lib/amy2.min"],function(){require(["body"])}),define("main",function(){}),define("service/map",["Store"],function(e){return new e({body:document.body,login:document.getElementById("login"),"login-form":document.getElementById("login-form"),"signup-form":document.getElementById("signup-form"),loading:document.getElementById("loading"),serverdown:document.getElementById("serverdown"),nointernet:document.getElementById("nointernet"),dock:document.getElementById("wrapper"),notify:document.getElementById("notify"),"notify-popup":document.getElementById("notify-popup"),"newidea-popup":document.getElementById("newidea-popup"),"new2q-popup":document.getElementById("new2q-popup"),"new2c-popup":document.getElementById("new2c-popup"),"help-popup":document.getElementById("help-popup"),"tip-popup":document.getElementById("tip-popup"),cache:document.getElementById("cache"),"public":document.getElementById("public"),"public-menu":document.getElementById("public-menu"),"public-detail":document.getElementById("public-detail"),"public-writetwocents":document.getElementById("public-writetwocents"),"public-twocents":document.getElementById("public-twocents"),"public-edit":document.querySelector("#public-detail .idea-edit"),"public-sendmail":document.querySelector("#public-detail .idea-sendmail"),"public-share":document.querySelector("#public-detail .idea-share"),brainstorm:document.getElementById("brainstorm"),"brainstorm-menu":document.getElementById("brainstorm-menu"),"ideafy-menu":document.getElementById("ideafy-menu"),"ideafy-quick":document.getElementById("ideafy-quick"),quickstart:document.getElementById("quickstart"),quicksetup:document.getElementById("quicksetup"),quickscenario:document.getElementById("quickscenario"),"scenario-whiteboard":document.getElementById("scenario-whiteboard"),quicktech:document.getElementById("quicktech"),quickidea:document.getElementById("quickidea"),quickwrapup:document.getElementById("quickwrapup"),library:document.getElementById("library"),"library-menu":document.getElementById("library-menu"),ideas:document.getElementById("ideas"),"ideas-detail":document.getElementById("ideas-detail"),"library-idea":document.querySelector("library-idea"),"library-writetwocents":document.getElementById("library-writetwocents"),"library-twocents":document.getElementById("library-twocents"),"library-edit":document.querySelector("#ideas-detail .idea-edit"),"library-sendmail":document.querySelector("#ideas-detail .idea-sendmail"),"library-share":document.querySelector("#ideas-detail .idea-share"),sessions:document.getElementById("sessions"),decks:document.getElementById("decks"),decklist:document.getElementById("decklist"),deckview:document.getElementById("deckview"),connect:document.getElementById("connect"),"connect-menu":document.getElementById("connect-menu"),"connect-messages":document.getElementById("connect-messages"),msgdetail:document.getElementById("msgdetail"),"connect-contacts":document.getElementById("connect-contacts"),contactdetails:document.getElementById("contactdetails"),"connect-twocents":document.getElementById("connect-twocents"),dashboard:document.getElementById("dashboard"),"dashboard-menu":document.getElementById("dashboard-menu"),"dashboard-profile":document.getElementById("dashboard-profile"),leaderboard:document.getElementById("leaderboard"),"dashboard-settings":document.getElementById("dashboard-settings"),"dashboard-about":document.getElementById("dashboard-about")})}),define("service/config",["Store","Olives/Transport","CouchDBStore","Observable"],function(e,t,n,r){var i,s,o,u,a=new e;return this.reset=function(){_location="http://37.153.96.26:1664",s=new t(io,_location),o=new n,u=new r,o.setTransport(s),a.reset({location:_location,transport:s,db:"ideafy",user:o,observer:u,polling_interval:6e4,userTemplate:{lastname:"",firstname:"",address:{street1:"",street2:"",zip:null,state:"",city:"",state:"",country:""},gender:1,lang:"en-us",birthdate:[],connections:[],taiaut_decks:["INT"],custom_decks:[],active_deck:"INT",occupation:{situation:"",job:"",organization:""},family:{couple:null,children:null},leisure_activities:[{name:"",comment:""},{name:"",comment:""},{name:"",comment:""}],interests:[{name:"",comment:""},{name:"",comment:""},{name:"",comment:""}],type:7,notifications:[],facebook:"",twitter:"",gplus:"",linkedin:"",username:"",sessionInProgress:{},organization:"",rated:[],rated_ideas:[],favorites:[],ip:0,picture_file:"img/avatars/deedee0.png",intro:"Ideafyer",title:null,achievements:[],ideas_count:0,su_sessions_count:0,mu_sessions_count:0,twocents_count:0,twoquestions_count:0,tutorial_complete:!1,profile_complete:!1,news:[],twocents:[],twoquestions:[],settings:{notifyPopup:!0,useascharacter:!1,ccme:!1,privacy_lvl:0,showTips:!0,startupScreen:"#public",listSize:null,polling_interval:6e4}},ideaTemplate:{title:"",sessionId:"",sessionReplay:!1,authors:[],description:"",solution:"",creation_date:[],character:"",problem:"",lang:"en-us",context:"",techno:[],type:6,sharedwith:[],modification_date:[],inspired_by:"",visibility:"private",votes:[],rating:"",authornames:"",twocents:[]},TQTemplate:{author:[],question:"",creation_date:[],lang:"en-us",type:10,modification_date:[],votes:[],rating:"",username:"",twocents:[]},sessionTemplate:{title:"",description:"",initiator:{id:"",username:"",picture_file:""},participants:[],date:[],startTime:null,resumeTime:null,duration:null,elapsedTime:0,elapsedTimers:{},mode:"",type:8,deck:"",status:"in progress",step:"",lang:"en-us",characters:[],contexts:[],problems:[],scenarioWB:[],scenario:[],techno:[[]],ideaWB:[],idea:[],score:""},avatars:new e({}),avatar:null,defaultLabels:{language:"en-us",emailplaceholder:"Email",passwordplaceholder:"Password",repeatpasswordplaceholder:"Confirm password",loginbutton:"Log in",newuserbutton:"New user",invalidlogin:"Invalid username or password",missingloginparam:"Please enter both username and password or register",signupmissingemail:"Please enter your email address in the field above",signupmissingpwd:"A password is required",signupmissingpwdok:"Please confirm your password",signupmissingfn:"Please enter your first name",signupmisingln:"Please enter your last name",signupinvalidemail:"Invalid email address",signuppwdnomatch:"Passwords do not match",signupwelcomeobject:"Welcome to Ideady",signupwelcomebody:"Thank you for trying Ideafy. We hope you'll enjoy it. We designed it so you can manage ideas that matter to you or just play around. But don't keep what you're doing to yourself.",signupbutton:"Sign up",Initialization:"Initializing user data. Please wait ...",firstnameplaceholder:"First name",lastnameplaceholder:"Last name",createidealbl:"Enter a new idea",ideatitleplaceholder:"Enter a title for your idea",ideadescplaceholder:"Enter a description of your idea in non technical terms",ideasolplaceholder:"Describe how your idea would work, what components, products, services or technologies you would  use",privatelbl:"Private",publiclbl:"Public",ideavisiblelbl:"Your idea is ",setideavisiblelbl:"Change status:",ideafyreplaylbl:"Ideafy Replay is",ideafysetreplaylbl:"Change Ideafy Replay status: ",enabledreplaylbl:"Enabled",disabledreplaylbl:"Disabled",enablereplaylbl:"Enable",disablereplaylbl:"Disable",oklbl:"Ok",continuelbl:"Continue",setpublicquestion:"Warning, every Ideafy user will be able to view your idea. This operation is irreversible. Do you want to proceed?",publicideasheadertitle:"Public Ideas",searchpublicplaceholder:"Search public ideas...",ideadetailsheadertitle:"Idea Overview",idealistheadertitle:"My Ideas",searchprivateplaceholder:"Search your ideas...",modifyidealbl:"Modify your idea",sendidealbl:"Email your idea",sharedwith:"Shared with ",ideafyer:" Ideafyer",ideafyers:" Ideafyers",votebuttonlbl:"Vote",novotesyet:"No vote yet",onevote:"1 vote",votes:"votes",ideawrotelbl:" wrote : ",twocentcommentlbl:"commented :",youwrotelbl:"wrote :",theywrotelbl:"wrote :",youcommentedlbl:"commented :",youlbl:"You",hidetwocentreplies:"Hide replies",showonetcreply:"Reply",showtcrepliesbefore:"",showtcrepliesafter:" Replies",twocentreplycommentlbl:"replied :",yourepliedlbl:"replied :",addtwocentplaceholder:"Add your two cents",addtwocentreplyplaceholder:"Respond to this comment",twocentcreationdate:"Creation date: ",twocentmodificationdate:"Last modified: ",cancellbl:"Cancel",publishlbl:"Publish",titlefield:"Title field",descriptionfield:"Description field",solutionfield:"Solution field",emptyfielderror:" cannot be left empty",somethingwrong:"Something went wrong, please try again later",thankyou:"Thank you",loadingmessage:"Application loading, please wait...",maintenancemessage:"We're sorry. Our server is currently undergoing a scheduled maintenance. Please come back later.","library-ideas":"My Ideas","library-sessions":"My Ideafy Sessions",sbytitle:"Session title",sbydate:"Date",sbyidea:"Idea title",sbyscore:"Score",searchsessions:"Search previous sessions...",foundlbl:"Found",matchingsessions:"matching session(s)",noideayet:"---",completed:"completed",inprogress:"in progress",noscore:"no score yet","library-decks":"My Ideafy decks",brainstormheadertitle:"Brainstorm",brainstormchoosemode:"Choose your Ideafy mode",continuesession:"Continue last session",quickbmode:"Quick mode session",quickstart:"Describe your session",quickstarthelp:"<h2>Why is this step important?</h2><p>Giving your session a name and other background information will make it easier to retrieve later on from your library. Besides, it's always interesting to keep track of the particular context in which ideas or other contents were generated. If you are setting up a multi-user session, this will provide important context information to invitees and may persuade them to join.</p>",quickstarttitle:"Name your session",quickstarttitleplaceholderpre:"",quickstarttitleplaceholderpost:"'s session",quickstartdesc:"Enter a description of your session",quickstartdescplaceholder:"Date, context, purpose, ...",nextbutton:"Next",finishbutton:"Ready",quicksetup:"Set up a situation",quicksetuphelp:"<h2>Setting the stage</h2><p>This step lets you setup a random situation. Draw and select one card of each of the following categories: character, context, problem. They will be the starting point of your session. You can zoom in on each card to get additional information, select a different one by clicking on the deck icon at the top or accept it (thumbs-up button).</p><p>Which is it going to be ? Will you let fortune decide what situation you are going to deal with or will you work the stacks until you get one you are comfortable with? Ideafy encourages you to pick random situations because they force you to think outside the box.</p><p>Note that when you start a <i>Custom session</i> you can specify one or more of your starting cards to address specific situations.</p>",credits:"Credits : ",source:"Source : ",dyknow:"Did you know ?",agelbl:" year old",hobbieslbl:"Leisure activities",interestslbl:"Centers of interest",commentslbl:"Comments",singlelbl:"single",marriedlbl:"married",divorcedlbl:"divorced",widowlbl:"widow",nochildlbl:"no children",onechildlbl:" child",childrenlbl:" children",siblingslbl:" siblings",onesiblinglbl:" sibling",quickscenario:"Write your story",quickscenariohelp:"<p>This is your <strong>whiteboard.</strong></p><p>Now is the time to show your creativity and imagination. The cards you just picked give you a scope, a set of directions to project your thoughts. Use them as hints but do not feel overly constrained: they are here to help you <strong>write your own story and describe your own use case</strong>.</p><p>Finding the problem to solve is often the most important step of an innovation. So get started and use the tools below to <strong>post any thought, drawing or picture that will help you focus on a story.</strong></p><br><p>When you are done, click on the <strong>ready</strong> button at the bottom to write up your story.</p>",choosecolorlbl:"Choose a color",importlbl:"Choose a picture",importpiclbl:"Choose a picture",importcameralbl:"Take a picture",pencilsizelbl:"Size",pencilcolorlbl:"Color",drawbgcolorlbl:"Background",cleardrawinglbl:"Clear",storytitleplaceholder:"Enter the title of your story",storydescplaceholder:"Tell your story, describe the problem your character is facing",storysolplaceholder:"How would you plan to fix this problem ?",quicktech:"Assign technologies",quicktechhelp:"<h2>Draw technologies</h2><p>The next phase of your session consists in finding a way to implement your solution using state of the art technologies. In this step you will draw three technology cards that you will try to include in your design.</p>",tech1lbl:"Techno 1",tech2lbl:"Techno 2",tech3lbl:"Techno 3",scenariolbl:"Scenario",storytitlelbl:"Your Story",cdtitlelbl:"Title : &nbsp",scenariodesclbl:"Scenario description",soldesclbl:"Solution description",quickidea:"Describe your idea",quickideahelp:"<p>Welcome back to your <strong>whiteboard.</strong></p><p>Your goal now is to try to apply the technologies that you just picked to design a solution to the use case described in your scenario.</p><p>Again do not feel too constrained: at this stage you can either alter your scenario to accomodate a technology, add additional technologies to the ones you have drawn to complete your solution or skip some of these if they do not fit in your design.</p><p>You are almost done: at the end of this step you will be able to refine your use case and turn it into an <strong>idea</strong>. You will be asked to provide a description in layman terms and also to describe how you would implement it with your chosen technologies.</p><br><p>When you are done, clik on the <strong>ready</strong> button at the bottom to write up your story.</p>",quickwrapup:"Summary",quickstepstart:"Session description",quickstepsetup:"Setup",quickstepscenario:"Scenario",quicksteptech:"Technologies",quickstepidea:"Solution",quickstepwrapup:"Summary",congratulations:"Congratulations !",sessioncompleted:"You successfully completed your Ideafy session",ideatitlelbl:"Your Idea",scenarioheader:"Scenario",scenariosolution:"Solution",ideadescription:"Idea description",ideaimplementation:"Technical implementation",yourtime:"Your time",yourscore:"Your score",musession:"Multi-user session",customsession:"Custom session",ideafytutorial:"ideafy tutorial","connect-contacts":"Contacts","connect-messages":"Messages","connect-twocents":"Two cents","dashboard-profile":"My profile","dashboard-settings":"Settings","dashboard-about":"About Ideafy",tolbl:"To : ",subjectlbl:"Subject : ",yourmessage:"Your message to ",sentok:" has been sent.",sentdocmsg:" sent you an Ideafy document",notavalidaddress:" is not a valid email address",norecipient:"No email address specified",sendlbl:"Send",sharelbl:"Share",msglistheadertitle:"My Messages",notificationlbl:"Notifications",allbtn:"View all",msgbtn:"Messages",notifbtn:"Notifications",unreadbtn:"Unread",searchmsgplaceholder:"Search ...",messageview:"Message panel",replyalllbl:"Reply all",forwardlbl:"Forward",deletelbl:"Delete",newmsg:"New message",cclbl:"Cc :",tocontactlbl:"Contact :",entersubjectlbl:"Please enter a subject",notavalidcontact:" is not a contact",messagesentok:"Your message has been sent",on:"On ",contactview:"Contact panel",contactlistheadertitle:"My Contacts",usrbtn:"Users",grpbtn:"Groups",newcontactlbl:"New contact",addcontactnow:"Add your contact now",lookup:"Or look up the Ideafy database",beforecount:"The <strong>Ideafy community</strong> now counts <strong>",aftercount:" <strong>users </strong> merrily crafting and exchanging ideas.<br>Look up your acquaintances and friends in the community and connect.",addcontactrightintro:"Building up your address book is the best and fastest way to increase exposure of your ideas and thoughts, but also to get access to a much broader content.",searchcontactplaceholder:"Enter email address of the person you wish to connect with ...",clearemailfirst:"Please clear the email field first",needbothfnln:"Both first and last names are required",selectcontact:"Select contact and press + to invite",noentryfound:"No matching entry in the database",cannotaddself:"You cannot add a connection to yourself",alreadyconnected:" is already a contact",alreadysentCXR:"You already sent a connection request to ",CXRobject:" wants to be a connection",CXRsent:"Your connection request has been sent",addamessage:"Add a message",accept:"Accept",reject:"Reject",acceptedCXR:" has accepted your connection request",rejectedCXR:" has declined your connection request",CXRaccepted:"Request accepted, ",CXRrejected:"Contact request rejected",isnowacontact:" is now a contact",isnolongeracontact:" is no longer a contact",canceledCX:" has canceled your connection",newfolderlbl:"New group",groupnamelbl:"Group name",groupdesclbl:"Group description",colortouch:"A colorful touch is always nice","char":"Character",context:"Context",problem:"Problem",grpcontacts:"Group contacts",addgrpcontacts:"Add contacts",nogrpname:"Please enter a group name",nogrpintro:"Please provide a group desciption",grpnameexists:"A group with this name already exists",nocontactselected:"Please add at least one contact to your group",profilelbl:"My Profile",aboutlbl:"About Ideafy",settingslbl:"Application parameters",completionprefix:"Your profile is ",completionsuffix:"% complete",info:"information",leaderboard:"leaderboard",enterbirthdate:"Provide your date of birth",entergender:"Indicate your gender",enterfamily:"Complete your family status",enteraddress:"Specify your address",enterintro:"Change your introduction",enteroccupation:"Describe your occupation",enterleisure:"Provide at least two leisure activities",enterinterest:"Provide at least two areas of interest",entersocialnw:"Add a social network",enterownpic:"Customize your avatar",completeprofile:"<i>Complete your profile</i>",mystatslbl:"My Stats",ideaslbl:"Public Ideas",sessionslbl:"Sessions",contactslbl:"Contacts",toquestionslbl:"Twoquestions",recentactivitylbl:"Recent Activity",enterednewidea:"You entered a new idea: ",reachedrank:"Congratulations ! You made a new rank :",gotaward:"You received an award : ",posted2q:"You posted a TwoQuestion :",commentedon:"You commented on : ",by:" by ",profileintro:"Profile introduction",shortprofiledesc:"Short profile description",day:"Day",dob:"Date of birth",jan:"January",feb:"February",mar:"March",apr:"April",may:"May",jun:"June",jul:"July",aug:"August",sep:"September",oct:"October",nov:"November",dec:"December",year:"Year",mailaddress:"My Address",street:"Street",city:"City",state:"State",zip:"ZIP code",country:"Country",myfamily:"My Family",single:"Single",married:"Married",divorced:"Divorced",widow:"Widow",relation:"In a relationship",children:"Children",myoccupation:"My Occupation",student:"Student",active:"Active",retired:"Retired",unemployed:"Unemployed",stayathome:"Stay at home parent",jobtitle:"Job title",organization:"Organization",name:"Name",comment:"Comment",field:"Field",updatelbl:"Update",selectavatar:"Or select an avatar",uploadcomplete:"Upload complete",mynotes:"My Notes",writesomething:"Write something",stats:"Stats",achievements:"Achievements",decklistheadertitle:"My Decks",ideafypoints:" Ideafy Points",version:"Version : ",groupupdated:"Group updated",socialnwlbl:"Social networks",designedby:"Designed by : ",mtcheadertitle:"My Two Cents Wall",userpref:"User Preferences",brainstormsettings:"Brainstorm Settings",aboutIdeafy:"About Ideafy",faq:"FAQ",tutorials:"Tutorials",userguide:"User Guide",support:"Support",eula:"View License Agreement",page:"Page ",supportlegend:"A question or an issue?",supportplaceholder:"Enter your text and send",requestsent:"Thank you ! Your request has been sent",createquestion:"New TwoQuestion",questionplaceholder:"Enter your question",noquestion:"Please enter a question",lengthexceeded:"Maximum question length reached",characters:" characters",publicidealbl:"Public Idea",privateidealbl:"Private Idea",publicwarning:"<b>WARNING :</b> publishing your idea as a public one is irreversible. Visit Ideafy's dashboard to learn more.",uploadinprogress:"Upload in progress",notifyingcontacts:" Notifying contacts",askednew:" has asked a new TwoQuestion",melbl:"Me",nowconnected:" are now connected with ",noreplyyet:"No reply yet",mytwoquestions:"My TwoQuestions",mytwocents:"My Twocents",twoqprefix:"",twoqsuffix:"'s TwoQuestions",notwoqyet:"This Ideafyer has not posted any TwoQuestion yet",mytqdetailheader:"My TwoQuestion",tqheaderprefix:"",tqheadersuffix:"'s TwoQuestion",selecttq:"Select a contact to diplay TwoQuestions",mytwocentwall:"My Twocent Wall",sendtcprefix:"Send a Twocent to ",sendtcsuffix:"",twocentplaceholder:"Write your two cents",nomessage:"Please enter a message",sendinginprogress:"Sending in progress",senttc:" wrote you a new Twocent",selectall:"Select all",shareok:"Document shared successfully",signaturelbl:"Signature",sharing:"Sharing : ",messagecenter:"Message Center",twocentview:"Twocent Center",twocentcenter:"TwoQuestions & Twocents","about-taiaut":"About Taiaut",ideafydesc:"Look at Ideafy as your personal accelerator of ideas. You need ideas? Browse the database of ideas shared by other Ideafyers, ask your network or craft new ones using the embedded brainstorming engine. You have creative ideas? Ideafy makes it easy to share them with your network or to expose them to a community of innovative minds. Start discussions, ask questions or just give your two cents. Your Ideafyer friends want to find out what is on your mind. Ideation is fun. Get started and earn as many Ideafy Points and achievements as you can. Will you be the King of Ideas?",taiautdesc:"Taiaut was founded in May 2012 by three partners passionate about innovation and new technology. The aim of the company is to take advantage of leading edge communication technologies to advance creative ideas and best innovation practices globally. The company is headquartered in Boersch, France",solene:"Solène Troussé",oliviers:"Olivier Scherrer",olivierw:"Olivier Wietrich",vincent:"Vincent Weyl",contribsolene:"User interface design",contribscherrer:"Framework design and development",contribwietrich:"User Interface development and software packaging",contribvincent:"Application conception & lead developer","public":"Public wall",library:"My Library",brainstorm:"Brainstorming center",connect:"Communication Center",dashboard:"Dashboard",notips:"Do not show tips at startup",showtips:"Show tips at startup",shownotif:"Show notification popup",setlang:"Choose your language",choosestartup:"Choose your startup screen",usechar:"Allow my profile to be used as an Ideafy character (my name will not be shown)",changepwd:"Change password",changelbl:"Change",brainstormtutorial:"Brainstorming tutorial",twoway:"Support is a two-way street",supportusintro:"Ideafy is a free application and we intend to keep it that way. We are committed to bringing you the best experience. Here are a few things you can do to help us support you better:",asanideafyer:"As an Ideafyer",asanexec:"As a business executive",asadev:"As a developer",asaninvest:"As an investor",ideafyerhelp:"Tell us how you feel by rating the application. If you encounter an issue please use the form above and we will try to fix it speedily. All your feedback is welcome and really helps us improve Ideafy.",exechelp:'If you feel like your business could become even more innovative by using such a platform internally or with your partners, we do propose standalone deployments or dedicated instances. This will not be free but we offer ultra competitive conditions. Contact us with the form above or via our <a onclick=\'window.open("http://www.taiaut.com", "_system");\'>website</a>',devhelp:'Ideafy exists thanks to three javascript libraries written by the company partners. They are released under MIT licenses and are available here : <a onclick=\'window.open("http://github.com/flams/emily", "_system");\'>emily</a>, <a onclick=\'window.open("http://github.com/flams/olives", "_system");\'>olives</a> and <a onclick=\'window.open("http://http://github.com/flams/CouchDB-emily-tools", "_system");\'>couchdb-emily-tools</a>. Check them out and if you are up for it help us make them even better.',investhelp:"We have plenty of ideas to expand the Ideafy service and we are constantly looking for funding opportunities. If you are interested, want to find out about our future and be part of it please contact us.",toc:"Table of contents",backtotop:"Back to top",nointernet:"Connection failed, please check your internet connection and try again"},labels:new e({})})},this.reset(),a}),define("service/utils",["service/config","Observable","Promise","Olives/LocalStore"],function(e,t,n,r){return{formatDate:function(e){var t=e[1]+1;return t<10&&(t="0"+t),e[2]+"/"+t+"/"+e[0]},formatDuration:function(e){var t=Math.round(e/1e3),n=Math.floor(t/86400),r=Math.floor(t%86400/3600),i=Math.floor(t%86400%3600/60),s=Math.floor(t%86400%3600%60),o;return n>0?o=n+"d ":o="",r>0?o+=r+":":o+="",i>0?o+=(r>0&&i<10?"0":"")+i+":":o+="0:",s<10?o+="0"+s:o+=s,o},displayFirstSentence:function(e,t){var n=[];n=t.split("."[0],1);if(!(n[0].length>140))return e.innerHTML;e.innerHTML=n[0].substr(0,139).replace(/\w*\s(\S)*$/," ..."),e.innerHTML=n[0]+"..."},truncate:function(e,t){e.innerHTML=t;while(e.scrollHeight>e.offsetHeight){var n=e.innerHTML;e.innerHTML=n.replace(/\W*\s(\S)*$/,"...")}return e.innerHTML},setRating:function(e,t){var n="<img src = 'img/wall/disableIdeaVote.png'>",r="<img src = 'img/wall/semi-activeIdeaVote.png'>",i="<img src = 'img/wall/activeIdeaVote.png'>",s="";if(!t)for(o=0;o<5;o++)s+=n;else{var o=0;while(o<Math.floor(t))s+=i,o++;o<5&&(Math.round(t-Math.floor(t))?s+=r:s+=n,o++);while(o<5)s+=n,o++}e.innerHTML=s},searchArray:function(t,n){var r=n.toLowerCase().split(" "),s=[];for(i=0,l=t.length;i<l;i++){var o=JSON.stringify(t[i]).toLowerCase(),u=0;for(j=0;j<r.length;j++){if(!(o.search(r[j])>-1))break;u++}u===r.length&&s.push(t[i])}return s},sortByProperty:function s(e,t,n){switch(t){case"idea":e.sort(function(e,r){var i=e[t],o=r[t],u,a;return n?(!!i&&i instanceof Array&&!!i.length?(s(i,"title",!0),u=i[0].title):u="",!!o&&o instanceof Array&&!!o.length?(s(o,"title",!0),a=o[0].title):a="",u<a?1:u>a?-1:0):(!!i&&i instanceof Array&&!!i.length?(s(i,"title",!1),u=i[0].title):u="",!!o&&o instanceof Array&&!!o.length?(s(o,"title",!1),a=o[0].title):a="",u<a?-1:u>a?1:0)});break;case"date":e.sort(function(e,r){var i=e[t],s=r[t],o=new Date(i[0],i[1],i[2]),u=new Date(s[0],s[1],s[2]);return n?o<u?1:o>u?-1:0:o<u?-1:o>u?1:0});break;default:e.sort(function(e,r){var i=e[t],s=r[t];return typeof i=="string"||typeof s=="string"?(i&&i.toLowerCase&&(i=i.toLowerCase()),s&&s.toLowerCase&&(s=s.toLowerCase()),n?i<s?1:i>s?-1:0:i<s?-1:i>s?1:0):n?i<s?1:i>s?-1:0:i<s?-1:i>s?1:0})}},uploadFile:function(t,n,r,i){var s=new XMLHttpRequest;s.open("POST",e.get("location")+t),s.onreadystatechange=function(){s.readyState===4&&i&&i(s)},s.upload.onprogress=function(e){e.lengthComputable&&r.set("status",Math.round(e.loaded/e.total*100))},s.send(n)},checkServerStatus:function(){var t=new n,r=new XMLHttpRequest;return r.open("GET",e.get("location")),r.onreadystatechange=function(){r.readyState===4&&(r.status===200?t.resolve():t.reject())},r.send(),t},updateLabels:function(t){var i={lang:t},s=new r,o=e.get("labels"),u=new n;return s.sync("ideafy-data"),e.get("transport").request("Lang",i,function(t){t==="nok"?(s.set("labels",e.get("defaultLabels")),e.set("language","en-us")):(s.set("labels",t),e.set("language",t.language)),s.sync("ideafy-data"),o.reset(s.get("labels")),u.resolve()}),u},getAvatarById:function(t){var r=new n,i=e.get("avatars");if(t!==e.get("user").get("_id"))return e.get("transport").request("GetAvatar",{id:t},function(e){if(e.error)r.reject();else{if(i.getNbItems()<100)i.set(t,e);else{var n=i.toJSON(),s=n.keys();i.del(s[0]),i.set(t,e)}r.resolve()}}),r;e.get("transport").request("GetFile",{sid:"avatars",filename:t+"_@v@t@r"},function(t){e.set("avatar",t),r.resolve()})},getAvatarByFileName:function(t,n){e.get("transport").request("GetAvatar",{file:t},function(e){n(e)})},getGrade:function(t,n){var r=e.get("transport"),i=e.get("user");r.request("GetGrade",{ip:t,lang:i.get("lang")},function(e){n(e)})},getAchievements:function(t,n){var r=e.get("transport"),i=e.get("user");r.request("GetAchievements",{userid:t,lang:i.get("lang")},function(e){n(e)})},getUserDetails:function(t,n){var r=e.get("transport");r.request("GetUserDetails",{userid:t},function(e){n(e)})},checkProfileCompletion:function(){var t=e.get("user"),n=e.get("labels"),r={percentage:0,missing:[]};return t.get("firstname")&&t.get("lastname")&&(r.percentage+=10),t.get("birthdate").length===3?r.percentage+=10:r.missing.push(n.get("enterbirthdate")),t.get("family").couple!==null&&t.get("family").children!==null?r.percentage+=10:r.missing.push(n.get("enterfamily")),t.get("address").city&&t.get("address").country?r.percentage+=10:r.missing.push(n.get("enteraddress")),t.get("intro")&&t.get("intro")!=="Ideafyer"?r.percentage+=10:r.missing.push(n.get("enterintro")),t.get("occupation").situation>=0&&t.get("occupation").job&&t.get("occupation").organization?r.percentage+=10:r.missing.push(n.get("enteroccupation")),t.get("leisure_activities")[0].name&&t.get("leisure_activities")[1].name?r.percentage+=10:r.missing.push(n.get("enterleisure")),t.get("interests")[0].name&&t.get("interests")[1].name?r.percentage+=10:r.missing.push(n.get("enterinterest")),t.get("twitter")||t.get("facebook")||t.get("gplus")||t.get("linkedin")?r.percentage+=10:r.missing.push(n.get("entersocialnw")),t.get("picture_file").search("img/avatars/deedee")<0?r.percentage+=10:r.missing.push(n.get("enterownpic")),r},stringToBytes:function(e){var t,n,r=[],i,s=0,o;for(i=0;i<e.length;i++){t=e.charCodeAt(i);if(t<127)r[s++]=t&255;else{n=[];do n.unshift(t&255),t>>=8;while(t);for(o=0;o<n.length;o++)r[s++]=n[o]}}return r},changeStyle:function(e){var t=document.querySelector(".currentStyle"),n=t.getAttribute("href");n!=="css/"+e&&t.setAttribute("href","css/"+e)}}}),define("service/avatar",["Olives/OObject","Olives/Model-plugin","Olives/Event-plugin","service/config","Store","service/utils"],function(e,t,n,r,i,s){function o(e){var o=new i,u=r.get("avatars"),a=e[0];this.plugins.addAll({avatar:new t(o,{setStyle:function(e){this.setAttribute("style","background-image: url('"+e+"');")}}),event:new n(this)}),this.template='<div class="avatar" data-avatar="bind: setStyle, img"></div>',e.length>1?o.set("img","img/avatars/deedee6.png"):a===r.get("user").get("_id")?(o.set("img",r.get("avatar")),r.watchValue("avatar",function(){o.set("img",r.get("avatar"))})):a==="ideafy@taiaut.com"||a==="IDEAFY"?o.set("img","img/avatars/doctordeedee.png"):u.get(a)?o.set("img",u.get(a)):s.getAvatarById(a).then(function(){o.set("img",u.get(a))})}return function(n){return o.prototype=new e,new o(n)}}),define("twocents/writetwocent",["Olives/OObject","service/config","Olives/Model-plugin","Olives/Event-plugin","Store","service/utils"],function(e,t,n,r,i,s){return function(u){var a=new e,f=t.get("user"),l=t.get("transport"),c=new Date,h=new i({author:f.get("_id"),message:"",firstname:f.get("firstname"),date:[c.getFullYear(),c.getMonth(),c.getDate()],datemod:"",plusones:0,replies:[]}),p,d,v=u||"public",m="new",g=0;return a.plugins.addAll({twocent:new n(h,{date:function(e){e&&(this.innerHTML=s.formatDate(e))},setVisible:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")}}),config:new n(t,{setAvatar:function(e){this.setAttribute("style","background: url('"+e+"') no-repeat center center;background-size:cover;")}}),labels:new n(t.get("labels")),twocentevent:new r(a)}),a.template='<div class = "writeTwocent"><div class="userAvatar twocentAvatar" data-config="bind: setAvatar, avatar"></div><textarea class="twocentText" data-labels="bind: placeholder, addtwocentplaceholder" data-twocent="bind: value, message"></textarea><div class="writeFooter"><ul class="twocentContext"><li class="creadate"><span class="creadatelbl" data-labels="bind:innerHTML, twocentcreationdate"></span><span class="date" data-twocent="bind: date, date"></span></li><li class="moddate invisible" data-twocent="bind: setVisible, datemod"><span class="moddatelbl" data-labels="bind: innerHTML, twocentmodificationdate"></span><span class="date" data-twocent="bind: date, datemod"></span></li></ul><div class="twocentCancel" data-labels="bind: innerHTML, cancellbl" data-twocentevent="listen: touchstart, press; listen: touchend, cancel">Cancel</div><div class="twocentPublish" data-labels="bind: innerHTML, publishlbl" data-twocentevent="listen: touchstart, press; listen: touchend, publish">Publish</div></div></div>',a.reset=function(t,n,r,i){var s=new Date,o={author:f.get("_id"),message:"",firstname:f.get("firstname"),date:"",datemod:"",plusones:0,replies:[]};t&&(p=t),n?(h.reset(n),m=n,g=r,h.set("datemod",[s.getFullYear(),s.getMonth(),s.getDate()])):(h.reset(o),h.set("date",[s.getFullYear(),s.getMonth(),s.getDate()]),m="new"),i&&(d=i)},a.cancel=function(e,t){t.setAttribute("style","-webkit-box-shadow: none; background: #e69b73;"),d?d():document.getElementById(v+"-writetwocents").classList.add("invisible")},a.publish=function(e,n){n.setAttribute("style","-webkit-box-shadow: none; background: #8cab68;");if(h.get("message")){var r=JSON.parse(h.toJSON()),i,s;m==="new"?s="new":s="edit",i={docId:p,type:s,position:g,twocent:r},l.request("WriteTwocent",i,function(e){e!=="ok"?alert(t.get("labels").get("somethingwrong")):(m==="new"?document.getElementById(v+"-writetwocents").classList.add("invisible"):d(),a.reset(p))},a)}},a.press=function(e,t){t.setAttribute("style","-webkit-box-shadow: inset 0 0 5px 1px rgba(0,0,0,0.6); background: #666666;")},a}}),define("twocents/writetwocentreply",["Olives/OObject","Store","Olives/Model-plugin","Olives/Event-plugin","service/config","service/utils"],function(e,t,n,r,i,s){function o(e){var o=i.get("user"),u=i.get("transport"),a,f,l,c,h=new Date,p,d={author:o.get("_id"),message:"",firstname:o.get("firstname"),date:"",datemod:"",plusones:0},v=new t(d);this.plugins.addAll({model:new n(v,{date:function m(m){this.innerHTML=s.formatDate(m)}}),config:new n(i,{setAvatar:function(e){this.setAttribute("style","background: url('"+e+"') no-repeat center center;background-size:cover;")}}),writereplyevent:new r(this),labels:new n(i.get("labels"))}),this.template='<div class="writeTwocent writeTwocentReply"><div class="replyAvatar" data-config="bind: setAvatar, avatar"></div><textarea class="twocentText replyMessage" data-labels="bind: placeholder, addtwocentreplyplaceholder" data-model="bind: value, message"></textarea><div class="writeFooter"><ul class="twocentContext"><li class="creadate"><span class="creadatelbl" data-labels="bind:innerHTML, twocentcreationdate"></span><span class="date" data-model="bind: date, date"></span></li></ul><div class="twocentCancel" data-labels="bind: innerHTML, cancellbl" data-writereplyevent="listen: touchstart, press; listen: touchend, cancel">Cancel</div><div class="twocentPublish" data-labels="bind: innerHTML, publishlbl" data-writereplyevent="listen: touchstart, press; listen: touchend, publish;">Publish</div></div></div>',this.reset=function(e,t,n,r,i,s){var o=new Date;e&&t&&(a=e,f=t),i?c=i:c="",n?(v.reset(n),editTCR=n,l=r,v.set("datemod",[o.getFullYear(),o.getMonth(),o.getDate()])):(v.reset(d),v.set("date",[o.getFullYear(),o.getMonth(),o.getDate()]),editTCR="newreply"),p=s},this.cancel=function(t,n){n.setAttribute("style","-webkit-box-shadow: none; background: #e69b73;"),v.reset(d),p?p():e.classList.add("invisible")},this.publish=function(t,n){n.setAttribute("style","-webkit-box-shadow: none; background: #8cab68;");if(v.get("message")){var r=JSON.parse(v.toJSON()),s,o;editTCR==="newreply"?o=editTCR:o="editreply",c&&(r.message="@ "+c+" : "+r.message),s={docId:a,type:o,position:l,twocent:f,reply:r},u.request("WriteTwocent",s,function(t){t!=="ok"?alert(i.get("labels").get("somethingwrong")):e.classList.add("invisible")})}},this.press=function(e,t){t.setAttribute("style","-webkit-box-shadow: inset 0 0 5px 1px rgba(0,0,0,0.6); background: #666666;")}}return function(n){return o.prototype=new e,new o(n)}}),define("twocents/twocentreplylist",["Olives/OObject","Store","Olives/Model-plugin","Olives/Event-plugin","service/utils","service/config","twocents/writetwocentreply","service/avatar"],function(e,t,n,r,i,s,o,u){function a(e,a,f,l){var c=new t(e),h=this,p,d=s.get("user"),v=s.get("labels"),m=s.get("transport");h.plugins.addAll({reply:new n(c,{date:function g(g){g&&(this.innerHTML=i.formatDate(g))},setFirstname:function(e){var t=this.getAttribute("data-reply_id");this.innerHTML=e,c.get(t).author===d.get("_id")&&(this.innerHTML=v.get("youlbl"))},setReplylbl:function(e){var t=this.getAttribute("data-reply_id");this.innerHTML=v.get("twocentreplycommentlbl"),c.get(t).author===d.get("_id")&&(this.innerHTML=v.get("yourepliedlbl"))},setAvatar:function(t){var n=document.createDocumentFragment(),r=new u([t]);r.place(n),this.hasChildNodes()?this.replaceChild(n,this.firstChild):this.appendChild(n)},setVisible:function(e){e&&e===d.get("_id")?this.setAttribute("style","display: block;"):this.setAttribute("style","display: none;")},setInVisible:function(e){e&&e===d.get("_id")?this.setAttribute("style","display: none;"):this.setAttribute("style","display: block;")}}),replyevent:new r(h),labels:new n(v)}),h.template='<ul class="replies" data-reply="foreach"><li class="twocentReply"><div class="twocentHeader"><div class="replyAvatar" data-reply="bind:setAvatar, author"></div><div class="twocentAuthor" data-reply="bind: setFirstname, firstname"></div><span class="commentLabel" data-labels="bind: setReplylbl, firstname"></span><br/><div class="twocentDate date" data-reply="bind: date, date"></div><div class="twocentMenu"><div class="twocentButton twocentEditButton" data-reply="bind: setVisible, author" data-replyevent="listen: touchstart, edit"></div><div class="twocentButton twocentDeleteButton" data-reply="bind: setVisible, author" data-replyevent="listen: touchstart, deleteTwocentReply"></div><div class="twocentButton twocentReplyButton" data-reply="bind: setInVisible, author" data-replyevent="listen:touchstart, reply"></div></div></div><p class="twocentMessage replyMessage" data-reply="bind: innerHTML, message"></p><div class="writePublicTwocentReply replyToReply invisible"></div></li></ul>',h.edit=function(t,n){var r=n.getAttribute("data-reply_id"),i=h.dom.children[r],s=new o,u=function(){h.dom.replaceChild(i,s.dom)},l=document.createDocumentFragment();s.reset(a,f,e[r],r,null,u),s.render(),s.place(l),h.dom.replaceChild(l,i),UI=h.dom},h.deleteTwocentReply=function(e,t){var n=t.getAttribute("data-reply_id"),r={docId:a,type:"deltcreply",twocent:f,position:n};m.request("WriteTwocent",r,function(e){e!=="ok"&&alert(s.get("labels").get("somethingwrong"))})},h.reply=function(t,n){var r=n.getAttribute("data-reply_id"),i=document.querySelector(".twocent[data-twocents_id='"+f+"']"),s=i.querySelector(".writePublicTwocentReply[data-reply_id='"+r+"']"),u=document.createDocumentFragment(),l=new o(s);l.reset(a,f,null,r,e[r].firstname),l.render(),l.place(u),s.hasChildNodes()||s.appendChild(u),s.classList.remove("invisible")}}return function(n,r,i,s){return a.prototype=new e,new a(n,r,i,s)}}),define("twocents/twocentlist",["Olives/OObject","service/config","CouchDBStore","Store","service/utils","Olives/Model-plugin","Olives/Event-plugin","twocents/twocentreplylist","twocents/writetwocent","twocents/writetwocentreply","service/avatar"],function(e,t,n,r,i,s,o,u,a,f,l){return function(){var h=new e,p=new n,d=t.get("labels"),v=new r([]),m=t.get("transport"),g=t.get("user"),y,b;return p.setTransport(m),h.plugins.addAll({labels:new s(t.get("labels")),twocents:new s(v,{date:function w(w){w&&(this.innerHTML=i.formatDate(w))},setFirstName:function(e){if(e!==g.get("firstname"))this.innerHTML=e;else{var n=this.getAttribute("data-twocents_id");v.get(n).author===g.get("_id")?this.innerHTML=t.get("labels").get("youlbl"):this.innerHTML=e}},setCommentlbl:function(e){if(e!==g.get("firstname"))this.innerHTML=d.get("twocentcommentlbl");else{var t=this.getAttribute("data-twocents_id");v.get(t).author===g.get("_id")?this.innerHTML=d.get("youcommentedlbl"):this.innerHTML=d.get("twocentcommentlbl")}},setVisible:function(e){e===g.get("_id")?this.setAttribute("style","display: block;"):this.setAttribute("style","display: none;")},setInVisible:function(e){e===g.get("_id")?this.setAttribute("style","display: none;"):this.setAttribute("style","display: block;")},deleteOK:function(e){var t=this.getAttribute("data-twocents_id");e&&e.length>0?this.setAttribute("style","display: none;"):g.get("_id")===v.get(t).author?this.setAttribute("style","display: block;"):this.setAttribute("style","display: none;")},toggleHideButton:function(e){!e||!e.length?this.classList.add("invisible"):(this.classList.remove("invisible"),e.length===1?this.innerHTML=t.get("labels").get("showonetcreply"):this.innerHTML=t.get("labels").get("showtcrepliesbefore")+e.length+t.get("labels").get("showtcrepliesafter"))},displayReplies:function(e){if(!e||!e.length)this.classList.add("invisible");else{var t=this.getAttribute("data-twocents_id"),n=new u(e,y,t,b),r=document.createDocumentFragment();n.render(),n.place(r),this.hasChildNodes()?this.replaceChild(r,this.firstChild):this.appendChild(r),this.classList.remove("invisible")}},setAvatar:function(t){var n=document.createDocumentFragment(),r=new l([t]);r.place(n),this.hasChildNodes()?this.replaceChild(n,this.firstChild):this.appendChild(n)}}),twocentevent:new o(h)}),h.template='<ul class="twocentList" data-twocents="foreach"><li class="twocent"><div class="twocentHeader"><div class="twocentAvatar" data-twocents="bind: setAvatar, author"></div><div class="twocentAuthor"data-twocents="bind: setFirstName, firstname"></div><span class="commentLabel" data-twocents="bind: setCommentlbl, firstname"></span><br/><div class="twocentDate date" data-twocents="bind: date, date"></div><div class="twocentMenu"><div class="twocentButton twocentEditButton" data-twocents="bind: setVisible, author" data-twocentevent="listen: touchstart, edit"></div><div class="twocentButton twocentDeleteButton" data-twocents="bind: deleteOK, replies" data-twocentevent="listen: touchstart, deleteTwocent"></div><div class="twocentButton twocentReplyButton" data-twocents="bind: setInVisible, author" data-twocentevent="listen: touchstart, reply"></div></div></div><div class="twocentBody"><p class="twocentMessage" data-twocents="bind: innerHTML, message"></p><div class="repliesButton hideReplies" name="hide" data-twocents="bind: toggleHideButton, replies" data-twocentevent="listen: touchstart, toggleReplies" data-labels="bind:innerHTML, hidetwocentreplies"></div></div><div class="writePublicTwocentReply invisible"></div><div class="displayReplies" data-twocents="bind: displayReplies, replies"></div></li></ul>',h.edit=function(e,t){var n=t.getAttribute("data-twocents_id"),r=h.dom.children[n],i=new a,s=document.createDocumentFragment(),o=function(){h.dom.replaceChild(r,i.dom)};i.reset(y,v.get(n),n,o),i.render(),i.place(s),h.dom.replaceChild(s,r)},h.reset=function(n,r){y=n,b=r,p.unsync(),p.reset(),p.sync(t.get("db"),y).then(function(){v.reset(p.get("twocents"));switch(b){case"connect":h.place(document.getElementById("connect-twocents"));break;case"library":h.place(document.getElementById("library-twocents"));break;default:h.place(document.getElementById("public-twocents"))}p.watchValue("twocents",function(e){v.reset(e)})})},h.deleteTwocent=function(e,n){var r=n.getAttribute("data-twocents_id"),i={docId:y,type:"delete",position:r,twocent:{author:g.get("_id")}};alert("Are you sure?"),m.request("WriteTwocent",i,function(e){e!=="ok"&&alert(t.get("labels").get("somethingwrong"))})},h.reply=function(e,t){var n=t.getAttribute("data-twocents_id"),r=document.querySelector(".writePublicTwocentReply[data-twocents_id='"+n+"']"),i=new f(r),s=document.createDocumentFragment();i.reset(y,n),i.render(),i.place(s),r.hasChildNodes()||r.appendChild(s),r.classList.remove("invisible")},h.toggleReplies=function(e,t){var n=t.getAttribute("data-twocents_id"),r=v.get(n).replies,i=t.getAttribute("name"),s=document.querySelector(".displayReplies[data-twocents_id='"+n+"']");i==="show"?(s.classList.remove("invisible"),t.setAttribute("name","hide"),t.classList.remove("showReplies"),t.classList.add("hideReplies")):(s.classList.add("invisible"),t.setAttribute("name","show"),t.classList.remove("hideReplies"),t.classList.add("showReplies"))},h}}),define("public/detail-stack/public-idea",["Olives/OObject","Store","Olives/Model-plugin","Olives/Event-plugin","service/map","service/utils","service/avatar","service/config","twocents/writetwocent","twocents/twocentlist","Observable"],function(e,t,n,r,i,s,o,u,a,f,l){return function(h){var p=new e,d=new a,v=new f,m=u.get("labels"),g=new t([{active:!1},{active:!1},{active:!1},{active:!1},{active:!1}]),y=!1,b=u.get("user"),w=u.get("transport"),E=u.get("observer"),S=new t,x=i.get("public-detail"),T,N=new l;return p.plugins.addAll({label:new n(m),publicdetail:new n(S,{toggleRateEdit:function(e){e.indexOf(b.get("_id"))>-1?this.setAttribute("href","#public-edit"):this.setAttribute("href","#public-favorites")},toggleTwocentShare:function(e){e.indexOf(b.get("_id"))>-1?this.setAttribute("href","#public-share"):this.setAttribute("href","#public-2cents")},displayWriteTwocent:function(e){e.indexOf(b.get("_id"))<0?this.classList.remove("invisible"):this.classList.add("invisible")},displayTwocentList:function(e){e&&e.length&&document.getElementById("public-writetwocents").classList.add("invisible")},date:function C(C){C&&(this.innerHTML=s.formatDate(C))},setAuthor:function(e){e===b.get("username")&&S.get("doc").authors.indexOf(b.get("_id"))>-1?this.innerHTML=m.get("youlbl"):this.innerHTML=e},setWrotelbl:function(e){e.length===1&&e[0]===b.get("_id")?this.innerHTML=m.get("youwrotelbl"):e.length>1?this.innerHTML=m.get("theywrotelbl"):this.innerHTML=m.get("ideawrotelbl")},setAvatar:function(t){var n=document.createDocumentFragment(),r=new o(t);r.place(n),this.hasChildNodes()?this.replaceChild(n,this.firstChild):this.appendChild(n)},setRating:function(t){if(t===undefined){var n=this.getAttribute("data-listideas_id"),r=S.get(n).doc.votes;r.length===0?this.innerHTML="":this.innerHTML=Math.round(r.reduce(function(e,t){return e+t})/r.length*100)/100}else this.innerHTML=Math.round(t*100)/100},toggleVoteButton:function(e){var t=S.get("id"),n=S.get("doc").authors;document.getElementById("ratingPopup").classList.remove("appear"),b.get("rated_ideas").indexOf(t)<0&&n.indexOf(b.get("_id"))<0&&!y?(this.setAttribute("name","vote"),this.innerHTML=m.get("votebuttonlbl"),this.classList.remove("votes"),this.classList.add("publicButton")):(y=!0,this.classList.remove("publicButton"),this.setAttribute("name","voted"),e.length===0?this.innerHTML="("+m.get("novotesyet")+")":e.length===1?this.innerHTML="("+m.get("onevote")+")":this.innerHTML="("+e.length+" "+m.get("votes")+")",this.classList.add("votes"))}}),vote:new n(g,{setIcon:function(e){var t="background: url('img/public/activeIdeaVote.png') no-repeat center center;",n="background: url('img/public/rateForList.png') no-repeat center center;";e?this.setAttribute("style",t):this.setAttribute("style",n)}}),publicdetailevent:new r(p)}),p.template='<div class="public-idea"><div class="header blue-dark"><a href="#public-2cents" data-publicdetail="bind: toggleTwocentShare, doc.authors" data-publicdetailevent="listen: touchstart, action" class="option left"></a><span data-label="bind: innerHTML, publicdetailsheadertitle"></span><a href="#public-favorites" data-publicdetail="bind: toggleRateEdit, doc.authors" data-publicdetailevent="listen: touchstart, action" class="option right"></a></div><div class = "detail-contents"><div class="detail-header"><div class="avatar" data-publicdetail="bind:setAvatar, doc.authors"></div><h2 data-publicdetail="bind:innerHTML,doc.title"></h2><span class="date" data-publicdetail="bind:date, doc.creation_date"></span><br><span class="author" data-publicdetail="bind:setAuthor,doc.authornames"></span><span class="commentlbl" data-publicdetail="bind: setWrotelbl, doc.authors"></span></div><div class="detail-body"><p data-publicdetail="bind:innerHTML,doc.description"></p><p data-publicdetail="bind:innerHTML,doc.solution"></p></div><div class="detail-footer"><div class ="rateIdea"><a class="item-acorn"></a><div class="rating" data-publicdetail="bind:setRating,value.rating"></div><div class="publicButton" data-publicdetail="bind:toggleVoteButton, doc.votes" name="vote" data-publicdetailevent="listen: touchstart, press; listen: touchend, vote;" data-label="bind: innerHTML, votebuttonlbl"></div><div id="ratingPopup" class="popup"><ul class="acorns" data-vote="foreach"><li class="item-acorn" data-vote="bind: setIcon, active" data-publicdetailevent="listen: touchstart, previewVote; listen: touchend, castVote"></li></ul></div></div></div></div><div id="public-writetwocents" class="invisible" data-publicdetail="bind: displayWriteTwocent, doc.authors"></div><div id="public-twocents" class="twocents" data-publicdetail="bind: displayTwocentList, doc.twocents"></div></div>',p.reset=function(t,n){y=!1,S.reset(t.get(n)),d.reset(S.get("id")),v.reset(S.get("id"),"public"),T=document.getElementById("public-writetwocents"),d.place(T),t.watch("updated",function(e,t){e===parseInt(n)&&S.reset(t)})},p.action=function(e,t){var n=t.getAttribute("href");n==="#public-2cents"?(console.log("twocents action"),d.reset(S.get("id")),console.log(T),T.classList.remove("invisible")):h(n)},p.edit=function(){_stack.getStack().show("#public-edit")},p.press=function(e,t){t.classList.add("pressed")},p.vote=function(e,t){y||document.getElementById("ratingPopup").classList.add("appear"),t.classList.remove("pressed")},p.previewVote=function(e,t){var n=0,r=t.getAttribute("data-vote_id");g.loop(function(e,t){t<=r?g.update(t,"active",!0):g.update(t,"active",!1)})},p.castVote=function(e,t){var n=parseInt(t.getAttribute("data-vote_id"))+1,r=S.get("id"),i={id:r,vote:n,voter:b.get("_id")};y||(y=!0,w.request("Vote",i,function(e){e!="ok"?(console.log(e,"something went wrong, please try again later"),y=!1):(alert(u.get("labels").get("thankyou")),document.getElementById("ratingPopup").classList.remove("appear"),_node=x.querySelector("publicButton"),g.reset([{active:!1},{active:!1},{active:!1},{active:!1},{active:!1}]))}))},p.place(x),p}}),define("service/confirm",["Olives/OObject","service/map","Olives/Model-plugin","Olives/Event-plugin","service/config","Store"],function(e,t,n,r,i,s){function o(e,t,o){var u=i.get("labels"),a=this,f=new s({question:""});a.plugins.addAll({label:new n(u),confirm:new n(f),confirmevent:new r(this)}),a.template='<div class = "confirm"><div class="help-doctor"></div><p class="confirm-question" data-confirm="bind:innerHTML,question"></p><div class="option left" data-confirmevent="listen:touchstart, press; listen:touchend, ok" data-label="bind: innerHTML, continuelbl">Continue</div><div class="option right" data-confirmevent="listen:touchstart, press; listen:touchend, cancel" data-label="bind:innerHTML, cancellbl">Cancel</div></div>',a.press=function(e,t){e.stopPropagation(),t.classList.add("pressed")},a.ok=function(e,t){t.classList.remove("pressed"),o(!0)},a.cancel=function(e,t){t&&t.classList.remove("pressed"),o(!1)},a.close=function(){e.removeChild(e.lastChild)},f.set("question",t),a.render(),a.place(e),setTimeout(function(){a.close},15e3)}return function(n,r,i){return o.prototype=new e,new o(n,r,i)}}),define("public/detail-stack/public-edit",["Olives/OObject","service/map","CouchDBStore","Olives/Model-plugin","Olives/Event-plugin","service/config","service/confirm"],function(e,t,n,r,i,s,o){return function(a){var f=new e,l=new n,c=s.get("labels"),h=new n({error:""});return l.setTransport(s.get("transport")),f.plugins.addAll({editlabel:new r(c),editidea:new r(l,{setVisibility:function(e){e==="public"?this.innerHTML=c.get("publiclbl"):this.innerHTML=c.get("privatelbl")},hideVisibility:function(e){e==="public"?this.setAttribute("style","display:none"):this.setAttribute("style","display:inline-block")},setVisibleIcon:function(e){e==="public"?this.setAttribute("style","background:url('img/public/publicForList.png') no-repeat left center; background-size: 14px 12px;"):this.setAttribute("style","background-image:url('img/public/privateForList.png');")},setReplay:function(e){e?this.setAttribute("style","display:inline-block"):this.setAttribute("style","display:none")},setIdeafyStatus:function(e){e?this.innerHTML=c.get("enabledreplaylbl"):this.innerHTML=c.get("disabledreplaylbl")},setSessionReplay:function(e){e?this.innerHTML=c.get("disablereplaylbl"):this.innerHTML=c.get("enablereplaylbl")}}),editevent:new i(f),errormsg:new r(h,{setError:function(e){switch(e){case"notitle":this.innerHTML=c.get("titlefield")+c.get("emptyfielderror");break;case"nodesc":this.innerHTML=c.get("descriptionfield")+c.get("emptyfielderror");break;case"nosol":this.innerHTML=c.get("solutionfield")+c.get("emptyfielderror");break;default:this.innerHTML=""}}})}),f.template='<div class="idea-edit"><div class="header blue-dark"><span data-editlabel="bind:innerHTML, modifyidealbl">Modify your idea</span></div><form class="form"><p><input type="text" class="input" data-editidea="bind: value, title"></p><p><textarea class="description input" data-editidea="bind: value, description"></textarea></p><p><textarea class="solution input" data-editidea="bind: value, solution"></textarea></p><div class="options"><div class="current-visibility" data-editidea="bind:setVisibleIcon, visibility"><span class="label" data-editlabel="bind:innerHTML,ideavisiblelbl"></span><span data-editlabel="bind:innerHTML, privatelbl" data-editidea="bind:setVisibility, visibility"></span></div><div class="edit-visibility" data-editidea="bind:hideVisibility, visibility"><span class="label" data-editlabel="bind:innerHTML,setideavisiblelbl"></span><div class="visibility public" data-editlabel="bind:innerHTML, publiclbl" data-editevent="listen:touchstart, editVisibility"></div></div></div><div class="options invisible" data-editidea="bind:setReplay, sessionId"><div class="current-visibility replay"><span class="label" data-editlabel="bind:innerHTML,ideafyreplaylbl"></span><span data-editlabel="bind:innerHTML, disabledreplaylbl" data-editidea="bind:setIdeafyStatus, sessionReplay"></span></div><div class="edit-visibility replay"><span class="label" data-editlabel="bind:innerHTML, ideafysetreplaylbl"></span><div class="toggle-replay" data-editidea = "bind: setSessionReplay, sessionReplay" data-editevent="listen:touchstart, press; listen:touchend, enableReplay" data-editlabel="bind:innerHTML, enablereplaylbl"></div></div></div><p class="submit"><label class="publish pressed-btn" data-editevent="listen:touchend, upload">Publish</label><label class="cancel pressed-btn" data-editevent="listen:touchend, cancel">Cancel</label><label class="editerror" data-errormsg="bind:setError, error"></label></p></form></div>',f.place(t.get("public-edit")),f.reset=function(t){l.unsync(),l.reset(),l.sync(s.get("db"),t)},f.editVisibility=function(e,t){var n=new o(t,c.get("setpublicquestion"),function(e){e?l.set("visibility","public"):l.set("visibility","private"),n.close()})},f.press=function(e,t){t.classList.add("pressed")},f.enableReplay=function(e,t){setTimeout(function(){l.get("sessionReplay")?l.set("sessionReplay",!1):l.set("sessionReplay",!0),t.classList.remove("pressed")},300)},f.upload=function(e,t){var n=new Date,r=[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()];l.get("title")===""?h.set("error","notitle"):l.get("description")===""?h.set("error","nodesc"):l.get("solution")===""?h.set("error","nosol"):(l.set("modification_date",r),l.upload().then(function(){a("close")})),nide.classList.remove("pressed")},f.cancel=function(e,t){t.classList.remove("pressed"),a("close")},f}}),define("public/detail-stack/public-sendmail",["Olives/OObject","service/map","service/config","Olives/Model-plugin","Olives/Event-plugin","Store","service/avatar","service/utils"],function(e,t,n,r,s,o,u,a){return function(c){var h=new e,p=new o({errormsg:""}),d=n.get("user"),v=n.get("transport"),m=n.get("labels"),g=new o({toField:"",from:"",subject:"",body:"",signature:"",attachment:"",sent:!1});return h.plugins.addAll({labels:new r(m),mail:new r(g,{setUserAvatar:function(e){e&&this.setAttribute("style","background: url('"+n.get("avatar")+"') no-repeat center center;")},date:function y(y){y&&(this.innerHTML=a.formatDate(y))},setAvatar:function(t){var n=document.createDocumentFragment(),r=new u(t);r.place(n),this.hasChildNodes()?this.replaceChild(n,this.firstChild):this.appendChild(n)},setRating:function(e){},setVotes:function(e){}}),mailevent:new s(h),errormsg:new r(p)}),h.template='<div class="idea-sendmail"><div class="header blue-dark"><a href="#public-2cents" class="option left"></a><span data-labels="bind:innerHTML, sendidealbl"></span><a href="#public-favorites" class="option right"></a></div><div class="avatar" data-mail="bind:setUserAvatar, from"></div><form class="form"><p><textarea class="mail-header" data-mail="bind: value, toField" data-labels="bind:placeholder, tolbl"></textarea></p><p><input type="text" class="input" data-mail="bind:value, subject" data-labels="bind:placeholder, subjectlbl"></textarea></p><p><textarea class="input" data-mail="bind:value, body"></textarea></p><p><legend data-labels="bind: innerHTML, signaturelbl"></legend><textarea class="signature" data-mail="bind:value, signature"></textarea></p><div class="attachment"><div class="attachment-header"><div data-mail="bind:setAvatar, attachment.authors"></div><span class="date" data-mail="bind:date, attachment.creation_date"></span><h2 data-mail="bind:innerHTML,attachment.title"></h2><span class="author" data-mail="bind:innerHTML,attachment.authornames"></span><span data-labels="bind:innerHTML, ideawrotelbl"></span><div class="visibility-icon private"></div></div><div class="attachment-body"><p data-mail="bind:innerHTML,attachment.description"></p><p data-mail="bind:innerHTML,attachment.solution"></p><div class = "rating" data-mail="bind:setRating, attachment.rating"></div><div class = "votes" data-mail="bind:setVotes, attachment. votes"></div></div></div><div class="sendmail-footer"><p class="send"><label class="cancelmail" data-labels="bind:innerHTML, cancellbl" data-mailevent="listen: touchstart, press; listen:touchend, cancel">Cancel</label><label class="sendmail" data-labels="bind:innerHTML, sendlbl" data-mailevent="listen:touchstart, press; listen:touchend, send">Send</label><label class="editerror" data-errormsg="bind:innerHTML, errormsg"></label></p></div></form></div>',h.place(t.get("public-sendmail")),h.reset=function(t){p.reset({errormsg:""}),g.reset({toField:"",from:d.get("username"),subject:"",body:"",signature:d.get("username")+" <"+d.get("_id"),attachment:t,sent:!1}),d.get("signature")&&g.set("signature",d.get("signature")),json={}},h.validateAddress=function(t){var n=/^[a-z0-9._-]+@[a-z0-9.-]+\.[a-z]{2,4}$/,r=t.toLowerCase().split(/,|;/),s=!0;for(i=0,l=r.length;i<l;i++)if(!n.test(r[i].trim())){p.set("errormsg",r[i]+m.get("notavalidaddress")),s=!1;break}return s},h.validateMessage=function(){return g.get("toField")?h.validateAddress(g.get("toField")):p.set("errormsg",m.get("norecipient")),p.get("errormsg")===""},h.sendMail=function(){json.type="doc",json.recipient=g.get("toField"),json.cc=d.get("_id"),json.replyTo=d.get("_id"),json.subject=d.get("username")+m.get("sentdocmsg"),json.header=g.get("subject"),json.body=g.get("body"),json.signature=g.get("signature"),json.attachHeader="<div style='background:#657B99; font-family:Helvetica; padding:15px;'><p style='color:white;font-size:24px;font-weight:bold;margin-top:10px;'>"+g.get("attachment").title+"</p><p style='color: #F27B3D; font-size:16px; font-weight:bold;margin-bottom:10px;'>"+g.get("attachment").authornames+", <span style='color:black';>"+a.formatDate(g.get("attachment").creation_date)+"</span></p></div>",json.attachBody="<div style='border:1px solid #657b99;background:white'><p style='font-size:14px; font-family:Helvetica; text-align:justify; padding:15px;'>"+g.get("attachment").description+"</p><p style='font-size:14px; font-family:Helvetica; text-align:justify; padding:15px;'>"+g.get("attachment").solution+"</p></div>",v.request("SendMail",json,function(e){e.sendmail==="ok"?(p.set("errormsg",m.get("yourmessage")+e.recipient+m.get("sentoklbl")),setTimeout(function(){c("close")},350)):(p.set("errormsg",m.get("somethingwrong")),g.set("sent",!1),console.log("error",e.error),console.log("response",e.response))})},h.press=function(e,t){(!t.classList.contains("sendmail")||!g.get("sent"))&&t.classList.add("pressed")},h.send=function(e,t){g.get("sent")||(g.set("sent",!0),p.set("errormsg",""),t.classList.remove("pressed"),h.validateMessage()?h.sendMail():g.set("sent",!1))},h.cancel=function(e,t){t.classList.remove("pressed"),c("close")},h}}),define("service/autocontact",["Olives/OObject","service/map","Olives/Model-plugin","Olives/Event-plugin","service/config","Store"],function(e,t,n,r,s,o){function u(e,t,u){var a=this,f=s.get("user"),c=!1,h=new o([]);a.plugins.addAll({auto:new n(h,{setSelected:function(e){e?this.classList.add("selected"):this.classList.remove("selected")},setType:function(e){e==="group"?this.classList.add("group"):this.classList.remove("group")}}),select:new r(a)}),a.template='<div class = "autocontact"><div class="autoclose" data-select="listen:touchstart,close"></div><ul data-auto="foreach"><li data-auto="bind:innerHTML, username; bind:setType, type; bind:setSelected, selected" data-select="listen:touchstart, select"></li></ul></div>',a.init=function(){var n=f.get("connections"),r=[],s=[],o={};h.reset([]);for(i=0,l=n.length;i<l;i++)r.push(n[i].username),o[n[i].username]=n[i].type;r.sort().forEach(function(e){h.alter("push",{username:e,type:o[e]})});if(t.value){s=t.value.split(/,|;/);for(i=0,l=s.length;i<l;i++)s[i]=s[i].trim()}h.loop(function(e,t){s.indexOf(e.username)>-1?h.update(t,"selected",!0):h.update(t,"selected",!1)})},a.updateList=function(){var n,r,s=[],o={};if(t.value){c=!0,n=t.value.split(/,|;/),r=n[n.length-1].trim().toLowerCase(),h.reset([]),f.get("connections").forEach(function(e){e.username.toLowerCase().search(r)===0&&h.alter("push",{username:e.username,type:e.type})});if(t.value){currentList=t.value.split(/,|;/);for(i=0,l=currentList.length;i<l;i++)currentList[i]=currentList[i].trim()}h.loop(function(e,t){currentList.indexOf(e.username)>-1?h.update(t,"selected",!0):h.update(t,"selected",!1)})}},a.close=function(t,n){e.classList.add("invisible")},a.select=function(e,t){var n=t.getAttribute("data-auto_id"),r=h.get(n).selected;h.update(n,"selected",!r),r?a.remove(h.get(n)):a.add(h.get(n))},a.add=function(n){var r;if(n.type==="user")if(!c)t.value?t.value+=", "+n.username:t.value=n.username;else{var s=t.value.split(/,|;/),o="";s.forEach(function(e){e=e.trim()}),s.pop();for(i=0,l=s.length;i<l;i++)o+=s[i]+", ";o+=n.username,t.value=o,c=!1}else f.get("connections").forEach(function(e){e.username===n.username&&(r=e.contacts)}),r.forEach(function(e){t.value.search(e.username)<0&&(a.add(e),h.loop(function(t,n){t.username===e.username&&h.update(n,"selected",!0)}))});u(t.value)},a.remove=function(n){var r,s="";if(n.type==="user"){r=t.value.split(/,|;/);for(i=0,l=r.length;i<l;i++)r[i]=r[i].trim();r.splice(r.indexOf(n.username),1),r.forEach(function(e){s+=e+", "}),t.value=s.substr(0,s.length-2),u(s.substr(0,s.length-2)),h.loop(function(e,t){e.type==="group"&&e.selected&&f.get("connections").forEach(function(r){r.username===e.username&&JSON.stringify(r).search(n.username)>-1&&h.update(t,"selected",!1)})})}else f.get("connections").forEach(function(e){e.username===n.username&&e.contacts.forEach(function(e){h.loop(function(t,n){t.username===e.username&&h.update(n,"selected",!1)}),a.remove(e)})})},a.init(),a.render(),a.place(e)}return function(n,r,i){return u.prototype=new e,new u(n,r,i)}}),define("public/detail-stack/public-share",["Olives/OObject","service/map","service/config","Olives/Model-plugin","Olives/Event-plugin","Store","service/avatar","service/utils","service/autocontact","CouchDBStore"],function(e,t,n,r,s,o,u,a,f,l){return function(a){var f=new e,c=new o({errormsg:""}),h=n.get("user"),p=n.get("transport"),d=n.get("labels"),v=new o({body:"",docId:"",docType:"",attachment:"",docTitle:"",signature:h.get("signature")}),m=new o([]),g=new o([]),y=!1;return f.plugins.addAll({labels:new r(d),share:new r(v,{setHeader:function(e){this.innerHTML=d.get("sharing")+e}}),contacts:new r(g,{setSelected:function(e){e?this.innerHTML="&#10003;":this.innerHTML=""}}),auto:new r(m,{highlight:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),shareevent:new s(f),errormsg:new r(c)}),f.template='<div class="idea-share"><div class="header blue-dark"><span data-share="bind:setHeader, docTitle">Sharing idea</span></div><form class="form"><legend>Select contacts</legend><div class="selectall" data-labels="bind:innerHTML, selectall" data-shareevent="listen: touchstart, press; listen:touchend, selectAll">Select all</div><input class="search" data-shareevent="listen:touchstart, displayAutoContact; listen:input, updateAutoContact" data-labels="bind:placeholder, tocontactlbl"><div id="sharelistauto" class="autocontact invisible"><div class="autoclose" data-shareevent="listen:touchstart,close"></div><ul data-auto="foreach"><li data-auto="bind:innerHTML, username; bind:highlight, selected" data-shareevent="listen:touchend, select"></li></ul></div><div class="sharecontactlist"><ul data-contacts="foreach"><li class = "contact list-item" data-shareevent="listen:touchstart, discardContact"><p class="contact-name" data-contacts="bind:innerHTML, username"></p><div class="remove-contact"></div><p class="contact-intro" data-contacts="bind:innerHTML, intro"></p></li></ul><p><legend>Add a message</legend><textarea class="input sharemessage" data-share="bind:value, body"></textarea></p><p><legend>Signature</legend><textarea class="signature" data-share="bind:value, signature"></textarea></p><div class="sendmail-footer"><p class="send"><label class="cancelmail" data-labels="bind:innerHTML, cancellbl" data-shareevent="listen: touchstart, press; listen:touchend, cancel">Cancel</label><label class="sendmail" data-labels="bind:innerHTML, sendlbl" data-shareevent="listen:touchstart, press; listen:touchend, share">Share</label><label class="editerror" data-errormsg="bind:innerHTML, errormsg"></label></p></div></form></div>',f.reset=function(t){c.reset({errormsg:""}),v.reset({body:"",docId:t._id,docType:t.type,docTitle:t.title,signature:h.get("username")+" <"+h.get("_id")+">"}),h.get("signature")&&v.set("signature",h.get("signature")),g.reset([])},f.updateAutoContact=function(e,t){var n=JSON.parse(m.toJSON()),r=h.get("connections"),s,o=t.value.toLowerCase();if(t.value==="")m.reset(r);else{for(i=n.length-1;i>=0;i--)s=n[i].username.toLowerCase(),s.search(o)!==0&&n.splice(i,1);m.reset(n)}m.loop(function(e,t){g.toJSON().search(e.contact.userid)>-1&&m.update(t,"selected",!0)})},f.close=function(t,n){n.parentNode.classList.add("invisible")},f.displayAutoContact=function(e,t){document.getElementById("sharelistauto").classList.remove("invisible"),m.reset(h.get("connections"))},f.discardContact=function(e,t){var n=t.getAttribute("data-contacts_id"),r=g.get(n).userid;g.alter("splice",n,1),m.loop(function(e,t){e.userid===r&&setTimeout(function(){m.update(t,"selected",!1)},200)}),f.unselectGroup(r)},f.select=function(e,t){var n=t.getAttribute("data-auto_id");m.get(n).selected?(f.removeContact(m.get(n)),setTimeout(function(){m.update(n,"selected",!1),document.getElementById("sharelistauto").classList.add("invisible")},200)):(f.addContact(m.get(n)),f.selectGroup(),setTimeout(function(){m.update(n,"selected",!0),document.getElementById("sharelistauto").classList.add("invisible")},200))},f.selectAll=function(e,t){t.classList.remove("pressed"),g.reset([]),m.reset(h.get("connections")),m.loop(function(e,t){m.update(t,"selected",!0),e.type==="user"&&g.alter("push",e)})},f.removeContact=function(e){if(e.type==="group")for(j=e.contacts.length-1;j>=0;j--)f.removeContact(e.contacts[j]);else g.loop(function(t,n){t.userid===e.userid&&g.alter("splice",n,1)}),f.unselectGroup(e.userid),m.loop(function(t,n){t.userid===e.userid&&m.update(n,"selected",!1)})},f.selectGroup=function(){var e,t=!1;m.loop(function(n,r){if(n.type==="group"&&!n.selected){e=n.contacts,t=!0;for(j=e.length-1;j>=0;j--)if(g.toJSON().search(e[j].userid)<0){t=!1;break}t&&m.update(r,"selected",!0)}})},f.unselectGroup=function(e){m.loop(function(t,n){t.type==="group"&&t.selected&&JSON.stringify(t.contacts).search(e)>0&&m.update(n,"selected",!1)})},f.addContact=function(e){var t,n,r=!0;if(e.type==="user")g.alter("push",e);else for(t=0,n=e.contacts.length;t<n;t++)g.loop(function(n,s){n.userid===e.contacts[t].userid&&(r=!1)}),r&&(g.alter("push",e.contacts[t]),m.loop(function(n,r){n.userid===e.contacts[t].userid&&m.update(r,"selected",!0)}))},f.press=function(e,t){t.classList.add("pressed")},f.share=function(e,t){var n=new Date,r={type:"DOC",status:"unread",date:[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getMinutes()],author:h.get("_id"),username:h.get("username"),firstname:h.get("firstname"),toList:"",ccList:"",object:"",body:v.get("body"),signature:v.get("signature"),docId:v.get("docId"),docType:v.get("docType"),docTitle:v.get("docTitle"),dest:[]};y||(y=!0,g.loop(function(e,t){r.dest.push(e.userid)}),p.request("Notify",r,function(e){c.set("errormsg",d.get("shareok")),t.classList.remove("pressed"),f.updateSharedWith(r.docId,r.dest),setTimeout(function(){c.set("errormsg",""),y=!1,a("close")},1e3)}))},f.cancel=function(e,t){t.classList.remove("pressed"),a("close")},f.updateSharedWith=function(t,r){var i=new l;i.setTransport(p),i.sync(n.get("db"),t).then(function(){var e=i.get("sharedwith")||[],t,n=!0;e===[]?i.set("sharedwith",r):(r.forEach(function(r){n=!0;for(t=e.length-1;t>=0;t--)e[t]===r&&(n=!1);n&&e.push(r)}),i.set("sharedwith",e)),i.upload()})},f.place(t.get("public-share")),f}}),define("public/public-stack",["Olives/OObject","service/map","Amy/Stack-plugin","./detail-stack/public-idea","./detail-stack/public-edit","./detail-stack/public-sendmail","./detail-stack/public-share","service/config","Store"],function(e,t,n,r,i,s,o,u,a){return function(){var l=new e,c=new n,h=t.get("public-detail"),p=u.get("observer"),d=new a,v=0;return l.plugins.addAll({detailstack:c}),l.alive(h),l.reset=function(t,n){d=t,v=n,c.getStack().get("#public-ideadetail").reset(t,n),c.getStack().show("#public-ideadetail")},l.action=function(t){switch(t){case"#public-edit":c.getStack().get("#public-edit").reset(d.get(v).id),c.getStack().show("#public-edit");break;case"#public-favorites":break;case"#public-share":c.getStack().get("#public-share").reset(d.get(v).doc),c.getStack().show("#public-share");break;case"close":c.getStack().show("#public-ideadetail");break;default:c.getStack().show("#public-ideadetail")}},l.edit=function(t){c.getStack().get("#public-edit").reset(t),c.getStack().show("#public-edit")},l.sendMail=function(t){c.getStack().get("#public-sendmail").reset(t),c.getStack().show("#public-sendmail")},l.share=function(t){c.getStack().get("#public-share").reset(t),c.getStack().show("#public-share")},c.getStack().add("#public-ideadetail",new r(l.action)),c.getStack().add("#public-edit",new i(l.action)),c.getStack().add("#public-sendmail",new s(l.action)),c.getStack().add("#public-share",new o(l.action)),p.watch("public-viewidea",function(e){l.viewIdea(e)}),p.watch("public-edit",function(e){l.edit(e)}),p.watch("public-sendmail",function(e){l.sendMail(e)}),p.watch("public-share",function(e){l.share(e)}),PDS=c,l}}),define("service/new2c",["Olives/OObject","service/map","Olives/Model-plugin","Olives/Event-plugin","service/config","Store"],function(e,t,n,r,i,s){return new function(){var u=new e,a=new s({userid:"",username:""}),f=i.get("user"),l=new s,c=i.get("labels"),h=i.get("transport"),p,d=!1,v=new s({error:""});return u.plugins.addAll({new2c:new n(l),dest:new n(a,{setHeader:function(e){this.innerHTML=c.get("sendtcprefix")+e+c.get("sendtcsuffix")}}),labels:new n(c),errormsg:new n(v),new2cevent:new r(u)}),u.template='<div><div class = "header blue-dark"><span data-dest="bind: setHeader, username"></span><div class="close-popup" data-new2cevent="listen:touchstart, cancel"></div></div><form class="form"><p><textarea class="description input" data-labels="bind:placeholder, twocentplaceholder" data-new2c="bind: value, message"></textarea></p><div><span class="errormsg" data-errormsg="bind:innerHTML, error"></span><div class="sendmail" data-new2cevent="listen:touchstart, press; listen:touchend, upload" data-labels="bind:innerHTML, sendlbl"></div></div></form></div>',u.render(),u.place(t.get("new2c-popup")),u.press=function(e,t){t.classList.add("pressed")},u.closePopup=function(){document.getElementById("new2c-popup").classList.remove("appear"),document.getElementById("cache").classList.remove("appear"),l.reset(),a.reset(),v.reset({error:""})},u.reset=function(n){p=n,t.get("new2c-popup").classList.add("appear"),t.get("cache").classList.add("appear"),a.set("userid",p.userid),a.set("username",p.username),l.reset({author:f.get("_id"),message:"",firstname:f.get("firstname"),username:f.get("username"),date:[],datemod:"",plusones:0,replies:[]}),d=!1},u.cancel=function(e,t){u.closePopup()},u.upload=function(e,t){var n=new Date,r={},i;l.get("message")?(d=!0,i=setInterval(function(){v.get("error")===c.get("sendinginprogress")?v.set("error",c.get("sendinginprogress")+" ..."):v.set("error",c.get("sendinginprogress"))},150),l.set("date",[n.getFullYear(),n.getMonth(),n.getDate()]),r.tc=JSON.parse(l.toJSON()),r.userid=a.get("userid"),r.username=a.get("username"),h.request("SendTwocent",r,function(e){var n=p.twocents||[],s,o=f.get("connections");if(e==="ok"){n.unshift(r.tc),p.twocents=n;for(s=o.length-1;s>=0;s--)o[s].type==="user"&&o[s].userid===p.userid&&o.splice(s,1,p);f.set("connections",o),f.upload().then(function(){clearInterval(i),t.classList.remove("pressed"),u.closePopup()})}else v.set("error","something went wrong - try again later"),clearInterval(i),t.classList.remove("pressed")})):(v.set("error",c.get("nomessage")),t.classList.remove("pressed"))},u}}),define("service/actionbar",["Olives/OObject","Olives/Model-plugin","Olives/Event-plugin","service/config","Store","CouchDBStore","Promise","service/new2c"],function(e,t,n,r,i,s,o,u){function a(e,a,f,c){var h=new i([]),p=a.offsetHeight,d=new i({height:p}),v=10,m=r.get("user"),g=r.get("labels"),y=r.get("observer"),b=r.get("transport"),w,E=this;this.plugins.addAll({buttons:new t(h,{setIcon:function(e){this.setAttribute("style","background-image:url('"+e+"');")}}),style:new t(d,{setPosition:function(e){this.setAttribute("style","height:"+e+"px; margin-top:-"+(e-v)+"px;")},setButtons:function(e){var t=Math.floor((e-v-40)/2);this.setAttribute("style","margin-top:"+t+"px;")}}),action:new n(this)}),this.template='<div class="actionbar" data-style="bind:setPosition, height" data-action="listen:touchend, hide"><ul class="buttonlist" data-style="bind:setButtons, height" data-buttons="foreach"><li class="actionbutton" data-buttons ="bind:setIcon,icon" data-action="listen:touchstart, press; listen:touchend, action"></li></ul></div>',this.hide=function(e,t){c(this)},this.press=function(e,t){t.classList.add("pressed")},this.action=function(e,t){var n=t.getAttribute("data-buttons_id"),i=h.get(n).name;e.stopPropagation(),t.classList.remove("pressed");switch(i){case"delete":this.deleteItem().then(function(){c(E)});break;case"edit":this.editItem();break;case"share":this.shareItem();break;case"replay":r.get("observer").notify("replay-session",f.sessionId);break;case"mail":this.mailItem();break;case"twocent":this.sendTwocent();default:}},w=function(e,t){switch(e){case"idea":t.authors.indexOf(m.get("_id"))>-1&&h.alter("push",{name:"edit",icon:"img/wall/35modify.png"}),t.sessionId&&(t.sessionReplay||t.authors.indexOf(m.get("_id"))>-1)&&h.alter("push",{name:"replay",icon:"img/library/25goToSession.png"}),h.alter("push",{name:"mail",icon:"img/wall/35mail.png"}),t.authors.indexOf(m.get("_id"))>-1&&(m.get("connections")&&m.get("connections").length?h.alter("push",{name:"share",icon:"img/wall/35share.png"}):(m.get("facebook")||m.get("twitter")||m.get("gplus")||m.get("linkedin"))&&h.alter("push",{name:"share",icon:"img/wall/35share.png"})),t.authors.length===1&&t.authors[0]===m.get("_id")&&!t.twocents.length&&!t.sharedwith.length&&t.visibility!=="public"&&h.alter("push",{name:"delete",icon:"img/wall/35delete.png"}),t.authors.indexOf(m.get("_id"))===-1&&t.sharedwith.indexOf(m.get("_id"))>-1&&document.getElementById("library")&&h.alter("push",{name:"delete",icon:"img/wall/35delete.png"});break;case"message":h.alter("push",{name:"mail",icon:"img/wall/35mail.png"}),h.alter("push",{name:"delete",icon:"img/wall/35delete.png"});break;case"contact":h.alter("push",{name:"mail",icon:"img/wall/35mail.png"}),t.type==="user"&&h.alter("push",{name:"twocent",icon:"img/2centDisable.png"}),h.alter("push",{name:"delete",icon:"img/wall/35delete.png"});break;default:}},this.deleteItem=function(){var n=new o,i=new s;i.setTransport(b);switch(e){case"idea":f.authors.length===1&&f.authors[0]===m.get("_id")?i.sync(r.get("db"),f._id).then(function(){i.remove(),n.resolve()}):b.request("RemoveFromLibrary",{id:f._id,userid:m.get("_id")},function(e){});break;case"message":var u=m.get("notifications"),a,c;for(a=0,l=u.length;a<l;a++)if(JSON.stringify(u[a])===JSON.stringify(f)){c=a;break}u.splice(c,1),m.set("notifications",u),m.upload();break;case"contact":var u=m.get("connections"),h=new Date,p=[h.getFullYear(),h.getMonth(),h.getDate(),h.getHours(),h.getMinutes(),h.getSeconds()];if(f.type==="user"){for(a=u.length-1;a>=0;a--)if(u[a].type==="user"&&u[a].userid===f.userid)u.splice(a,1);else if(u[a].type==="group"){var d=u[a].contacts;for(j=d.length-1;j>=0;j--)d[j].userid===f.userid&&d.splice(j,1)}}else for(a=u.length-1;a>=0;a--)u[a].username===f.username&&u.splice(a,1);m.set("connections",u),f.type==="user"&&m.get("news").unshift({type:"CX-",date:p,content:{userid:f.userid,username:f.username}}),m.upload().then(function(){if(f.type==="user"){var e=new Date,t={dest:[f.userid],date:p,original:"",type:"CXCancel",author:m.get("_id"),username:m.get("username"),firstname:m.get("firstname"),toList:f.username,ccList:"",object:m.get("username")+g.get("canceledCX"),body:"",signature:"",contactInfo:{firstname:m.get("firstname"),lastname:m.get("lastname"),userid:m.get("_id"),username:m.get("username"),intro:m.get("intro"),type:"user"}};b.request("Notify",t,function(e){console.log(e)})}y.notify("contact-deleted")});break;default:}return n},this.editItem=function(){switch(e){case"idea":document.getElementById("public")?y.notify("public-edit",f._id):y.notify("library-edit",f._id);break;default:}},this.mailItem=function(){switch(e){case"idea":document.getElementById("public")?y.notify("public-sendmail",f):y.notify("library-sendmail",f);break;case"message":break;case"contact":y.notify("message-contact",f);break;default:}},this.shareItem=function(){switch(e){case"idea":document.getElementById("public")?y.notify("public-share",f):y.notify("library-share",f);break;case"message":break;case"contact":break;default:}},this.sendTwocent=function(){u.reset(f)},w(e,f)}return function(n,r,i,s){return a.prototype=new e,new a(n,r,i,s)}}),define("public/lists/list-public",["Olives/OObject","CouchDBStore","service/config","Olives/Model-plugin","Olives/Event-plugin","service/utils","service/avatar","service/actionbar","Promise"],function(e,t,n,r,i,s,o,u,a){function f(e,f,l,c){var h=new t([]),p,d,v=!1,m=null,g={db:e,view:l,design:f,query:{descending:!0,include_docs:!0,limit:30}};h.setTransport(n.get("transport")),this.template="<ul class='ideas-list' data-listideas='foreach'><li class='list-item' data-listevent='listen:touchstart, setStart; listen:touchmove, showActionBar'><div class='item-header'><div class='avatar' data-listideas='bind:setAvatar,doc.authors'></div><h2 data-listideas='bind:innerHTML,doc.authornames'></h2><span class='date' data-listideas='bind:date,doc.creation_date'></span></div><div class='item-body'><h3 data-listideas='bind:innerHTML,doc.title'>Idea title</h3><p data-listideas='bind:innerHTML,doc.description'></p></div><div class='item-footer'><a class='idea-type'></a><a class='item-acorn'></a><span class='rating' data-listideas='bind:setRating, value.rating'></span> </div></li></ul>",this.plugins.addAll({listideas:new r(h,{date:function y(y){this.innerHTML=s.formatDate(y)},setRating:function(t){if(t===undefined){var n=this.getAttribute("data-listideas_id"),r=h.get(n).doc.votes||[];r.length===0?this.innerHTML="":this.innerHTML=Math.round(r.reduce(function(e,t){return e+t})/r.length*100)/100}else this.innerHTML=t},setAvatar:function(t){var n,r;r=document.createDocumentFragment(),n=new o(t),n.place(r),this.hasChildNodes()?this.replaceChild(r,this.firstChild):this.appendChild(r)}}),listevent:new i(this)}),this.getModel=function(){return h},this.resetQuery=function(e){var t=new a;return g.query=e,h.unsync(),h.reset([]),h.sync(g.db,g.design,g.view,g.query).then(function(){t.resolve()}),t},this.setStart=function(e,t){p=[e.pageX,e.pageY],m&&this.hideActionBar(m)},this.showActionBar=function(e,t){var n=t.getAttribute("data-listideas_id"),r=document.getElementById("public");d=[e.pageX,e.pageY];if(!r.classList.contains("mosaic")&&!v&&p[0]-d[0]>40&&d[1]-p[1]<20&&d[1]-p[1]>-20){var i=new u("idea",t,h.get(n).doc,this.hideActionBar),s=document.createDocumentFragment();i.place(s),t.appendChild(s),m=i,v=!0}},this.hideActionBar=function(t){var n=t.dom.parentElement;n.removeChild(n.lastChild),v=!1,m=null},c&&(g.query=c),this.init=function(t){var n=new a;return h.sync(g.db,g.design,g.view,g.query).then(function(){t(h,0),n.resolve()}),n}}return function(n,r,i,s){return f.prototype=new e,new f(n,r,i,s)}}),define("public/lists/list-polling",["Olives/OObject","CouchDBStore","Store","service/config","Olives/Model-plugin","Olives/Event-plugin","service/utils","service/avatar","service/actionbar","Promise"],function(e,t,n,r,i,s,o,u,a,f){function l(e,l,c,h){var p=new n([]),d,v,m,g=!1,y=null,b=r.get("user"),w={db:e,view:c,design:l,query:{descending:!0,include_docs:!0,limit:30}};this.template="<ul class='ideas-list' data-listideas='foreach'><li class='list-item' data-listevent='listen:touchstart, setStart; listen:touchmove, showActionBar'><div class='item-header'><div class='avatar' data-listideas='bind:setAvatar,doc.authors'></div><h2 data-listideas='bind:innerHTML,doc.authornames'></h2><span class='date' data-listideas='bind:date,doc.creation_date'></span></div><div class='item-body'><h3 data-listideas='bind:innerHTML,doc.title'>Idea title</h3><p data-listideas='bind:innerHTML,doc.description'></p></div><div class='item-footer'><a class='idea-type'></a><a class='item-acorn'></a><span class='rating' data-listideas='bind:setRating, value.rating'></span> </div></li></ul>",this.plugins.addAll({listideas:new i(p,{date:function E(E){this.innerHTML=o.formatDate(E)},setRating:function(t){if(t===undefined){var n=this.getAttribute("data-listideas_id"),r=p.get(n).doc.votes||[];r.length===0?this.innerHTML="":this.innerHTML=Math.round(r.reduce(function(e,t){return e+t})/r.length*100)/100}else this.innerHTML=t},setAvatar:function(t){var n,r;r=document.createDocumentFragment(),n=new u(t),n.place(r),this.hasChildNodes()?this.replaceChild(r,this.firstChild):this.appendChild(r)}}),listevent:new s(this)}),this.getModel=function(){return p},this.resetQuery=function(e){var n=new f,i=b.get("settings").polling_interval||r.get("polling_interval"),s=new t;return w.query=e,clearInterval(m),s.setTransport(r.get("transport")),s.sync(w.db,w.design,w.view,w.query).then(function(){p.reset(JSON.parse(s.toJSON())),s.unsync(),m=setInterval(function(){s.reset(),s.sync(w.db,w.design,w.view,w.query).then(function(){p.reset(JSON.parse(s.toJSON())),s.unsync()})},i),n.resolve()}),n},this.setStart=function(e,t){d=[e.pageX,e.pageY],y&&this.hideActionBar(y)},this.showActionBar=function(e,t){var n=t.getAttribute("data-listideas_id"),r=document.getElementById("public");v=[e.pageX,e.pageY];if(!r.classList.contains("mosaic")&&!g&&d[0]-v[0]>40&&v[1]-d[1]<20&&v[1]-d[1]>-20){var i=new a("idea",t,p.get(n).doc,this.hideActionBar),s=document.createDocumentFragment();i.place(s),t.appendChild(s),y=i,g=!0}},this.hideActionBar=function(t){var n=t.dom.parentElement;n.removeChild(n.lastChild),g=!1,y=null},h&&(w.query=h),this.init=function(n){var i=new f,s=b.get("settings").polling_interval||r.get("polling_interval"),o=new t;return o.setTransport(r.get("transport")),o.sync(w.db,w.design,w.view,w.query).then(function(){p.reset(JSON.parse(o.toJSON())),n(p,0),o.unsync(),m=setInterval(function(){o.reset(),o.sync(w.db,w.design,w.view,w.query).then(function(){p.reset(JSON.parse(o.toJSON())),o.unsync()})},s),i.resolve()}),i},b.watchValue("settings",function(){var e=new t,n;b.get("settings").polling_interval!==r.get("polling_interval")&&(r.set("polling_interval",b.get("settings").polling_interval),n=r.get("polling_interval"),clearInterval(m),e.setTransport(r.get("transport")),m=setInterval(function(){e.reset(),e.sync(w.db,w.design,w.view,w.query).then(function(){p.reset(JSON.parse(e.toJSON())),e.unsync()})},n))})}return function(n,r,i,s){return l.prototype=new e,new l(n,r,i,s)}}),define("service/submenu",["Olives/OObject","Olives/Model-plugin","Amy/Control-plugin","service/config"],function(e,t,n,r){function i(e,i){var s=!1,o,u,a,f,l,c=function(t){t?e.setAttribute("style","display : block;"):e.setAttribute("style","display : none;"),s=t};o="<div></div>",u='<div class="sub-menu"><div class="left-caret"></div><ul class="menu-list" data-menucontrol="radio:li,selected,touchend,setCurrentWidget"><li class="menu-item selected" name="#ideas" data-menucontrol="init"><a class="library-item" href="#ideas" data-label="bind:innerHTML, library-ideas"></a></li><li class="menu-item" name="#sessions"><a class="library-item" href="#sessions" data-label="bind:innerHTML, library-sessions"></a></li><li class="menu-item" name="#decks"><a class="library-item" href="#decks" data-label="bind:innerHTML, library-decks"></a></li></ul></div>',a="<div></div>",f='<div class="sub-menu"><div class="left-caret"></div><ul class="menu-list" data-menucontrol="radio:li,selected,touchstart,setCurrentWidget"><li class="menu-item selected" data-menucontrol="init" name="#messages"><a class="connect-item" href="#connect-messages" data-label="bind:innerHTML, connect-messages"></a></li><li class="menu-item" name="#contacts"><a class="connect-item" href="#connect-contacts" data-label="bind:innerHTML, connect-contacts"></a></li><li class="menu-item" name="#twocents"><a class="connect-item" href="#connect-twocents" data-label="bind:innerHTML, connect-twocents"></a></li></ul></div>',l='<div class="sub-menu"><div class="left-caret"></div><ul class="menu-list" data-menucontrol="radio:li,selected,touchstart,setCurrentWidget"><li class="menu-item selected" name="#profile" data-menucontrol="init"><a class="dashboard-item" href="#dashboard-profile" data-label="bind:innerHTML, dashboard-profile"></a></li><li class="menu-item" name="#settings"><a class="dashboard-item" href="#dashboard-settings" data-label="bind:innerHTML, dashboard-settings">Settings</a></li><li class="menu-item" name="#about"><a class="dashboard-item" href="#dashboard-about" data-label="bind:innerHTML, dashboard-about">About Ideafy</a></li></ul></div>',e.id.search("public")>-1&&(this.template=o),e.id.search("library")>-1&&(this.template=u),e.id.search("brainstorm")>-1&&(this.template=a),e.id.search("connect")>-1&&(this.template=f),e.id.search("dashboard")>-1&&(this.template=l),this.plugins.addAll({label:new t(r.get("labels")),menucontrol:new n(this)}),this.getState=function(){return s},this.toggleActive=function(e){c(e)},this.setCurrentWidget=function(t){var n=t.target.getAttribute("name");i&&i(n),setTimeout(function(){c(!1)},200)},this.render(),this.place(e)}return function(n,r){return i.prototype=new e,new i(n,r)}}),define("public/public",["Olives/OObject","Amy/Control-plugin","Olives/Model-plugin","Amy/Delegate-plugin","CouchDBStore","service/map","service/config","./public-stack","service/utils","./lists/list-public","./lists/list-polling","Amy/Stack-plugin","service/submenu"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){return function(){var i=new e,a=s.get("public"),p=a.querySelector(".bydate"),d=a.querySelector(".byrating"),v=o.get("db"),m=new t(this),g=new u,y=new h(s.get("public-menu")),b=new c;i.plugins.addAll({liststack:b,publicevent:new r(this),publiccontrol:m}),this.selectStart=function(e){var t=b.getStack().getCurrentScreen().getModel(),n=e.target.getAttribute("data-listideas_id");g.reset(t,n)},this.show=function(e,t){var n=a.querySelector(".bydate"),r=a.querySelector(".byrating"),i=t.getAttribute("name");i!==b.getStack().getCurrentName&&(b.getStack().show(i),i==="#list-date"?(g.reset(w.getModel(),0),r.classList.remove("pushed"),n.classList.add("pushed")):(g.reset(E.getModel(),0),r.classList.add("pushed"),n.classList.remove("pushed")))},this.selectEnd=function(e){},this.mosaic=function(){var e=document.getElementById("public-detail");a.classList.toggle("mosaic"),e.classList.contains("invisible")&&(e.classList.remove("invisible"),g.reset(w.getModel(),0))},this.plus=function(){s.get("newidea-popup").classList.add("appear"),s.get("cache").classList.add("appear")},this.search=function(e,t){e.keyCode===13&&(t.value===""?(p.setAttribute("style","display: inline-block;"),d.setAttribute("style","display: inline-block;"),b.getStack().show("#list-date"),p.classList.add("pushed"),d.classList.remove("pushed")):i.searchIdea(t.value))},i.searchIdea=function(t){p.setAttribute("style","display: none;"),d.setAttribute("style","display: none;"),S.resetQuery({q:t,sort:"\\creation_date<date>",include_docs:!0}).then(function(){b.getStack().show("#list-search"),LS=S.getModel(),g.reset(S.getModel(),0)})},i.alive(a),i.showMenu=function(){y.toggleActive(!0)},i.hideMenu=function(){y.toggleActive(!1)},y.toggleActive(!1);var w=new l(v,"library","_view/publicideas"),E=new f(v,"ideas","_view/ideasbyvotes"),S=new f("_fti/local/"+v,"indexedideas","publicbyname",{q:"init_listSearch_UI",sort:"\\creation_date<date>",limit:60,include_docs:!0});return b.getStack().add("#list-rating",E),b.getStack().add("#list-search",S),b.getStack().add("#list-date",w),E.init(g.reset),w.init(g.reset).then(function(){b.getStack().show("#list-date"),g.reset(w.getModel(),0)}),i}}),define("library/ideas/detail-stack/library-idea",["Olives/OObject","Store","Olives/Model-plugin","Olives/Event-plugin","service/map","service/utils","service/avatar","service/config","twocents/writetwocent","twocents/twocentlist","Observable"],function(e,t,n,r,i,s,o,u,a,f,l){return function(h){var p=new e,d=new f,v=new a("library"),m=u.get("labels"),g=new t([{active:!1},{active:!1},{active:!1},{active:!1},{active:!1}]),y=!1,b=u.get("user"),w=u.get("transport"),E=u.get("observer"),S=new t,x=new t([]),T=i.get("ideas-detail"),N=i.get("library-writetwocents"),C=new l;return p.plugins.addAll({label:new n(m),ideadetail:new n(S,{toggleRateEdit:function(e){e.indexOf(b.get("_id"))>-1?this.setAttribute("href","#library-edit"):this.setAttribute("href","#library-favorites")},toggleTwocentShare:function(e){e.indexOf(b.get("_id"))>-1?this.setAttribute("href","#library-share"):this.setAttribute("href","#library-2cents")},displayWriteTwocent:function(e){e.indexOf(b.get("_id"))<0?this.classList.remove("invisible"):this.classList.add("invisible")},displayTwocentList:function(e){e&&e.length&&document.getElementById("public-writetwocents").classList.add("invisible")},date:function k(k){k&&(this.innerHTML=s.formatDate(k))},setAuthor:function(e){e===b.get("username")&&S.get("doc").authors.indexOf(b.get("_id"))>-1?this.innerHTML=m.get("youlbl"):this.innerHTML=e},setWrotelbl:function(e){e.length===1&&e[0]===b.get("_id")?this.innerHTML=m.get("youwrotelbl"):e.length>1?this.innerHTML=m.get("theywrotelbl"):this.innerHTML=m.get("ideawrotelbl")},setAvatar:function(t){var n=document.createDocumentFragment(),r=new o(t);r.place(n),this.hasChildNodes()?this.replaceChild(n,this.firstChild):this.appendChild(n)},hideRating:function(e){e.search("I:WELCOME")>-1?this.classList.add("invisible"):this.classList.remove("invisible")},setRating:function(t){if(t===undefined){var n=S.get("doc").votes;n.length===0?this.innerHTML="":this.innerHTML=Math.round(n.reduce(function(e,t){return e+t})/n.length*100)/100}else this.innerHTML=Math.round(t*100)/100},toggleVoteButton:function(e){var t=S.get("id"),n=S.get("doc").authors;document.getElementById("ratingPopup").classList.remove("appear"),b.get("rated_ideas").indexOf(t)<0&&n.indexOf(b.get("_id"))<0&&!y?(this.setAttribute("name","vote"),this.innerHTML=m.get("votebuttonlbl"),this.classList.remove("votes"),this.classList.add("publicButton")):(y=!0,this.classList.remove("publicButton"),this.setAttribute("name","voted"),e.length===0?this.innerHTML="("+m.get("novotesyet")+")":e.length===1?this.innerHTML="("+m.get("onevote")+")":this.innerHTML="("+e.length+" "+m.get("votes")+")",this.classList.add("votes"))},setSharedWith:function(e){S.get("id").search("I:WELCOME")<0&&e&&e.length?(this.classList.remove("invisible"),e.length===1?this.innerHTML=m.get("sharedwith")+"<b><u>"+1+m.get("ideafyer")+"</u></b>":this.innerHTML=m.get("sharedwith")+"<b><u>"+e.length+m.get("ideafyer")+"</u></b>"):this.classList.add("invisible")}}),share:new n(x),vote:new n(g,{setIcon:function(e){var t="background: url('img/public/activeIdeaVote.png') no-repeat center center;",n="background: url('img/public/rateForList.png') no-repeat center center;";e?this.setAttribute("style",t):this.setAttribute("style",n)}}),ideadetailevent:new r(p)}),p.template='<div class="library-idea"><div class="header blue-dark"><a href="#library-2cents" data-ideadetail="bind: toggleTwocentShare, doc.authors" data-ideadetailevent="listen: touchstart, action" class="option left"></a><span data-label="bind: innerHTML, ideadetailsheadertitle"></span><a href="#library-favorites" data-ideadetail="bind: toggleRateEdit, doc.authors" data-ideadetailevent="listen: touchstart, action" class="option right"></a></div><div class = "detail-contents"><div class="detail-header"><div class="avatar" data-ideadetail="bind:setAvatar, doc.authors"></div><h2 data-ideadetail="bind:innerHTML,doc.title"></h2><span class="date" data-ideadetail="bind:date, doc.creation_date"></span><br><span class="author" data-ideadetail="bind:setAuthor,doc.authornames"></span><span class="commentlbl" data-ideadetail="bind: setWrotelbl, doc.authors"></span></div><div class="detail-body"><p data-ideadetail="bind:innerHTML,doc.description"></p><p data-ideadetail="bind:innerHTML,doc.solution"></p></div><div class="detail-footer"><div class="sharedwith invisible" data-ideadetail="bind: setSharedWith, doc.sharedwith" data-ideadetailevent="listen:touchstart, displayList"></div><div id="sharelist" class="autocontact invisible"><div class="autoclose" data-ideadetailevent="listen:touchstart,close"></div><ul data-share="foreach"><li data-share="bind:innerHTML, value.username"></li></ul></div><div class ="rateIdea" data-ideadetail="bind:hideRating, id"><a class="item-acorn"></a><div class="rating" data-ideadetail="bind:setRating,value.rating"></div><div class="publicButton" data-ideadetail="bind: toggleVoteButton, doc.votes" name="vote" data-ideadetailevent="listen: touchstart, press; listen: touchend, vote;" data-label="bind: innerHTML, votebuttonlbl"></div><div id="ratingPopup" class="popup"><ul class="acorns" data-vote="foreach"><li class="item-acorn" data-vote="bind: setIcon, active" data-ideadetailevent="listen: touchstart, previewVote; listen: touchend, castVote"></li></ul></div></div></div></div><div id="library-writetwocents" class="invisible" data-ideadetail="bind: displayWriteTwocent, doc.authors"></div><div id="library-twocents" class="twocents" data-ideadetail="bind: displayTwocentList, doc.twocents"></div></div>',p.reset=function(t,n){y=!1,S.reset(t.get(n)),v.reset(S.get("id")),d.reset(S.get("id"),"library"),N=document.getElementById("library-writetwocents"),v.place(N),t.watch("updated",function(e,t){e===parseInt(n)&&S.reset(t)})},p.action=function(e,t){var n=t.getAttribute("href");n==="#library-2cents"?(v.reset(S.get("id")),N.classList.remove("invisible")):h(n)},p.edit=function(){_stack.getStack().show("#public-edit")},p.press=function(e,t){t.classList.add("pressed")},p.vote=function(e,t){y||document.getElementById("ratingPopup").classList.add("appear"),t.classList.remove("pressed")},p.previewVote=function(e,t){var n=0,r=t.getAttribute("data-vote_id");g.loop(function(e,t){t<=r?g.update(t,"active",!0):g.update(t,"active",!1)})},p.castVote=function(e,t){var n=parseInt(t.getAttribute("data-vote_id"))+1,r=S.get("id"),i={id:r,vote:n,voter:b.get("_id")};y||(y=!0,w.request("Vote",i,function(e){e!="ok"?(console.log(e,"something went wrong, please try again later"),y=!1):(alert(u.get("labels").get("thankyou")),document.getElementById("ratingPopup").classList.remove("appear"),_node=T.querySelector("publicButton"),g.reset([{active:!1},{active:!1},{active:!1},{active:!1},{active:!1}]))}))},p.close=function(t,n){n.parentNode.classList.add("invisible")},p.displayList=function(e,t){w.request("GetUserNames",{list:S.get("doc").sharedwith},function(e){console.log(e),x.reset(e),document.getElementById("sharelist").classList.remove("invisible")})},p.place(T),p}}),define("library/ideas/detail-stack/library-edit",["Olives/OObject","service/map","CouchDBStore","Olives/Model-plugin","Olives/Event-plugin","service/config","service/confirm"],function(e,t,n,r,i,s,o){return function(a){var f=new e,l=new n,c=s.get("labels"),h=new n({error:""});return l.setTransport(s.get("transport")),f.plugins.addAll({editlabel:new r(c),editidea:new r(l,{setVisibility:function(e){e==="public"?this.innerHTML=c.get("publiclbl"):this.innerHTML=c.get("privatelbl")},hideVisibility:function(e){e==="public"?this.setAttribute("style","display:none"):this.setAttribute("style","display:inline-block")},setVisibleIcon:function(e){e==="public"?this.setAttribute("style","background:url('img/public/publicForList.png') no-repeat left center; background-size: 14px 12px;"):this.setAttribute("style","background-image:url('img/public/privateForList.png');")},setReplay:function(e){e?this.setAttribute("style","display:inline-block"):this.setAttribute("style","display:none")},setIdeafyStatus:function(e){e?this.innerHTML=c.get("enabledreplaylbl"):this.innerHTML=c.get("disabledreplaylbl")},setSessionReplay:function(e){e?this.innerHTML=c.get("disablereplaylbl"):this.innerHTML=c.get("enablereplaylbl")}}),editevent:new i(f),errormsg:new r(h,{setError:function(e){switch(e){case"notitle":this.innerHTML=c.get("titlefield")+c.get("emptyfielderror");break;case"nodesc":this.innerHTML=c.get("descriptionfield")+c.get("emptyfielderror");break;case"nosol":this.innerHTML=c.get("solutionfield")+c.get("emptyfielderror");break;default:this.innerHTML=""}}})}),f.template='<div class="idea-edit"><div class="header blue-dark"><span data-editlabel="bind:innerHTML, modifyidealbl"></span></div><form class="form"><p><input type="text" class="input" data-editidea="bind: value, title"></p><p><textarea class="description input" data-editidea="bind: value, description"></textarea></p><p><textarea class="solution input" data-editidea="bind: value, solution"></textarea></p><div class="options"><div class="current-visibility" data-editidea="bind:setVisibleIcon, visibility"><span class="label" data-editlabel="bind:innerHTML,ideavisiblelbl"></span><span data-editlabel="bind:innerHTML, privatelbl" data-editidea="bind:setVisibility, visibility"></span></div><div class="edit-visibility" data-editidea="bind:hideVisibility, visibility"><span class="label" data-editlabel="bind:innerHTML,setideavisiblelbl"></span><div class="visibility public" data-editlabel="bind:innerHTML, publiclbl" data-editevent="listen:touchstart, editVisibility"></div></div></div><div class="options invisible" data-editidea="bind:setReplay, sessionId"><div class="current-visibility replay"><span class="label" data-editlabel="bind:innerHTML,ideafyreplaylbl"></span><span data-editlabel="bind:innerHTML, disabledreplaylbl" data-editidea="bind:setIdeafyStatus, sessionReplay"></span></div><div class="edit-visibility replay"><span class="label" data-editlabel="bind:innerHTML, ideafysetreplaylbl"></span><div class="toggle-replay" data-editidea = "bind: setSessionReplay, sessionReplay" data-editevent="listen:touchstart, press; listen:touchend, enableReplay" data-editlabel="bind:innerHTML, enablereplaylbl"></div></div></div><p class="submit"><label class="publish pressed-btn" data-editlabel="bind:innerHTML, publishlbl" data-editevent="listen:touchend, upload"></label><label class="cancel pressed-btn" data-editlabel="bind:innerHTML, cancellbl" data-editevent="listen:touchend, cancel"></label><label class="editerror" data-errormsg="bind:setError, error"></label></p></form></div>',f.place(t.get("library-edit")),f.reset=function(t){l.unsync(),l.reset(),l.sync(s.get("db"),t)},f.editVisibility=function(e,t){var n=new o(t,c.get("setpublicquestion"),function(e){e?l.set("visibility","public"):l.set("visibility","private"),n.close()})},f.press=function(e,t){t.classList.add("pressed")},f.enableReplay=function(e,t){setTimeout(function(){l.get("sessionReplay")?l.set("sessionReplay",!1):l.set("sessionReplay",!0),t.classList.remove("pressed")},300)},f.upload=function(e,t){var n=new Date,r=[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()];l.get("title")===""?h.set("error","notitle"):l.get("description")===""?h.set("error","nodesc"):l.get("solution")===""?h.set("error","nosol"):(l.set("modification_date",r),l.upload().then(function(){a("close")})),nide.classList.remove("pressed")},f.cancel=function(e,t){t.classList.remove("pressed"),a("close")},f}}),define("library/ideas/detail-stack/library-sendmail",["Olives/OObject","service/map","service/config","Olives/Model-plugin","Olives/Event-plugin","Store","service/avatar","service/utils"],function(e,t,n,r,s,o,u,a){return function(c){var h=new e,p=new o({errormsg:""}),d=n.get("user"),v=n.get("transport"),m=n.get("labels"),g=new o({toField:"",from:"",subject:"",body:"",signature:"",attachment:"",sent:!1});return h.plugins.addAll({labels:new r(m),mail:new r(g,{setUserAvatar:function(e){console.log("from",e),e&&this.setAttribute("style","background: url('"+n.get("avatar")+"') no-repeat center center; background-size: cover")},date:function y(y){y&&(this.innerHTML=a.formatDate(y))},setAvatar:function(t){if(t){var n=document.createDocumentFragment(),r=new u(t);r.place(n),this.hasChildNodes()?this.replaceChild(n,this.firstChild):this.appendChild(n)}},setRating:function(e){},setVotes:function(e){}}),mailevent:new s(h),errormsg:new r(p)}),h.template='<div class="idea-sendmail"><div class="header blue-dark"><span data-labels="bind:innerHTML, sendidealbl"></span></div><div class="avatar" data-mail="bind:setUserAvatar, from"></div><form class="form"><p><textarea class="mail-header" data-mail="bind: value, toField" data-labels="bind:placeholder, tolbl"></textarea></p><p><input type="text" class="input" data-mail="bind:value, subject" data-labels="bind:placeholder, subjectlbl"></textarea></p><p><textarea class="input" data-mail="bind:value, body"></textarea></p><p><legend data-labels="bind: innerHTML, signaturelbl"></legend><textarea class="signature" data-mail="bind:value, signature"></textarea></p><div class="attachment"><div class="attachment-header"><div data-mail="bind:setAvatar, attachment.authors"></div><span class="date" data-mail="bind:date, attachment.creation_date"></span><h2 data-mail="bind:innerHTML,attachment.title"></h2><span class="author" data-mail="bind:innerHTML,attachment.authornames"></span><span data-labels="bind:innerHTML, ideawrotelbl"></span><div class="visibility-icon private"></div></div><div class="attachment-body"><p data-mail="bind:innerHTML,attachment.description"></p><p data-mail="bind:innerHTML,attachment.solution"></p><div class = "rating" data-mail="bind:setRating, attachment.rating"></div><div class = "votes" data-mail="bind:setVotes, attachment.votes"></div></div></div><div class="sendmail-footer"><p class="send"><label class="cancelmail" data-labels="bind:innerHTML, cancellbl" data-mailevent="listen: touchstart, press; listen:touchend, cancel">Cancel</label><label class="sendmail" data-labels="bind:innerHTML, sendlbl" data-mailevent="listen:touchstart, press; listen:touchend, send">Send</label><label class="editerror" data-errormsg="bind:innerHTML, errormsg"></label></p></div></form></div>',h.reset=function(t){p.reset({errormsg:""}),g.reset({toField:"",from:d.get("username"),subject:"",body:"",signature:d.get("username")+" <"+d.get("_id"),attachment:t,sent:!1}),d.get("signature")&&g.set("signature",d.get("signature"))},h.validateAddress=function(t){var n=/^[a-z0-9._-]+@[a-z0-9.-]+\.[a-z]{2,4}$/,r=t.toLowerCase().split(/,|;/),s=!0;for(i=0,l=r.length;i<l;i++)if(!n.test(r[i].trim())){p.set("errormsg",r[i]+m.get("notavalidaddress")),s=!1;break}return s},h.validateMessage=function(){return g.get("toField")?h.validateAddress(g.get("toField")):p.set("errormsg",m.get("norecipient")),p.get("errormsg")===""},h.sendMail=function(){var t={};t.type="doc",t.recipient=g.get("toField"),t.cc=d.get("_id"),t.replyTo=d.get("_id"),t.subject=d.get("username")+m.get("sentdocmsg"),t.header=g.get("subject"),t.body=g.get("body"),t.signature=g.get("signature"),t.attachHeader="<div style='background:#657B99; font-family:Helvetica; padding:15px;'><p style='color:white;font-size:24px;font-weight:bold;margin-top:10px;'>"+g.get("attachment").title+"</p><p style='color: #F27B3D; font-size:16px; font-weight:bold;margin-bottom:10px;'>"+g.get("attachment").authornames+", <span style='color:black';>"+a.formatDate(g.get("attachment").creation_date)+"</span></p></div>",t.attachBody="<div style='border:1px solid #657b99;background:white'><p style='font-size:14px; font-family:Helvetica; text-align:justify; padding:15px;'>"+g.get("attachment").description+"</p><p style='font-size:14px; font-family:Helvetica; text-align:justify; padding:15px;'>"+g.get("attachment").solution+"</p></div>",v.request("SendMail",t,function(e){e.sendmail==="ok"?(p.set("errormsg",m.get("yourmessage")+e.recipient+m.get("sentoklbl")),setTimeout(function(){c("close")},350)):(p.set("errormsg",m.get("somethingwrong")),g.set("sent",!1),console.log("error",e.error),console.log("response",e.response))})},h.press=function(e,t){(!t.classList.contains("sendmail")||!g.get("sent"))&&t.classList.add("pressed")},h.send=function(e,t){g.get("sent")||(g.set("sent",!0),p.set("errormsg",""),t.classList.remove("pressed"),h.validateMessage()?h.sendMail():g.set("sent",!1))},h.cancel=function(e,t){t.classList.remove("pressed"),c("close")},h.place(t.get("library-sendmail")),h}}),define("library/ideas/detail-stack/library-share",["Olives/OObject","service/map","service/config","Olives/Model-plugin","Olives/Event-plugin","Store","service/avatar","service/utils","service/autocontact","CouchDBStore"],function(e,t,n,r,s,o,u,a,f,l){return function(a){var f=new e,c=new o({errormsg:""}),h=n.get("user"),p=n.get("transport"),d=n.get("labels"),v=new o({body:"",docId:"",docType:"",attachment:"",docTitle:"",signature:h.get("signature")}),m=new o([]),g=new o([]),y=!1;return f.plugins.addAll({labels:new r(d),share:new r(v,{setHeader:function(e){this.innerHTML=d.get("sharing")+e}}),contacts:new r(g,{setSelected:function(e){e?this.innerHTML="&#10003;":this.innerHTML=""}}),auto:new r(m,{highlight:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),shareevent:new s(f),errormsg:new r(c)}),f.template='<div class="idea-share"><div class="header blue-dark"><span data-share="bind:setHeader, docTitle">Sharing idea</span></div><form class="form"><legend>Select contacts</legend><div class="selectall" data-labels="bind:innerHTML, selectall" data-shareevent="listen: touchstart, press; listen:touchend, selectAll">Select all</div><input class="search" data-shareevent="listen:touchstart, displayAutoContact; listen:input, updateAutoContact" data-labels="bind:placeholder, tocontactlbl"><div id="sharelistauto" class="autocontact invisible"><div class="autoclose" data-shareevent="listen:touchstart,close"></div><ul data-auto="foreach"><li data-auto="bind:innerHTML, username; bind:highlight, selected" data-shareevent="listen:touchend, select"></li></ul></div><div class="sharecontactlist"><ul data-contacts="foreach"><li class = "contact list-item" data-shareevent="listen:touchstart, discardContact"><p class="contact-name" data-contacts="bind:innerHTML, username"></p><div class="remove-contact"></div><p class="contact-intro" data-contacts="bind:innerHTML, intro"></p></li></ul></div><p><legend>Add a message</legend><textarea class="input sharemessage" data-share="bind:value, body"></textarea></p><p><legend>Signature</legend><textarea class="signature" data-share="bind:value, signature"></textarea></p><div class="sendmail-footer"><p class="send"><label class="cancelmail" data-labels="bind:innerHTML, cancellbl" data-shareevent="listen: touchstart, press; listen:touchend, cancel">Cancel</label><label class="sendmail" data-labels="bind:innerHTML, sharelbl" data-shareevent="listen:touchstart, press; listen:touchend, share">Share</label><label class="editerror" data-errormsg="bind:innerHTML, errormsg"></label></p></div></form></div>',f.reset=function(t){c.reset({errormsg:""}),v.reset({body:"",docId:t._id,docType:t.type,docTitle:t.title,signature:h.get("username")+" <"+h.get("_id")+">"}),h.get("signature")&&v.set("signature",h.get("signature")),g.reset([])},f.updateAutoContact=function(e,t){var n=JSON.parse(m.toJSON()),r=h.get("connections"),s,o=t.value.toLowerCase();if(t.value==="")m.reset(r);else{for(i=n.length-1;i>=0;i--)s=n[i].username.toLowerCase(),s.search(o)!==0&&n.splice(i,1);m.reset(n)}m.loop(function(e,t){g.toJSON().search(e.contact.userid)>-1&&m.update(t,"selected",!0)})},f.close=function(t,n){n.parentNode.classList.add("invisible")},f.displayAutoContact=function(e,t){document.getElementById("sharelistauto").classList.remove("invisible"),m.reset(h.get("connections"))},f.discardContact=function(e,t){var n=t.getAttribute("data-contacts_id"),r=g.get(n).userid;g.alter("splice",n,1),m.loop(function(e,t){e.userid===r&&setTimeout(function(){m.update(t,"selected",!1)},200)}),f.unselectGroup(r)},f.select=function(e,t){var n=t.getAttribute("data-auto_id");m.get(n).selected?(f.removeContact(m.get(n)),setTimeout(function(){m.update(n,"selected",!1),document.getElementById("sharelistauto").classList.add("invisible")},200)):(f.addContact(m.get(n)),f.selectGroup(),setTimeout(function(){m.update(n,"selected",!0),document.getElementById("sharelistauto").classList.add("invisible")},200))},f.selectAll=function(e,t){t.classList.remove("pressed"),g.reset([]),m.reset(h.get("connections")),m.loop(function(e,t){m.update(t,"selected",!0),e.type==="user"&&g.alter("push",e)})},f.removeContact=function(e){if(e.type==="group")for(j=e.contacts.length-1;j>=0;j--)f.removeContact(e.contacts[j]);else g.loop(function(t,n){t.userid===e.userid&&g.alter("splice",n,1)}),f.unselectGroup(e.userid),m.loop(function(t,n){t.userid===e.userid&&m.update(n,"selected",!1)})},f.selectGroup=function(){var e,t=!1;m.loop(function(n,r){if(n.type==="group"&&!n.selected){e=n.contacts,t=!0;for(j=e.length-1;j>=0;j--)if(g.toJSON().search(e[j].userid)<0){t=!1;break}t&&m.update(r,"selected",!0)}})},f.unselectGroup=function(e){m.loop(function(t,n){t.type==="group"&&t.selected&&JSON.stringify(t.contacts).search(e)>0&&m.update(n,"selected",!1)})},f.addContact=function(e){var t,n,r=!0;if(e.type==="user")g.alter("push",e);else for(t=0,n=e.contacts.length;t<n;t++)g.loop(function(n,s){n.userid===e.contacts[t].userid&&(r=!1)}),r&&(g.alter("push",e.contacts[t]),m.loop(function(n,r){n.userid===e.contacts[t].userid&&m.update(r,"selected",!0)}))},f.press=function(e,t){t.classList.add("pressed")},f.share=function(e,t){var n=new Date,r={type:"DOC",status:"unread",date:[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getMinutes()],author:h.get("_id"),username:h.get("username"),firstname:h.get("firstname"),toList:"",ccList:"",object:"",body:v.get("body"),signature:v.get("signature"),docId:v.get("docId"),docType:v.get("docType"),docTitle:v.get("docTitle"),dest:[]};y||(y=!0,g.loop(function(e,t){r.dest.push(e.userid)}),p.request("Notify",r,function(e){c.set("errormsg",d.get("shareok")),t.classList.remove("pressed"),f.updateSharedWith(r.docId,r.dest),setTimeout(function(){c.set("errormsg",""),y=!1,a("close")},1e3)}))},f.cancel=function(e,t){t.classList.remove("pressed"),a("close")},f.updateSharedWith=function(t,r){var i=new l;i.setTransport(p),i.sync(n.get("db"),t).then(function(){var e=i.get("sharedwith")||[],t,n=!0;e===[]?i.set("sharedwith",r):(r.forEach(function(r){n=!0;for(t=e.length-1;t>=0;t--)e[t]===r&&(n=!1);n&&e.push(r)}),i.set("sharedwith",e)),i.upload()})},f.place(t.get("library-share")),f}}),define("library/ideas/idea-stack",["Olives/OObject","service/map","Amy/Stack-plugin","./detail-stack/library-idea","./detail-stack/library-edit","./detail-stack/library-sendmail","./detail-stack/library-share","service/config","Store"],function(e,t,n,r,i,s,o,u,a){return function(){var l=new e,c=new n,h=t.get("ideas-detail"),p=u.get("observer"),d=new a,v=0;return l.plugins.addAll({detailstack:c}),l.alive(h),l.reset=function(t,n){d=t,v=n,c.getStack().get("#library-ideadetail").reset(t,n),c.getStack().show("#library-ideadetail")},l.action=function(t){switch(t){case"#library-edit":c.getStack().get("#library-edit").reset(d.get(v).id),c.getStack().show("#library-edit");break;case"#library-favorites":break;case"#library-share":c.getStack().get("#library-share").reset(d.get(v).doc),c.getStack().show("#library-share");break;case"close":c.getStack().show("#library-ideadetail");break;default:c.getStack().show("#library-ideadetail")}},l.edit=function(t){c.getStack().get("#library-edit").reset(t),c.getStack().show("#library-edit")},l.sendMail=function(t){c.getStack().get("#library-sendmail").reset(t),c.getStack().show("#library-sendmail")},l.share=function(t){c.getStack().get("#library-share").reset(t),c.getStack().show("#library-share")},c.getStack().add("#library-ideadetail",new r(l.action)),c.getStack().add("#library-edit",new i(l.action)),c.getStack().add("#library-sendmail",new s(l.action)),c.getStack().add("#library-share",new o(l.action)),p.watch("library-viewidea",function(e){l.viewIdea(e)}),p.watch("library-edit",function(e){l.edit(e)}),p.watch("library-sendmail",function(e){l.sendMail(e)}),p.watch("library-share",function(e){l.share(e)}),l}}),define("library/ideas/lists/idealist",["Olives/OObject","CouchDBStore","service/config","Olives/Model-plugin","Olives/Event-plugin","service/utils","service/avatar","service/actionbar","Promise"],function(e,t,n,r,i,s,o,u,a){function f(e,f,l,c){var h=new t([]),p,d,v=!1,m=null,g={db:e,view:l,design:f,query:{descending:!0,include_docs:!0}};h.setTransport(n.get("transport")),this.template='<ul class="ideas-list" data-listideas="foreach"><li class="list-item" data-listevent="listen:touchstart, setStart; listen:touchmove, showActionBar"><div class="item-header"><div class="avatar" data-listideas="bind:setAvatar,doc.authors"></div><h2 data-listideas="bind:innerHTML,doc.authornames"></h2><span class="date" data-listideas="bind:date,doc.creation_date"></span></div><div class="item-body"><h3 data-listideas="bind:innerHTML,doc.title"></h3><p data-listideas="bind:innerHTML,doc.description"></p></div><div class="item-footer"><a class="idea-type private" data-listideas="bind:setVisibility, doc.visibility"></a><a class="item-acorn"></a><span class="rating" data-listideas="bind:setRating, value.rating"></span></div></li></ul>',this.plugins.addAll({listideas:new r(h,{date:function y(y){y?this.innerHTML=s.formatDate(y):this.innerHTML=""},setRating:function(t){if(t===undefined){var n=this.getAttribute("data-listideas_id"),r=h.get(n).doc.votes||[];r.length===0?this.innerHTML="0":this.innerHTML=Math.round(r.reduce(function(e,t){return e+t})/r.length*100)/100}else this.innerHTML=Math.round(t*100)/100},setAvatar:function(t){var n,r;t&&(r=document.createDocumentFragment(),n=new o(t),n.place(r),this.hasChildNodes()?this.replaceChild(r,this.firstChild):this.appendChild(r))},setVisibility:function(e){e==="public"?this.classList.add("public"):this.classList.remove("public")}}),listevent:new i(this)}),this.getModel=function(){return h},this.resetQuery=function(e){var t=new a;return g.query=e,h.unsync(),h.reset([]),h.sync(g.db,g.design,g.view,g.query).then(function(){t.resolve()}),t},this.setStart=function(e,t){p=[e.pageX,e.pageY],m&&this.hideActionBar(m)},this.showActionBar=function(e,t){var n=t.getAttribute("data-listideas_id"),r=document.getElementById("ideas");d=[e.pageX,e.pageY];if(!r.classList.contains("mosaic")&&!v&&p[0]-d[0]>40&&d[1]-p[1]<20&&d[1]-p[1]>-20){var i=new u("idea",t,h.get(n).doc,this.hideActionBar),s=document.createDocumentFragment();i.place(s),t.appendChild(s),m=i,v=!0}},this.hideActionBar=function(t){var n=t.dom.parentElement;n.removeChild(n.lastChild),v=!1,m=null},c&&(g.query=c),this.init=function(){var t=new a;return h.sync(g.db,g.design,g.view,g.query).then(function(){t.resolve()}),t}}return function(n,r,i,s){return f.prototype=new e,new f(n,r,i,s)}}),define("library/ideas/ideas",["Olives/OObject","Amy/Control-plugin","Olives/Model-plugin","Amy/Delegate-plugin","CouchDBStore","service/map","service/config","./idea-stack","./lists/idealist","Amy/Stack-plugin"],function(e,t,n,r,i,s,o,u,a,f){return function(){var c=new e,h=s.get("ideas"),p=h.querySelector(".bydate"),d=h.querySelector(".byrating"),v=new i({search:""}),m=o.get("db"),g=o.get("observer"),y=new t(this),b=new u,w=new f;c.plugins.addAll({idealiststack:w,search:new n(v),ideasevent:new r(this),ideascontrol:y}),this.selectStart=function(e){var t=w.getStack().getCurrentScreen().getModel(),n=e.target.getAttribute("data-listideas_id");b.reset(t,n),v.set("search","")},this.show=function(e,t){var n=h.querySelector(".bydate"),r=h.querySelector(".byrating"),i=t.getAttribute("name");i!==w.getStack().getCurrentName&&(w.getStack().show(i),i==="#list-date"?(b.reset(E.getModel(),0),r.classList.remove("pushed"),n.classList.add("pushed")):(b.reset(x.getModel(),0),r.classList.add("pushed"),n.classList.remove("pushed")))},this.mosaic=function(){var e=document.getElementById("ideas-detail");h.classList.toggle("mosaic"),e.classList.contains("invisible")?(e.classList.remove("invisible"),b.reset(E.getModel(),0)):e.classList.add("invisible")},this.plus=function(){s.get("newidea-popup").classList.add("appear"),s.get("cache").classList.add("appear")},this.search=function(e,t){e.keyCode===13&&(t.value===""?(p.setAttribute("style","display: inline-block;"),d.setAttribute("style","display: inline-block;"),w.getStack().show("#list-date"),p.classList.add("pushed"),d.classList.remove("pushed")):c.searchIdea(t.value))},c.searchIdea=function(t){p.setAttribute("style","display: none;"),d.setAttribute("style","display: none;"),S.resetQuery({q:t,sort:"\\creation_date<date>",include_docs:!0}).then(function(){w.getStack().show("#list-search"),v.set("search",S.getModel().get(0).doc.title),b.reset(S.getModel(),0)})},c.alive(h);var E=new a(m,"library","_view/ideas",{key:o.get("uid"),descending:!0,include_docs:!0}),S=new a("_fti/local/"+m,"indexedideas","userbyname",{q:"init_listSearch_UI",sort:"\\creation_date<date>",limit:30,include_docs:!0}),x=new a(m,"ideas","_view/privatebyvotes",{startkey:'["'+o.get("user").get("_id")+'",{}]',endkey:'["'+o.get("user").get("_id")+'"]',descending:!0,include_docs:!0});return w.getStack().add("#list-date",E),w.getStack().add("#list-search",S),w.getStack().add("#list-rating",x),x.init(),E.init().then(function(){w.getStack().show("#list-date"),b.reset(E.getModel(),0)}),c}}),define("service/avatarlist",["Olives/OObject","Olives/Model-plugin","Olives/Event-plugin","service/config","service/utils","Store"],function(e,t,n,r,i,s){function o(e){var i=new s([]),o,u=r.get("avatars");this.plugins.addAll({avatar:new t(i,{setAvatar:function(e){this.setAttribute("style","background-image: url('"+e+"');")}}),event:new n(this)}),this.template='<ul data-avatar="foreach"><li data-avatar="bind: setAvatar, img; bind: name, id"></li></ul>';for(o=0;o<e.length;o++)e[o]===r.get("user").get("_id")?i.alter("push",{id:e[o],img:r.get("avatar")}):u.get(e[o])?i.alter("push",{id:e[o],img:u.get(e[o])}):r.get("transport").request("GetAvatar",{id:e[o]},function(t){t.error||i.alter("push",{id:e[o],img:t})})}return function(n){return o.prototype=new e,new o(n)}}),define("library/sessions/sessions",["Olives/OObject","service/map","Olives/Model-plugin","Olives/Event-plugin","service/config","CouchDBStore","Store","service/utils","service/avatarlist"],function(e,t,n,r,s,o,u,a,f){return function(){var c=new e,h=new e,p,d,v=t.get("sessions"),m=new u,g=s.get("db"),y=s.get("user"),b=s.get("avatars"),w=s.get("labels"),E=new u({sbytitle:{selected:!1,descending:!0},sbydate:{selected:!0,descending:!0},sbyidea:{selected:!1,descending:!0},sbyscore:{selected:!1,descending:!0}}),S="sbydate",x=[],T=[],N="",C=new o;return C.setTransport(s.get("transport")),c.plugins.addAll({label:new n(w),sort:new n(E,{setSelected:function(e){e?this.classList.add("selectsort"):this.classList.remove("selectsort")},setOrder:function(e){e?(this.classList.remove("sort-ascending"),this.classList.add("sort-descending")):(this.classList.remove("sort-descending"),this.classList.add("sort-ascending"))}}),sessions:new n(m,{formatDate:function(e){e&&e.length&&(this.innerHTML=a.formatDate(e))},formatIdeas:function(e){if(e&&e.length===1)this.innerHTML=e[0].title;else if(e&&e.length>1){var t=[];for(i=0;i<e.length;i++)t.push(e[i].title);this.innerHTML=t.join("<br/>")}else this.innerHTML=w.get("noideayet")},setAvatars:function(e){var t=new f(e),n=document.createDocumentFragment(),r=this;t.place(n),r.hasChildNodes()?r.replaceChild(n,r.firstChild):r.appendChild(n)},setStatus:function(e){e==="completed"?this.innerHTML=w.get("completed"):this.innerHTML=w.get("inprogress")},setScore:function(e){e>=0?this.innerHTML=e:this.innerHTML=""},setSuffix:function(e){e===undefined||e===""||e===null?this.innerHTML=w.get("noscore"):this.innerHTML="ip"}}),sortevent:new r(c),sessionevent:new r(c)}),c.template='<div id="sessions"><div id="session-list" class="list"><div class="header blue-light" data-label="bind: innerHTML, library-sessions"></div><div class="session-tools"><div class="session-sorting"><div id="sbytitle" class="sort-button" data-sort="bind: setSelected, sbytitle.selected" data-sortevent="listen: touchstart, sort"><span data-label="bind: innerHTML, sbytitle"></span><div class="sort-caret" data-sort="bind: setOrder, sbytitle.descending"></div></div><div id="sbydate" class="sort-button" data-sort="bind: setSelected, sbydate.selected" data-sortevent="listen: touchstart, sort"><span data-label="bind: innerHTML, sbydate"></span><div class="sort-caret" data-sort="bind: setOrder, sbydate.descending"></div></div><div id="sbyidea" class="sort-button" data-sort="bind: setSelected, sbyidea.selected" data-sortevent="listen: touchstart, sort"><span data-label="bind: innerHTML, sbyidea"></span><div class="sort-caret" data-sort="bind: setOrder, sbyidea.descending"></div></div><div id="sbyscore" class="sort-button" data-sort="bind: setSelected, sbyscore.selected" data-sortevent="listen: touchstart, sort"><span data-label="bind: innerHTML, sbyscore"></span><div class="sort-caret" data-sort="bind: setOrder, sbyscore.descending"></div></div></div><input class="search" type="text" data-label="bind:placeholder, searchsessions" data-sortevent="listen: keypress, search"><div id="sessionsearchresult"></div></div><div class="session-details"><ul data-sessions="foreach"><li class="session-item" data-sessionevent="listen:touchstart, setStart; listen: touchmove, displayActionBar"><table class="session-boxscore"><tr><td class="session-type"></td><td class="session-info"><p class="session-title" data-sessions="bind: innerHTML, title">Titre de la session</p><p class="session-date" data-sessions="bind: formatDate, date">jj/mm/aaaa</p></td><td class="session-idea" data-sessions="bind:formatIdeas, idea">Idea(s) generated from session</td><td class="avatarlist" data-sessions="bind: setAvatars, participants"></td><td class="session-status" data-sessions="bind:setStatus, status">completed</td><td class="session-score"><span class="points" data-sessions="bind:setScore, score"></span><span data-sessions="bind: setSuffix, score">ip</span></td></tr></table><div class="actionbar" data-sessionevent="listen: touchend, hideActionBar"><div class="replaysession" name="replay" data-sessionevent="listen: touchstart, press; listen:touchend, replay"></div><div class="deletesession" name="delete" data-sessionevent="listen: touchstart, press; listen:touchend, deleteSession"></div></div></li></ul></div></div></div>',c.sort=function(t,n){var r=n.getAttribute("id");E.get(r).selected?E.set(r,{selected:!0,descending:!E.get(r).descending}):(E.set(S,{selected:!1,descending:E.get(S).descending}),E.set(r,{selected:!0,descending:E.get(r).descending}),S=r),c.sortSessions(r)},c.sortSessions=function(t){var n;N?n=T:n=x;if(n.length)switch(t){case"sbytitle":a.sortByProperty(n,"title",E.get("sbytitle").descending);break;case"sbydate":a.sortByProperty(n,"date",E.get("sbydate").descending);break;case"sbyidea":a.sortByProperty(n,"idea",E.get("sbyidea").descending);break;case"sbyscore":a.sortByProperty(n,"score",E.get("sbyscore").descending)}m.reset(n)},c.acceptinput=function(e,t){t.removeAttribute("readonly")},c.search=function(t,n){var r=document.getElementById("sessionsearchresult");r.innerHTML="",t.keyCode===13&&(N=n.value,N===""?(c.sortSessions(S),m.reset(x)):(T=a.searchArray(x,N),r.innerHTML=w.get("foundlbl")+" "+T.length+" "+w.get("matchingsessions"),m.reset(T)))},c.setStart=function(e,t){p=[e.pageX,e.pageY]},c.displayActionBar=function(e,t){var n=t.getAttribute("data-sessions_id"),r=t.offsetHeight,i=m.get(n);d=[e.pageX,e.pageY],p[0]-d[0]>40&&d[1]-p[1]<20&&d[1]-p[1]>-20&&(t.querySelector(".actionbar").setAttribute("style","display: block;margin-top:-"+r+"px;height: "+r+"px;"),i.participants.length>1||i.participants[0]!=y.get("_id")||i.id===y.get("sessionInProgress").id?t.querySelector(".deletesession").setAttribute("style","display: none;"):t.querySelector(".deletesession").setAttribute("style","display: inline-block;"),setTimeout(function(){t.querySelector(".actionbar").setAttribute("style","display: none;")},2e3))},c.hideActionBar=function(e,t){t.setAttribute("style","display: none;")},c.press=function(e,t){t.classList.add("pressed")},c.replay=function(e,t){var n=t.getAttribute("data-sessions_id"),r=m.get(n).id,i=m.get(n).mode;t.parentNode.setAttribute("style","display: none;"),t.classList.remove("pressed"),s.get("observer").notify("replay-session",r,i)},c.deleteSession=function(e,t){var n=t.getAttribute("data-sessions_id"),r=m.get(n).id;t.classList.remove("pressed"),t.parentNode.setAttribute("style","display: none;");var i=new o;i.setTransport(s.get("transport")),i.sync(g,r).then(function(){i.remove()}),s.get("transport").request("cleanUpSession",r,function(e){e.err&&console.log(e.err)})},c.resetSessionData=function(){x=[],C.loop(function(e,t){var n={id:e.id,title:e.value.title,date:e.value.date,idea:e.value.idea,participants:[],usernames:[],status:e.value.status,score:e.value.score,mode:e.value.mode};n.participants.push(e.value.initiator.id),n.usernames.push(e.value.initiator.username);for(j=0;j<e.value.participants.length;j++)n.participants.push(e.value.participants[j].id),n.usernames.push(e.value.participants[j].username);n.idea&&n.idea.length>1&&a.sortByProperty(n.idea,"title",!1),x.push(n)}),m.reset(x)},c.getMode=function(t){var n;return C.loop(function(e,r){e.id===t&&(n=e.value.mode)}),n},c.place(v),C.sync(g,"library","_view/sessions",{key:s.get("uid"),descending:!0}).then(function(){c.resetSessionData(),["added","deleted","updated"].forEach(function(e){C.watch(e,function(e,t){c.resetSessionData(),c.sortSessions(S)})})}),c}}),define("library/decks/decklist/decklist",["Olives/OObject","service/map","service/config","Olives/Model-plugin","Olives/Event-plugin","Store","CouchDBStore","Promise","service/utils"],function(e,t,n,r,i,s,o,u,a){return function(u){var f=new e,l=n.get("labels"),c=n.get("user"),h=new s([]);return f.plugins.addAll({labels:new r(l),active:new r(c,{}),decks:new r(h,{setVersion:function(e){e?this.innerHTML=l.get("version")+e:this.innerHTML=""},setAuthor:function(e){e==="Taïaut"?(this.innerHTML="",this.setAttribute("style","background-image:url('img/logo.png');")):this.innerHTML=e},date:function(e){e?this.innerHTML=a.formatDate(e):this.innerHTML=""}}),decksevent:new i(f)}),f.template='<ul id="deck-list" data-decks="foreach"><li class="list-item" data-decklistevent="listen:touchstart, setStart; listen:touchmove, showActionBar"><div class = "decklight"></div><div class="item-header"><h3 data-decks="bind:innerHTML, title"></h3><span class="version" data-decks="bind:setVersion, version"></span></div><div class="item-body"><p data-decks="bind:innerHTML,description"></p></div><div class="item-footer"><label data-labels="bind:innerHTML, designedby"></label><div class="author" data-decks="bind:setAuthor, author"></div><span class="date" data-decks="bind:date, date"></div></div></li></ul>',f.reset=function(){},f.getModel=function(){return h},f.getDecks=function(t,r){var i=new o;i.setTransport(n.get("transport")),i.sync(n.get("db"),{keys:c.get(t)}).then(function(){var e=c.get("lang");h.reset([]),i.loop(function(t,n){!t.doc.default_lang||t.doc.default_lang===e?h.alter("push",t.doc):t.doc.translations&&t.doc.translations[e]?h.alter("push",t.doc.translations[e]):h.alter("push",t.doc)}),r&&r("ok")})},f.initSelected=function(t,n){var r=f.dom,i=r.querySelector(".list-item[data-decks_id='"+n+"']");t(i),i.classList.add("selected")},f.init=function(t){f.getDecks(u,t)},c.watchValue(u,function(){f.getDecks(u)}),c.watchValue("lang",function(){f.getDecks(u)}),f}}),define("library/decks/deckview/deckdetails",["Olives/OObject","service/config","Olives/Model-plugin","Olives/Event-plugin","Store","service/avatar","service/utils","CouchDBStore"],function(e,t,n,r,i,s,o,u){return function(){var f=new e,l=new i,c=new i({max:0}),h=new i([]),p=new u,d=t.get("labels");return p.setTransport(t.get("transport")),f.plugins.addAll({labels:new n(d),range:new n(c,{setCursorWidth:function(e){}}),cards:new n(h,{setStyle:function(e){e&&e==="null"?this.classList.add("invisible"):this.classList.remove("invisible")},formatTitle:function(e){var t,n=this;e&&(t=n.getAttribute("data-cards_id"),h.get(t).type&&h.get(t).type!==4?this.innerHTML=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase():(this.innerHTML=e.toUpperCase(),this.setAttribute("style","font-family:Helvetica;")))},setPic:function(e){e?this.setAttribute("style","background-image:url('"+e+"');"):this.setAttribute("style","background-image: none;")}}),deckdetails:new n(l,{formatDate:function(e){e?this.innerHTML=o.formatDate(e):this.innerHTML=""},setPic:function(e){var t,n,r=this;e==="Taiaut"?this.setAttribute("style","background-image:url('img/logo.png');"):(n=document.createDocumentFragment(),t=new s([e]),t.place(n),r.hasChildNodes()?r.replaceChild(n,r.firstChild):r.appendChild(n))}}),carouselevent:new r(f)}),f.template='<div class="deckdetails"><div class="deckinfo"><div class="deckheader"><div class="decklogo" data-deckdetails="bind: setPic, author"></div><p><h2 data-deckdetails="bind:innerHTML, title"></h2><span data-labels="bind:innerHTML, designedby"></span><span data-deckdetails="bind: innerHTML, created_by"></span></p><span class="date" ></span></div><p class="deckdescription" data-deckdetails="bind: innerHTML, description"></p></div><div class="deckcarousel"><div class="innercarousel"></div><ul data-cards="foreach"><li data-cards="bind: setStyle,style"><div class="card"><div class="cardpicture" data-cards="bind:setPic,picture_file"></div><div class="cardtitle" data-cards="bind: formatTitle, title"></div></div></li></ul><input class="deckslider" type="range" value=0 min=0 data-range="bind: max, max; bind: setCursorWidth, max" data-carouselevent="listen: input, updateCards"></div></div>',f.displayCards=function(t){var n,r=[];h.reset([]);for(n=0;n<5;n++)p.get(t-2+n)?r[n]=p.get(t-2+n).value:r[n]={style:"null"};h.reset(r)},f.updateCards=function(e,t){f.displayCards(t.value)},f.reset=function(n){l.reset(n),c.set("max",0),p.unsync(),p.sync(t.get("db"),"library","_view/cards",{key:'"'+l.get("_id")+'"'}).then(function(){c.set("max",p.getNbItems()-1),f.displayCards(0)})},f}}),define("service/cardpopup",["Olives/OObject","Olives/Model-plugin","Olives/Event-plugin","service/config","Store"],function(e,t,n,r,s){function o(e){var o=new s,u=r.get("labels"),a,f={x:0,y:0},l='<div class="cardpopup" data-carddetails="bind:setPosition, position"><div class="card-detail"><div class="cd-header blue-dark"> <span data-carddetails="bind: formatName, firstname"></span><div class="close-popup" data-popupevent="listen:touchstart, close"></div></div><div class="cd-picarea"><div class="cardpicture" data-carddetails="bind:setPic, picture_file"></div><div class="cardinfo"><p><span class="cd-agelbl"></span><span data-carddetails="bind:innerHTML, age">age</span><span class="agesuffix" data-label="bind:innerHTML, agelbl"></span><br/><span class="cd-locationlbl"></span><span class="cd-info" data-carddetails="bind: innerHTML, location"></span><br/><span class="cd-joblbl"></span><span class="cd-info" data-carddetails="bind: innerHTML, occupation.description"></span><br/><span class="cd-familylbl"></span><span class="cd-info" data-carddetails="bind: setFamily, family"></span><br/><span class="cd-creditslbl" data-label="bind:innerHTML, credits"></span><span class="cd-info" data-carddetails="bind:innerHTML, picture_credit"></span></div></div><div class="cd-contentarea"><span class="contentTitle" data-label="bind: innerHTML, hobbieslbl">Hobbies</span><p class = "charinfo" data-carddetails="bind:setLeisure, leisure_activities">hobbies</p><span class="contentTitle" data-label="bind: innerHTML, interestslbl">Centers of interest</span><p class = "charinfo" data-carddetails="bind: setInterests, interests">Centers of interest</p><span class="contentTitle" data-label="bind: innerHTML, commentslbl">Comments</span><p class = "charinfo" data-carddetails="bind:setComments, comments"></p></div></div><div class="leftcaret" data-carddetails="bind: setCaret, caret.left"></div><div class="rightcaret" data-carddetails="bind: setCaret, caret.right"></div></div>',c='<div class="cardpopup" data-carddetails="bind:setPosition, position"><div class="card-detail"><div class="cd-header blue-dark"> <span data-carddetails="bind: formatTitle, title"></span><div class="close-popup" data-popupevent="listen:touchstart, close"></div></div><div class="cd-picarea"><div class="cardpicture" data-carddetails="bind:setPic, picture_file"></div><div class="cardinfo"><p><span class="cd-creditslbl" data-label="bind:innerHTML, credits"></span><span class="cd-info" data-carddetails="bind:innerHTML, picture_credit">Picture credits</span><br/><span class="cd-sourcelbl" data-label="bind:innerHTML, source">Source : </span><span class="cd-info" data-carddetails="bind: setSources, sources"></span></div></div><div class="cd-contentarea"><span class="contentTitle" data-label="bind: innerHTML, dyknow"></span><p class = "dyknow" data-carddetails="bind:innerHTML,didYouKnow"></p></div></div><div class="leftcaret" data-carddetails="bind: setCaret, caret.left"></div><div class="rightcaret" data-carddetails="bind: setCaret, caret.right"></div></div>',h='<div class="cardpopup" data-carddetails="bind:setPosition, position"><div class="card-detail"><div class="cd-header blue-dark story"> <div class="storytitlelbl" data-label="bind:innerHTML, storytitlelbl"></div><div class="storytitle"><span data-label="bind:innerHTML, cdtitlelbl"></span> <span data-carddetails="bind: formatTitle, title"></span></div><div class="close-popup" data-popupevent="listen:touchstart, close"></div></div><div class="cd-contentarea story"><span class="contentTitle" data-label="bind: innerHTML, scenariodesclbl"></span><p class = "dyknow" data-carddetails="bind:innerHTML,story"></p><span class="contentTitle" data-label="bind: innerHTML, soldesclbl"></span><p class = "dyknow" data-carddetails="bind:innerHTML,solution"></p></div></div><div class="leftcaret" data-carddetails="bind: setCaret, caret.left"></div><div class="rightcaret" data-carddetails="bind: setCaret, caret.right"></div></div>';this.plugins.addAll({label:new t(u),carddetails:new t(o,{setPosition:function(e){e&&this.setAttribute("style","left:"+e.x+"px; top:"+e.y+"px;")},setCaret:function(e){var t,n=o.get("position").y;n>340?t=240:t=60,e?this.setAttribute("style","display: inline-block; margin-top:"+t+"px;"):this.setAttribute("style","display: none;")},setPic:function(e){e?this.setAttribute("style","background-image:url('"+e+"');"):this.setAttribute("style","background-image: none;")},setSources:function(e){e&&e.length?this.innerHTML=e.join(", "):this.innerHTML=""},formatTitle:function(e){e&&(this.innerHTML=e.toUpperCase())},formatName:function(e){e&&(this.innerHTML=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase()+"  "+o.get("lastname").toUpperCase())},setFamily:function(e){var t=e.couple,n=e.children,r,i;t===0?r=u.get("singlelbl"):t===1?r=u.get("marriedlbl"):t===2?r=u.get("divorcedlbl"):t===3&&(r=u.get("widowlbl")),n===0?i="":(o.get("age")<20?n===1?i=n+u.get("onesiblinglbl"):i=n+u.get("siblingslbl"):n===1?i=n+u.get("onechildlbl"):i=n+u.get("childrenlbl"),i=", "+i),this.innerHTML=r+i},setLeisure:function(e){var t="<ul>";if(e&&e.length){for(i=0;i<e.length;i++)e[i].comment?t+="<li>"+e[i].name+" ("+e[i].comment+")</li>":t+="<li>"+e[i].name+"</li>";this.innerHTML=t+"</ul>"}else this.innerHTML=""},setInterests:function(e){var t="<ul>";if(e&&e.length){for(i=0;i<e.length;i++)e[i].comment?t+="<li>"+e[i].name+" ("+e[i].comment+")</li>":t+="<li>"+e[i].name+"</li>";this.innerHTML=t+"</ul>"}else this.innerHTML=""},setComments:function(e){var t="<ul>";if(e&&e.length){for(i=0;i<e.length;i++)t+="<li>"+e[i]+"</li>";this.innerHTML=t+"</ul>"}else this.innerHTML=""}}),popupevent:new n(this)}),this.close=function(t,n){a.classList.add("invisible"),e()},this.reset=function(t,n,r,i){a=i,this.template="",typeof t=="string"?o.reset(JSON.parse(t)):o.reset(t),o.set("position",n),r==="left"?o.set("caret",{left:!0,right:!1}):o.set("caret",{left:!1,right:!0}),o.get("type")===1?this.template=l:o.get("type")===5?this.template=h:this.template=c,this.render(),this.place(a),a.classList.remove("invisible")}}return function(n){return o.prototype=new e,new o(n)}}),define("library/decks/deckview/cardlist",["Olives/OObject","service/config","Olives/Model-plugin","Olives/Event-plugin","CouchDBStore","Store","service/cardpopup"],function(e,t,n,r,i,s,o){return function(a){var f=new e,l=new s([]),c=new s([]),h=new s({currentPage:0,nbPages:0}),p,d,v=t.get("labels"),m=null;return f.plugins.addAll({pagination:new n(h,{setPage:function(e){var t=e+1;h.get("nbPages")>1?this.innerHTML=v.get("page")+t+" / "+h.get("nbPages"):this.innerHTML=""},setLeft:function(e){e>0?this.classList.remove("invisible"):this.classList.add("invisible")},setRight:function(e){e<h.get("nbPages")-1?this.classList.remove("invisible"):this.classList.add("invisible")}}),cards:new n(c,{formatTitle:function(e){e&&(a!=="techno"?this.innerHTML=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase():(this.innerHTML=e.toUpperCase(),this.setAttribute("style","font-family:Helvetica;")))},setPic:function(e){e?this.setAttribute("style","background-image:url('"+e+"');"):this.setAttribute("style","background-image: none;")}}),cardlistevent:new r(f)}),f.template='<div class="cardlist"><div id="cardlist-popup" class="invisible"></div><div class="cardpage" data-cardlistevent="listen:touchstart, setStart; listen:touchmove, changePage"><div class="pagenb"><div class="leftcaret" data-pagination="bind: setLeft, currentPage" data-cardlistevent="listen:touchstart, press; listen:touchend, previousPage"></div><span data-pagination="bind: setPage, currentPage"></span><div class = "rightcaret" data-pagination="bind: setRight, currentPage" data-cardlistevent="listen:touchstart, press; listen:touchend, nextPage"></div></div><ul data-cards="foreach"><li class="card" data-cardlistevent="listen:touchstart, highlight; listen:touchend, zoom"><div class="cardpicture" data-cards="bind:setPic,picture_file"></div><div class="cardtitle" data-cards="bind: formatTitle, title"></div></li></ul></div></div>',f.reset=function(t){m=null,f.getCardList(t.content[a])},f.getCardList=function(n){var r=new i;r.setTransport(t.get("transport")),r.sync(t.get("db"),{keys:n}).then(function(){l.reset([]),r.loop(function(e,t){l.alter("push",e.doc)}),h.set("nbPages",Math.ceil(l.getNbItems()/12)),f.displayPage(0),r.unsync()})},f.displayPage=function(t){var n,r=l.getNbItems()-12*t;h.set("currentPage",t),c.reset([]);for(n=0;n<r;n++)c.alter("push",l.get(t*12+n))},f.press=function(e,t){t.classList.add("invisible")},f.previousPage=function(e,t){f.displayPrevious()},f.nextPage=function(e,t){f.displayNext()},f.displayPrevious=function(){var t=h.get("currentPage");t>0&&f.displayPage(t-1)},f.displayNext=function(){var t=h.get("currentPage");t<h.get("nbPages")-1&&f.displayPage(t+1)},f.setStart=function(e,t){p=[e.pageX,e.pageY]},f.changePage=function(e,t){touchPoint=[e.pageX,e.pageY],p[0]-touchPoint[0]>40&&touchPoint[1]-p[1]<20&&touchPoint[1]-p[1]>-20?(console.log("displaynext"),f.displayNext()):p[0]-touchPoint[0]<40&&touchPoint[1]-p[1]<20&&touchPoint[1]-p[1]>-20&&(console.log("displayprev"),f.displayPrevious())},f.highlight=function(e,t){m!==null&&document.querySelector("li[data-cards_id='"+m+"']").classList.remove("highlighted"),m=t.getAttribute("data-cards_id"),t.classList.add("highlighted")},f.zoom=function(e,t){var n=parseInt(t.getAttribute("data-cards_id"),10)+12*h.get("currentPage");f.setPopup(n)},f.setPopup=function(t){var n={x:0,y:0},r="";t%=12;switch(t){case 1:n.x=304,n.y=157,r="left";break;case 2:n.x=23,n.y=157,r="right";break;case 3:n.x=170,n.y=157,r="right";break;case 4:n.x=157,n.y=339,r="left";break;case 5:n.x=304,n.y=339,r="left";break;case 6:n.x=23,n.y=339,r="right";break;case 7:n.x=170,n.y=339,r="right";break;case 8:n.x=157,n.y=350,r="left";break;case 9:n.x=304,n.y=350,r="left";break;case 10:n.x=23,n.y=350,r="right";break;case 11:n.x=170,n.y=350,r="right";break;default:n.x=157,n.y=157,r="left"}d.reset(l.get(t),n,r,document.getElementById("cardlist-popup"))},f.closePopup=function(){document.querySelector("li[data-cards_id='"+m+"']").classList.remove("highlighted"),m=null},d=new o(f.closePopup),f}}),define("library/decks/deckview/deckview",["Olives/OObject","Olives/Model-plugin","Olives/Event-plugin","Amy/Stack-plugin","Store","service/map","./deckdetails","./cardlist","service/config"],function(e,t,n,r,i,s,o,u,a){return function(){var f=new e,l=new i([{name:"characters",active:!1},{name:"contexts",active:!1},{name:"problems",active:!1},{name:"techno",active:!1}]),c=new r;return f.plugins.addAll({cardmenu:new t(l,{setClass:function(e){this.classList.add(e)},setActive:function(e){e?this.classList.add("active"):this.classList.remove("active")}}),deckviewstack:c,deckviewevent:new n(f)}),f.template='<div><ul class="card-menu" data-cardmenu="foreach"><li data-cardmenu = "bind: setClass, name; bind:setActive, active" data-deckviewevent="listen: touchstart, viewCards"></li></li></ul><div id="deckviewstack" data-deckviewstack="destination"></div></div>',f.viewCards=function(e,t){var n=t.getAttribute("data-cardmenu_id");l.loop(function(e,t){t===parseInt(n)?l.update(t,"active",!0):l.update(t,"active",!1)}),c.getStack().show(l.get(n).name)},f.reset=function(t){["details","characters","contexts","problems","techno"].forEach(function(e){c.getStack().get(e).reset(t)}),l.reset([{name:"characters",active:!1},{name:"contexts",active:!1},{name:"problems",active:!1},{name:"techno",active:!1}]),c.getStack().show("details")},f.init=function(){c.getStack().add("details",new o),c.getStack().add("characters",new u("characters")),c.getStack().add("contexts",new u("contexts")),c.getStack().add("problems",new u("problems")),c.getStack().add("techno",new u("techno"))},f.place(s.get("deckview")),f}}),define("library/decks/decks",["Olives/OObject","Olives/Model-plugin","Amy/Stack-plugin","Amy/Control-plugin","Amy/Delegate-plugin","service/config","service/map","./decklist/decklist","./deckview/deckview"],function(e,t,n,r,i,s,o,u,a){return function(){var l=new e,c=new r(l),h=s.get("user"),p,d=new n,v=new u,m=new a;return l.plugins.addAll({label:new t(s.get("labels")),deckliststack:d,decksevent:new i(l),deckscontrol:c}),l.alive(o.get("decks")),l.reset=function(e){v.reset(),m.reset()},l.init=function(){var t=new u("taiaut_decks");d.getStack().add("ideafy",t),t.init(function(e){e&&(d.getStack().show("ideafy"),m.init(),t.initSelected(c.init,0),m.reset(t.getModel().get(0)),p=0)})},l.selectStart=function(e){var t=d.getStack().getCurrentScreen().getModel(),n=e.target.getAttribute("data-decks_id");m.reset(t.get(n)),p=n},l.init(),h.watchValue("lang",function(){var e=d.getStack().getCurrentName(),t,n=d.getStack().getCurrentScreen();switch(e){case"custom":t="custom_decks";break;default:t="taiaut_decks"}n.getDecks(t,function(e){e&&(n.initSelected(c.init,p),m.reset(n.getModel().get(p)))})}),l}}),define("library/library",["Olives/OObject","Amy/Stack-plugin","service/map","service/submenu","./ideas/ideas","./sessions/sessions","./decks/decks","service/config"],function(e,t,n,r,i,s,o,u){return function(){var f=new e,l=new t,c=u.get("observer"),h=function(t){l.getStack().show(t)},p=new r(n.get("library-menu"),h);return f.plugins.add("librarystack",l),f.alive(n.get("library")),f.showMenu=function(){p.toggleActive(!0)},f.hideMenu=function(){p.toggleActive(!1)},p.toggleActive(!1),l.getStack().add("#ideas",new i),l.getStack().add("#sessions",new s),l.getStack().add("#decks",new o),l.getStack().show("#ideas"),c.watch("display-doc",function(e,t){switch(t){case 6:var n=l.getStack().get("#ideas");n.searchIdea(e.substr(2)),l.getStack().getCurrentScreen()!==n&&l.getStack().show("#ideas");break;default:}}),f}}),define("brainstorm/ideafy-menu",["Olives/OObject","service/map","Store","Olives/Model-plugin","Olives/Event-plugin","service/config"],function(e,t,n,r,i,s){return function(u){var a=new e,f=s.get("user"),l=s.get("labels"),c=new n,h={name:"continue",active:!0,selected:!1,label:l.get("continuesession"),bg:"continuesession.png",bgselected:"continueactive.png"},p="";return a.plugins.addAll({ideafymenu:new r(c,{setActive:function(e){e?this.classList.remove("inactive"):this.classList.add("inactive")},setBg:function(e){var t=this.getAttribute("data-ideafymenu_id");e?this.setAttribute("style","background-image:url('img/brainstorm/"+c.get(t).bgselected+"');color:white;"):this.setAttribute("style","background-image:url('img/brainstorm/"+c.get(t).bg+"');color:#4D4D4D;")}}),labels:new r(l),ideafyevent:new i(this)}),a.alive(t.get("ideafy-menu")),this.press=function(e,t){var n=t.getAttribute("data-ideafymenu_id");c.update(n,"selected",!0),t.classList.add("pressed")},this.start=function(e,t){var n=t.getAttribute("data-ideafymenu_id");c.get(n).name==="continue"?u("continue",p):u(c.get(n).name),t.classList.remove("pressed"),c.update(n,"selected",!1)},a.addContinue=function(t){var n=JSON.parse(c.toJSON());c.get(0).name!=="continue"&&(n.unshift(h),c.reset(n)),p=t},a.removeContinue=function(){var t=JSON.parse(c.toJSON());t[0].name==="continnue"&&t.splice(0,1),c.reset(t),p=""},a.reset=function(){c.reset([{name:"quick",active:!0,selected:!1,label:l.get("quickbmode"),bg:"quick.png",bgselected:"quickactive.png"},{name:"musession",active:!1,selected:!1,label:l.get("musession"),bg:"multiuser.png",bgselected:"multiuseractive.png"},{name:"customb",active:!1,selected:!1,label:l.get("customsession"),bg:"customb.png",bgselected:"custombactive.png"},{name:"tutorial",active:!0,selected:!1,label:l.get("ideafytutorial"),bg:"tutorial.png",bgselected:"tutorialactive.png"}]),f.get("sessionInProgress")&&f.get("sessionInProgress").id&&a.addContinue(f.get("sessionInProgress"))},a.reset(),f.watchValue("sessionInProgress",function(e){e.id&&e.type?a.addContinue(e):a.removeContinue()}),f.watchValue("lang",function(){var e=s.get("labels");c.loop(function(t,n){switch(t.name){case"continue":c.update(n,"label",e.get("continuesession"));break;case"quick":c.update(n,"label",e.get("quickbmode"));break;case"musession":c.update(n,"label",e.get("musession"));break;case"customb":c.update(n,"label",e.get("customsession"));break;case"tutorial":c.update(n,"label",e.get("ideafytutorial"))}})}),a}}),define("service/help",["Olives/OObject","service/map","Olives/Model-plugin","Olives/Event-plugin","service/config","Store"],function(e,t,n,r,i,s){return new function(){var u=new e,a=i.get("labels"),f=new s({html:""});return u.plugins.addAll({help:new n(f),helpevent:new r(u)}),u.template='<div><div class="help-doctor"></div><div class="close-help" data-helpevent="listen:touchstart, close"></div><div class="help-screen" data-help="bind:innerHTML,html"></div></div>',u.render(),u.place(t.get("help-popup")),u.setContent=function(t){f.set("html",a.get(t))},u.close=function(e,t){document.getElementById("help-popup").classList.remove("appear"),document.getElementById("cache").classList.remove("appear")},u}}),define("brainstorm/quickb/quickstart",["Olives/OObject","service/map","Olives/Model-plugin","Olives/Event-plugin","service/config","service/help"],function(e,t,n,r,i,s){return function(u,a,f,l){var c=new e,h=i.get("user"),p=i.get("db"),d=i.get("labels"),v="step";return c.plugins.addAll({labels:new n(d),model:new n(u,{setTitle:function(e){var t=new Date;e&&e.username&&this.setAttribute("placeholder",d.get("quickstarttitleplaceholderpre")+e.username+d.get("quickstarttitleplaceholderpost"))}}),quickstartevent:new r(c)}),c.template='<div id = "quickstart"><div class="previousbutton" data-quickstartevent="listen: touchstart, press; listen: touchstart, prev"></div><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, quickstart" data-quickstartevent="listen:touchstart, toggleProgress"></div><div class="help-brainstorm" data-quickstartevent="listen:touchstart, help"></div><form class="quickstart-form"><label data-labels="bind:innerHTML, quickstarttitle"></label><hr/><textarea class="quickstart-title" autofocus="" name="title" data-model="bind:value, title; bind: setTitle, initiator"></textarea><label data-labels="bind:innerHTML, quickstartdesc"></label><hr/><textarea class="quickstart-desc" name="description" data-model="bind:value, description" data-labels="bind: placeholder, quickstartdescplaceholder"></textarea><div class="next-button" data-labels="bind:innerHTML, nextbutton" data-quickstartevent="listen: touchstart, press; listen:touchend, next"></div></form><div>',c.place(t.get("quickstart")),c.press=function(e,t){t.classList.add("pressed")},c.next=function(e,t){v==="step"?(v="screen",u.get("title")===""&&u.set("title",d.get("quickstarttitleplaceholderpre")+u.get("initiator").username+d.get("quickstarttitleplaceholderpost")),u.set("lang",h.get("lang")),u.set("_id","S:QUICK:"+u.get("startTime")),u.sync(p,u.get("_id")),h.set("sessionInProgress",{id:u.get("_id"),type:"quick"}),h.upload().then(function(){console.log("move to next screen",u.toJSON()),t.classList.remove("pressed"),f("quickstart")})):(t.classList.remove("pressed"),f("quickstart"))},c.prev=function(e,t){t.classList.remove("pressed"),a("quickstart")},c.toggleProgress=function(e,t){l(t)},c.reset=function(t){var n=new Date,r=u.get("step");t?(r==="quickstart"?v="step":next="screen",r!=="quickwrapup"&&u.set("resumeTime",n.getTime())):(u.set("startTime",n.getTime()),u.set("date",[n.getFullYear(),n.getMonth(),n.getDate()]),v="step")},c.help=function(e,t){s.setContent("quickstarthelp"),document.getElementById("cache").classList.add("appear"),document.getElementById("help-popup").classList.add("appear")},c}}),define("brainstorm/quickb/quicksetup",["Olives/OObject","service/map","Olives/Model-plugin","Olives/Event-plugin","service/config","CouchDBStore","Store","Promise","service/cardpopup","service/help","service/utils"],function(e,t,n,r,i,s,o,u,a,f,l){return function(h,p,d,v,m){var g=new e,y,b=t.get("quicksetup"),w=i.get("labels"),E=i.get("transport"),S=i.get("db"),x=i.get("user"),T={},N=new o({timer:null,display:!1}),C,k=new o({"char":{selected:!1,left:null,popup:!1},context:{selected:!1,left:null,popup:!1},problem:{selected:!1,left:null,popup:!1}}),L=new o({"char":{id:"",title:w.get("char"),pic:""},context:{id:"",title:w.get("context"),pic:""},problem:{id:"",title:w.get("problem"),pic:""}}),A={"char":0,context:0,problem:0},O=!0,M={"char":new o,context:new o,problem:new o},_="",D=null,P=0,H="step";return g.plugins.addAll({labels:new n(w),quicksetup:new n(k,{setReload:function(e){e===0?this.classList.add("reload"):this.classList.remove("reload")},updateNext:function(e){k.get("char").selected&&k.get("context").selected&&k.get("problem").selected?this.classList.remove("invisible"):this.classList.add("invisible")},popup:function(e){e?this.classList.add("highlighted"):this.classList.remove("highlighted")},setSelected:function(e){e?this.classList.add("pushed"):this.classList.remove("pushed")}}),quicksetuptimer:new n(N,{setTime:function(e){this.innerHTML=l.formatDuration(e)},displayTimer:function(e){e?this.classList.add("showtimer"):this.classList.remove("showtimer")}}),quicksetupcards:new n(L,{removeDefault:function(e){e?this.classList.remove("defaultcard"):this.classList.add("defaultcard")},formatTitle:function(e){e?this.innerHTML=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase():this.innerHTML=e},setPic:function(e){e?this.setAttribute("style","background-image:url('"+e+"');"):this.setAttribute("style","background-image: none;")}}),quicksetupevent:new r(g)}),g.template='<div id = "quicksetup"><div class="previousbutton" data-quicksetupevent="listen: touchstart, press; listen: touchstart, prev"></div><div id="quicksetup-popup" class="invisible"></div><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, quicksetup" data-quicksetupevent="listen:touchstart, toggleProgress"></div><div class="timer" data-quicksetuptimer="bind:setTime, timer; bind: displayTimer, display" data-quicksetupevent="listen:touchstart,toggleTimer"></div><div class="help-brainstorm" data-quicksetupevent="listen:touchstart, help"></div><div class="drawarea"><div class="decks"><div class="drawbutton drawchar" name="char" data-quicksetupevent="listen: touchstart, push; listen:touchend, draw" data-quicksetup="bind: setReload, char.left"></div><div class="drawbutton drawcontext" name="context" data-quicksetupevent="listen: touchstart, push; listen:touchend, draw" data-quicksetup="bind:setReload, context.left"></div><div class="drawbutton drawproblem" name="problem" data-quicksetupevent="listen: touchstart, push; listen:touchend, draw" data-quicksetup="bind:setReload, problem.left"></div></div><div class="cards"><div class="card char defaultcard" name="char" data-quicksetupevent="listen:touchstart, zoom" data-quicksetupcards="bind:removeDefault, char.pic" data-quicksetup="bind: popup, char.popup"><div class="cardpicture" data-quicksetupcards="bind: setPic, char.pic"></div><div class="cardtitle" data-quicksetupcards="bind:formatTitle, char.title">Character</div></div><div class="card context defaultcard" name="context" data-quicksetupevent="listen:touchstart, zoom" data-quicksetupcards="bind:removeDefault, context.pic" data-quicksetup="bind: popup, context.popup"><div class="cardpicture" data-quicksetupcards="bind: setPic, context.pic"></div><div class="cardtitle" data-quicksetupcards="bind:formatTitle, context.title">Context</div></div><div class="card problem defaultcard" name="problem" data-quicksetupevent="listen:touchstart, zoom" data-quicksetupcards="bind:removeDefault, problem.pic" data-quicksetup="bind: popup, problem.popup"><div class="cardpicture" data-quicksetupcards="bind: setPic, problem.pic"></div><div class="cardtitle" data-quicksetupcards="bind:formatTitle, problem.title">Problem</div></div></div><div class="confirmdraw"><div class="drawok" name="char" data-quicksetup="bind:setSelected, char.selected" data-quicksetupevent="listen: touchstart, push; listen:touchend, accept"></div><div class="drawok" name="context" data-quicksetup="bind:setSelected, context.selected" data-quicksetupevent="listen: touchstart, push; listen:touchend, accept"></div><div class="drawok" name="problem" data-quicksetup="bind:setSelected, problem.selected" data-quicksetupevent="listen: touchstart, push; listen:touchend, accept"></div></div><div class="next-button invisible" data-labels="bind:innerHTML, nextbutton" data-quicksetupevent="listen: touchstart, press; listen:touchend, next" data-quicksetup="bind:updateNext, char.selected;bind:updateNext, context.selected;bind:updateNext, problem.selected"></div></div></div>',g.place(b),g.press=function(e,t){t.classList.add("pressed")},g.next=function(e,t){H==="step"?(H="screen",p.set("characters",L.get("char")),p.set("contexts",L.get("context")),p.set("problems",L.get("problem")),clearInterval(C),N.set("display",!0),g.updateSessionScore(N.get("timer")).then(function(){h.unsync(),h.sync(i.get("db"),h.get("_id")).then(function(){h.set("elapsedTimers",{quicksetup:N.get("timer")}),h.set("characters",[L.get("char").id]),h.set("contexts",[L.get("context").id]),h.set("problems",[L.get("problem").id]),t.classList.remove("pressed"),v("quicksetup")})})):(t.classList.remove("pressed"),v("quicksetup"))},g.help=function(e,t){f.setContent("quicksetuphelp"),document.getElementById("cache").classList.add("appear"),document.getElementById("help-popup").classList.add("appear")},g.prev=function(e,t){t.classList.remove("pressed"),d("quicksetup")},g.toggleProgress=function(e,t){m(t)},g.toggleTimer=function(e,t){N.set("display",!N.get("display"))},g.push=function(e,t){H!=="screen"&&t.classList.add("pushed")},g.draw=function(e,t){var n=t.getAttribute("name"),r=k.get(n);_now=new Date,H==="step"&&O&&(r.left===0&&(T[n]=p.get("deck")[n].concat(),r.left=T[n].length,k.set(n,r)),r.selected&&alert("please unlock selected card first"),O&&!r.selected&&(O=!1,r.selected===!1?g.drawCard(n).then(function(){var e=!1;t.classList.remove("pushed"),O=!0,k.loop(function(t,n){t.popup===!0&&(e=!0)}),e&&g.setPopup(n)}):(t.classList.remove("pushed"),O=!0)))},g.accept=function(e,t){var n=t.getAttribute("name"),r=k.get(n);H==="step"&&(L.get(n).id?r.selected?(r.selected=!1,k.set(n,r)):(r.selected=!0,k.set(n,r)):(r.selected=!1,k.set(n,r)))},g.zoom=function(e,t){var n=t.getAttribute("name");g.setPopup(n)},g.setPopup=function(t){var n={x:0,y:337},r="left",i=k.get(_)||"",s=k.get(t);i&&(i.popup=!1,k.set(_,i)),s.popup=!0,k.set(t,s),_=t,t==="char"&&(n.x=475),t==="context"&&(n.x=195,r="right"),t==="problem"&&(n.x=342,r="right"),M[t].getNbItems()&&y.reset(M[t].toJSON(),n,r,document.getElementById("quicksetup-popup"))},g.closePopup=function(){var t=k.get(_);t.popup=!1,k.set(_,t),_=""},y=new a(g.closePopup),g.initTimer=function(e){var t=new Date,n=t.getTime(),r=e||0;N.set("display",!1),N.set("timer",r),h.get("step")==="quicksetup"&&(C=setInterval(function(){var e=new Date;N.set("timer",r+e.getTime()-n)},1e3))},g.reset=function(t){t?(P=h.get("elapsedTimers").quicksetup||0,h.get("characters").length?(H="screen",g.getDeck(h.get("deck")).then(function(){g.getCard(h.get("characters")[0],M.char).then(function(){var e=M.char;L.set("char",{id:e.get("_id"),title:e.get("title"),pic:e.get("picture_file")}),p.set("characters",L.get("char"))}),g.getCard(h.get("contexts")[0],M.context).then(function(){var e=M.context;L.set("context",{id:e.get("_id"),title:e.get("title"),pic:e.get("picture_file")}),p.set("contexts",L.get("context"))}),g.getCard(h.get("problems")[0],M.problem).then(function(){var e=M.problem;L.set("problem",{id:e.get("_id"),title:e.get("title"),pic:e.get("picture_file")}),p.set("problems",L.get("problem"))}),k.reset({"char":{selected:!0,left:1,popup:!1},context:{selected:!0,left:1,popup:!1},problem:{selected:!0,left:1,popup:!1}}),_="",N.set("timer",P),N.set("display",!0)})):(g.init(),g.initTimer(P))):g.init()},g.getDeck=function(t){var n=new u,r=new s;return r.setTransport(E),r.sync(S,t).then(function(){var e,t={},s=i.get("user").get("lang");!r.get("default_lang")||r.get("default_lang")===s?e=JSON.parse(r.toJSON()):r.get("translations")&&r.get("translations")[s]?e=r.get("translations")[s]:e=JSON.parse(r.toJSON()),t.char=e.content.characters,t.context=e.content.contexts,t.problem=e.content.problems,t.techno=e.content.techno,p.set("deck",t),n.resolve(),setTimeout(function(){r.unsync()},2e3)}),n},g.getCard=function(t,n){var r=new u,i=new s;return i.setTransport(E),i.sync(S,t).then(function(){n.reset(JSON.parse(i.toJSON())),r.resolve(),setTimeout(function(){i.unsync()},250)}),r},g.drawCard=function(t){var n=new u,r=k.get(t),i=L.get(t),s=Math.floor(Math.random()*T[t].length),o=T[t][s];return g.getCard(o,M[t]).then(function(){var e=M[t];A[t]++,T[t].splice(s,1),i.id=o,i.title=e.get("title"),i.pic=e.get("picture_file"),L.set(t,i),r.left=T[t].length,k.set(t,r),n.resolve()}),n},g.updateSessionScore=function(t){var n=new u,r={sid:h.get("_id"),step:"quicksetup",time:t,cards:A.char+A.context+A.problem};return E.request("UpdateSessionScore",r,function(e){e.res==="ok"?n.resolve():n.reject()}),n},g.init=function(){g.getDeck(i.get("user").get("active_deck")).then(function(){var e=p.get("deck");T.char=e.char.concat(),T.context=e.context.concat(),T.problem=e.problem.concat(),A.char=0,A.context=0,A.problem=0,M={"char":new o,context:new o,problem:new o},_="",O=!0,D=null,L.reset({"char":{id:"",title:w.get("char"),pic:""},context:{id:"",title:w.get("context"),pic:""},problem:{id:"",title:w.get("problem"),pic:""}}),k.reset({"char":{selected:!1,left:null,popup:!1},context:{selected:!1,left:null,popup:!1},problem:{selected:!1,left:null,popup:!1}})}),H="step"},g}}),define("brainstorm/whiteboard/wbdefault",["Olives/OObject","service/config","Olives/Model-plugin"],function(e,t,n){return function(i){var s=new e,o="",u=t.get("labels");return s.plugins.add("labels",new n(u)),i==="scenario"?o="quickscenariohelp":o="quickideahelp",s.template='<div id="whiteboard-default" class="defaultcontent"><div class="doctor-deedee"></div><div class="help" data-labels="bind:innerHTML,'+o+'"></div></div>',s}}),define("brainstorm/whiteboard/wbmain",["Olives/OObject","Olives/Model-plugin","Olives/Event-plugin","service/config"],function(e,t,n,r){return function(s,o,u){var a=new e,f,l=!0,c=!1,h=r.get("transport");return a.plugins.addAll({wbmain:new t(s,{displayPost:function(e){var t=this,n=t.getAttribute("data-wbmain_id"),r=s.get(n).content,i=s.get(n).style,o=s.get(n).background,u;switch(e){case"postit":t.classList.remove("photo"),t.classList.remove("drawing"),t.innerHTML='<div class="inner-postit">'+r+"</div>",t.setAttribute("style","background:url('img/brainstorm/"+i.img+"') no-repeat center center; background-size: contain; color:"+i.marker+";");break;case"import":t.classList.add("photo"),t.classList.remove("drawing"),this.innerHTML="",u={sid:f,filename:r},h.request("GetFile",u,function(e){t.setAttribute("style","background:white; background-image: url('"+e+"'); background-repeat: no-repeat; background-position: center center; background-size:contain;")});break;case"drawing":t.classList.remove("photo"),t.classList.add("drawing"),this.innerHTML="",u={sid:f,filename:r},h.request("GetFile",u,function(e){t.setAttribute("style","background:"+o+"; background-image: url('"+e+"'); background-repeat: no-repeat; background-position: center center; background-size:contain;")});break;default:}}}),wbevent:new n(a)}),a.template='<div class="wbmain"><ul class="wblist" data-wbmain="foreach"><li class="wb-item postit" data-wbmain="bind: displayPost, type" data-wbevent="listen: touchend, edit; listen:touchmove, cancelEdit"></li><ul><div>',a.edit=function(e,t){var n=t.getAttribute("data-wbmain_id"),r=s.get(n).type;l?c?s.get(n).type!=="postit"&&(t.classList.contains("enlarge")?t.classList.remove("enlarge"):t.classList.add("enlarge")):(o.set(r,"active"),u(r,n)):l=!0},a.cancelEdit=function(e,t){l=!1},a.setSessionId=function(e){f=e},a.setReadonly=function(e){c=e},a}}),define("brainstorm/whiteboard/wbpostit",["Olives/OObject","Store","Olives/Model-plugin","Olives/Event-plugin","service/config"],function(e,t,n,r,i){return function(o,u){var a=new e,f=i.get("labels"),l="#4D4D4D",c=new t([{name:"blue",color:"#657B99",img:"postItBlue.png",selected:!1},{name:"azur",color:"#9AC9CD",img:"postItAzur.png",selected:!1},{name:"yellow",color:"#F2E520",img:"postItYellow.png",selected:!0},{name:"orange",color:"#F27B3D",img:"postItOrange.png",selected:!1}]),h=null,p=new t({type:"postit",content:"",style:{postit:"yellow",img:"postItYellow.png",marker:"#4D4D4D"}});return a.plugins.addAll({labels:new n(f),postit:new n(p,{setStyle:function(e){var t=e.marker,n=e.img;this.setAttribute("style","background-image:url('img/brainstorm/"+n+"'); color:"+t+";")}}),colors:new n(c,{setBg:function(e){this.setAttribute("style","background:"+e+";")},setSelected:function(e){e?this.innerHTML="&#10003;":this.innerHTML=""}}),postitevent:new r(a)}),a.template='<div class="wbpostit"><div class="postit-cancel postit-close" data-postitevent="listen:touchstart,cancel"></div><div class="postit" data-postit="bind:setStyle, style"><textarea data-postit="bind: value, content"></textarea></div><span class="choosecolorlbl" data-labels="bind:innerHTML, choosecolorlbl"></span><ul class="postitcolors" data-colors="foreach"><li class="postitcolor" data-postitevent="listen:touchstart,choose" data-colors="bind:setBg, color;bind:setSelected, selected"></li></ul><div name="post" class = "postpostit" data-postitevent="listen: touchstart, press; listen:touchend, post"></div><div class = "delpostit" name="del" data-postitevent="listen:touchstart, press;listen:touchend, del"></div></div>',a.cancel=function(e,t){u("postit")},a.choose=function(e,t){var n=t.getAttribute("data-colors_id");c.loop(function(e,t){t===parseInt(n,10)?c.update(t,"selected",!0):c.update(t,"selected",!1)}),p.set("style",{postit:c.get(n).name,marker:l,img:c.get(n).img})},a.press=function(e,t){t.classList.add("pressed")},a.post=function(e,t){!h&&h!==0?o.alter("push",JSON.parse(p.toJSON())):(o.update(h,"content",p.get("content")),o.update(h,"style",p.get("style"))),t.classList.remove("pressed"),u("postit"),a.reset()},a.reset=function(t){h=t,!h&&h!==0?p.reset({type:"postit",content:"",style:{postit:"yellow",img:"postItYellow.png",marker:"#4D4D4D"}}):p.reset(o.get(t))},a.del=function(e,t){h&&o.del(h),t.classList.remove("pressed"),a.reset(),u("postit")},a}}),define("brainstorm/whiteboard/wbimport",["Olives/OObject","service/map","service/config","Olives/Model-plugin","Olives/Event-plugin","service/utils","Store","Promise"],function(e,t,n,r,i,s,o,u){return function(a,f){var l=new e,c=n.get("labels"),h=new FileReader,p=new o({status:null}),d=null,v=new o({type:"import",content:""}),m,g=400,y=300,b=function(e){var t,n,r=document.getElementById("preview"),i=r.getContext("2d");t=e.width,n=e.height,t>n?t>g&&(n*=g/t,t=g):n>y&&(t*=y/n,n=y),r.width=t,r.height=n,i.drawImage(e,0,0,t,n)},w=function(e){var t=new u,r="/upload",i=new FormData,o="postit",a=document.getElementById("preview"),f=a.toDataURL("image/png"),l=new Date,c=e||n.get("user").get("_id")+"_"+l.getTime();return i.append("type",o),i.append("sid",m),i.append("filename",c),i.append("dataString",f),s.uploadFile(r,i,p,function(e){v.set("content",c),t.resolve()}),t},E=function(){var e=document.getElementById("preview"),t=e.getContext("2d");t.clearRect(0,0,e.width,e.height)};return l.template='<div class="import"><ul><li class="importbutton" data-importevent="listen: touchstart, press; listen:touchend, picturePreview" data-labels="bind:innerHTML, importpiclbl"></li><li class="importbutton" data-importevent="listen: touchstart, press; listen:touchend, cameraPreview" data-labels="bind:innerHTML, importcameralbl"></li></ul><div id="postpic" class="wbpostit invisible" data-importmodel="bind:setVisibility, content"><div class="postit-cancel postit-close" data-importevent="listen:touchstart,cancel"></div><div class="picframe"><canvas id="preview" data-importmodel="bind:showPreview, content"></canvas></div><div name="post" class = "postpostit" data-importevent="listen: touchstart, press; listen:touchend, post"></div><div class = "delpostit" name="del" data-importevent="listen:touchstart, press;listen:touchend, del"></div><div class="uploadprogress" data-importprogress="bind:showProgress, status"></div></div>',l.plugins.addAll({labels:new r(c),importmodel:new r(v,{setVisibility:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")},showPreview:function(e){var t,r=this,i=n.get("transport");e?(t={sid:m,filename:e},i.request("GetFile",t,function(e){var t=new Image,n=r.getContext("2d");t.src=e,r.width=t.width,r.height=t.height,n.drawImage(t,0,0)})):this.innerHTML=""}}),importprogress:new r(p,{showProgress:function(e){e?this.innerHTML=e+"%":this.innerHTML=""}}),importevent:new i(l)}),l.cancel=function(e,t){t.parentNode.classList.add("invisible"),f("import")},l.check=function(e,t){t.classList.remove("pressed"),t.files.length&&l.preview("change",t)},l.cameraPreview=function(e,t){function i(e){n.src=e,setTimeout(function(){b(n),document.getElementById("postpic").classList.remove("invisible"),t.classList.remove("pressed")},1e3)}function s(e){alert("error: "+e)}var n=new Image,r={quality:50,correctOrientation:!0};navigator.camera.getPicture(i,s,r)},l.picturePreview=function(e,t){function s(e){r.src=e,setTimeout(function(){b(r),document.getElementById("postpic").classList.remove("invisible"),t.classList.remove("pressed")},1e3)}function o(e){alert("error: "+e)}var n=navigator.camera.PictureSourceType.PHOTOLIBRARY,r=new Image,i={quality:50,correctOrientation:!0,sourceType:n};navigator.camera.getPicture(s,o,i)},l.press=function(e,t){t.classList.add("pressed")},l.post=function(e,t){w(v.get("content")).then(function(){!d&&d!==0?a.alter("push",JSON.parse(v.toJSON())):a.update(d,"content",v.get("content")),t.classList.remove("pressed"),l.reset(),p.reset({status:""}),E(),f("import")})},l.reset=function(t){d=t,!d&&d!==0?v.reset({type:"import",content:""}):v.reset(a.get(t))},l.setSessionId=function(e){m=e},l.del=function(e,t){(d||d===0)&&a.del(d),t.classList.remove("pressed"),t.parentNode.classList.add("invisible"),l.reset(),E(),f("import")},l}}),define("brainstorm/whiteboard/wbdrawing",["Olives/OObject","service/map","service/config","Olives/Model-plugin","Olives/Event-plugin","Store","Promise","service/utils"],function(e,t,n,r,s,o,u,a){return function(f,c){var h=new e,p=null,d=[],v=new o({color:"#4D4D4D",size:"1",cap:"round",bg:"white",mode:"pencil"}),m=new o([{color:"#4D4D4D",active:!0},{color:"#657B99",active:!1},{color:"#9AC9CD",active:!1},{color:"#F2E520",active:!1},{color:"#F27B3D",active:!1},{color:"#BD262C",active:!1},{color:"#5F8F28",active:!1},{color:"white",active:!1}]),g=new o([{color:"white",active:!0},{color:"#657B99",active:!1},{color:"#9AC9CD",active:!1},{color:"#F2E520",active:!1},{color:"#F27B3D",active:!1},{color:"#BD262C",active:!1},{color:"#5F8F28",active:!1},{color:"#4D4D4D",active:!1}]),y=n.get("labels"),b=new o({status:null}),w=new o({type:"drawing",content:"",background:""}),E=function(e){var t=new u,r="/upload",i=new FormData,s="postit",o=document.getElementById("drawarea"),f=o.toDataURL("image/png"),l=new Date,c=e||n.get("user").get("_id")+"_"+l.getTime();return i.append("type",s),i.append("sid",S),i.append("filename",c),i.append("dataString",f),a.uploadFile(r,i,b,function(e){w.set("content",c),w.set("background",v.get("bg")),t.resolve()}),t},S;return h.plugins.addAll({labels:new r(y),color:new r(m,{setColor:function(e){this.setAttribute("style","background:"+e+";")},setActive:function(e){e?this.innerHTML="&#10003;":this.innerHTML=""}}),pencil:new r(v,{setSize:function(e){this.setAttribute("r",Math.round(e/2))},setColor:function(e){this.setAttribute("style","background:"+e+";")},togglebgfill:function(e){this.setAttribute("fill",e)},togglemode:function(e){e==="pencil"?this.setAttribute("fill",v.get("bg")):this.setAttribute("fill","#CCCCCC")},togglepencil:function(e){v.get("mode")==="pencil"?this.setAttribute("fill",e):this.setAttribute("fill",v.get("bg"))},toggleselected:function(e){this.classList.contains(e)?this.classList.add("selected"):this.classList.remove("selected")}}),bgcolor:new r(g,{setColor:function(e){this.setAttribute("style","background:"+e+";")},setActive:function(e){e?this.innerHTML="&#10003;":this.innerHTML=""}}),uploadprogress:new r(b,{showProgress:function(e){e?this.innerHTML=e+"%":this.innerHTML=""}}),drawing:new r(w,{draw:function(e){var t=n.get("transport"),r=this,i;e&&(i={sid:S,filename:e},t.request("GetFile",i,function(e){var t=new Image,n=r.getContext("2d");t.src=e,n.drawImage(t,0,0)}))}}),drawingevent:new s(h)}),h.template='<div class = "wbdrawing"><div class="drawingtools"><div class="pencil selected" data-pencil="bind:toggleselected, mode" data-drawingevent="listen:touchstart, drawactive"><span></span></div><div class="erase" data-drawingevent="listen:touchstart, erase" data-pencil="bind:toggleselected, mode"><span></span></div><div class="clear" data-drawingevent="listen:touchstart, select; listen:touchend,clear"><span data-labels="bind:innerHTML, cleardrawinglbl">Clear</span></div><p name="pencilsize" data-drawingevent="listen:touchstart, expand"><svg width="60" height="54"  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><circle class="stroke" cx="30" cy="36" r="18" stroke-width="1" data-pencil="bind:togglebgfill,bg; bind:togglemode,mode"/><circle class="fill" cx="30" cy="36" r="18" data-pencil="bind:setSize,size; bind:togglepencil,color"/></svg><div class="drawinglabel" data-labels="bind:innerHTML, pencilsizelbl">size</div></p><input id="pencilsize" class="vertical invisible" type="range" min="1" max="36" data-pencil="bind:value,size" data-drawingevent="listen:touchstart, stop; listen:touchmove,stop; listen:touchend,hide"><div name="pencilcolors" id="pencilcolor" data-drawingevent="listen:touchstart, expand"><ul id="pencilcolors"  class="invisible" data-color="foreach"><li class="color-item" data-drawingevent="listen:touchstart, getColor"><div data-color="bind:setColor, color; bind:setActive, active"></div></li></ul><div class="pencilpreview" data-pencil="bind:setColor, color"></div><div class="drawinglabel" data-labels="bind:innerHTML, pencilcolorlbl">Color</div></div><div name="pencilbgcolors" id="pencilbgcolor" data-drawingevent="listen:touchstart, expand"><ul id="pencilbgcolors"  class="invisible" data-bgcolor="foreach"><li class="color-item" data-drawingevent="listen:touchstart, getBgColor"><div data-bgcolor="bind:setColor, color; bind:setActive, active"></div></li></ul><div class="bgpreview" data-pencil="bind:setColor, bg"></div><div class="drawinglabel" data-labels="bind:innerHTML, drawbgcolorlbl">Background</div></div><div class="canceldrawing" data-drawingevent="listen:touchstart, select; listen:touchend,cancel"></div><div class="deletedrawing" data-drawingevent="listen:touchstart,select;listen:touchend,deletedrawing"></div><div class="savedrawing" data-drawingevent="listen:touchstart, post" data-uploadprogress="bind:showProgress,status" ></div></div><canvas id="drawarea" class="drawingcanvas" width=652 height=438 data-pencil="bind:setColor, bg" data-drawingevent="listen:touchstart,start;listen:touchmove,move;listen:touchend,end;" data-drawing="bind:draw, content"></canvas></div>',h.setSessionId=function(e){S=e},h.clear=function(e,t){var n=document.getElementById("drawarea"),r=n.getContext("2d");r.clearRect(0,0,n.width,n.height),t.classList.remove("selected")},h.resetColors=function(){v.reset({color:"#4D4D4D",size:"1",cap:"round",bg:"white",mode:"pencil"}),m.reset([{color:"#4D4D4D",active:!0},{color:"#657B99",active:!1},{color:"#9AC9CD",active:!1},{color:"#F2E520",active:!1},{color:"#F27B3D",active:!1},{color:"#BD262C",active:!1},{color:"#5F8F28",active:!1},{color:"white",active:!1}]),g.reset([{color:"white",active:!0},{color:"#657B99",active:!1},{color:"#9AC9CD",active:!1},{color:"#F2E520",active:!1},{color:"#F27B3D",active:!1},{color:"#BD262C",active:!1},{color:"#5F8F28",active:!1},{color:"#4D4D4D",active:!1}])},h.erase=function(e,t){v.set("mode","erase"),v.set("color",v.get("bg"))},h.drawactive=function(e,t){v.set("mode","pencil"),m.loop(function(e,t){e.active&&v.set("color",e.color)})},h.expand=function(e,t){var n=t.getAttribute("name"),r=document.getElementById(n);r.classList.contains("invisible")?r.classList.remove("invisible"):r.classList.add("invisible")},h.stop=function(e,t){e.stopPropagation()},h.hide=function(e,t){e.stopPropagation(),t.classList.add("invisible")},h.select=function(e,t){t.classList.add("selected")},h.getColor=function(e,t){var n=t.getAttribute("data-color_id");e.stopPropagation(),m.loop(function(e,t){t===parseInt(n)?m.update(t,"active",!0):m.update(t,"active",!1)}),v.set("color",m.get(n).color),v.set("mode","pencil"),t.parentNode.classList.add("invisible")},h.getBgColor=function(e,t){var n=t.getAttribute("data-bgcolor_id");e.stopPropagation(),g.loop(function(e,t){t===parseInt(n)?g.update(t,"active",!0):g.update(t,"active",!1)}),v.set("bg",g.get(n).color),t.parentNode.classList.add("invisible")},h.cancel=function(e,t){h.clear(e,t),h.resetColors(),w.reset({type:"drawing",content:"",background:""}),t.classList.remove("selected"),c("drawing")},h.deletedrawing=function(e,t){(p||p===0)&&f.del(p),h.cancel(e,t)},h.post=function(e,t){t.classList.add("selected"),E(w.get("content")).then(function(){!p&&p!==0?f.alter("push",JSON.parse(w.toJSON())):(f.update(p,"content",w.get("content")),f.update(p,"background",w.get("background"))),t.classList.remove("selected"),h.cancel(e,t),b.reset({status:""})})},h.reset=function(t){p=t,h.resetColors(),d=[],!p&&p!==0?w.reset({type:"drawing",content:"",background:""}):(w.reset(f.get(t)),v.set("bg",w.get("background")),g.loop(function(e,t){e.color===w.get("background")?g.update(t,"active",!0):g.update(t,"active",!1)}))},h.start=function(e,t){var n=e.touches;for(i=0,l=n.length;i<l;i++){var r=n[i];d[r.identifier]={x:r.pageX-t.offsetLeft,y:r.pageY-t.offsetTop}}e.preventDefault()},h.end=function(e,t){},h.move=function(e,t){var n=e.touches;for(i=0,l=n.length;i<l;i++){var r=n[i],s=r.identifier,o=r.pageX-t.offsetLeft-d[s].x,u=r.pageY-t.offsetTop-d[s].y,a=h.draw(t,s,o,u);d[s]={x:a.x,y:a.y}}e.preventDefault()},h.draw=function(e,t,n,r){var i=e.getContext("2d");return i.lineWidth=v.get("size"),i.strokeStyle=v.get("color"),i.lineCap=v.get("cap"),i.beginPath(),i.moveTo(d[t].x,d[t].y),i.lineTo(d[t].x+n,d[t].y+r),i.stroke(),i.closePath(),{x:d[t].x+n,y:d[t].y+r}},h}}),define("brainstorm/whiteboard/whiteboard",["Amy/Stack-plugin","./wbdefault","./wbmain","./wbpostit","./wbimport","./wbdrawing","Store"],function(e,t,n,r,i,s,o){function u(e,u,a){var f=new o([]),l=this;this.selectScreen=function(t,n){n&&l.getStack().get(t).reset(n),l.getStack().show(t)},this.exitScreen=function(t){u.getNbItems()?l.getStack().show("main"):l.getStack().show("default"),a.set(t,"inactive")},this.getContent=function(){return f},this.setSessionId=function(e){l.getStack().get("main").setSessionId(e),l.getStack().get("import").setSessionId(e),l.getStack().get("drawing").setSessionId(e)},this.setReadonly=function(e){l.getStack().get("main").setReadonly(e)},this.getStack().add("default",new t(e)),this.getStack().add("main",new n(u,a,this.selectScreen)),this.getStack().add("postit",new r(u,this.exitScreen)),this.getStack().add("import",new i(u,this.exitScreen)),this.getStack().add("drawing",new s(u,this.exitScreen))}return function(n,r,i){return u.prototype=new e,new u(n,r,i)}}),define("brainstorm/quickb/quickscenario",["Olives/OObject","service/map","Olives/Model-plugin","Olives/Event-plugin","service/config","Store","CouchDBStore","service/cardpopup","../whiteboard/whiteboard","Promise","service/utils"],function(e,t,n,r,i,s,o,u,a,f,l){return function(h,p,d,v,m){var g=new e,y,b,w=i.get("labels"),E=new s,S=new s,x=new s,T=new s({"char":{id:"",title:"",pic:""},context:{id:"",title:"",pic:""},problem:{id:"",title:"",pic:""}}),N=new s({cardpopup:{"char":!1,context:!1,problem:!1}},{postit:"inactive"},{"import":"inactive"},{drawing:"inactive"},{ready:!1},{showstory:!1},{shownext:!1},{readonly:!1}),C=new s({timer:null,display:!1}),k,L=new s({title:"",story:"",solution:""}),A=new s([]),O=new a("scenario",A,N),M,_=0,D="step",P=i.get("transport");return g.plugins.addAll({labels:new n(w,{setPlaceholder:function(e){this.setAttribute("placeholder",e)}}),cards:new n(T,{formatTitle:function(e){e&&(this.innerHTML=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase())},setPic:function(e){e&&this.setAttribute("style","background-image:url('"+e+"');")}}),wbtools:new n(N,{setActive:function(e){e==="active"?this.classList.add("pushed"):this.classList.remove("pushed")},setReady:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")},toggleToolbox:function(e){e?this.classList.add("invisible"):this.classList.remove("invisible")},setReadonly:function(e){e?this.setAttribute("readonly","readonly"):this.removeAttribute("readonly")},popup:function(e){e?this.classList.add("highlighted"):this.classList.remove("highlighted")}}),quickscenariotimer:new n(C,{setTime:function(e){this.innerHTML=l.formatDuration(e)},displayTimer:function(e){e?this.classList.add("showtimer"):this.classList.remove("showtimer")}}),scenario:new n(L),wbstack:O,quickscenarioevent:new r(g)}),g.template='<div id = "quickscenario"><div class="previousbutton" data-quickscenarioevent="listen: touchstart, press; listen: touchstart, prev"></div><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, quickscenario" data-quickscenarioevent="listen:touchstart, toggleProgress"></div><div class="timer" data-quickscenariotimer="bind:setTime, timer; bind: displayTimer, display" data-quickscenarioevent="listen:touchstart,toggleTimer"></div><div id="quickscenario-left" class="leftarea"><div class = "card char" data-wbtools="bind:popup,cardpopup.char" name="char" data-quickscenarioevent="listen:touchstart, zoom"><div class="cardpicture" data-cards="bind:setPic,char.pic"></div><div class="cardtitle" data-cards="bind:formatTitle,char.title">Character</div></div><div class="card context" name="context" data-wbtools="bind: popup,cardpopup.context" data-quickscenarioevent="listen:touchstart, zoom"><div class="cardpicture" data-cards="bind:setPic,context.pic"></div><div class="cardtitle" data-cards="bind: formatTitle,context.title">Context</div></div><div class="card problem" name="problem" data-wbtools="bind:popup, cardpopup.problem" data-quickscenarioevent="listen:touchstart, zoom"><div class="cardpicture" data-cards="bind:setPic,problem.pic"></div><div class="cardtitle" data-cards="bind:formatTitle,problem.title">Problem</div></div></div><div id="quickscenario-popup"></div><div id="quickscenario-right" class="workarea"><div id="scenario-whiteboard" class="whiteboard"><div class="stack" data-wbstack="destination"></div></div><div id="toolbox" data-wbtools="bind:toggleToolbox, showstory"><div class="toolbox-button"><div class="postit-button" name="postit" data-wbtools="bind:setActive, postit" data-quickscenarioevent="listen: touchstart, push; listen:touchend, post"></div><legend>Post-it</legend></div><div class="toolbox-button"><div class="importpic-button" name="import" data-wbtools="bind:setActive, import" data-quickscenarioevent="listen: touchstart, push; listen:touchend, importpic"></div><legend>Import pictures</legend></div><div class="toolbox-button"><div class="drawingtool-button" name="drawing" data-wbtools="bind:setActive, drawing" data-quickscenarioevent="listen: touchstart, push; listen:touchend, draw"></div><legend>Drawing tool</legend></div></div><div id="finish-button" class="invisible" data-wbtools="bind:setReady, ready" data-labels="bind:innerHTML, finishbutton" data-quickscenarioevent="listen: touchstart, press; listen:touchend, finish"></div><div id = "quickscenario-writeup" class="writeup invisible" data-wbtools="bind: setReady,showstory"><textarea class = "enterTitle" maxlength="40" data-labels="bind:setPlaceholder, storytitleplaceholder" data-scenario="bind:value, title" data-wbtools="bind:setReadonly, readonly"></textarea><div class="setPrivate"></div><div class="setPublic"></div><textarea class = "enterDesc" data-labels="bind:setPlaceholder, storydescplaceholder" data-scenario="bind:value, story" data-wbtools="bind:setReadonly, readonly"></textarea><textarea class = "enterSol" data-labels="bind:setPlaceholder, storysolplaceholder" data-scenario="bind:value, solution" data-wbtools="bind:setReadonly, readonly"></textarea><div class = "finish-button finish-writeup"></div></div><div class="next-button invisible" data-wbtools="bind:setReady, shownext" data-labels="bind:innerHTML, nextbutton" data-quickscenarioevent="listen: touchstart, press; listen:touchend, next"></div></div></div>',g.place(t.get("quickscenario")),g.press=function(e,t){t.classList.add("pressed")},g.next=function(e,t){t.classList.remove("pressed"),D==="step"?(D="screen",clearInterval(k),C.set("display",!0),p.set("scenario",JSON.parse(L.toJSON())),g.updateSessionScore(C.get("timer")).then(function(){h.unsync(),h.sync(i.get("db"),h.get("_id")).then(function(){var e=h.get("elapsedTimers");e.quickscenario=C.get("timer"),h.set("scenario",[JSON.parse(L.toJSON())]),h.set("elapsedTimers",e),N.set("readonly",!0),v("quickscenario")})})):v("quickscenario")},g.prev=function(e,t){t.classList.remove("pressed"),d("quickscenario")},g.toggleProgress=function(e,t){m(t)},g.toggleTimer=function(e,t){C.set("display",!C.get("display"))},g.push=function(e,t){var n=t.getAttribute("name");N.set(n,"active")},g.zoom=function(e,t){var n=t.getAttribute("name");g.setPopup(n)},g.setPopup=function(t){var n={x:240,y:130},r="left",s=T.get(t),u=N.get("cardpopup"),a="",f;b&&(u[b]=!1),u[t]=!0,N.set("cardpopup",u),b=t,t==="char"&&(n.y=120,s.id===E.get("_id")&&(a=E.toJSON())),t==="context"&&(n.y=290,s.id===S.get("_id")&&(a=S.toJSON())),t==="problem"&&(n.y=350,s.id===x.get("_id")&&(a=x.toJSON())),a?y.reset(a,n,r,document.getElementById("quickscenario-popup")):(f=new o,f.setTransport(P),f.sync(i.get("db"),s.id).then(function(){a=f.toJSON(),y.reset(a,n,r,document.getElementById("quickscenario-popup")),t==="char"&&E.reset(JSON.parse(f.toJSON())),t==="context"&&S.reset(JSON.parse(f.toJSON())),t==="problem"&&x.reset(JSON.parse(f.toJSON()))}))},g.closePopup=function(){var t=N.get("cardpopup");t[b]=!1,N.set("cardpopup",t),b=""},y=new u(g.closePopup),g.post=function(e,t){O.selectScreen("postit"),N.set("import","inactive"),N.set("drawing","inactive")},g.importpic=function(e,t){O.selectScreen("import"),N.set("postit","inactive"),N.set("drawing","inactive")},g.draw=function(e,t){O.selectScreen("drawing"),N.set("import","inactive"),N.set("postit","inactive")},g.exitTool=function(t){N.set(t,"inactive")},g.finish=function(e,t){O.setReadonly(!0),N.set("ready",!1),N.set("showstory",!0)},g.updateSessionScore=function(e){var t=new f,n={sid:h.get("_id"),step:"quickscenario",time:e,wbcontent:A.toJSON(),scenario:L.toJSON()};return P.request("UpdateSessionScore",n,function(e){e.res==="ok"?t.resolve():t.reject()}),t},g.reset=function(t){N.reset({cardpopup:{"char":!1,context:!1,problem:!1}},{postit:"inactive"},{"import":"inactive"},{drawing:"inactive"},{ready:!1},{showstory:!1},{shownext:!1},{readonly:!1}),O.setSessionId(h.get("_id")),A.reset(h.get("scenarioWB")),A.getNbItems()?O.selectScreen("main"):O.selectScreen("default"),h.get("scenario").length?(D="screen",N.set("ready",!1),N.set("showstory",!0),O.setReadonly(!0),L.reset(h.get("scenario")[0]),p.set("scenario",h.get("scenario")[0]),N.set("readonly",!0),N.set("shownext",!0)):(L.reset({title:"",story:"",solution:""}),A.getNbItems()?N.set("ready",!0):N.set("ready",!1),O.setReadonly(!1),D="step"),h.get("elapsedTimers").quickscenario?_=h.get("elapsedTimers").quickscenario:_=0,C.set("timer",_),D==="screen"?C.set("display",!0):g.initTimer(_)},g.initTimer=function(e){var t=new Date,n=t.getTime(),r=e||0;C.set("display",!1),C.set("timer",r),h.get("step")==="quickscenario"&&(k=setInterval(function(){var e=new Date;C.set("timer",r+e.getTime()-n)},1e3))},p.watchValue("characters",function(e){T.set("char",e)}),p.watchValue("contexts",function(e){T.set("context",e)}),p.watchValue("problems",function(e){T.set("problem",e)}),h.watchValue("_id",function(e){O.setSessionId(e)}),["added","deleted","updated"].forEach(function(e){A.watch(e,function(){JSON.stringify(h.get("scenarioWB"))!==A.toJSON()&&(h.set("scenarioWB",JSON.parse(A.toJSON())),h.upload()),A.getNbItems()&&D==="step"?N.set("ready",!0):N.set("ready",!1)})}),L.watch("updated",function(){L.get("title")&&L.get("story")&&L.get("solution")?N.set("shownext",!0):N.set("shownext",!1)}),g}}),define("brainstorm/quickb/quicktech",["Olives/OObject","service/map","Olives/Model-plugin","Olives/Event-plugin","service/config","service/help","Store","CouchDBStore","Promise","service/cardpopup","service/utils"],function(e,t,n,r,i,s,o,u,a,f,l){return function(h,p,d,v,m){var g=new e,y=null,b=null,w,E=new o({timer:null,display:!1}),S=i.get("transport"),x=i.get("user"),T=i.get("labels"),N,C,k=new o({left:"",scenario:{popup:!1},tech1:{popup:!1,selected:!1},tech2:{popup:!1,selected:!1},tech3:{popup:!1,selected:!1}}),L=[],A=!0,O=new o,M=new o,_=new o,D={tech1:O,tech2:M,tech3:_},P=0,H=new o([{id:"",title:"",pic:""},{id:"",title:"",pic:""},{id:"",title:"",pic:""}]),B="step";return g.plugins.addAll({labels:new n(T),display:new n(k,{setReload:function(e){!e&&P>0?this.classList.add("reload"):this.classList.remove("reload")},updateNext:function(e){k.get("tech1").selected&&k.get("tech2").selected&&k.get("tech3").selected?this.classList.remove("invisible"):this.classList.add("invisible")},setSelected:function(e){e?this.classList.add("pushed"):this.classList.remove("pushed")},popup:function(e){e?this.classList.add("highlighted"):this.classList.remove("highlighted")}}),techcards:new n(H,{removeDefault:function(e){e?this.classList.remove("defaultcard"):this.classList.add("defaultcard")},formatTitle:function(e){e&&(this.innerHTML=e.toUpperCase())},setPic:function(e){e?this.setAttribute("style","background-image:url('"+e+"');"):this.setAttribute("style","background-image: none;")}}),quicktechtimer:new n(E,{setTime:function(e){this.innerHTML=l.formatDuration(e)},displayTimer:function(e){e?this.classList.add("showtimer"):this.classList.remove("showtimer")}}),quicktechevent:new r(g)}),g.template='<div id = "quicktech"><div class="previousbutton" data-quicktechevent="listen: touchstart, press; listen: touchstart, prev"></div><div id="quicktech-popup" class="invisible"></div><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, quicktech" data-quicktechevent="listen:touchstart, toggleProgress"></div><div class="timer" data-quicktechtimer="bind:setTime, timer; bind: displayTimer, display" data-quicktechevent="listen:touchstart,toggleTimer"></div><div class="help-brainstorm" data-quicktechevent="listen:touchstart, help"></div><div id="quicktech-left" class="leftarea"><div class="card defaultscenario" name="scenario" data-quicktechevent="listen: touchstart, select; listen:touchstart, zoom" data-display="bind: popup, scenario.popup"><div class="cardpicture"></div><div class="cardtitle" data-labels="bind:innerHTML, scenariolbl"></div></div></div><div class="drawarea"><div class="decks"><div class="drawbutton drawtech" "name"="tech" data-quicktechevent="listen: touchstart, push; listen:touchend, draw" data-display="bind: setReload, left"></div></div><div class="cards"><div class="card tech defaultcard" name="tech1" data-quicktechevent="listen: touchstart, select; listen:touchend, zoom" data-techcards="bind:removeDefault, 0.pic" data-display="bind: popup, tech1.popup"><div class="cardpicture" data-techcards="bind:setPic, 0.pic"></div><div class="cardtitle" data-techcards="bind:formatTitle, 0.title" data-labels="bind:innerHTML, tech1lbl"></div></div><div class="card tech defaultcard" name="tech2" data-quicktechevent="listen: touchstart, select; listen:touchend, zoom" data-techcards="bind:removeDefault, 1.pic" data-display="bind: popup, tech2.popup"><div class="cardpicture" data-techcards="bind:setPic, 1.pic"></div><div class="cardtitle" data-techcards="bind:formatTitle, 1.title" data-labels="bind:innerHTML,tech2lbl"></div></div><div class="card tech defaultcard" name="tech3" data-quicktechevent="listen: touchstart, select; listen:touchend, zoom" data-techcards="bind:removeDefault, 2.pic" data-display="bind: popup, tech3.popup"><div class="cardpicture" data-techcards="bind:setPic, 2.pic"></div><div class="cardtitle" data-techcards="bind:formatTitle, 2.title" data-labels="bind:innerHTML, tech3lbl"></div></div></div><div class="confirmdraw"><div class="drawok" name="tech1" data-quicktechevent="listen: touchstart, push; listen:touchend, accept"></div><div class="drawok" name="tech2" data-quicktechevent="listen: touchstart, push; listen:touchend, accept"></div><div class="drawok" name="tech3" data-quicktechevent="listen: touchstart, push; listen:touchend, accept"></div></div><div class="next-button" data-labels="bind:innerHTML, nextbutton" data-quicktechevent="listen: touchstart, press; listen:touchend, next" data-display="bind:updateNext, tech1.selected;bind:updateNext, tech2.selected;bind:updateNext, tech3.selected"></div></div></div>',g.place(t.get("quicktech")),g.press=function(e,t){t.classList.add("pressed")},g.next=function(e,t){var n=new Date,r=n.getTime()-y;B==="step"?(B="screen",p.set("techno",H),clearInterval(w),E.set("display",!0),g.updateSessionScore(E.get("timer")).then(function(){h.unsync(),h.sync(i.get("db"),h.get("_id")).then(function(){var e=h.get("elapsedTimers");e.quicktech=E.get("timer"),h.set("elapsedTimers",e),h.set("techno",[[H.get(0).id,H.get(1).id,H.get(2).id]]),t.classList.remove("pressed"),v("quicktech")})})):(t.classList.remove("pressed"),v("quicktech"))},g.help=function(e,t){s.setContent("quicktechhelp"),document.getElementById("cache").classList.add("appear"),document.getElementById("help-popup").classList.add("appear")},g.prev=function(e,t){t.classList.remove("pressed"),d("quicktech")},g.toggleProgress=function(e,t){m(t)},g.toggleTimer=function(e,t){E.set("display",!E.get("display"))},g.select=function(e,t){var n=t.getAttribute("name");(n.search("tech")<0||P>0||B==="screen")&&t.classList.add("highlighted")},g.zoom=function(e,t){var n=t.getAttribute("name");(n.search("tech")<0||P>0||B==="screen")&&g.setPopup(n)},g.setPopup=function(t){var n={x:0,y:337},r="left",i=k.get(C)||"",s=new o,u,a=k.get(t);i&&(i.popup=!1,k.set(C,i)),a.popup=!0,k.set(t,a),C=t,t==="scenario"?(n.x=240,n.y=275,s.reset(h.get("scenario")[0]),s.set("type",5),u=s.toJSON()):(t==="tech1"&&(n.x=560),t==="tech2"&&(n.x=279,r="right"),t==="tech3"&&(n.x=426,r="right"),D[t].get("_id")&&(u=D[t].toJSON())),u&&N.reset(u,n,r,document.getElementById("quicktech-popup"))},g.closePopup=function(){var t=k.get(C);t.popup=!1,k.set(C,t),C=""},g.push=function(e,t){var n=t.getAttribute("name");t.classList.contains("drawok")?D[n].get("_id")&&B==="step"&&t.classList.add("pushed"):t.classList.add("pushed")},g.draw=function(e,t){B==="step"&&A&&(A=!1,k.get("tech1").selected||g.drawTech("tech1"),k.get("tech2").selected||g.drawTech("tech2"),k.get("tech3").selected||g.drawTech("tech3"),setTimeout(function(){t.classList.remove("pushed"),A=!0},350))},g.drawTech=function(t){var n;L.length===0&&(L=p.get("deck").techno.concat(),k.loop(function(e,t){e.selected&&L.splice(L.indexOf(H.get(t).id),1)})),n=Math.floor(Math.random()*L.length),g.getCardDetails(L[n],t),L.splice(n,1),k.set("left",L.length),P++},g.getCardDetails=function(t,n){var r=new u,s=["tech1","tech2","tech3"],o=s.indexOf(n);r.setTransport(S),r.sync(i.get("db"),t).then(function(){D[n].reset(JSON.parse(r.toJSON())),H.update(o,"id",t),H.update(o,"title",r.get("title")),H.update(o,"pic",r.get("picture_file")),setTimeout(function(){r.unsync()},500)})},g.accept=function(e,t){var n=t.getAttribute("name"),r=["tech1","tech2","tech3"],i=r.indexOf(n),s=k.get(n);B==="step"&&(H.get(i)&&H.get(i).id?s.selected?(t.classList.remove("pushed"),s.selected=!1,k.set(n,s)):(s.selected=!0,k.set(n,s)):(alert("please draw a card first"),t.classList.remove("pushed")))},g.reset=function(e){var t=h.get("techno")[0];k.reset({left:"",scenario:{popup:!1},tech1:{popup:!1,selected:!1},tech2:{popup:!1,selected:!1},tech3:{popup:!1,selected:!1}}),e&&t.length?(B="screen",g.getCardDetails(t[0],"tech1"),g.getCardDetails(t[1],"tech2"),g.getCardDetails(t[2],"tech3"),["tech1","tech2","tech3"].forEach(function(e){k.set(e,{popup:!1,selected:!0})}),H.watch("updated",function(){H.getNbItems()===3&&p.set("techno",H)})):(L=[],P=0,B="step",O.reset(),M.reset(),_.reset(),H.reset([{id:"",title:"",pic:""},{id:"",title:"",pic:""},{id:"",title:"",pic:""}])),h.get("elapsedTimers").quicktech?b=h.get("elapsedTimers").quicktech:b=0,E.set("timer",b),B==="screen"?E.set("display",!0):g.initTimer(b)},g.updateSessionScore=function(t){var n=new a,r={sid:h.get("_id"),step:"quicktech",time:t,cards:P};return S.request("UpdateSessionScore",r,function(e){e.res==="ok"?n.resolve():n.reject()}),n},g.initTimer=function(e){var t=new Date,n=t.getTime(),r=e||0;E.set("display",!1),E.set("timer",r),h.get("step")==="quicktech"&&(w=setInterval(function(){var e=new Date;E.set("timer",r+e.getTime()-n)},1e3))},N=new f(g.closePopup),p.watchValue("deck",function(e){L=e.techno.concat(),k.set("left",L.length)}),g}}),define("brainstorm/quickb/quickidea",["Olives/OObject","service/map","Olives/Model-plugin","Olives/Event-plugin","service/config","service/cardpopup","../whiteboard/whiteboard","Store","CouchDBStore","Promise","service/utils"],function(e,t,n,r,i,s,o,u,a,f,l){return function(h,p,d,v,m){var g=new e,y,b,w="step",E,S=0,x,T=new u({timer:null,display:!1}),N=new u({title:"",description:"",solution:"",visibility:"private"}),C=new u,k=new u([]),L=[],A=new u({cardpopup:{scenario:!1,techs:[!1,!1,!1]}},{postit:"inactive"},{"import":"inactive"},{drawing:"inactive"},{ready:!1},{showidea:!1},{shownext:!1},{readonly:!1}),O=new u([]),M=new o("idea",O,A),_=i.get("transport"),D=i.get("labels");return g.plugins.addAll({labels:new n(D,{setPlaceholder:function(e){this.setAttribute("placeholder",e)}}),scenario:new n(C),techs:new n(k,{setPic:function(e){e&&this.setAttribute("style","background-image:url('"+e+"');")}}),wbtools:new n(A,{setActive:function(e){e==="active"?this.classList.add("pushed"):this.classList.remove("pushed")},setReady:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")},toggleToolbox:function(e){e?this.classList.add("invisible"):this.classList.remove("invisible")},setReadonly:function(e){e?this.setAttribute("readonly","readonly"):this.removeAttribute("readonly")},popup:function(e){var t;this.getAttribute("name")==="scenario"?e?this.classList.add("highlighted"):this.classList.remove("highlighted"):(t=this.getAttribute("data-techs_id"),e[t]?this.classList.add("highlighted"):this.classList.remove("highlighted"))}}),quickideatimer:new n(T,{setTime:function(e){this.innerHTML=l.formatDuration(e)},displayTimer:function(e){e?this.classList.add("showtimer"):this.classList.remove("showtimer")}}),idea:new n(N,{setVisibility:function(e){e==="public"?(this.value=0,this.setAttribute("style","background-image:url('img/brainstorm/publicforslider.png'); background-position: 50px center; background-repeat:no-repeat; background-size: 30px;")):(this.value=1,this.setAttribute("style","background-image:url('img/brainstorm/privateforslider.png'); background-position: 15px center; background-repeat:no-repeat; background-size: 20px;"))}}),wbstack:M,quickideaevent:new r(g)}),g.template='<div id = "quickidea"><div class="previousbutton" data-quickideaevent="listen: touchstart, press; listen: touchstart, prev"></div><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, quickidea" data-quickideaevent="listen:touchstart, toggleProgress"></div><div class="timer" data-quickideatimer="bind:setTime, timer; bind: displayTimer, display" data-quickideaevent="listen:touchstart,toggleTimer"></div><div id="quickidea-left" class="leftarea"><div class="card defaultscenario" name="scenario" data-quickideaevent="listen: touchstart, select; listen:touchend, zoom" data-wbtools="bind: popup,cardpopup.scenario"><div class="cardpicture"></div><div class="cardtitle" data-scenario="bind:innerHTML, title"></div></div><ul class="cardlist" data-techs="foreach"><li><div class="card tech" data-quickideaevent="listen: touchstart, select; listen:touchend, zoom" data-wbtools="bind: popup,cardpopup.techs"><div class="cardpicture" data-techs="bind:setPic, pic"></div><div class="cardtitle" data-techs="bind:innerHTML,title"></div></div></li></ul></div><div id="quickidea-popup"></div><div id="quickidea-right" class="workarea"><div id="idea-whiteboard" class="whiteboard"><div class="stack" data-wbstack="destination"></div></div><div id="toolbox" data-wbtools="bind:toggleToolbox, showidea"><div class="toolbox-button"><div class="postit-button" name="postit" data-wbtools="bind:setActive, postit" data-quickideaevent="listen: touchstart, push; listen:touchend, post"></div><legend>Post-it</legend></div><div class="toolbox-button"><div class="importpic-button" name="import" data-wbtools="bind:setActive, import" data-quickideaevent="listen: touchstart, push; listen:touchend, importpic"></div><legend>Import pictures</legend></div><div class="toolbox-button"><div class="drawingtool-button" name="drawing" data-wbtools="bind:setActive, drawing" data-quickideaevent="listen: touchstart, push; listen:touchend, draw"></div><legend>Drawing tool</legend></div></div><div id="finish-button" class="invisible" data-wbtools="bind:setReady, ready" data-labels="bind:innerHTML, finishbutton" data-quickideaevent="listen: touchstart, press; listen:touchend, finish"></div><div id = "quickidea-writeup" class="writeup invisible" data-wbtools="bind: setReady,showidea"><textarea class = "enterTitle" maxlength="40" data-labels="bind:setPlaceholder, ideatitleplaceholder" data-idea="bind:value, title" data-wbtools="bind:setReadonly, readonly"></textarea><input class="visibility-slider" type="range" min="0" max="1" value ="1" data-idea="bind: setVisibility, visibility" data-quickideaevent="listen:touchend, toggleVisibility" data-wbtools="bind:setReadonly, readonly"><textarea class = "enterDesc" data-labels="bind:setPlaceholder, ideadescplaceholder" data-idea="bind:value, description" data-wbtools="bind:setReadonly, readonly"></textarea><textarea class = "enterSol" data-labels="bind:setPlaceholder, ideasolplaceholder" data-idea="bind:value, solution" data-wbtools="bind:setReadonly, readonly"></textarea><div class = "finish-button finish-writeup"></div></div><div class="next-button invisible" data-wbtools="bind:setReady, shownext" data-labels="bind:innerHTML, nextbutton" data-quickideaevent="listen: touchstart, press; listen:touchend, next"></div></div></div>',g.place(t.get("quickidea")),g.press=function(e,t){t.classList.add("pressed")},g.next=function(e,t){var n=new Date,r,s;t.classList.remove("pressed"),w==="step"?(w="screen",clearInterval(x),T.set("display",!0),s=g.getSessionDuration(),p.set("idea",JSON.parse(N.toJSON())),g.createIdeaDoc(),g.updateSessionScore(T.get("timer")).then(function(){h.unsync(),h.sync(i.get("db"),h.get("_id")).then(function(){var e=h.get("elapsedTimers");e.quickidea=T.get("timer"),h.set("idea",[JSON.parse(N.toJSON())]),h.set("elapsedTimers",e),h.set("duration",s),h.set("status","completed"),A.set("readonly",!0),v("quickidea")})})):v("quickidea")},g.prev=function(e,t){t.classList.remove("pressed"),d("quickidea")},g.toggleProgress=function(e,t){m(t)},g.toggleTimer=function(e,t){T.set("display",!T.get("display"))},g.toggleVisibility=function(e,t){w==="step"&&(N.get("visibility")==="public"?N.set("visibility","private"):N.set("visibility","public"))},g.push=function(e,t){var n=t.getAttribute("name");A.set(n,"active")},g.select=function(e,t){t.classList.add("higlighted")},g.zoom=function(e,t){var n,r;t.getAttribute("name")==="scenario"?n="scenario":(n="techno",r=t.getAttribute("data-techs_id")),g.setPopup(n,r)},g.setPopup=function(t,n){var r={x:240,y:30},s="left",o=A.get("cardpopup"),f=new u,l="",c,h;b&&(b.type==="scenario"?o.scenario=!1:o.techs[b.id]=!1,A.set("cardpopup",o)),t==="scenario"?o.scenario=!0:o.techs[n]=!0,A.set("cardpopup",o),b={type:t,id:n},t==="scenario"?(r.y=55,f.reset(p.get("scenario")),f.set("type",5),l=f.toJSON(),y.reset(l,r,s,document.getElementById("quickidea-popup"))):(n==0&&(r.y=200),n==1&&(r.y=260),n==2&&(r.y=350),L[n]?(l=L[n],y.reset(l,r,s,document.getElementById("quickidea-popup"))):(h=new a,h.setTransport(_),h.sync(i.get("db"),p.get("techno").get(n).id).then(function(){l=h.toJSON(),y.reset(l,r,s,document.getElementById("quickidea-popup")),L[n]=l})))},g.closePopup=function(){var t=A.get("cardpopup");t[b]=!1,A.set("cardpopup",t),b=""},y=new s(g.closePopup),g.post=function(e,t){M.selectScreen("postit"),A.set("import","inactive"),A.set("drawing","inactive")},g.importpic=function(e,t){M.selectScreen("import"),A.set("postit","inactive"),A.set("drawing","inactive")},g.draw=function(e,t){M.selectScreen("drawing"),A.set("import","inactive"),A.set("postit","inactive")},g.exitTool=function(t){A.set(t,"inactive")},g.finish=function(e,t){M.setReadonly(!0),A.set("ready",!1),A.set("showidea",!0)},g.updateSessionScore=function(e){var t=new f,n={sid:h.get("_id"),step:"quickidea",time:e,wbcontent:O.toJSON(),idea:N.toJSON()};return _.request("UpdateSessionScore",n,function(e){e.res==="ok"?t.resolve():t.reject()}),t},g.getSessionDuration=function(){var t=h.get("elapsedTime"),n=h.get("resumeTime")||h.get("startTime");return now=new Date,now.getTime()-n+t},g.createIdeaDoc=function(){var t=new a(i.get("ideaTemplate")),n=new Date,r="I:"+n.getTime();t.setTransport(_),t.set("title",N.get("title")),t.set("sessionId",h.get("_id")),t.set("authors",[h.get("initiator").id]),t.set("description",N.get("description")),t.set("solution",N.get("solution")),t.set("creation_date",[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()]),t.set("character",h.get("characters")[0]),t.set("problem",h.get("problems")[0]),t.set("context",h.get("contexts")[0]),t.set("visibility",N.get("visibility")),t.set("authornames",h.get("initiator").username),t.set("lang",h.get("lang")),t.set("_id",r),t.sync(i.get("db"),r),setTimeout(function(){t.upload()},300)},g.reset=function(t){A.reset({cardpopup:{scenario:!1,techs:[!1,!1,!1]}},{postit:"inactive"},{"import":"inactive"},{drawing:"inactive"},{ready:!1},{showidea:!1},{shownext:!1},{readonly:!1}),k.reset(),M.setSessionId(h.get("_id")),O.reset(h.get("ideaWB")),O.getNbItems()?M.selectScreen("main"):M.selectScreen("default"),clearInterval(x),h.get("idea").length?(M.setReadonly(!0),A.set("ready",!1),A.set("showidea",!0),N.reset(h.get("idea")[0]),p.set("idea",h.get("idea")[0]),A.set("readonly",!0),A.set("shownext",!0),w="screen"):(N.reset({title:"",description:"",solution:"",visibility:"private"}),O.getNbItems()?A.set("ready",!0):A.set("ready",!1),M.setReadonly(!1),w="step"),h.get("elapsedTimers").quickidea?S=h.get("elapsedTimers").quickidea:S=0,T.set("timer",S),w==="screen"?T.set("display",!0):g.initTimer(S)},g.initTimer=function(e){var t=new Date,n=t.getTime(),r=e||0;T.set("display",!1),T.set("timer",r),h.get("step")==="quickidea"&&(x=setInterval(function(){var e=new Date;T.set("timer",r+e.getTime()-n)},1e3))},h.watchValue("_id",function(e){M.setSessionId(e)}),p.watchValue("scenario",function(e){C.reset(p.get("scenario"))}),p.watchValue("techno",function(e){k.reset(JSON.parse(p.get("techno").toJSON()))}),["added","deleted","updated"].forEach(function(e){O.watch(e,function(){JSON.stringify(h.get("ideaWB"))!==O.toJSON()&&(h.set("ideaWB",JSON.parse(O.toJSON())),h.upload()),O.getNbItems()?A.set("ready",!0):A.set("ready",!1)})}),N.watch("updated",function(){N.get("title")&&N.get("description")&&N.get("solution")?A.set("shownext",!0):A.set("shownext",!1)}),g}}),define("brainstorm/quickb/quickwrapup",["Olives/OObject","service/map","Olives/Model-plugin","Olives/Event-plugin","service/config","Store","service/utils"],function(e,t,n,r,i,s,o){return function(a,f,l,c,h){var p=new e,d=new s,v=new s([]),m=i.get("labels");return p.plugins.addAll({labels:new n(m),wrapup:new n(d,{formatTitle:function(e){e&&(this.innerHTML=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase())},setScore:function(e){e&&(this.innerHTML=e+" ip")},setTime:function(e){e&&(this.innerHTML=o.formatDuration(e))}}),cards:new n(v,{formatTitle:function(e){var t=this.getAttribute("data-cards_id");e&&(t<3?this.innerHTML=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase():(this.innerHTML=e.toUpperCase(),this.setAttribute("style","font-family:Helvetica;")))},setPic:function(e){e?this.setAttribute("style","background-image:url('"+e+"');"):this.setAttribute("style","background-image: none;")}}),quickwrapupevent:new r(p)}),p.template='<div id = "quickwrapup"><div class="previousbutton" data-quickwrapupevent="listen: touchstart, press; listen: touchstart, prev"></div><div class="brainstorm-header header blue-light" data-labels="bind: innerHTML, quickwrapup" data-quickwrapupevent="listen:touchstart, toggleProgress"></div><div class="congrats"><div class="message"><span class="messagetitle" data-labels="bind:innerHTML, congratulations"></span><span class="sessioncompleted" data-labels="bind:innerHTML, sessioncompleted"></span></div><div class="enddeedee"></div></div><div class="summary"><div class="storysummary"><div class="storyheader" data-labels="bind:innerHTML, storytitlelbl">Your Story</div><div class="storytitle" data-wrapup="bind:formatTitle, scenario.title"></div><div class="storycontent"><p class="summaryheader" data-labels="bind:innerHTML, scenarioheader"></p><p class="content" data-wrapup="bind:innerHTML, scenario.story"></p><p class="summaryheader" data-labels="bind:innerHTML, scenariosolution"></p><p class="content" data-wrapup="bind:innerHTML, scenario.solution">solution content</p></div></div><div class="ideasummary"><div class="ideaheader" data-labels="bind:innerHTML, ideatitlelbl"></div><div class="ideatitle" data-wrapup="bind:formatTitle, idea.title"></div><div class="ideacontent"><p class="summaryheader" data-labels="bind:innerHTML, ideadescription"></p><p class="content" data-wrapup="bind:innerHTML, idea.description"></p><p class="summaryheader" data-labels="bind:innerHTML, ideaimplementation"></p><p class="content" data-wrapup="bind:innerHTML, idea.solution">solution content</p></div></div></div><div class="sessionresults"><div class ="sessiontime"><span data-labels="bind:innerHTML, yourtime"></span><span data-wrapup = "bind: setTime, duration"></span></div><div class="sessionscore"><span data-labels="bind:innerHTML, yourscore"></span><span data-wrapup="bind:setScore, score"></span></div></div><div class="sessioncards" data-quickwrapupevent="listen:touchstart, toggleCards"><legend>Cards used during this session</legend><ul class="cardlist" data-cards="foreach"><li class="card"><div class="cardpicture" data-cards="bind:setPic,pic"></div><div class="cardtitle" data-cards="bind: formatTitle, title"></div></li></ul></div></div>',p.place(t.get("quickwrapup")),p.press=function(e,t){t.classList.add("pressed")},p.next=function(e,t){t.classList.remove("pressed"),c("quickwrapup")},p.prev=function(e,t){t.classList.remove("pressed"),l("quickwrapup")},p.toggleProgress=function(e,t){h(t)},p.toggleCards=function(e,t){t.classList.contains("expanded")?t.classList.remove("expanded"):t.classList.add("expanded")},p.reset=function(t){console.log(t,a.toJSON()),v.reset([]),d.reset()},f.watchValue("scenario",function(e){d.set("scenario",e)}),f.watchValue("idea",function(e){d.set("idea",e)}),["added","updated"].forEach(function(e){f.watch(e,function(){var e;f.get("characters")&&f.get("contexts")&&f.get("problems")&&f.get("techno").getNbItems()===3&&(e=[f.get("characters"),f.get("contexts"),f.get("problems"),f.get("techno").get(0),f.get("techno").get(1),f.get("techno").get(2)],v.reset(e))})}),a.watchValue("score",function(e){d.set("score",e)}),a.watchValue("duration",function(e){d.set("duration",e)}),CARDS=v,p}}),define("brainstorm/quickb/quickb",["Olives/OObject","service/map","Amy/Stack-plugin","Olives/Model-plugin","Olives/Event-plugin","./quickstart","./quicksetup","./quickscenario","./quicktech","./quickidea","./quickwrapup","CouchDBStore","service/config","Promise","Store"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){return function(v,m){var g=new e,y=new e,b=document.createDocumentFragment(),w=t.get("ideafy-quick"),E=new n,S=h.get("labels"),x=new d([{name:"quickstart",label:S.get("quickstepstart"),currentStep:!0,status:"ongoing"},{name:"quicksetup",label:S.get("quickstepsetup"),currentStep:!1,status:null},{name:"quickscenario",label:S.get("quickstepscenario"),currentStep:!1,status:null},{name:"quicktech",label:S.get("quicksteptech"),currentStep:!1,status:null},{name:"quickidea",label:S.get("quickstepidea"),currentStep:!1,status:null},{name:"quickwrapup",label:S.get("quickstepwrapup"),currentStep:!1,status:null}]),T=h.get("user"),N=new c;return _sessionData=new d,y.plugins.addAll({labels:new r(S),step:new r(x,{setCurrent:function(e){e?this.classList.add("pressed"):this.classList.remove("pressed")},setActive:function(e){e?this.classList.remove("inactive"):this.classList.add("inactive")}}),progressevent:new i(y)}),y.template='<div class = "progressbar"><ul id = "quicksteplist" class="steplist" data-step="foreach"><li class="step inactive" data-step="bind: innerHTML, label; bind:setCurrent, currentStep; bind:setActive, status" data-progressevent="listen: touchstart, changeStep"></li></ul><div class="exit-brainstorm" data-progressevent="listen: touchstart, press; listen:touchend, exit"></div></div>',y.place(b),g.plugins.add("quickstack",E),g.alive(w),y.changeStep=function(e,t){var n=t.getAttribute("data-step_id");x.get(n).status?(x.loop(function(e,t){n==t?x.update(t,"currentStep",!0):x.update(t,"currentStep",!1)}),E.getStack().show(x.get(n).name)):e.stopImmediatePropagation()},y.press=function(e,t){t.classList.add("pressed")},y.exit=function(e,t){t.classList.remove("pressed"),m()},g.retrieveSession=function(t){_sessionData.reset(),N.unsync(),N.reset(),N.sync(h.get("db"),t.id).then(function(){var e=N.get("step"),n=1e4,r=x.getNbItems();E.getStack().get("quickstart").reset(t),E.getStack().get("quicksetup").reset(t),E.getStack().get("quickscenario").reset(t),E.getStack().get("quicktech").reset(t),E.getStack().get("quickidea").reset(t),E.getStack().get("quickwrapup").reset(t),x.loop(function(t,r){r<n&&(t.name===e?(n=r,x.update(r,"currentStep",!0),t.name==="quickwrapup"?x.update(r,"status","done"):x.update(r,"status","ongoing")):x.update(r,"status","done"))}),e==="quickwrapup"?(E.getStack().show("quickwrapup"),x.update(0,"currentStep",!1)):(x.update(0,"currentStep",!0),x.update(n,"currentStep",!1),E.getStack().show("quickstart"),N.get("status")!=="completed"&&(T.set("sessionInProgress",t),T.upload()))})},g.startNewSession=function(){N.unsync(),N.reset(h.get("sessionTemplate")),_sessionData.reset({}),N.set("initiator",{id:T.get("_id"),username:T.get("username"),picture_file:T.get("picture_file")}),N.set("mode","quick"),N.set("step","quickstart"),N.set("deck",T.get("active_deck")),E.getStack().get("quickstart").reset(),E.getStack().get("quicksetup").reset(),E.getStack().get("quickscenario").reset(),E.getStack().get("quicktech").reset(),E.getStack().get("quickidea").reset(),E.getStack().get("quickwrapup").reset(),E.getStack().show("quickstart")},g.reset=function(t){x.reset([{name:"quickstart",label:S.get("quickstepstart"),currentStep:!0,status:"ongoing"},{name:"quicksetup",label:S.get("quickstepsetup"),currentStep:!1,status:null},{name:"quickscenario",label:S.get("quickstepscenario"),currentStep:!1,status:null},{name:"quicktech",label:S.get("quicksteptech"),currentStep:!1,status:null},{name:"quickidea",label:S.get("quickstepidea"),currentStep:!1,status:null},{name:"quickwrapup",label:S.get("quickstepwrapup"),currentStep:!1,status:null}]),t?g.retrieveSession(t):g.startNewSession()},g.prev=function(t){var n;x.loop(function(e,r){e.name===t&&(n=r)}),n>0?(x.update(n,"currentStep",!1),x.update(n-1,"currentStep",!0),E.getStack().show(x.get(n-1).name)):(alert("Exiting session"),m())},g.next=function(t){var n,r;x.loop(function(e,r){e.name===t&&(n=r)}),n<x.getNbItems()-1&&(x.get(n).status!=="done"?(x.update(n,"status","done"),x.update(n,"currentStep",!1),x.update(n+1,"status","ongoing"),x.update(n+1,"currentStep",!0),N.set("step",x.get(n+1).name),N.upload(),r=E.getStack().get(x.get(n+1).name),r.initTimer&&r.initTimer(),E.getStack().show(x.get(n+1).name)):E.getStack().show(x.get(n+1).name))},g.init=function(t){N.setTransport(h.get("transport")),E.getStack().add("quickstart",new s(N,g.prev,g.next,g.toggleProgress)),E.getStack().add("quicksetup",new o(N,_sessionData,g.prev,g.next,g.toggleProgress)),E.getStack().add("quickscenario",new u(N,_sessionData,g.prev,g.next,g.toggleProgress)),E.getStack().add("quicktech",new a(N,_sessionData,g.prev,g.next,g.toggleProgress)),E.getStack().add("quickidea",new f(N,_sessionData,g.prev,g.next,g.toggleProgress)),E.getStack().add("quickwrapup",new l(N,_sessionData,g.prev,g.next,g.toggleProgress)),g.reset(t)},g.toggleProgress=function(t){var n=t.querySelector(".progressbar");n?setTimeout(function(){t.removeChild(n),y.place(b)},600):t.appendChild(b)},g.init(v),g}}),define("brainstorm/brainstorm",["Olives/OObject","service/map","service/submenu","Amy/Stack-plugin","Olives/Model-plugin","service/config","Store","service/utils","./ideafy-menu","./quickb/quickb"],function(e,t,n,r,i,s,o,u,a,f){return function(){var l=new e,c=new n(t.get("brainstorm-menu")),h=new o;return _stack=new r,l.plugins.addAll({brainstormstack:_stack,header:new i(h,{setDate:function(e){e&&(this.innerHTML=e.toLocaleDateString())},setTime:function(e){var t=e.getHours(),n=e.getMinutes(),r=e.getSeconds();t<10&&(t="0"+t),n<10&&(n="0"+n),r<10&&(r="0"+r),this.innerHTML=t+":"+n+":"+r}})}),l.alive(t.get("brainstorm")),l.showMenu=function(){c.toggleActive(!0)},l.hideMenu=function(){c.toggleActive(!1)},l.exitSession=function(){_stack.getStack().show("menu")},l.selectScreen=function(t,n){t==="continue"&&(t=n.type);if(_stack.getStack().get(t))_stack.getStack().get(t).reset(n),_stack.getStack().show(t);else{n?t=n.type:n=null;switch(t){case"quick":_stack.getStack().add("quick",new f(n,l.exitSession));break;case"tutorial":s.get("observer").notify("display-tutorials");break;default:t=""}t&&_stack.getStack().show(t)}},c.toggleActive(!1),h.set("headertitle",s.get("labels").get("brainstormheadertitle")),setInterval(function(){var e=new Date;h.set("date",e)},1e3),_stack.getStack().add("menu",new a(l.selectScreen)),_stack.getStack().show("menu"),s.get("observer").watch("replay-session",function(e,t){var n={};n.id=e,t?n.type=t:e.toLowerCase().search("quick")>-1&&(n.type="quick"),l.selectScreen(n.type,n)}),l}}),define("connect/contacts/addcontact",["Olives/OObject","service/config","Olives/Model-plugin","Olives/Event-plugin","CouchDBStore","Store","service/avatar"],function(e,t,n,r,s,o,u){return function(){var f=new e,l=new s,c=new o({email:"",firstname:"",lastname:"",result:"",display:!1,sentok:!1,message:""}),h=new o([]),p={},d=t.get("user"),v=t.get("transport"),m=t.get("labels"),g=function(e,t){var n=/^[a-z0-9._-]+@[a-z0-9.-]+\.[a-z]{2,4}$/;e==="email"?n.test(t.toLowerCase())?(c.set("result",""),y("userid",t.toLowerCase())):c.set("result",m.get("signupinvalidemail")):c.get("email")?c.set("result",m.get("clearemailfirst")):c.get("firstname")&&c.get("lastname")?(c.set("result",""),y("username",c.get("firstname").toLowerCase()+" "+c.get("lastname").toLowerCase())):c.set("result",m.get("needbothfnln"))},y=function(e,n){var r=new s;r.setTransport(v),e==="userid"?r.sync(t.get("db"),"users","_view/searchbyid",{key:'"'+n+'"',descending:!0}).then(function(){h.reset(JSON.parse(r.toJSON())),h.getNbItems()?c.set("display",!0):c.set("result",m.get("noentryfound")),r.unsync()}):r.sync(t.get("db"),"users","_view/searchbyusername",{key:'"'+n+'"',descending:!0}).then(function(){h.reset(JSON.parse(r.toJSON())),h.getNbItems()?c.set("display",!0):c.set("result",m.get("noentryfound")),r.unsync()})},b=function(e){var t=!1,n=d.get("sentMessages"),r=!1;if(e.userid===d.get("_id"))c.set("result",m.get("cannotaddself"));else if(JSON.stringify(d.get("connections")).search(e.userid)>-1)c.set("result",e.username+m.get("alreadyconnected"));else{for(i=0;i<n.length;i++)console.log(n[i]),n[i].type==="CXR"&&n[i].toList.search(e.username)>-1&&(r=!0);r?c.set("result",m.get("alreadysentCXR")+e.username):t=!0}return t},w=function(e){var t=new Date,n={};b(e)&&(n.dest=[e.userid],n.type="CXR",n.status="unread",n.date=[t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()],n.author=d.get("_id"),n.username=d.get("username"),n.firstname=d.get("firstname"),n.toList=e.username,n.ccList="",n.object=d.get("username")+m.get("CXRobject"),n.body=c.get("message"),n.signature=d.get("signature"),n.contactInfo={firstname:d.get("firstname"),lastname:d.get("lastname"),userid:d.get("_id"),username:d.get("username"),intro:d.get("intro"),type:"user"},v.request("Notify",n,function(e){var e=JSON.parse(e);e[0].res==="ok"?(c.set("result",m.get("CXRsent")),setTimeout(function(){f.reset()},2e3)):model.set("result","There was an error, please try again later")}))};return f.plugins.addAll({label:new n(m),count:new n(l),search:new n(c,{setVisible:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")},setStyle:function(e){e?this.setAttribute("style","color: #5F8F28;"):this.setAttribute("style","color: #F27B3D;")}}),contacts:new n(h,{setAvatar:function(t){var n,r;_frag=document.createDocumentFragment(),_ui=new u([t]),_ui.place(_frag),this.hasChildNodes()?this.replaceChild(_frag,this.firstChild):this.appendChild(_frag)},setSelected:function(e){e?this.innerHTML="&#10003;":this.innerHTML=""}}),searchdbevent:new r(f)}),f.template='<div id="addcontact"><div class="header blue-dark"><span class="newcontactlbl" data-label="bind:innerHTML, newcontactlbl"></span></div><div class = "detail-contents"><div class="doctor-deedee"></div><div class="addcontactform"><p class="half"><span data-label="bind:innerHTML, beforecount"></span><strong><span data-count="bind:innerHTML, 0.value"></span></strong><span data-label="bind:innerHTML, aftercount"></span></p><p class="half" data-label="bind: innerHTML, addcontactrightintro"></p><legend data-label="bind:innerHTML, addcontactnow"></legend><input class="search" type="text" name="email" data-label="bind:placeholder, searchcontactplaceholder" data-search="bind: value, email" data-searchdbevent="listen: keypress, searchDB"><legend data-label="bind:innerHTML, lookup"></legend><div class="searchcontact"><input type="text" class="search half" name="fn" data-label="bind:placeholder, firstnameplaceholder" data-search="bind: value, firstname" data-searchdbevent="listen: keypress, searchDB"><input class="search half right" type="text" name="ln" data-label="bind: placeholder, lastnameplaceholder" data-search="bind: value, lastname" data-searchdbevent="listen: keypress, searchDB"></div><p class="searchresult" data-search="bind: innerHTML, result; bind:setStyle, sentok"></p></div></div><div class = "contactlist invisible" data-search="bind: setVisible, display"><legend data-label="bind:innerHTML, selectcontact"></legend><ul data-contacts="foreach"><li class = "contact list-item"><div data-contacts="bind:setAvatar, value.userid"></div><p class="contact-name" data-contacts="bind:innerHTML, value.username"></p><p class="contact-intro" data-contacts="bind:innerHTML, value.intro"></p><div class="select-contact" data-searchdbevent="listen:touchstart, check"></div></li></ul><textarea class="input" data-label="bind:placeholder, addamessage" data-search="bind:value, message"></textarea><div class="addcontactbtns"><div class="addct" data-searchdbevent="listen:touchstart, press; listen:touchend, add"></div><div class="cancelct" data-searchdbevent="listen:touchstart, press; listen:touchend, cancel"></div></div></div></div>',f.init=function(){l.setTransport(v),l.sync(t.get("db"),"users","_view/count")},f.searchDB=function(e,t){var n;e.keyCode===13&&(e.target.blur(),console.log(e.target),n=t.getAttribute("name"),g(n,t.value))},f.check=function(e,t){var n=t.getAttribute("data-contacts_id");t.innerHTML?(t.innerHTML="",p[n]=!1):(t.innerHTML="&#10003;",p[n]=!0)},f.reset=function(){c.reset({email:"",firstname:"",lastname:"",result:"",display:!1,sentok:!1,message:""}),h.reset([])},f.press=function(e,t){t.classList.add("pushed")},f.cancel=function(e,t){t.classList.remove("pushed"),f.reset()},f.add=function(e,t){t.classList.remove("pushed");for(i in Object.keys(p))w(h.get(i).value)},f.init(),f}}),define("connect/contacts/addgroup",["Olives/OObject","service/config","Olives/Model-plugin","Olives/Event-plugin","Store","service/avatar"],function(e,t,n,r,s,o){return function(){var a=new e,f=new s({username:"",intro:"",type:"group",color:"graygroup.png",contacts:[]}),c=new s([{color:"#4D4D4D",icon:"graygroup.png",selected:!0},{color:"#657B99",icon:"bluegroup.png",selected:!1},{color:"#9AC9CD",icon:"azurgroup.png",selected:!1},{color:"#5F8F28",icon:"greengroup.png",selected:!1},{color:"#F2E520",icon:"yellowgroup.png",selected:!1},{color:"#F27B3D",icon:"orangegroup.png",selected:!1},{color:"#BD262C",icon:"redgroup.png",selected:!1}]),h=new s([]),p=new s([]),d=new s({error:""}),v={},m=t.get("user"),g=t.get("labels");return a.plugins.addAll({label:new n(g),error:new n(d),color:new n(c,{setColor:function(e){this.setAttribute("style","background:"+e+";")},setSelected:function(e){e?this.innerHTML="&#10003;":this.innerHTML=""}}),group:new n(f,{setColor:function(e){this.setAttribute("style","background: url('img/connect/"+e+"') no-repeat top left; background-size: contain;")},setStyle:function(e){e?this.setAttribute("style","color: #5F8F28;"):this.setAttribute("style","color: #F27B3D;")},setVisible:function(e){e.length?this.classList.remove("invisible"):this.classList.add("invisible")}}),contacts:new n(h,{setAvatar:function(t){var n,r;_frag=document.createDocumentFragment(),_ui=new o([t]),_ui.place(_frag),this.hasChildNodes()?this.replaceChild(_frag,this.firstChild):this.appendChild(_frag)},setSelected:function(e){e?this.innerHTML="&#10003;":this.innerHTML=""}}),auto:new n(p,{highlight:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),addgrpevent:new r(a)}),a.template='<div id="addgroup"><div class="header blue-dark"><span class="newfolderlbl" data-label="bind:innerHTML, newfolderlbl"></span></div><div class = "detail-contents"><div class="folderpic" data-group="bind: setColor, color"></div><form><p><input type="text" class="input" data-group="bind:value, username" data-label="bind:placeholder, groupnamelbl"></p><p><textarea class="input" data-group="bind:value, intro" data-label="bind:placeholder, groupdesclbl"></textarea></p><legend data-label="bind:innerHTML, colortouch"></legend><ul class="groupcolors" data-color="foreach"><li data-color="bind:setColor, color; bind:setSelected, selected" data-addgrpevent="listen: touchstart, selectColor"></li></ul></form><div class = "groupcontactlist" data-group="bind: setVisible, contacts"><legend name="list" data-label="bind:innerHTML, grpcontacts" data-addgrpevent="listen: touchstart, toggleHide"></legend><ul class="contactlistdetail" data-contacts="foreach"><li class = "contact list-item" data-addgrpevent="listen:touchstart, discardContact"><div data-contacts="bind:setAvatar, userid"></div><p class="contact-name" data-contacts="bind:innerHTML, username"></p><div class="remove-contact"></div><p class="contact-intro" data-contacts="bind:innerHTML, intro"></p></li></ul></div><div class="addgroupbtns"><span class="errormsg" data-error="bind:innerHTML, error"></span><div class="addct" data-addgrpevent="listen:touchstart, press; listen:touchend, add"></div><div class="cancelct" data-addgrpevent="listen:touchstart, press; listen:touchend, cancel"></div></div><div class="addgrpcontacts"><legend name="add" data-label="bind:innerHTML, addgrpcontacts" data-addgrpevent="listen: touchstart, toggleHide"></legend><div class="addgrpcontactdetails"><input class="search" data-addgrpevent="listen:keyup, updateAutoContact" data-labels="bind:placeholder, tocontactlbl"><div class = "autocontact"><ul data-auto="foreach"><li data-auto="bind:innerHTML, contact.username; bind:highlight, selected" data-addgrpevent="listen:touchend, select"></li></ul></div></div></div></div>',a.init=function(){m.get("connections").forEach(function(e){e.type==="user"&&p.alter("push",{contact:e,selected:!1})})},a.selectColor=function(e,t){var n=t.getAttribute("data-color_id");c.loop(function(e,t){c.update(t,"selected",!1)}),c.update(n,"selected",!0),f.set("color",c.get(n).icon)},a.toggleHide=function(e,t){var n=t.getAttribute("name");t.classList.contains("hide")?(t.classList.remove("hide"),n==="add"?document.querySelector(".addgrpcontactdetails").classList.remove("invisible"):document.querySelector(".contactlistdetail").classList.remove("invisible")):(t.classList.add("hide"),n==="add"?document.querySelector(".addgrpcontactdetails").classList.add("invisible"):document.querySelector(".contactlistdetail").classList.add("invisible"))},a.select=function(e,t){var n=t.getAttribute("data-auto_id");p.get(n).selected?(a.removeContact(n),setTimeout(function(){p.update(n,"selected",!1)},200)):(a.addContact(n),setTimeout(function(){p.update(n,"selected",!0)},200))},a.addContact=function(t){var n=JSON.parse(h.toJSON()),r=p.get(t).contact,s=0;if(h.toJSON().search(r.userid)<0){for(i=0,l=n.length;i<l;i++)r.lastname>n[i].lastname?s++:r.lastname===n[i].lastname&&r.username>n[i].username&&s++;n.splice(s,0,r),h.reset(n),f.set("contacts",n)}},a.removeContact=function(t){var n=JSON.parse(h.toJSON());for(i=n.length-1;i>=0;i--)n[i].userid===p.get(t).contact.userid&&n.splice(i,1);h.reset(n)},a.updateAutoContact=function(e,t){var n=JSON.parse(p.toJSON()),r=m.get("connections"),s,o=t.value.toLowerCase();if(t.value===""){n=[];for(i=0,l=r.length;i<l;i++)r[i].type==="user"&&n.push({contact:r[i],selected:!1})}else if(e.keyCode===8||e.keyCode===46){n=[];for(i=0,l=r.length;i<l;i++)r[i].type==="user"&&n.push({contact:r[i],selected:!1});for(i=n.length-1;i>=0;i--)n[i].contact.username.toLowerCase().search(o)!==0&&n.splice(i,1)}else for(i=n.length-1;i>=0;i--)s=n[i].contact.username.toLowerCase(),s.search(o)!==0&&n.splice(i,1);p.reset(n),p.loop(function(e,t){h.toJSON().search(e.contact.userid)>-1&&p.update(t,"selected",!0)})},a.discardContact=function(e,t){var n=t.getAttribute("data-contacts_id"),r=h.get(n).userid;h.alter("splice",n,1),p.loop(function(e,t){e.contact.userid===r&&setTimeout(function(){p.update(t,"selected",!1)},200)})},a.reset=function(){f.reset({username:"",intro:"",type:"group",color:"graygroup.png",contacts:[]}),h.reset([]),p.reset([]),d.reset({error:""}),m.get("connections").forEach(function(e){e.type==="user"&&p.alter("push",{contact:e,selected:!1})})},a.press=function(e,t){t.classList.add("pushed")},a.cancel=function(e,t){t.classList.remove("pushed"),a.reset(),document.querySelector("#addgroup input.search").value=""},a.add=function(e,t){var n=m.get("connections"),r=0,s=JSON.parse(f.toJSON());t.classList.remove("pushed"),d.set("error","");if(s.username==="")d.set("error",g.get("nogrpname"));else if(s.intro==="")d.set("error",g.get("nogrpintro"));else if(!s.contacts.length)d.set("error",g.get("nocontactselected"));else{for(i=0,l=n.length;i<l;i++)n[i].type==="user"?s.username>n[i].lastname&&r++:(s.username===n[i].username&&d.set("error",g.get("grpnameexists")),s.username>n[i].username&&r++);d.get("error")||(n.splice(r,0,s),m.set("connections",n),m.upload().then(function(){a.reset()}))}},a.init(),a}}),define("connect/contacts/contact-detail",["Olives/OObject","service/config","service/map","Store","Olives/Model-plugin","Olives/Event-plugin","service/avatar","service/utils"],function(e,t,n,r,s,o,u,a){return function(){var l=new e,c=new r,h=new r,p=new r([]),d=new r([]),v=t.get("labels"),m=t.get("user"),g=t.get("transport");return l.plugins.addAll({label:new s(v),basicinfo:new s(h,{setAvatar:function(e){var t=document.createDocumentFragment(),n=new u([e]);n.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t)}}),ctdetails:new s(c),grades:new s(p,{showBadge:function(e){this.setAttribute("style","background: url('img/profile/"+e+"') no-repeat center center; background-size: cover;")}}),achievements:new s(d,{showBadge:function(e){this.setAttribute("style","background: url('img/profile/"+e+"') no-repeat center center; background-size: cover;")}}),ctdetailsevent:new o(l)}),l.template='<div id = "contactdetails"><div class="header blue-dark"><span class="subjectlbl" data-details="bind:innerHTML, username"></span></div><div class = "detail-contents"><div class = "contactessentials"><div class="avatar" data-basicinfo="bind:setAvatar, userid"></div><div class="basicinfo"><h2 data-basicinfo="bind:innerHTML,username"></h2><p data-basicinfo="bind:innerHTML, intro"></p></div><div class="contactdashboard"><div class="contactstats"><legend data-label="bind:innerHTML, stats"></legend><div class="userscore"><span class="ip" data-ctdetails="bind:innerHTML, ip"></span><span data-label="bind:innerHTML, ideafypoints"></span></div><table><tr class ="myids"><th data-label="bind:innerHTML, ideaslbl"></th><td data-ctdetails="bind: innerHTML, ideas_count"></td></tr><tr class ="myss"><th data-label="bind:innerHTML, sessionslbl"></th><td data-ctdetails="bind: innerHTML, sessions"></td></tr><tr class="myctcts"><th data-label="bind:innerHTML, contactslbl"></th><td data-ctdetails="bind: innerHTML, contacts"></td></tr><tr class="my2q"><th data-label="bind:innerHTML, toquestionslbl"></th><td data-ctdetails="bind: innerHTML, twoquestions_count"></td></tr></table></div><div class="contactbadges"><legend data-label="bind:innerHTML, achievements"></legend><p class="grade" data-stats="bind:innerHTML, title"></p><ul class="badges" data-grades="foreach"><li class="contactbadge"><div data-grades="bind:showBadge, badge"></div><label data-grades="bind:innerHTML, title"></label></li></ul><ul class="badges" data-achievements="foreach"><li class="contactbadge"><div data-achievements="bind:showBadge, badge"></div><label data-achievements="bind:innerHTML, label"></label></li></ul></div></div></div></div><div class = "contactnotes"><legend data-label="bind: innerHTML, mynotes"></legend><div id = "cancelnotes" class="invisible" data-ctdetailsevent="listen:touchstart, push; listen:touchend, cancelNotes"></div><div id = "uploadnotes" class="invisible" data-ctdetailsevent="listen:touchstart, push;listen:touchend, uploadNotes"></div><textarea id="ctnotes" class = "input" data-label="bind:placeholder,writesomething" data-basicinfo="bind: value, notes" data-ctdetailsevent="listen:input, displayNoteBtns"></textarea></div></div></div>',l.place(n.get("contactdetails")),l.updateContact=function(t){var n=m.get("connections"),r,i=n.length,s,o;for(r=0;r<i;r++){n[r].userid===t._id&&(n[r].username=t.username,n[r].firstname=t.firstname,n[r].lastname=t.lastname,n[r].intro=t.intro);if(n[r].type==="group"){s=n[r].contacts;for(o=0;o<s.length;o++)s[o].userid===t._id&&(s[o].username=t.username,s[o].firstname=t.firstname,s[o].lastname=t.lastname,s[o].intro=t.intro);n[r].contacts=s}}m.set("connections",n),m.upload()},l.getUserInfo=function(t){a.getUserDetails(t,function(e){(e.username!==h.get("username")||e.firstname!==h.get("firstname")||e.lastname!==h.get("lastname")||e.intro!==h.get("intro"))&&l.updateContact(e),c.reset(e),c.set("sessions",c.get("su_sessions_count")+c.get("mu_sessions_count")),a.getGrade(e.ip,function(e){p.alter("push",e.grade),e.distinction&&p.alter("push",e.distinction)}),d.reset(e.achievements)})},l.reset=function(t){h.reset(t),p.reset([]),d.reset([]),h.get("notes")||h.set("notes",""),l.getUserInfo(t.userid)},l.displayNoteBtns=function(e,t){document.getElementById("uploadnotes").classList.remove("invisible"),document.getElementById("cancelnotes").classList.remove("invisible")},l.hideNoteBtns=function(t,n){document.getElementById("uploadnotes").classList.add("invisible"),document.getElementById("cancelnotes").classList.add("invisible")},l.push=function(e,t){t.classList.add("pushed")},l.uploadNotes=function(e,t){var n=m.get("connections"),r,i=n.length,s,o,u=document.getElementById("uploadnotes"),a=document.getElementById("cancelnotes");console.log(h.get("notes"));for(r=0;r<i;r++){n[r].userid===h.get("userid")&&(n[r].notes=h.get("notes"));if(n[r].type==="group"){s=n[r].contacts;for(o=0;o<s.length;o++)s[o].userid===h.get("userid")&&(s[o].notes=h.get("notes"));n[r].contacts=s}}m.set("connections",n),m.upload().then(function(){t.classList.remove("pushed"),l.hideNoteBtns()})},l.cancelNotes=function(e,t){var n=m.get("connections"),r=n.length;i;for(i=0;i<r;i++)n[i].userid===h.get("userid")&&h.set("notes",n[i].notes);t.classList.add("pushed"),l.hideNoteBtns()},l}}),define("connect/contacts/group-detail",["Olives/OObject","service/config","Olives/Model-plugin","Olives/Event-plugin","Store","service/avatar"],function(e,t,n,r,s,o){return function(){var a=new e,f=new s,c=new s([]),h,p=[{color:"#4D4D4D",icon:"graygroup.png",selected:!1},{color:"#657B99",icon:"bluegroup.png",selected:!1},{color:"#9AC9CD",icon:"azurgroup.png",selected:!1},{color:"#5F8F28",icon:"greengroup.png",selected:!1},{color:"#F2E520",icon:"yellowgroup.png",selected:!1},{color:"#F27B3D",icon:"orangegroup.png",selected:!1},{color:"#BD262C",icon:"redgroup.png",selected:!1}],d=new s(p),v=new s([]),m=new s({error:""}),g={},y=t.get("user"),b=t.get("labels");return a.template='<div id="groupdetails"><div class="header blue-dark"><span class="newfolderlbl" data-group="bind:innerHTML, username"></span></div><div class = "detail-contents"><div class="folderpic" data-group="bind: setColor, color"></div><form><p><input type="text" class="input" data-group="bind:value, username" data-label="bind:placeholder, groupnamelbl"></p><p><textarea class="input" data-group="bind:value, intro" data-label="bind:placeholder, groupdesclbl"></textarea></p><legend data-label="bind:innerHTML, colortouch"></legend><ul class="groupcolors" data-color="foreach"><li data-color="bind:setColor, color; bind:setSelected, selected" data-grpdetailsevent="listen: touchstart, selectColor"></li></ul></form><div class = "grpcontactlist" data-group="bind: setVisible, contacts"><legend name="list" data-label="bind:innerHTML, grpcontacts" data-grpdetailsevent="listen: touchstart, toggleHide"></legend><ul class="contactlistdetail" data-grpcontacts="foreach"><li class = "contact list-item" data-grpdetailsevent="listen:touchstart, discardContact"><div data-grpcontacts="bind:setAvatar, userid"></div><p class="contact-name" data-grpcontacts="bind:innerHTML, username"></p><div class="remove-contact"></div><p class="contact-intro" data-grpcontacts="bind:innerHTML, intro"></p></li></ul></div><p class="update"><label class="cancelmail" data-label="bind:innerHTML, cancellbl" data-grpdetailsevent="listen: touchstart, press; listen:touchend, cancel">Cancel</label><label class="sendmail" data-label="bind:innerHTML, updatelbl" data-grpdetailsevent="listen:touchstart, press; listen:touchend, updateGroup"></label><label class="editerror" data-error="bind:innerHTML, error"></label><div class="addgrpcontacts"><legend name="add" data-label="bind:innerHTML, addgrpcontacts" data-grpdetailsevent="listen: touchstart, toggleHide"></legend><div class="addgrpcontactdetails"><input class="search" data-grpdetailsevent="listen:keyup, updateAutoContact" data-label="bind:placeholder, tocontactlbl"><div class = "autocontact"><ul data-auto="foreach"><li data-auto="bind:innerHTML, contact.username; bind:highlight, selected" data-grpdetailsevent="listen:touchend, select"></li></ul></div></div></div></div>',a.plugins.addAll({label:new n(b),error:new n(m),color:new n(d,{setColor:function(e){this.setAttribute("style","background:"+e+";")},setSelected:function(e){e?this.innerHTML="&#10003;":this.innerHTML=""}}),group:new n(f,{setColor:function(e){this.setAttribute("style","background: url('img/connect/"+e+"') no-repeat top left; background-size: contain;")},setStyle:function(e){e?this.setAttribute("style","color: #5F8F28;"):this.setAttribute("style","color: #F27B3D;")},setVisible:function(e){e.length?this.classList.remove("invisible"):this.classList.add("invisible")}}),grpcontacts:new n(c,{setAvatar:function(t){var n,r;t&&(_frag=document.createDocumentFragment(),_ui=new o([t]),_ui.place(_frag),this.hasChildNodes()?this.replaceChild(_frag,this.firstChild):this.appendChild(_frag))},setSelected:function(e){e?this.innerHTML="&#10003;":this.innerHTML=""}}),auto:new n(v,{highlight:function(e){e?this.classList.add("selected"):this.classList.remove("selected")}}),grpdetailsevent:new r(a)}),a.selectColor=function(e,t){var n=t.getAttribute("data-color_id");d.loop(function(e,t){d.update(t,"selected",!1)}),d.update(n,"selected",!0),f.set("color",d.get(n).icon)},a.toggleHide=function(e,t){var n=t.getAttribute("name");t.classList.contains("hide")?(t.classList.remove("hide"),n==="add"?document.querySelector(".addgrpcontactdetails").classList.remove("invisible"):document.querySelector(".contactlistdetail").classList.remove("invisible")):(t.classList.add("hide"),n==="add"?document.querySelector(".addgrpcontactdetails").classList.add("invisible"):document.querySelector(".contactlistdetail").classList.add("invisible"))},a.select=function(e,t){var n=t.getAttribute("data-auto_id");v.get(n).selected?(a.removeContact(n),setTimeout(function(){v.update(n,"selected",!1)},200)):(a.addContact(n),setTimeout(function(){v.update(n,"selected",!0)},200))},a.addContact=function(t){var n=JSON.parse(c.toJSON()),r=v.get(t).contact,s=0;if(c.toJSON().search(r.userid)<0){for(i=0,l=n.length;i<l;i++)r.lastname>n[i].lastname?s++:r.lastname===n[i].lastname&&r.username>n[i].username&&s++;n.splice(s,0,r),c.reset(n),f.set("contacts",n)}},a.removeContact=function(t){var n=JSON.parse(c.toJSON());for(i=n.length-1;i>=0;i--)n[i].userid===v.get(t).contact.userid&&n.splice(i,1);c.reset(n),f.set("contacts",n)},a.updateAutoContact=function(e,t){var n=JSON.parse(v.toJSON()),r=y.get("connections");if(t.value===""){n=[];for(i=0,l=r.length;i<l;i++)r[i].type==="user"&&n.push({contact:r[i],selected:!1})}else if(e.keyCode===8||e.keyCode===46){n=[];for(i=0,l=r.length;i<l;i++)r[i].type==="user"&&n.push({contact:r[i],selected:!1});for(i=n.length-1;i>=0;i--)n[i].contact.username.search(t.value)!==0&&n.splice(i,1)}else for(i=n.length-1;i>=0;i--)n[i].contact.username.search(t.value)!==0&&n.splice(i,1);v.reset(n),v.loop(function(e,t){c.toJSON().search(e.contact.userid)>-1&&v.update(t,"selected",!0)})},a.discardContact=function(e,t){var n=t.getAttribute("data-grpcontacts_id"),r=c.get(n).userid;c.alter("splice",n,1),v.loop(function(e,t){e.contact.userid===r&&setTimeout(function(){v.update(t,"selected",!1)},200)}),f.set("contacts",JSON.parse(c.toJSON()))},a.press=function(e,t){t.classList.add("pressed")},a.cancel=function(e,t){t.classList.remove("pressed"),a.reset(h),document.querySelector("#groupdetails input.search").value=""},a.updateGroup=function(e,t){var n=y.get("connections"),r,i=JSON.parse(f.toJSON());t.classList.remove("pressed"),m.set("error","");if(i.username==="")m.set("error",b.get("nogrpname"));else if(i.intro==="")m.set("error",b.get("nogrpintro"));else if(!i.contacts.length)m.set("error",b.get("nocontactselected"));else for(r=n.length-1;r>=0;r--)n[r].type==="group"&&n[r].username===h.username&&(m.get("error")||(n.splice(r,1,i),y.set("connections",n),y.upload().then(function(){a.reset(i),m.set("error",b.get("groupupdated"))})))},a.reset=function(t){d.reset(p),d.loop(function(e,n){e.icon===t.color?d.update(n,"selected",!0):d.update(n,"selected",!1)}),f.reset(t),h=t,c.reset(t.contacts),v.reset([]),m.reset({error:""}),y.get("connections").forEach(function(e){e.type==="user"&&v.alter("push",{contact:e,selected:!1})}),v.loop(function(e,t){c.toJSON().search(e.contact.userid)>-1&&v.update(t,"selected",!0)})},a.init=function(){y.get("connections").forEach(function(e){e.type==="user"&&v.alter("push",{contact:e,selected:!1})})},a.init(),a}}),define("connect/contacts/contacts",["Olives/OObject","service/map","service/config","Amy/Stack-plugin","Olives/Model-plugin","Olives/Event-plugin","Amy/Control-plugin","Store","service/avatar","service/actionbar","./addcontact","./addgroup","./contact-detail","./group-detail"],function(e,t,n,r,s,o,u,a,f,c,h,p,d,v){return function(){var g=new e,y=new r,b=new h,w=new p,E=new d,S=new v,x=new a([{name:"all",label:"allbtn",selected:!0},{name:"users",label:"usrbtn",selected:!1},{name:"groups",label:"grpbtn",selected:!1}]),T=0,N=new a([]),C,k,L=!1,A=n.get("user"),O=n.get("labels"),M=function(e){var t=x.get(e).name,n=A.get("connections"),r=n.length,s=[];switch(t){case"users":for(i=0;i<r;i++)n[i].type==="user"&&s.push(n[i]);break;case"groups":for(i=0;i<r;i++)n[i].type==="group"&&s.push(n[i]);break;default:s=n}return s},_=function(e){var t=[],n=[];t=A.get("connections").concat();if(e==="")n=t,x.update(0,"selected",!0),T=0;else for(i=0,l=t.length;i<l;i++)JSON.stringify(t[i]).toLowerCase().search(e.toLowerCase())>-1&&n.push(t[i]);return n};return g.plugins.addAll({label:new s(O),sort:new s(x,{setLabel:function(e){this.innerHTML=O.get(e)},setSelected:function(e){e?this.classList.add("pressed"):this.classList.remove("pressed")}}),contact:new s(N,{setAvatar:function(t){var n=this.getAttribute("data-contact_id"),r,i;t==="group"?(this.hasChildNodes()&&this.removeChild(this.firstChild),this.setAttribute("style","background: url('img/connect/"+N.get(n).color+"') no-repeat center center; background-size: contain;display:block; width:40px; height:40px;float:left;")):(this.setAttribute("style","background:none;"),_frag=document.createDocumentFragment(),_ui=new f([N.get(n).userid]),_ui.place(_frag),this.hasChildNodes()?this.replaceChild(_frag,this.firstChild):this.appendChild(_frag))},setIntro:function(e){e?this.innerHTML=e:this.innerHTML=" "}}),contactdetailstack:y,contactlistcontrol:new u(g),contactlistevent:new o(g)}),g.template='<div id="connect-contacts"><div class="contacts list"><div class="header blue-light"><span data-label="bind: innerHTML, contactlistheadertitle">My Contacts</span><div class="option right" data-contactlistevent="listen: touchstart, plus"></div></div><ul class="selectors" data-sort = "foreach"><li class="sort-button" data-sort="bind: setLabel, label; bind:setSelected, selected, bind: name, name" data-contactlistevent="listen:touchstart, displaySort"></li></ul><input class="search" type="text" data-label="bind: placeholder, searchmsgplaceholder" data-contactlistevent="listen: keypress, search"><div class="contactlist overflow" data-contactlistcontrol="radio:li,selected,touchstart,selectContact"><ul data-contact="foreach"><li class="contact list-item" data-contactlistevent="listen:touchstart, setStart; listen:touchmove, showActionBar"><div data-contact="bind:setAvatar, type"></div><p class="contact-name" data-contact="bind:innerHTML, username"></p><p class="contact-intro" data-contact="bind:setIntro, intro"></p><div class="select-contact"></div></li></ul></div></div><div id="toggleadd" class="group" data-contactlistevent="listen:touchstart, press; listen:touchend, toggleAddUI"></div><div id="contact-detail" class="details" data-contactdetailstack="destination"></div></div>',g.place(t.get("connect-contacts")),g.plus=function(t,n){var r=document.getElementById("toggleadd");y.getStack().get("#addcontact").reset(),y.getStack().show("#addcontact"),r.classList.contains("user")&&r.classList.remove("user"),r.classList.add("group")},g.init=function(){N.reset(A.get("connections")),y.getStack().show("#addcontact")},g.getSelectedContact=function(){var e=document.querySelector(".contact.selected"),t=-1;return e&&(t=e.getAttribute("data-contact_id")),t},g.selectContact=function(e){var t=e.target.getAttribute("data-contact_id"),n=N.get(t);document.getElementById("toggleadd").classList.remove("group"),document.getElementById("toggleadd").classList.remove("user"),n.type==="user"?(E.reset(N.get(t)),y.getStack().getCurrentName()!=="#contactdetails"&&y.getStack().show("#contactdetails")):(S.reset(N.get(t)),y.getStack().getCurrentName()!=="#groupdetails"&&y.getStack().show("#groupdetails"))},g.displaySort=function(e,t){var n=t.getAttribute("data-sort_id");N.reset([]),T>-1&&x.update(T,"selected",!1),x.update(n,"selected",!0),T=n,N.reset(M(n))},g.search=function(e,t){e.keyCode===13&&(x.update(T,"selected",!1),T=-1,N.reset(_(t.value)))},g.setStart=function(e,t){C=[e.pageX,e.pageY],document.querySelector(".actionbar")&&g.hideActionBar()},g.showActionBar=function(e,t){var n=t.getAttribute("data-contact_id");k=[e.pageX,e.pageY];if(!L&&C[0]-k[0]>40&&k[1]-C[1]<20&&k[1]-C[1]>-20){var r=new c("contact",t,N.get(n),g.hideActionBar),i=document.createDocumentFragment();r.place(i),t.appendChild(i),L=!0}},g.hideActionBar=function(t){var t=document.querySelector(".actionbar"),n=t.parentNode;n.removeChild(n.lastChild),L=!1},g.press=function(e,t){t.classList.add("pressed")},g.toggleAddUI=function(e,t){t.classList.remove("pressed"),t.classList.contains("group")?(t.classList.remove("group"),y.getStack().get("#addgroup").reset(),y.getStack().show("#addgroup"),t.classList.add("user")):(t.classList.remove("user"),y.getStack().get("#addcontact").reset(),y.getStack().show("#addcontact"),t.classList.add("group"))},y.getStack().add("#contactdetails",E),y.getStack().add("#groupdetails",S),y.getStack().add("#addcontact",b),y.getStack().add("#addgroup",w),g.init(),A.watchValue("connections",function(){var e;T>-1&&N.reset(M(T)),y.getStack().getCurrentName==="#contactdetails"&&(e=g.getSelectedContact(),e>-1?(contactDetail.reset(N.get(e)),y.getStack().show("#contactdetails")):(y.getStack().show("#addcontact"),document.getElementById("toggleadd").classList.add("group")))}),n.get("observer").watch("contact-deleted",function(){y.getStack().show("#addcontact")}),A.watchValue("lang",function(){var e;x.loop(function(t,n){t.selected&&(e=n)}),x.reset([{name:"all",label:"allbtn",selected:!1},{name:"users",label:"usrbtn",selected:!1},{name:"groups",label:"grpbtn",selected:!1}]),x.update(e,"selected",!0)}),g}}),define("connect/messages/message-reply",["Olives/OObject","Store","Olives/Model-plugin","Olives/Event-plugin","service/config","service/utils","Promise","service/autocontact"],function(e,t,n,r,s,o,u,a){return function(){var c=new e,h=new t,p,d={},v=new t({errormsg:""}),m=s.get("labels"),g=s.get("user"),y=s.get("transport"),b=!1,w=function(e){var t=/<(.|\n)*?>/g;return e.replace(t,"")},E=function(e){var t=h.get("toList").toLowerCase().split(/,|;/),n=h.get("ccList").toLowerCase().split(/,|;/),r=JSON.stringify(g.get("connections")).toLowerCase(),s=[],o={},a=new u;arr=[];for(i=0,l=t.length;i<l;i++){if(!(r.search(t[i].trim())>-1||p.toList.search(t[i].trim())>-1||p.ccList.search(t[i].trim())>-1)){v.set("errormsg",m.get("tolbl")+" : "+t[i].trim()+m.get("notavalidcontact")),b=!1,a.reject();break}s.push(t[i].trim())}if(!v.get("errormsg")&&n[0]!=="")for(i=0,l=n.length;i<l;i++){if(!(r.search(n[i].trim())>-1||p.toList.search(n[i].trim())>-1||p.ccList.search(n[i].trim())>-1)){v.set("errormsg",m.get("tolbl")+" : "+n[i].trim()+m.get("notavalidcontact")),b=!1,a.reject();break}s.push(n[i].trim())}return v.get("errormsg")||(o.list=s,y.request("CheckRecipientList",o,function(t){var n=[];if(!t.error){for(i=0,l=t.length;i<l;i++)n.push(t[i].value);e(n),a.resolve()}else v.set("errormsg",t.error),a.reject()})),a};return c.plugins.addAll({labels:new n(m),errormsg:new n(v),reply:new n(h,{setAvatar:function(e){this.setAttribute("style","background: url('"+s.get("avatar")+"') no-repeat center center;background-size:cover;")},setCC:function(e){switch(e){case"replyall":break;case"forward":break;default:this.innerHTML=h.get("message").username}},setSubject:function(e){switch(e){case"replyall":break;case"forward":break;default:this.innerHTML="  Re : "+h.get("message").object}}}),replyevent:new r(c)}),c.template='<div><div class="avatar" data-reply="bind: setAvatar, message.author"></div><form class="form"><p><textarea name="toList" class="mail-header" data-labels="bind:placeholder, tocontactlbl" data-reply="bind: value, toList" data-replyevent="listen: touchstart, displayAutoContact; listen:keypress, updateAutoContact"></textarea></p><div id="tolistauto" class="invisible"></div><p><textarea name="ccList" class="mail-header" data-labels="bind:placeholder, cclbl" data-reply="bind: value, ccList" data-replyevent="listen: touchstart, displayAutoContact; listen:keypress, updateAutoContact"></textarea></p><div id="cclistauto" class="invisible"></div><p><span class="subject" data-labels="bind:innerHTML, subjectlbl"></span><span data-reply="bind:innerHTML, object"></span></p><p><textarea class="input" data-reply="bind:value, body"></textarea></p><blockquote class="original" data-reply="bind:innerHTML, original"></blockquote><p><legend>Signature</legend><textarea class="signature" data-reply="bind:value, signature"></textarea></p><div class="sendmail-footer"><p class="send"><label class="cancelmail" data-labels="bind:innerHTML, cancellbl" data-replyevent="listen: touchstart, press; listen:touchend, cancel">Cancel</label><label class="sendmail" data-labels="bind:innerHTML, sendlbl" data-replyevent="listen:touchstart, press; listen:touchend, send">Send</label><label class="editerror" data-errormsg="bind:innerHTML, errormsg"></label></p></div></div>',c.reset=function(t,n){p=t,h.reset({signature:"",original:"",author:g.get("_id"),username:g.get("username"),firstname:g.get("firstname"),toList:"",ccList:"",object:"",body:""}),h.set("type",n),g.get("signature")?h.set("signature",g.get("signature")):h.set("signature",g.get("username")),h.set("original",m.get("on")+o.formatDate(t.date)+"</p><p>"+t.username+m.get("ideawrotelbl")+"</p><p>"+m.get("subjectlbl")+t.object+"</p><hr><p>"+t.body+"</p>");switch(n){case"replyall":t.ccList?h.set("toList",t.username.concat(", "+t.ccList)):h.set("toList",t.username),t.object.search("Re :")!==0?h.set("object","Re : "+t.object):h.set("object",t.object);break;case"forward":h.set("toList",""),t.object.search("Fwd :")!==0?h.set("object","Fwd : "+t.object):h.set("object",t.object);break;default:h.set("toList",t.username),t.object.search("Re :")!==0?h.set("object","Re : "+t.object):h.set("object",t.object)}h.set("message",t),c.place(document.getElementById("msgreply"))},c.displayAutoContact=function(e,t){var n=t.getAttribute("name"),r,i,s=function(e){h.set(n,e)};n==="toList"?r=document.getElementById("tolistauto"):r=document.getElementById("cclistauto"),i=new a(r,t,s),d.name=i,r.classList.remove("invisible")},c.updateAutoContact=function(e,t){var n=t.getAttribute("name");e.keyCode===13?t.removeChild(t.firstChild):e.keyCode===186||e.keyCode===188?d.name.init():d.name.updateList()},c.press=function(e,t){t.classList.add("pressed")},c.cancel=function(e,t){t.classList.remove("pressed"),b=!1,document.getElementById("msgreply").classList.add("invisible")},c.send=function(e,t){var n=new Date,r={};t.classList.remove("pressed"),b||(b=!0,v.set("errormsg",""),r=JSON.parse(h.toJSON()),r.type="MSG",r.body=r.body.concat("<br><br>"+r.original),r.dest=[],E(function(e){r.dest=e}).then(function(){v.get("errormsg")?(console.log(result),b=!1):(r.date=[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()],y.request("Notify",r,function(e){b=!1,v.set("errormsg",m.get("messagesentok")),setTimeout(function(){v.set("errormsg",""),b=!1,document.getElementById("msgreply").classList.add("invisible")},2e3)}))}))},c}}),define("connect/messages/message-detail",["Olives/OObject","service/config","Store","Olives/Model-plugin","Olives/Event-plugin","service/avatar","service/utils","./message-reply"],function(e,t,n,r,s,o,u,a){return function(c){var h=new e,p=new a,d=new n,v=new n({response:""}),m=t.get("labels"),g=t.get("user"),y=t.get("observer"),b=t.get("transport");return h.template='<div id="msgdetail"><div class="header blue-dark"><span class="subjectlbl" data-label="bind:innerHTML, subjectlbl"></span><span data-message="bind:setObject, type"></span></div><div class = "detail-contents"><div class="detail-header"><div class="msgoptions" data-message="bind: showOptions, type"><div class="defaultmsgoption"><div name="reply" class="msgreply" data-messageevent="listen:touchstart, press; listen:touchend, action"></div><div name="more" class="more" data-messageevent="listen:touchstart, press; listen:touchend, action"></div></div><div class="msgoptionlist invisible"><div name="replyall" class="replyall sort-button" data-label="bind:innerHTML, replyalllbl" data-messageevent="listen:touchstart, press; listen:touchend, action"></div><div name="forward" class="forward sort-button" data-label="bind:innerHTML, forwardlbl" data-messageevent="listen:touchstart, press; listen:touchend, action"></div><div name="deletemsg" class="deletemsg sort-button" data-label="bind:innerHTML, deletelbl" data-messageevent="listen:touchstart, press; listen:touchend, action"></div></div></div><div data-message="bind:setAvatar, author"></div><p data-message="bind:innerHTML, username"></p><p class="toList"><span data-label="bind: innerHTML, tolbl"></span><span data-message="bind: setToList, toList"></span></p><p class="toList invisible" data-message="bind:showCcList, ccList"><span data-label="bind: innerHTML, cclbl"></span><span data-message="bind: innerHTML, ccList"></span></p><p class="msgdate"><span class="date" data-message="bind: date, date"></span></p></div><div class="detail-body"><p data-message="bind:setBody, type"></p><div class="showdoc" data-message="bind: showDocBtn, type" data-messageevent="listen:touchstart, press; listen:touchend, showDoc"></div></div><div class="goto2q invisible" data-message = "bind: showTwoQ, type" data-messageevent="listen: touchstart, press; listen: touchend, showTwoQ"></div><div class="acceptrejectCXR invisible" data-message="bind:showCXRbtn, type"><div class="acceptCXR" data-label="bind:innerHTML, accept" data-messageevent="listen:touchstart, press; listen:touchend, acceptCXR"></div><div class="rejectCXR" data-label="bind:innerHTML, reject" data-messageevent="listen:touchstart, press; listen:touchend, rejectCXR"></div></div></div><div id="msgreply" class="invisible"></div><div id="CXRconfirm" class="invisible" data-cxr="bind:setVisibility, response"><span class="CXRconfirmed" data-cxr="bind:setResponseMessage, response"></span></div></div>',h.plugins.addAll({label:new r(m),message:new r(d,{date:function w(w){var e=new Date,t=w[3],n=w[4],r=w[5];w&&w[0]===e.getFullYear()&&w[1]===e.getMonth()&&w[2]===e.getDate()?(t<10&&(t="0"+t),n<10&&(n="0"+n),r<10&&(r="0"+r),this.innerHTML=t+":"+n+":"+r):this.innerHTML=u.formatDate(w)+"  "+t+":"+n},setObject:function(e){switch(e){case"CXR":this.innerHTML=d.get("username")+m.get("CXRobject");break;case"CXRaccept":this.innerHTML=d.get("username")+m.get("acceptedCXR");break;case"CXRreject":this.innerHTML=d.get("username")+m.get("rejectedCXR");break;case"CXCancel":this.innerHTML=d.get("username")+m.get("canceledCX");break;case"DOC":this.innerHTML=d.get("username")+m.get("sentdocmsg");break;case"2Q+":this.innerHTML=d.get("username")+m.get("askednew");break;case"2C+":this.innerHTML=d.get("username")+m.get("senttc");break;default:this.innerHTML=d.get("object")}},setBody:function(e){switch(e){case"CXRaccept":this.innerHTML=m.get("youlbl")+m.get("nowconnected")+d.get("username");break;case"DOC":this.innerHTML=d.get("username")+m.get("sentdocmsg")+" : <b>"+d.get("docTitle")+"</b>";break;default:this.innerHTML=d.get("body")}},showOptions:function(e){e.search("CX")>-1||e==="2Q+"?this.classList.add("invisible"):this.classList.remove("invisible")},setToList:function(e){e?this.innerHTML=e:this.innerHTML=m.get("melbl")},showCcList:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")},showCXRbtn:function(e){e==="CXR"?this.classList.remove("invisible"):this.classList.add("invisible")},showDocBtn:function(e){e==="DOC"?this.classList.remove("invisible"):this.classList.add("invisible")},showTwoQ:function(e){e==="2Q+"||e==="2C+"?this.classList.remove("invisible"):this.classList.add("invisible")},setAvatar:function(t){var n=document.createDocumentFragment(),r=new o([t]);r.place(n),this.hasChildNodes()?this.replaceChild(n,this.firstChild):this.appendChild(n)}}),cxr:new r(v,{setVisibility:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")},setResponseMessage:function(e){e==="YES"?this.innerHTML=m.get("CXRaccepted")+d.get("username")+m.get("isnowacontact"):this.innerHTML=m.get("CXRrejected")}}),messageevent:new s(h)}),h.showDoc=function(t,n){n.classList.remove("pushed"),d.get("type")==="DOC"&&y.notify("display-doc",d.get("docId"),d.get("docType"))},h.showTwoQ=function(t,n){n.classList.remove("pushed"),d.get("type")==="2Q+"&&y.notify("display-twoq",d.get("docId"),d.get("author")),d.get("type")==="2C+"&&y.notify("display-twoc")},h.press=function(e,t){t.classList.add("pushed")},h.action=function(e,t){var n=t.getAttribute("name"),r=document.getElementById("msgreply"),i=document.querySelector(".msgoptionlist");switch(n){case"more":i.classList.remove("invisible");break;case"reply":i.classList.add("invisible"),p.reset(JSON.parse(d.toJSON()),"reply"),r.classList.remove("invisible");break;case"replyall":i.classList.add("invisible"),p.reset(JSON.parse(d.toJSON()),"replyall"),r.classList.remove("invisible");break;case"forward":i.classList.add("invisible"),p.reset(JSON.parse(d.toJSON()),"forward"),r.classList.remove("invisible");break;case"deletemsg":i.classList.add("invisible"),h.deletemsg(d.toJSON()),c("#defaultPage");break;default:}t.classList.remove("pushed")},h.deletemsg=function(t){var n=g.get("notifications"),r;for(i=0,l=n.length;i<l;i++)if(JSON.stringify(n[i])===t){r=i;break}n.splice(r,1),g.set("notifications",n),g.upload()},h.acceptCXR=function(e,t){var n=g.get("connections"),r=g.get("news")||[],s=0,o=new Date,u=[o.getFullYear(),o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds()];t.classList.remove("pushed");for(i=0,l=n.length;i<l;i++)n[i].type==="user"?(n[i].lastname<d.get("contactInfo").lastname&&s++,n[i].lastname===d.get("contactInfo").lastname&&n[i].firstname<d.get("contactInfo").firstname&&s++):n[i].username<d.get("contactInfo").lastname&&s++;n.splice(s,0,d.get("contactInfo")),g.set("connections",n),r.unshift({type:"CX+",date:u,content:{userid:d.get("author"),username:d.get("username")}}),g.set("news",r),g.upload().then(function(){var e={dest:[d.get("author")],date:u,original:"",type:"CXRaccept",author:g.get("_id"),username:g.get("username"),firstname:g.get("firstname"),toList:d.get("username"),ccList:"",object:g.get("username")+m.get("acceptedCXR"),body:m.get("youlbl")+m.get("nowconnected")+g.get("username"),signature:"",contactInfo:{firstname:g.get("firstname"),lastname:g.get("lastname"),userid:g.get("_id"),username:g.get("username"),intro:g.get("intro"),type:"user"}};v.set("response","YES"),b.request("Notify",e,function(e){JSON.parse(e)[0].res==="ok"&&setTimeout(function(){h.deletemsg(d.toJSON()),c("#defaultPage")},1e3)})})},h.rejectCXR=function(e,t){var n,r=new Date;t.classList.remove("pushed"),v.set("response","NO"),n={dest:[d.get("author")],original:"",date:[r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds()],type:"CXRreject",author:g.get("_id"),username:g.get("username"),firstname:g.get("firstname"),toList:d.get("username"),ccList:"",object:g.get("username")+m.get("rejectedCXR"),body:"",signature:""},b.request("Notify",n,function(e){JSON.parse(e)[0].res==="ok"&&setTimeout(function(){h.deletemsg(d.toJSON()),c("#defaultPage")},1500)})},h.reset=function(t){v.reset({response:""}),d.reset(t),p.reset(t,"reply")},MSG=d,h}}),define("connect/messages/newmessage",["Olives/OObject","Olives/Model-plugin","Olives/Event-plugin","service/config","Store","Promise","service/autocontact"],function(e,t,n,r,s,o,u){return function(f){var c=new e,h=new s,p=new s({errormsg:""}),d=r.get("labels"),v=r.get("user"),m=r.get("transport"),g=!1,y={},b=function(e){var t=h.get("toList").toLowerCase().split(/,|;/),n=h.get("ccList").toLowerCase().split(/,|;/),r=JSON.stringify(v.get("connections")).toLowerCase(),s=[],u={},a=new o;arr=[];for(i=0,l=t.length;i<l;i++){if(!(r.search(t[i].trim())>-1)){p.set("errormsg",d.get("tolbl")+" : "+t[i].trim()+d.get("notavalidcontact")),g=!1,a.reject();break}s.push(t[i].trim())}if(!p.get("errormsg")&&n[0]!=="")for(i=0,l=n.length;i<l;i++){if(!(r.search(n[i].trim())>-1)){p.set("errormsg",d.get("tolbl")+" : "+n[i].trim()+d.get("notavalidcontact")),g=!1,a.reject();break}s.push(n[i].trim())}return p.get("errormsg")||(u.list=s,m.request("CheckRecipientList",u,function(t){var n=[];if(!t.error){for(i=0,l=t.length;i<l;i++)n.push(t[i].value);e(n),a.resolve()}else p.set("errormsg",t.error),a.reject()})),a};return c.plugins.addAll({labels:new t(d),errormsg:new t(p),newmessage:new t(h,{setAvatar:function(e){this.setAttribute("style","background: url('"+r.get("avatar")+"') no-repeat center center;background-size:cover;")}}),newmessageevent:new n(c)}),c.template='<div id="newmsg"><div class="header blue-dark"><span data-labels="bind: innerHTML, newmsg">New message</span></div><div class="avatar" data-newmessage="bind: setAvatar, author"></div><form class="form"><p><textarea class="mail-header" name="toList" data-newmessage="bind: value, toList" data-newmessageevent="listen: touchstart, displayAutoContact; listen:keyup, updateAutoContact" data-labels="bind:placeholder, tocontactlbl"></textarea></p><div id="tolistauto" class="invisible"></div><p><textarea class="mail-header" name="ccList" data-newmessage="bind: value, ccList" data-labels="bind:placeholder, cclbl" data-newmessageevent="listen: touchstart, displayAutoContact; listen:keyup, updateAutoContact"></textarea></p><div id="cclistauto" class="invisible"></div><p><input type="text" class="input" data-newmessage="bind:value, object" data-labels="bind:placeholder, subjectlbl"></p><p><textarea class="input" data-newmessage="bind:value, body"></textarea></p><p><legend>Signature</legend><textarea class="signature" data-newmessage="bind:value, signature"></textarea></p><div class="sendmail-footer"><p class="send"><label class="cancelmail" data-labels="bind:innerHTML, cancellbl" data-newmessageevent="listen: touchstart, press; listen:touchend, cancel">Cancel</label><label class="sendmail" data-labels="bind:innerHTML, sendlbl" data-newmessageevent="listen:touchstart, press; listen:touchend, send">Send</label><label class="editerror" data-errormsg="bind:innerHTML, errormsg"></label></p></div></form></div>',c.reset=function(t){var n,r,i="";h.reset({author:v.get("_id"),username:v.get("username"),firstname:v.get("firstname"),type:"MSG",signature:v.get("username"),toList:"",ccList:"",object:"",body:"",date:null}),v.get("signature")?h.set("signature",v.get("signature")):h.set("signature",v.get("username")),p.reset({errormsg:""});if(t){console.log(t);if(t.type==="user")h.set("toList",t.username);else{for(n=0,r=t.contacts.length;n<r;n++)i?i=i+", "+t.contacts[n].username:i=t.contacts[n].username;h.set("toList",i)}}},c.press=function(e,t){t.classList.add("pressed")},c.cancel=function(e,t){t.classList.remove("pressed"),g=!1,c.reset(),f("#defaultPage")},c.displayAutoContact=function(e,t){var n=t.getAttribute("name"),r,i,s=function(e){h.set(n,e)};n==="toList"?r=document.getElementById("tolistauto"):r=document.getElementById("cclistauto"),i=new u(r,t,s),y.name=i,r.classList.remove("invisible")},c.updateAutoContact=function(e,t){var n=t.getAttribute("name");e.keyCode===13?t.removeChild(t.firstChild):e.keyCode===186||e.keyCode===188?y.name.init():y.name.updateList()},c.send=function(e,t){var n=new Date,r={};t.classList.remove("pressed"),g||(g=!0,p.set("errormsg",""),r=JSON.parse(h.toJSON()),h.get("object")||(p.set("errormsg",d.get("entersubjectlbl")),g=!1),r.dest=[],b(function(e){r.dest=e}).then(function(){p.get("errormsg")?(console.log(result),g=!1):(r.date=[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()],m.request("Notify",r,function(e){g=!1,c.reset(),p.set("errormsg",d.get("messagesentok")),setTimeout(function(){p.set("errormsg",""),g=!1,f("#defaultPage")},2e3)}))}))},c}}),define("connect/messages/messages",["Olives/OObject","service/map","Olives/Model-plugin","Olives/Event-plugin","Amy/Control-plugin","Amy/Stack-plugin","Store","service/config","service/avatar","service/utils","./message-detail","./newmessage","service/actionbar","Promise"],function(e,t,n,r,s,o,u,a,f,c,h,p,d,v){return function(){var g=new e,y=new o,b=function(e){y.getStack().show(e)},w="#defaultPage",E=new e,S=new h(b),x=new p(b),T=new u([{name:"all",label:"allbtn",selected:!0},{name:"messages",label:"msgbtn",selected:!1},{name:"notifications",label:"notifbtn",selected:!1},{name:"unread",label:"unreadbtn",selected:!1}]),N=0,C=new u([]),k=a.get("labels"),L,A,O=!1,M=a.get("user"),_=a.get("observer"),D=function(e){var t=T.get(e).name,n=M.get("notifications"),r,i=n.length,s=[];switch(t){case"messages":for(r=0;r<i;r++)n[r].type==="MSG"&&s.push(n[r]);break;case"notifications":for(r=0;r<i;r++)n[r].type!=="MSG"&&s.push(n[r]);break;case"unread":for(r=0;r<i;r++)n[r].status==="unread"&&s.push(n[r]);break;default:s=n}return s},P=function(e){var t=[],n=[];t=M.get("notifications").concat();if(e==="")n=t,T.update(0,"selected",!0),N=0;else for(i=0,l=t.length;i<l;i++)JSON.stringify(t[i]).toLowerCase().search(e.toLowerCase())>-1&&n.push(t[i]);return n};return g.plugins.addAll({label:new n(k),sort:new n(T,{setLabel:function(e){this.innerHTML=k.get(e)},setSelected:function(e){e?this.classList.add("pressed"):this.classList.remove("pressed")}}),msg:new n(C,{setObject:function(e){var t=this.getAttribute("data-msg_id");switch(e){case"CXR":this.innerHTML=C.get(t).username+k.get("CXRobject");break;case"CXRaccept":this.innerHTML=C.get(t).username+k.get("acceptedCXR");break;case"CXRreject":this.innerHTML=C.get(t).username+k.get("rejectedCXR");break;case"CXCancel":this.innerHTML=C.get(t).username+k.get("canceledCX");break;case"DOC":this.innerHTML=C.get(t).username+k.get("sentdocmsg");break;case"2Q+":this.innerHTML=C.get(t).username+k.get("askednew");break;case"2C+":this.innerHTML=C.get(t).username+k.get("senttc");break;default:this.innerHTML=C.get(t).object}},date:function H(H){var e=new Date;if(H&&H[0]===e.getFullYear()&&H[1]===e.getMonth()&&H[2]===e.getDate()){var t=H[3],n=H[4],r=H[5];t<10&&(t="0"+t),n<10&&(n="0"+n),r<10&&(r="0"+r),this.innerHTML=t+":"+n+":"+r}else this.innerHTML=c.formatDate(H)},highlight:function(e){e==="unread"?this.classList.add("unread"):this.classList.remove("unread")},setAvatar:function(t){var n=document.createDocumentFragment(),r=new f([t]);r.place(n),this.hasChildNodes()?this.replaceChild(n,this.firstChild):this.appendChild(n)}}),msglistevent:new r(g),msglistcontrol:new s(g),msgdetailstack:y}),g.template='<div id="connect-messages"><div class="messages list"><div class="header blue-light"><span data-label="bind: innerHTML, msglistheadertitle">My Messages</span><div class="option right" data-msglistevent="listen: touchstart, plus"></div></div><ul class="selectors" data-sort = "foreach"><li class="sort-button" data-sort="bind: setLabel, label; bind:setSelected, selected, bind: name, name" data-msglistevent="listen:touchstart, displaySort"></li></ul><input class="search" type="text" data-label="bind: placeholder, searchmsgplaceholder" data-msglistevent="listen: keypress, search"><div class="msglist overflow" data-msglistcontrol="radio:li,selected,touchend,selectMsg"><ul data-msg="foreach"><li class="msg list-item" data-msglistevent="listen:touchstart, setStart; listen:touchmove, showActionBar"><div data-msg="bind:setAvatar, author"></div><p class="msg-author unread" data-msg="bind:highlight, status; bind:innerHTML, username">Author</p><div class="select-msg"></div><span class="date" data-msg="bind: date, date"></span><p class="msg-subject unread" data-msg="bind:highlight, status; bind:setObject, type">Subject</p></li></ul></div></div><div id="msg-detail" class="details" data-msgdetailstack="destination"></div></div>',g.place(t.get("connect-messages")),g.plus=function(t,n){y.getStack().get("#newmsg").reset(),y.getStack().show("#newmsg")},g.displaySort=function(e,t){var n=t.getAttribute("data-sort_id");C.reset([]),y.getStack().show("#defaultPage"),N>-1&&T.update(N,"selected",!1),T.update(n,"selected",!0),N=n,C.reset(D(n))},g.search=function(e,t){e.keyCode===13&&(T.update(N,"selected",!1),N=-1,C.reset(P(t.value)))},g.selectMsg=function(t,n){var r=t.target.getAttribute("data-msg_id"),s=M.get("notifications"),o;if(C.get(r).status==="unread"){for(i=0,l=s.length;i<l;i++)if(JSON.stringify(s[i])===JSON.stringify(C.get(r))){index=i;break}C.update(r,"status","read"),s[index]=C.get(r),M.set("notifications",s),M.upload()}y.getStack().show("#msgdetail"),S.reset(C.get(r)),w="#msgdetail"},g.init=function(){g.cleanOld().then(function(){C.reset(M.get("notifications"))})},g.getSelectedmsg=function(){var e=document.querySelector(".msg.selected"),t=-1;return e&&(t=e.getAttribute("data-msg_id")),t},g.cleanOld=function(){var e=new v,t=new Date,n,r,s=!1,o=M.get("notifications")||[],u=M.get("sentMessages")||[];for(i=o.length-1;i>=0;i--)n=new Date(o[i].date[0],o[i].date[1],o[i].date[2],o[i].date[3],o[i].date[4],o[i].date[5]),t.getTime()-n.getTime()>2592e6&&(o.pop(),s=!0);for(i=u.length-1;i>=0;i--)r=new Date(u[i].date[0],u[i].date[1],u[i].date[2],u[i].date[3],u[i].date[4],u[i].date[5]),t.getTime()-r.getTime()>2592e6&&(u.pop(),s=!0);return s?(M.set("notifications",o),M.set("sentMessages",u),M.upload().then(function(){e.resolve()})):e.resolve(),e},g.setStart=function(e,t){L=[e.pageX,e.pageY],document.querySelector(".actionbar")&&g.hideActionBar()},g.showActionBar=function(e,t){var n=t.getAttribute("data-msg_id");A=[e.pageX,e.pageY];if(!O&&L[0]-A[0]>40&&A[1]-L[1]<20&&A[1]-L[1]>-20){var r=new d("message",t,C.get(n),g.hideActionBar),i=document.createDocumentFragment();r.place(i),t.appendChild(i),O=!0}},g.hideActionBar=function(){var t=document.querySelector(".actionbar"),n=t.parentNode;n.removeChild(n.lastChild),O=!1},E.template='<div class="msgsplash"><div class="header blue-dark"><span>'+a.get("labels").get("messageview")+'</span></div><div class="innersplash" data-labels="bind: innerHTML, messagecenter"></div></div>',E.plugins.add("labels",new n(k)),g.init(),y.getStack().add("#defaultPage",E),y.getStack().add("#msgdetail",S),y.getStack().add("#newmsg",x),y.getStack().show("#defaultPage"),M.watchValue("notifications",function(){var e,t=[];N>-1&&(t=D(N),C.reset(t)),y.getStack().getCurrentName==="#msgdetail"&&(e=g.getSelectedmsg(),e>-1?S.reset(C.get(e)):y.getStack().show("#defaultPage"))}),_.watch("display-message",function(e){var t=M.get("notifications"),n=t[e];T.update(N,"selected",!1),n.type==="MSG"?(T.update(1,"selected",!0),N=1):(T.update(2,"selected",!0),N=2),n.status="read",t[e]=n,M.set("notifications",t),M.upload(),C.reset([n]),document.querySelector('li[data-msg_id="0"]').classList.add("selected"),y.getStack().show("#msgdetail"),S.reset(n),w="#msgdetail"}),_.watch("message-contact",function(e){x.reset(e),y.getStack().show("#newmsg")}),M.watchValue("lang",function(){var e;T.loop(function(t,n){t.selected&&(e=n)}),T.reset([{name:"all",label:"allbtn",selected:!1},{name:"messages",label:"msgbtn",selected:!1},{name:"notifications",label:"notifbtn",selected:!1},{name:"unread",label:"unreadbtn",selected:!1}]),T.update(e,"selected",!0)}),g}}),define("connect/twocents/mtc-details",["Olives/OObject","service/config","Store","Olives/Model-plugin","Olives/Event-plugin","twocents/writetwocent","twocents/twocentlist","service/avatar","service/utils"],function(e,t,n,r,i,s,o,u,a){return function(){var i=new e,s=t.get("labels"),u=t.get("user"),a=new o;return i.plugins.addAll({labels:new r(s)}),i.template='<div class="twocent-detail"><div class="header blue-dark"><span data-labels="bind: innerHTML, mytwocentwall"></span></div><div class = "detail-contents"><div id="connect-twocents" class="twocents"></div></div></div>',i.reset=function(){a.reset(u.get("_id"),"connect")},i}}),define("connect/twocents/mtq-details",["Olives/OObject","service/config","Store","Olives/Model-plugin","Olives/Event-plugin","twocents/writetwocent","twocents/twocentlist","service/avatar","service/utils"],function(e,t,n,r,i,s,o,u,a){return function(){var l=new e,c=t.get("labels"),h=t.get("user"),p=new n,d=new s("connect"),v=new o,m;return l.plugins.addAll({labels:new r(c),tqdetail:new r(p,{setHeader:function(e){e?e===h.get("_id")?this.innerHTML=c.get("mytqdetailheader"):this.innerHTML=c.get("tqheaderprefix")+p.get("username")+c.get("tqheadersuffix"):this.innerHTML=c.get("selecttq")},displayWriteTwocent:function(e){!e||e===h.get("_id")?this.classList.add("invisible"):this.classList.remove("invisible")},displayTwocentList:function(e){e&&e.length&&document.getElementById("connect-writetwocents").classList.add("invisible")},displayTwocentNB:function(e){var t=e.length||0;t?t===1?this.innerHTML=t+" "+c.get("showonetcreply"):this.innerHTML=t+"showtcrepliesafter":this.innerHTML=c.get("noreplyyet")},date:function g(g){g&&(this.innerHTML=a.formatDate(g))},setAuthor:function(e){e===h.get("username")&&p.get("author")===h.get("_id")?this.innerHTML=c.get("youlbl"):this.innerHTML=e},setWrotelbl:function(e){e===h.get("_id")?this.innerHTML=c.get("youwrotelbl"):this.innerHTML=c.get("ideawrotelbl")},setAvatar:function(t){var n=document.createDocumentFragment(),r=new u([t]);r.place(n),this.hasChildNodes()?this.replaceChild(n,this.firstChild):this.appendChild(n)}}),tqevent:new i(l)}),l.template='<div class="twocent-detail"><div class="header blue-dark"><span data-tqdetail="bind: setHeader, author"></span></div><div class = "detail-contents"><div class="detail-header"><div class="avatar" data-tqdetail="bind:setAvatar, author"></div><span class="author" data-tqdetail="bind:setAuthor,username"></span><span class="commentlbl" data-tqdetail="bind: setWrotelbl, author"></span><p data-tqdetail="bind:innerHTML,question"></p><span class="date" data-tqdetail="bind:date, creation_date"></span></div><div class="detail-body"></div><div class="detail-footer"><div class="tcbutton" data-tqevent="listen:touchstart, press; listen: touchend, write"></div><div class="tcreplies" data-tqdetail = "bind: displayTwocentNB, twocents"></div></div><div id="connect-writetwocents" class="invisible" data-tqdetail="bind: displayWriteTwocent, author"></div><div id="connect-twocents" class="twocents" data-tqdetail="bind: displayTwocentList, twocents"></div></div></div>',l.press=function(e,t){t.classList.add("pressed")},l.write=function(e,t){t.classList.remove("pressed"),document.getElementById("connect-writetwocents").classList.remove("invisible")},l.hide=function(){document.querySelector(".detail-contents").classList.add("invisible"),p.reset({})},l.reset=function(t){p.reset(t.value),d.reset(p.get("_id")),v.reset(p.get("_id"),"connect"),m=l.dom.querySelector("#connect-writetwocents"),d.place(m)},l.place(document.createDocumentFragment()),l}}),define("connect/twocents/mtc-stack",["Olives/OObject","service/map","Amy/Stack-plugin","Olives/Model-plugin","./mtc-details","./mtq-details","service/config","Store"],function(e,t,n,r,i,s,o,u){return function(){var u=new e,a=new e,f=o.get("labels"),l=new n;return u.template='<div id = "mtcdetailstack" data-mtcdetailstack = "destination"></div>',u.plugins.addAll({mtcdetailstack:l}),u.setView=function(t){var n=l.getStack().getCurrentName();t==="2Q"&&n!=="twoqdetail"?l.getStack().show("twoqdetail"):t==="2C"&&n!=="twocdetail"?(l.getStack().get("twocdetail").reset(),l.getStack().show("twocdetail")):l.getStack().show("defaultPage")},u.reset=function(t,n){t==="2Q"&&(l.getStack().get("twoqdetail").reset(n),l.getStack().getCurrentName!=="twoqdetail"&&l.getStack().show("twoqdetail"))},a.template='<div class="msgsplash"><div class="header blue-dark" data-labels="bind: innerHTML, twocentview"><span></span></div><div class="innersplash" data-labels="bind: innerHTML, twocentcenter"></div></div>',a.plugins.add("labels",new r(f)),u.init=function(t,n){var r=new s,o=new i;l.getStack().add("twoqdetail",r),l.getStack().add("twocdetail",o),l.getStack().add("defaultPage",a),t==="default"&&l.getStack().show("defaultPage"),t==="2Q"&&(l.getStack().show("twoqdetail"),twoQDetail.reset(n))},u}}),define("connect/twocents/twoqlist",["Olives/OObject","CouchDBStore","service/config","Olives/Model-plugin","Olives/Event-plugin","service/utils","service/avatar","service/actionbar","Promise"],function(e,t,n,r,i,s,o,u,a){function f(e,f,l,c,h){var p=new t([]),d=new t([]),v,m,g=!1,y="",b=null,w={db:f,view:c,design:l,query:{descending:!0}},E=n.get("labels");p.setTransport(n.get("transport")),e==="contact"?y="contacttwoqlist":y="",this.template='<div><ul class="twoq-list '+y+'" data-twoqlist="foreach"><li class="list-item" data-twoqlistevent="listen:touchstart, setStart; listen:touchmove, showActionBar"><div class="item-header"><span class="date" data-twoqlist="bind:date,value.creation_date"></span></div><div class="item-body"><p data-twoqlist="bind:innerHTML,value.question"></p></div><div class="item-footer"><a class="item-twocent"></a><span class="replies" data-twoqlist="bind:showReplies, value.twocents"></span></div></li></ul><ul class="twoq-searchlist invisible '+y+'" data-twoqsearch="foreach"><li class="list-item" data-twoqlistevent="listen:touchstart, setStart; listen:touchmove, showActionBar"><div class="item-header"><span class="date" data-twoqsearch="bind:date,value.creation_date"></span></div><div class="item-body"><p data-twoqsearch="bind:innerHTML,value.question"></p></div><div class="item-footer"><a class="item-twocent"></a><span class="replies" data-twoqsearch="bind:showReplies, value.twocents"></span></div></li></ul></div>',this.plugins.addAll({twoqlist:new r(p,{date:function S(S){S?this.innerHTML=s.formatDate(S):this.innerHTML=""},showReplies:function(t){var n=t.length;n===0?this.innerHTML=E.get("noreplyyet"):n===1?this.innerHTML=n+" "+E.get("showonetcreply"):this.innerHTML=n+" "+E.get("showtcrepliesafter")},setAvatar:function(t){var n,r;t&&(r=document.createDocumentFragment(),n=new o([t]),n.place(r),this.hasChildNodes()?this.replaceChild(r,this.firstChild):this.appendChild(r))},setVisibility:function(e){e==="public"?this.classList.add("public"):this.classList.remove("public")}}),twoqsearch:new r(d,{date:function x(x){x?this.innerHTML=s.formatDate(x):this.innerHTML=""},showReplies:function(t){var n=t.length;n===0?this.innerHTML=E.get("noreplyyet"):n===1?this.innerHTML=n+" "+E.get("showonetcreply"):this.innerHTML=n+" "+E.get("showtcrepliesafter")},setAvatar:function(t){var n,r;t&&(r=document.createDocumentFragment(),n=new o([t]),n.place(r),this.hasChildNodes()?this.replaceChild(r,this.firstChild):this.appendChild(r))},setVisibility:function(e){e==="public"?this.classList.add("public"):this.classList.remove("public")}}),twoqlistevent:new i(this)}),this.getModel=function(){return p},this.resetQuery=function(e){var t=new a;return w.query=e,p.unsync(),p.reset([]),p.sync(w.db,w.design,w.view,w.query).then(function(){t.resolve()}),t},this.setStart=function(e,t){v=[e.pageX,e.pageY],b&&this.hideActionBar(b)},this.showActionBar=function(e,t){var n=t.getAttribute("data-twoqlist_id"),r=document.getElementById("mtc-list");m=[e.pageX,e.pageY];if(!r.classList.contains("mosaic")&&!g&&v[0]-m[0]>40&&m[1]-v[1]<20&&m[1]-v[1]>-20){var i=new u("2Q",t,p.get(n).value,this.hideActionBar),s=document.createDocumentFragment();i.place(s),t.appendChild(s),b=i,g=!0}},this.hideActionBar=function(t){var n=t.dom.parentElement;n.removeChild(n.lastChild),g=!1,b=null},this.showSearch=function(){var t=document.querySelector(".twoq-searchlist"),n=document.querySelector(".twoq-list");t.classList.contains("invisible")&&(n.classList.add("invisible"),t.classList.remove("invisible"))},this.hideSearch=function(){var t=document.querySelector(".twoq-searchlist"),n=document.querySelector(".twoq-list");t.classList.contains("invisible")||(n.classList.remove("invisible"),t.classList.add("invisible"))},this.search=function(t){d.reset([]),t?(this.showSearch(),p.loop(function(e,n){JSON.stringify(e).search(t)>-1&&d.alter("push",e)})):this.hideSearch()},h&&(w.query=h),this.init=function(){var t=new a;return p.sync(w.db,w.design,w.view,w.query).then(function(){t.resolve()}),t}}return function(n,r,i,s,o){return f.prototype=new e,new f(n,r,i,s,o)}}),define("connect/twocents/mytwocents",["Olives/OObject","service/map","service/config","Olives/Model-plugin","Olives/UI-plugin","Amy/Delegate-plugin","Amy/Stack-plugin","Amy/Control-plugin","./mtc-stack","./twoqlist","Store"],function(e,t,n,r,s,o,u,a,f,c,h){return function(){var d=new e,v=new u,m=new a(d),g=new f,y,b,w=[{name:"#mytwoq",active:!0},{name:"#contacttwoq",active:!1},{name:"#mytwoc",active:!1}],E=new h(w),S=new h,x=new h([]),T=n.get("user"),N=T.get("connections"),C=n.get("labels"),k=n.get("db");d.plugins.addAll({labels:new r(C),twoqbuttons:new r(E,{setBg:function(e){switch(e){case"#mytwoq":this.classList.add("mytwoq");break;case"#contacttwoq":this.classList.add("contacttwoq");break;case"#mytwoc":this.classList.add("mytwoc");break;default:}},setActive:function(e){e?this.classList.add("pushed"):this.classList.remove("pushed")}}),mtctools:new r(S,{setVisible:function(e){this.getAttribute("name")===e?this.classList.remove("invisible"):this.classList.add("invisible")},setLegend:function(e){switch(e){case"#mytwoq":this.innerHTML=C.get("mytwoquestions");break;case"#contacttwoq":this.classList.add("contacttwoq");break;case"#mytwoc":this.innerHTML=C.get("mytwocents");break;default:}},updateLegend:function(e){e&&S.get("view")==="#contacttwoq"&&(this.innerHTML=C.get("twoqprefix")+e+C.get("twoqsuffix"))}}),auto:new r(x),mtcliststack:v,mtcdetails:new s({mtcDetails:g}),mtccontrol:m,mtcevent:new o(d)}),d.template='<div id="connect-tc"><div id="mtc-list"><div class="header blue-light"><span data-labels="bind: innerHTML, mtcheadertitle"></span><div class="option right" data-mtcevent="listen: touchstart, plus"></div></div><ul class="twoqbuttons" data-twoqbuttons="foreach"><li data-twoqbuttons="bind: setBg,name; bind:setActive, active" data-mtcevent="listen:touchstart, selectView; listen: touchend, showView"></li></ul><div class="selectcontact" name = "#contacttwoq" data-mtctools="bind:setVisible, view"><legend>Select a contact</legend><input class="search" data-mtcevent="listen:touchstart, updateAutoContact; listen:keyup, updateAutoContact" data-labels="bind:placeholder, tocontactlbl" data-mtctools = "bind:value, contact"><div class="rightcaret" data-mtcevent="listen: touchstart, updateAutoContact"></div><div class = "autocontact invisible"><ul data-auto="foreach"><li data-auto="bind:innerHTML, contact.username; bind:highlight, selected" data-mtcevent="listen:touchstart, highlightContact; listen:touchend, selectContact"></li></ul></div></div><legend data-mtctools="bind:setLegend, view; bind: updateLegend, contact"></legend><input name="#mytwoq" class="search" type="text" data-mtctools="bind:setVisible, view" data-labels="bind: placeholder, searchmsgplaceholder" data-mtcevent="listen: input, search"><input name="#contacttwoq" class="search" type="text" data-mtctools="bind:setVisible, view" data-labels="bind: placeholder, searchmsgplaceholder" data-mtcevent="listen: keypress, search"><input name="#mytwoc" class="search" type="text" data-mtctools="bind:setVisible, view" data-labels="bind: placeholder, searchmsgplaceholder" data-mtcevent="listen: keypress, search"><div data-mtcliststack="destination" data-mtccontrol="radio:li,selected,touchstart,selectStart"></div></div><div id="mtc-detail" data-mtcdetails="place:mtcDetails" class="details"></div></div>',d.place(t.get("connect-twocents")),d.plus=function(){t.get("new2q-popup").classList.add("appear"),t.get("cache").classList.add("appear")},d.selectView=function(e,t){var n=t.getAttribute("data-twoqbuttons_id");E.loop(function(e,t){t===parseInt(n)?E.update(t,"active",!0):E.update(t,"active",!1)}),S.set("view",E.get(n).name)},d.showView=function(e,t){var n=t.getAttribute("data-twoqbuttons_id");switch(E.get(n).name){case"#mytwoq":v.getStack().show("#mytwoq"),g.setView("#defaultPage");break;case"#contacttwoq":v.getStack().show("#contacttwoq"),g.setView("#defaultPage");break;case"#mytwoc":v.getStack().show("#blank"),g.setView("2C")}},d.updateAutoContact=function(e,t){var n=JSON.parse(x.toJSON()),r,s,o=document.getElementById("mtc-list"),u=o.querySelector(".autocontact");u.classList.contains("invisible")&&u.classList.remove("invisible");if(!t.value||t.value===""){n=[];for(i=0,l=N.length;i<l;i++)N[i].type==="user"&&n.push({contact:N[i]});x.reset(n)}else{s=t.value.toLowerCase();for(i=n.length-1;i>=0;i--)r=n[i].contact.username.toLowerCase(),r.search(s)!==0&&n.splice(i,1);x.reset(n)}},d.highlightContact=function(e,t){t.classList.add("highlighted")},d.selectContact=function(e,t){var n=t.getAttribute("data-auto_id"),r=document.getElementById("mtc-list"),i=r.querySelector(".autocontact");t.classList.remove("highlighted"),S.set("contact",x.get(n).contact.username),i.classList.add("invisible"),b.resetQuery({key:'"'+x.get(n).contact.userid+'"',descending:!0})},d.selectStart=function(e,t){var n=v.getStack().getCurrentScreen().getModel(),r;if(S.get("view")==="#mytwoq"||S.get("view")==="#contacttwoq")r=e.target.getAttribute("data-twoqlist_id"),g.reset("2Q",n.get(r))},d.search=function(e,t){v.getStack().getCurrentScreen().search(t.value)},n.get("observer").watch("display-twoq",function(e,t){b.resetQuery({key:'"'+t+'"',descending:!0}).then(function(){v.getStack().show("#contacttwoq"),S.set("view","#contacttwoq"),E.loop(function(e,t){e.name==="#contacttwoq"?E.update(t,"active",!0):E.update(t,"active",!1)}),b.search(e),m.init(0),g.reset("2Q",b.getModel().get(0))})}),n.get("observer").watch("display-twoc",function(){v.getStack().show("#blank"),S.set("view","#mytwoc"),E.loop(function(e,t){e.name==="#mytwoc"?E.update(t,"active",!0):E.update(t,"active",!1)}),g.setView("2C")});for(i=0,l=N.length;i<l;i++)N[i].type==="user"&&x.alter("push",{contact:N[i],selected:!1});return y=new c("user",k,"questions","_view/questionsbyauthor",{key:n.get("uid"),descending:!0}),b=new c("contact",k,"questions","_view/questionsbyauthor",{key:'"Blank_List"',descending:!0}),blank=new c("contact",k,"questions","_view/questionsbyauthor",{key:'"Blank_List"',descending:!0}),v.getStack().add("#mytwoq",y),v.getStack().add("#contacttwoq",b),v.getStack().add("#blank",blank),y.init().then(function(){v.getStack().show("#mytwoq"),S.set("view","#mytwoq"),m.init(0),g.init("default")}),d}}),define("connect/connect",["Olives/OObject","service/map","Amy/Stack-plugin","service/submenu","./contacts/contacts","./messages/messages","./twocents/mytwocents","service/config"],function(e,t,n,r,i,s,o,u){return function(){var f=new e,l=new n,c=u.get("observer"),h=function(t){l.getStack().show(t)},p=new r(t.get("connect-menu"),h);return f.plugins.add("connectstack",l),f.alive(t.get("connect")),f.showMenu=function(){p.toggleActive(!0)},f.hideMenu=function(){p.toggleActive(!1)},p.toggleActive(!1),l.getStack().add("#messages",new s),l.getStack().add("#contacts",new i),l.getStack().add("#twocents",new o),l.getStack().show("#messages"),c.watch("display-message",function(e){l.getStack().show("#messages")}),c.watch("display-twoq",function(){l.getStack().show("#twocents")}),c.watch("display-twoc",function(){l.getStack().show("#twocents")}),c.watch("message-contact",function(){l.getStack().show("#messages")}),f}}),define("dashboard/profile/leaderboard",["Olives/OObject","service/config","Olives/Model-plugin","Olives/Event-plugin","CouchDBStore","service/utils","service/avatar"],function(e,t,n,r,i,s,o){return new function(){var a=new e,f=new i([]);return a.template='<div><ul data-leaders="foreach"><li class="leader"><div data-leaders="bind:setAvatar, value.userid"></div><div class="username" data-leaders="bind:innerHTML, value.username">Username</div><div class="distinction" data-leaders="bind:setDistinction, value.ip"></div><div class="grade" data-leaders="bind:setGrade, value.ip"></div><div class="score" data-leaders="bind: setScore, value.ip"></div></li></ul></div>',a.plugins.addAll({leaders:new n(f,{setAvatar:function(e){var t,n;n=document.createDocumentFragment(),t=new o([e]),t.place(n),this.hasChildNodes()?this.replaceChild(n,this.firstChild):this.appendChild(n)},setGrade:function(e){var t=this;s.getGrade(e,function(e){t.setAttribute("style","background: url('img/profile/"+e.grade.badge+"') no-repeat center center; background-size: 40px 40px;")})},setDistinction:function(e){var t=this;s.getGrade(e,function(e){e.distinction&&t.setAttribute("style","background: url('img/profile/"+e.distinction.badge+"') no-repeat center center; background-size: 40px 40px;")})},setScore:function(e){this.innerHTML=e+" ip"}}),leaderevent:new r(a)}),a.init=function(n){f.setTransport(t.get("transport")),f.sync(t.get("db"),"users","_view/leaderboard",{limit:100,descending:!0}).then(function(){a.place(n)})},a}}),define("dashboard/profile/editprofile",["Olives/OObject","service/config","Olives/Model-plugin","Olives/Event-plugin","service/avatar","service/utils","Store"],function(e,t,n,r,i,s,o){return new function(){var u=new e,a=t.get("user"),f=new o,l=[{name:"azur",file:"img/avatars/deedee0.png",selected:!1},{name:"blue",file:"img/avatars/deedee1.png",selected:!1},{name:"green",file:"img/avatars/deedee2.png",selected:!1},{name:"grey",file:"img/avatars/deedee3.png",selected:!1},{name:"orange",file:"img/avatars/deedee4.png",selected:!1},{name:"red",file:"img/avatars/deedee5.png",selected:!1},{name:"yellow",file:"img/avatars/deedee6.png",selected:!1}],c=new o(l),h={},p=new o({status:null}),d=t.get("labels"),v=80,m=80,g=function(e){var t=e.getContext("2d");t.clearRect(0,0,e.width,e.height)},y=function(e){var t,n,r=document.createElement("canvas"),i=r.getContext("2d");return t=e.width,n=e.height,t<n?(n*=v/t,t=v):(t*=m/n,n=m),r.width=t,r.height=n,i.drawImage(e,0,0,t,n),r.toDataURL("image/png")},b=function(e){var t=new Image,n=document.createElement("canvas"),r=document.getElementById("avatarcanvas"),i=n.getContext("2d"),s=r.scrollWidth,o=r.scrollHeight,u,a;t.src=e,setTimeout(function(){n.width=s,n.height=o,u=Math.floor(Math.max(0,(t.width-s)/2)),a=Math.floor(Math.max(0,(t.height-o)/2)),i.drawImage(t,u,a,s,o,0,0,s,o),f.set("avatar",n.toDataURL("image/png"))},300)},w=function(e){var t="/upload",n=new FormData;n.append("type","avatar"),n.append("filename",h.picture_file),n.append("img",f.get("avatar")),s.uploadFile(t,n,p,function(e){e.response!=="ok"&&console.log(e)})};return u.plugins.addAll({label:new n(d),avatars:new n(c,{setPic:function(e){this.setAttribute("style","background-image: url('"+e+"');background-repeat: no-repeat; background-position: center center; background-size: cover;")},setChecked:function(e){e?this.innerHTML="&#10003;":this.innerHTML=""}}),progress:new n(p,{showProgress:function(e){var t=0;e&&(t=Math.floor(e/100*80)),this.setAttribute("style","width:"+t+"px;"),e===100?this.innerHTML=d.get("uploadcomplete"):this.innerHTML=""}}),profile:new n(f,{setAvatar:function(e){this.setAttribute("style","background-image: url('"+e+"');background-repeat: no-repeat; background-position: center center; background-size: cover;")},setDay:function(e){e[2]&&(this.value=e[2])},setMonth:function(e){var t=e[1]||0;this.value=this.options[t].innerHTML},setYear:function(e){e[0]&&(this.value=e[0])},setFamilyStatus:function(e){if(e||e===0)this.selectedIndex=e},setChildren:function(e){if(e||e===0)this.selectedIndex=e},setSituation:function(e){if(e||e===0)this.selectedIndex=e},setLeisureName:function(e){var t=this,n=t.getAttribute("name");[0,1,2].forEach(function(r){e[r]&&n.search(r)>0&&(t.value=e[r].name)})},setLeisureDesc:function(e){var t=this,n=t.getAttribute("name");[0,1,2].forEach(function(r){e[r]&&n.search(r)>0&&(t.value=e[r].comment)})},setInterestName:function(e){var t=this,n=t.getAttribute("name");[0,1,2].forEach(function(r){e[r]&&n.search(r)>0&&(t.value=e[r].name)})},setInterestDesc:function(e){var t=this,n=t.getAttribute("name");[0,1,2].forEach(function(r){e[r]&&n.search(r)>0&&(t.value=e[r].comment)})}}),editprofileevent:new r(u)}),u.template='<div><div class = "setavatar"><canvas id ="avatarcanvas" class="currentavatar" data-profile="bind:setAvatar, avatar" data-editprofileevent="listen:touchstart, changeAvatar"></canvas><div id="rotate" class="invisible" data-editprofileevent="listen:touchstart, rotateAvatar"></div><div id="changeavatar" class="invisible"><div class="avatarcache"></div><div class="importbutton" data-editprofileevent="listen: touchstart, selectpress; listen:touchend, picturePreview" data-label="bind:innerHTML, importpiclbl"></div><div class="importbutton" data-editprofileevent="listen: touchstart, selectpress; listen:touchend, cameraPreview" data-label="bind:innerHTML, importcameralbl"></div><p data-label="bind:innerHTML, selectavatar"></p><ul class="defaultlist" data-avatars="foreach"><li><div class="defaultAvatar" data-avatars="bind: setPic, file"></div><div class="checkbox" data-avatars="bind: setChecked, selected" data-editprofileevent="listen: touchend, setDefaultAvatar"></div></li></ul></div></div><form class="profileinfo"><div class = "username"><div class = "firstname"><label data-label="bind:innerHTML, firstnameplaceholder"></label><input class="input" name="firstname" type="text" data-profile="bind: value, firstname" data-editprofileevent="listen: input, updateField"></div><div class = "lastname"><label data-label="bind:innerHTML, lastnameplaceholder"></label><input class="input" type="text" name="lastname" data-profile="bind: value, lastname" data-editprofileevent="listen: input, updateField"></div></div><label data-label="bind:innerHTML, profileintro"></label><input class="input" name="intro" type="text" data-profile="bind:value, intro" data-label="bind:placeholder, shortprofiledesc" data-editprofileevent="listen: input, updateField"><label data-label="bind:innerHTML, dob"></label><div class="dob"><input class="day" name="day" type="text" data-label="bind:placeholder, day" data-profile="bind: setDay, birthdate" data-editprofileevent="listen:input, updateDate"><select name="month" data-profile="bind: setMonth, birthdate" data-editprofileevent="listen:change, updateDate"><option data-label="bind:innerHTML, jan"></option><option data-label="bind:innerHTML, feb"></option><option data-label="bind:innerHTML, mar"></option><option data-label="bind:innerHTML, apr"></option><option data-label="bind:innerHTML, may"></option><option data-label="bind:innerHTML, jun"></option><option data-label="bind:innerHTML, jul"></option><option data-label="bind:innerHTML, aug"></option><option data-label="bind:innerHTML, sep"></option><option data-label="bind:innerHTML, oct"></option><option data-label="bind:innerHTML, nov"></option><option data-label="bind:innerHTML, dec"></option></select><input class="year" name="year" type="text" data-label="bind:placeholder,year" data-profile="bind: setYear, birthdate" data-editprofileevent="listen:input, updateDate"></div><div class="postal"><label class="streetaddress" data-label="bind:innerHTML, mailaddress"></label><input class="streetaddress input" name="street1" type="text" data-label="bind:placeholder, street" data-profile="bind:value, address.street1" data-editprofileevent="listen:input, updateAddress"><div class="city"><label data-label="bind:innerHTML, city"></label><input class="input city" name="city" type="text" data-profile="bind:value, address.city" data-editprofileevent="listen:input, updateAddress"></div><div class="zipstate"><div class="state"><label data-label="bind:innerHTML, state"></label><input class="input" name="state" type="text" data-profile="bind:value, address.state" data-editprofileevent="listen:input, updateAddress"></div><div class="zip"><label data-label="bind:innerHTML, zip"></label><input class="input" name="zip" type="text" data-profile="bind:value, address.zip" data-editprofileevent="listen:input, updateAddress"></div></div><label data-label="bind:innerHTML, country"></label><input class="input" name="country" type="text" data-profile="bind:value, address.country" data-editprofileevent="listen:input, updateAddress"></div><label data-label="bind:innerHTML, myfamily"></label><div class="family"><select class="status" name="couple" data-profile="bind: setFamilyStatus, family.couple" data-editprofileevent="listen:change, updateFamily"><option data-label="bind:innerHTML, single"></option><option data-label="bind:innerHTML, married"></option><option data-label="bind:innerHTML, divorced"></option><option data-label="bind:innerHTML, widow"></option><option data-label="bind:innerHTML, relation"></option></select><select class="children" name="children" data-profile="bind: setChildren, family.children" data-editprofileevent="listen:change, updateFamily"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8+</option></select><label data-label="bind:innerHTML, children"></label></div><label data-label="bind:innerHTML, myoccupation"></label><div class="job"><select class="status" name="situation" data-profile="bind: setSituation, occupation.situation" data-editprofileevent="listen:change, updateJob"><option data-label="bind:innerHTML, student"></option><option data-label="bind:innerHTML, active"></option><option data-label="bind:innerHTML, retired"></option><option data-label="bind:innerHTML, unemployed"></option><option data-label="bind:innerHTML, stayathome"></option></select><div class="jobdesc"><label data-label="bind:innerHTML, jobtitle"></label><input class="input" type="text" name="job" data-profile="bind:value, occupation.job" data-label="bind:placeholder, jobtitle" data-editprofileevent="listen:input, updateJob"></div><div class="org"><label data-label="bind:innerHTML, organization"></label><input class="input" name="organization" type="text" data-profile="bind:value, occupation.organization" data-label="bind:placeholder,organization" data-editprofileevent="listen:input, updateJob"></div></div></form><form class="addtlinfo"><legend data-label="bind:innerHTML, socialnwlbl"></legend><ul class="socialnw"><li class="fb"><input class="input" type="text" name="facebook" data-profile="bind: value, facebook" data-editprofileevent="listen: input, updateField"></li><li class="gp"><input class="input" name="gplus" type="text" data-profile="bind: value, gplus" data-editprofileevent="listen: input, updateField"></li><li class="lin"><input class="input" name="linkedin" type="text" data-profile="bind: value, linkedin" data-editprofileevent="listen: input, updateField"></li><li class="tw"><input class="input" name="twitter" type="text" data-profile="bind: value, twitter" data-editprofileevent="listen: input, updateField"></li></ul><legend data-label="bind:innerHTML, hobbieslbl"></legend><label data-label="bind:innerHTML, name"></label><label class="description" data-label="bind:innerHTML, comment"></label><input name="leisure0" class="input" type="text" data-profile="bind: setLeisureName, leisure_activities" data-editprofileevent="listen: input, updateLeisureName"><input class="input description" name="leisure0" type="text" data-profile="bind: setLeisureDesc, leisure_activities" data-editprofileevent="listen: input, updateLeisureDesc"><input name="leisure1" class="input" type="text"  data-profile="bind: setLeisureName, leisure_activities" data-editprofileevent="listen: input, updateLeisureName"><input class="input description" name="leisure1" type="text" data-profile="bind: setLeisureDesc, leisure_activities" data-editprofileevent="listen: input, updateLeisureDesc"><input class="input" name="leisure2" type="text" data-profile="bind: setLeisureName, leisure_activities" data-editprofileevent="listen: input, updateLeisureName"><input class="input description" name="leisure2" type="text" data-profile="bind: setLeisureDesc, leisure_activities" data-editprofileevent="listen: input, updateLeisureDesc"><legend data-label="bind:innerHTML, interestslbl"></legend><label data-label="bind:innerHTML, field"></label><label class="description" data-label="bind:innerHTML, comment"></label><input class="input" name="interest0" type="text" data-profile="bind: setInterestName, interests" data-editprofileevent="listen: input, updateInterestName"><input class="input description" name="interest0" type="text" data-profile="bind: setInterestDesc, interests" data-editprofileevent="listen: input, updateInterestDesc"><input class="input" name="interest1" type="text" data-profile="bind: setInterestName, interests" data-editprofileevent="listen: input, updateInterestName"><input class="input description" name="interest1" type="text" data-profile="bind: setInterestDesc, interests" data-editprofileevent="listen: input, updateInterestDesc"><input class="input" name="interest2" type="text" data-profile="bind: setInterestName, interests" data-editprofileevent="listen: input, updateInterestName"><input class="input description" name="interest2" type="text" data-profile="bind: setInterestDesc, interests" data-editprofileevent="listen: input, updateInterestDesc"></form><div class="useascharacter"></div><p class="update"><label class="cancelprofile" data-label="bind:innerHTML, cancellbl" data-editprofileevent="listen: touchstart, press; listen:touchend, cancel"></label><label class="updateprofile" data-label="bind:innerHTML, updatelbl" data-editprofileevent="listen:touchstart, press; listen:touchend, update"></label><label class="editerror" data-errormsg="bind:innerHTML, errormsg"></label></p><div class="uploadprogress" data-progress="bind:showProgress, status"></div></div>',u.init=function(t){u.reset(),u.place(t)},u.selectpress=function(e,t){t.classList.add("pressed")},u.cameraPreview=function(e,t){function i(e){n.src=e,setTimeout(function(){b(y(n)),h.picture_file=a.get("_id")+"_@v@t@r",document.getElementById("changeavatar").classList.add("invisible"),t.classList.remove("pressed")},1e3)}function s(e){alert("error: "+e)}var n=new Image,r={quality:50,correctOrientation:!0};navigator.camera.getPicture(i,s,r)},u.picturePreview=function(e,t){function s(e){r.src=e,setTimeout(function(){b(y(r)),h.picture_file=a.get("_id")+"_@v@t@r",document.getElementById("changeavatar").classList.add("invisible"),t.classList.remove("pressed")},1e3)}function o(e){alert("error: "+e)}var n=navigator.camera.PictureSourceType.PHOTOLIBRARY,r=new Image,i={quality:50,correctOrientation:!0,sourceType:n};navigator.camera.getPicture(s,o,i)},u.changeAvatar=function(e,t){document.getElementById("changeavatar").classList.remove("invisible"),p.set("status",0)},u.setDefaultAvatar=function(e,t){var n=t.getAttribute("data-avatars_id");c.loop(function(e,t){t===parseInt(n)?c.update(t,"selected",!0):c.update(t,"selected",!1)}),f.set("avatar",c.get(n).file),h.picture_file=c.get(n).file,document.getElementById("changeavatar").classList.add("invisible")},u.rotateAvatar=function(e,t){var n=document.createElement("canvas"),r=n.getContext("2d"),i=new Image;i.src=f.get("avatar"),setTimeout(function(){console.log(i.height,i.width),n.width=i.width,n.height=i.height,r.translate(n.width/2,n.height/2),r.rotate(Math.PI/2),r.translate(-n.height/2,-n.width/2),r.drawImage(i,0,0),f.set("avatar",n.toDataURL("image/png"))},300)},u.reset=function(){f.reset(JSON.parse(a.toJSON())),f.set("avatar",t.get("avatar")),c.reset(l),h={},f.get("picture_file").search("img/avatars/deedee")>-1&&c.loop(function(e,t){f.get("picture_file").search(e.file)>-1&&c.update(t,"selected",!0)})},u.updateField=function(e,t){var n=t.getAttribute("name");h[n]=t.value,f.set(n,t.value)},u.updateDate=function(e,t){var n=f.get("birthdate"),r=t.getAttribute("name"),i;switch(r){case"year":n[0]=t.value;break;case"month":n[1]=t.selectedIndex;break;case"day":n[2]=t.value}f.set("birthdate",n),h.birthdate=n},u.updateAddress=function(e,t){var n=f.get("address"),r=t.getAttribute("name");n[r]=t.value,f.set("address",n),h.address=n},u.updateFamily=function(e,t){var n=t.getAttribute("name"),r=f.get("family");r[n]=t.selectedIndex,f.set("family",r),h.family=r},u.updateJob=function(e,t){var n=f.get("occupation"),r=t.getAttribute("name"),i;switch(r){case"situation":n.situation=t.selectedIndex;break;case"job":n.job=t.value;break;case"organization":n.organization=t.value}console.log(n,f.get("occupation")),h.occupation=n},u.updateLeisureName=function(e,t){var n=t.getAttribute("name"),r=n.charAt(n.length-1),i=f.get("leisure_activities");i[r].name=t.value,f.set("leisure_activities",i),h.leisure_activities=i},u.updateLeisureDesc=function(e,t){var n=t.getAttribute("name"),r=n.charAt(n.length-1),i=f.get("leisure_activities");i[r].comment=t.value,f.set("leisure_activities",i),h.leisure_activities=i},u.updateInterestName=function(e,t){var n=t.getAttribute("name"),r=n.charAt(n.length-1),i=f.get("interests");i[r].name=t.value,f.set("interests",i),h.interests=i},u.updateInterestDesc=function(e,t){var n=t.getAttribute("name"),r=n.charAt(n.length-1),i=f.get("interests");i[r].comment=t.value,f.set("interests",i),h.interests=i},u.press=function(e,t){t.classList.add("pressed")},u.cancel=function(t,n){n.classList.remove("pressed"),document.querySelector(".userdetails").classList.remove("invisible"),document.querySelector(".edituserdetails").classList.add("invisible")},u.update=function(n,r){var i,s=0;r.classList.remove("pressed");for(i in h)a.set(i,h[i]),s++;s?a.upload().then(function(){console.log(h),h.picture_file&&t.set("avatar",f.get("avatar")),h.picture_file&&h.picture_file.search("img/avatars/deedee")<0&&(w(),document.getElementById("rotate").classList.add("invisible")),t.get("observer").notify("profile-updated"),document.querySelector(".edituserdetails").classList.add("invisible"),document.querySelector(".userdetails").classList.remove("invisible")}):(document.querySelector(".userdetails").classList.remove("invisible"),document.querySelector(".edituserdetails").classList.add("invisible"))},u}}),define("dashboard/profile/profile",["Olives/OObject","service/map","Olives/Model-plugin","Olives/Event-plugin","service/config","Store","service/utils","./leaderboard","./editprofile","Promise"],function(e,t,n,r,s,o,u,a,f,c){return function(){var p=new e,d=s.get("user"),v=d.get("ip"),m=s.get("labels"),g=new o({total:0,ideas:0,sessions:0,contacts:0,twoQ:0}),y=new o({status:""}),b=new o({view:"info",completion:0,socialnw:0}),w=new o(d.get("news")),E,S,x=new o([]),T=new o;return p.plugins.addAll({label:new n(m),stats:new n(b,{setViewLbl:function(e){this.innerHTML=m.get(e)},toggleInformation:function(e){e==="info"?this.classList.remove("invisible"):this.classList.add("invisible")},toggleLeaderboard:function(e){e==="leaderboard"?this.classList.remove("invisible"):this.classList.add("invisible")},setPercentage:function(e){this.innerHTML=m.get("completionprefix")+e+m.get("completionsuffix")},setProgress:function(e){e===100?this.setAttribute("style","width:100%;border-top-right-radius:5px;border-bottom-right-radius:5px;"):this.setAttribute("style","width:"+e+"%;")},showDetails:function(e){e===100?this.classList.add("invisible"):this.classList.remove("invisible")},showSocialNW:function(e){e?this.classList.remove("invisible"):this.classList.add("invisible")}}),grades:new n(x,{showBadge:function(e){this.setAttribute("style","background: url('img/profile/"+e+"') no-repeat center center; background-size: cover;")}}),achievements:new n(T,{showBadge:function(e){this.setAttribute("style","background: url('img/profile/"+e+"') no-repeat center center; background-size: cover;")}}),progressbar:new n(g,{setWidth:function(e){this.setAttribute("style","width:"+e+"%;")}}),progress:new n(y),config:new n(s,{setAvatar:function(e){this.setAttribute("style","background: url('"+e+"') no-repeat center center;background-size:cover;")}}),user:new n(d,{setLocation:function(e){e.country?this.innerHTML=e.country.toUpperCase():this.innerHTML=m.get("completeprofile"),e.city&&e.country&&(this.innerHTML=e.city+", "+e.country.toUpperCase()),e.city&&e.state&&e.country&&(this.innerHTML=e.city+", "+e.state.toUpperCase()+" "+e.country.toUpperCase())},setAge:function(e){var t=new Date,n,r;e&&e.length===3?(n=new Date(e[0],e[1],e[2]),r=t.getTime()-n.getTime(),this.innerHTML=Math.floor(r/1e3/3600/24/365)+" "+m.get("agelbl")):this.innerHTML=m.get("completeprofile")},setFamily:function(e){var t=e.couple,n=e.children,r,i;t===null?r=m.get("completeprofile"):t===0?r=m.get("singlelbl"):t===1?r=m.get("marriedlbl"):t===2?r=m.get("divorcedlbl"):t===3&&(r=m.get("widowlbl")),!n||n===0?i="":(d.get("age")<20?n===1?i=n+m.get("onesiblinglbl"):i=n+m.get("siblingslbl"):n===1?i=n+m.get("onechildlbl"):i=n+m.get("childrenlbl"),i=", "+i),this.innerHTML=r+i},setOccupation:function(e){e.situation===4?this.innerHTML=m.get("stayathome"):e.situation===3?this.innerHTML=m.get("unemployed"):e.situation===0?e.organization?this.innerHTML=m.get("student")+" @ "+e.organization:this.innerHTML=m.get("student"):e.situation===2?e.job?this.innerHTML=e.job+" ("+m.get("retired")+")":this.innerHTML=m.get("retired"):e.situation===1?!e.job&&!e.organization?this.innerHTML=m.get("active"):e.job&&!e.organization?this.innerHTML=e.job:!e.job&&e.organization?this.innerHTML=m.get("active")+" @ "+e.organization:this.innerHTML=e.job+" @ "+e.organization:this.innerHTML=m.get("completeprofile")},showLeisure:function(e){e[0].name||e[1].name||e[2].name?this.classList.remove("invisible"):this.classList.add("invisible")},setLeisure:function(e){var t="<ul>";if(e&&e.length){for(i=0;i<e.length;i++)e[i].comment?t+="<li>"+e[i].name+" ("+e[i].comment+")</li>":t+="<li>"+e[i].name+"</li>";this.innerHTML=t+"</ul>"}else this.innerHTML=""},showInterests:function(e){e[0].name||e[1].name||e[2].name?this.classList.remove("invisible"):this.classList.add("invisible")},setInterests:function(e){var t="<ul>";if(e&&e.length){for(i=0;i<e.length;i++)e[i].comment?t+="<li>"+e[i].name+" ("+e[i].comment+")</li>":t+="<li>"+e[i].name+"</li>";this.innerHTML=t+"</ul>"}else this.innerHTML=""},showSN:function(e){e?this.innerHTML=e:this.innerHTML=""},setSessionCount:function(e){var t=d.get("su_sessions_count")||0,n=d.get("mu_sessions_count")||0;this.innerHTML=t+n},setContactCount:function(e){var t=0;for(i=0,l=e.length;i<l;i++)e[i].type==="user"&&t++;this.innerHTML=t},setBarLength:function(e){e>=3e5?this.setAttribute("style","width: 100%"):e>=3e4?this.setAttribute("style","width: 75%"):e>=3e3?this.setAttribute("style","width: 50%"):this.setAttribute("style","width: 25%")}}),news:new n(w,{setType:function(e){e.search("CX")>-1?this.setAttribute("style","background: url('img/profileDisable.png') no-repeat center center; background-size: contain;"):e.search("RWD")>-1||e.search("RANK")>-1?this.setAttribute("style","background: url('img/brainstorm/yourScore40.png') no-repeat center center; background-size: 40px;"):e.search("ID")>-1?this.setAttribute("style","background: url('img/libraryIdeaDisabled40.png') no-repeat center center; background-size: 40px;"):e.search("2Q")>-1?this.setAttribute("style","background: url('img/2questionDisable50.png') no-repeat center center; background-size: 40px;"):e.search("2CTS")>-1&&this.setAttribute("style","background: url('img/2centDisable.png') no-repeat center center; background-size: 40px;")},setContent:function(e){var t=this.getAttribute("data-news_id");switch(w.get(t).type){case"CX+":this.innerHTML="<span class='newsinfo'>"+w.get(t).content.username+"</span>"+m.get("isnowacontact");break;case"CX-":this.innerHTML="<span class='newsinfo'>"+w.get(t).content.username+"</span>"+m.get("isnolongeracontact");break;case"IDEA+":this.innerHTML=m.get("enterednewidea")+"<span class='newsinfo'>"+w.get(t).content.title+"</span>";break;case"SHID":this.innerHTML=m.get("sharedanidea")+"("+"<span class='newsinfo'>"+w.get(t).content.title+"</span>)";break;case"RANK":this.innerHTML=m.get("reachedrank")+"<span class='newsinfo'>"+w.get(t).content.label+"</span>";break;case"RWD":this.innerHTML=m.get("gotaward")+"<span class='newsinfo'>"+w.get(t).content.label+"</span>";break;case"2Q+":this.innerHTML=m.get("posted2q")+"<span class='newsinfo'>"+w.get(t).content.question+"</span>";break;case"2CTS":this.innerHTML=m.get("commentedon")+"<span class='newsinfo'>"+w.get(t).content.title+"</span>"+m.get("by")+w.get("id").content.username}},formatDate:function(e){this.innerHTML=u.formatDate(e)}}),profileevent:new r(p)}),p.template='<div id="dashboard-profile"><div class="header blue-dark"><span data-label="bind:innerHTML, profilelbl"></span></div><input class="infoslider" type="range" min="0" max="1" value ="0" data-profileevent="listen:touchend, switchLeaderboard"><span class="slidertext" data-stats="bind:setViewLbl, view"></span><div id="profile-content" data-stats="bind:toggleInformation, view"><div class="leftprofile"><div class="userdetails"><div class="editbtn" data-profileevent="listen:touchstart, edit"></div><div class="cd-picarea"><div class="cardpicture" data-config="bind:setAvatar, avatar"></div><div class="cardinfo"><h2 data-user="bind:innerHTML,username"></h2><blockquote data-user="bind:innerHTML, intro"></blockquote><p><span class="cd-agelbl"></span><span data-user="bind:setAge, birthdate"></span></p><p><span class="cd-locationlbl"></span><span class="cd-info" data-user="bind: setLocation, address"></span></p><p><span class="cd-joblbl"></span><span class="cd-info" data-user="bind: setOccupation, occupation"></span></p><p><span class="cd-familylbl"></span><span class="cd-info" data-user="bind: setFamily, family"></span></p></div></div><div class="cd-contentarea"><div data-user="bind:showLeisure, leisure_activities"><span class="contentTitle" data-label="bind: innerHTML, hobbieslbl"></span><p class = "userinfo" data-user="bind:setLeisure, leisure_activities"></p></div><div data-user="bind:showInterests, interests"><span class="contentTitle" data-label="bind: innerHTML, interestslbl">Centers of interest</span><p class = "userinfo" data-user="bind: setInterests, interests"></p></div><div data-stats="bind:showSocialNW, socialnw"><span class="contentTitle" data-label="bind: innerHTML, socialnwlbl"></span><p class = "userinfo fb" data-user="bind:showSN, facebook"></p><p class = "userinfo gp" data-user="bind:showSN, gplus; bind:innerHTML"></p><p class = "userinfo tw" data-user="bind:showSN, twitter"></p><p class = "userinfo lin" data-user="bind:showSN, linkedin"></p></div></div><div><legend data-stats="bind: setPercentage, completion"></legend><div class="completionbar"><div class="innerbar" data-stats = "bind:setProgress, completion"></div></div></div></div><div class="edituserdetails invisible"></div><div class="mystats"><legend data-label="bind:innerHTML, mystatslbl"></legend><div class="completionbar"><ul data-user="bind: setBarLength, ip"><li class="innerbar myids" data-progressbar="bind: setWidth, ideas"></li><li class="innerbar myss" data-progressbar="bind:setWidth, sessions"></li><li class="innerbar myctcts" data-progressbar="bind: setWidth, contacts"></li><li class="innerbar my2q" data-progressbar="bind:setWidth, twoQ"></li></ul></div><table><tr class ="myids"><th data-label="bind:innerHTML, ideaslbl"></th><td data-user="bind: innerHTML, ideas_count"></td></tr><tr class ="myss"><th data-label="bind:innerHTML, sessionslbl"></th><td data-user="bind: setSessionCount, ip"></td></tr><tr class="myctcts"><th data-label="bind:innerHTML, contactslbl"></th><td data-user="bind: setContactCount, connections"></td></tr><tr class="my2q"><th data-label="bind:innerHTML, toquestionslbl"></th><td data-user="bind: innerHTML, twoquestions_count"></td></tr></table></div><div class="recentactivity"><legend data-label="bind:innerHTML, recentactivitylbl"></legend><ul data-news="foreach"><li><div class="newstype" data-news="bind:setType, type"></div><div class="newsdate" data-news="bind:formatDate, date"></div><p class="newstext" data-news="bind:setContent, content"></p></li></ul></div></div><div class = "rightprofile"><div class="userscore"><span class="ip" data-user="bind:innerHTML, ip"></span><span data-label="bind:innerHTML, ideafypoints"></span></div><div class="userachievements"><h2 class="grade" data-stats="bind:innerHTML, title"></h2><ul class="badges" data-grades="foreach"><li class="badge"><div data-grades="bind:showBadge, badge"></div><legend data-grades="bind:innerHTML, title"></legend></li></ul><ul class="badges" data-achievements="foreach"><li class="badge"><div data-achievements="bind:showBadge, badge"></div><legend data-achievements="bind:innerHTML, label"></legend></li></ul></div></div></div><div id="leaderboard" data-stats="bind:toggleLeaderboard, view"></div></div>',p.place(t.get("dashboard-profile")),p.switchLeaderboard=function(e,t){var n=document.getElementById("leaderboard"),r=document.getElementById("profile-content");E||(E=a,E.init(n)),t.value==1?(t.setAttribute("style","background: #5F8F28;"),b.set("view","leaderboard")):(t.setAttribute("style","background: #9AC9CD;"),b.set("view","info"))},p.edit=function(e,t){var n=document.querySelector(".edituserdetails");document.querySelector(".userdetails").classList.add("invisible"),S?S.reset():(S=f,S.init(n)),n.classList.remove("invisible")},s.get("observer").watch("profile-updated",function(e){p.checkProfileCompletion().then(function(){u.getGrade(d.get("ip"),function(e){p.updateGrade(e)}),u.getAchievements(d.get("_id"),function(e){e.length&&p.updateAchievements(e)})})}),d.watchValue("ip",function(){u.getGrade(d.get("ip"),function(e){p.updateGrade(e)}),p.updateProgressBar()}),d.watchValue("tutorial_complete",function(){p.updateGrade(),p.updateAchievements()}),d.watchValue("settings",function(){p.updateGrade(),p.updateAchievements()}),d.watchValue("news",function(){w.reset(d.get("news"))}),p.checkProfileCompletion=function(){var e=u.checkProfileCompletion(),t=new c;return b.set("completion",e.percentage),b.set("missing",e.missing),e.missing.indexOf(m.get("entersocialnw"))<0&&b.set("socialnw",1),e.percentage===100&&d.get("profile_complete")!==!0?(d.set("profile_complete",!0),d.upload().then(function(){t.resolve()})):e.percentage<100&&d.get("profile_complete")?(d.set("profile_complete",!1),d.upload().then(function(){t.resolve()})):t.resolve(),t},p.updateGrade=function(){u.getGrade(d.get("ip"),function(e){var t;e.distinction?t=[e.grade,e.distinction]:t=[e.grade],x.reset(t),b.set("title",e.grade.label)})},p.updateAchievements=function(){u.getAchievements(d.get("_id"),function(e){e.length&&T.reset(e)})},p.updateProgressBar=function(){var t,n,r,i,s,o,u,a,f;n=d.get("ideas_count"),i=d.get("su_sessions_count")||0,s=d.get("mu_sessions_count")||0,r=i+s,u=d.get("twoquestions_count")||0,o=0;for(a=0,f=d.get("connections").length;a<f;a++)d.get("connections")[a].type==="user"&&o++;t=n+u+o+r,g.set("total",t),g.set("ideas",Math.floor(n/t*100)),g.set("contacts",Math.floor(o/t*100)),g.set("sessions",Math.floor(r/t*100)),g.set("twoQ",Math.floor(u/t*100))},p.checkProfileCompletion().then(function(){p.updateGrade(),p.updateAchievements()}),p.updateProgressBar(),USR=d,p}}),define("dashboard/settings/settings",["Olives/OObject","service/map","Olives/Model-plugin","Olives/Event-plugin","service/config","Store","service/utils"],function(e,t,n,r,i,s,o){return function(){var a=new e,f=i.get("labels"),l=[{name:f.get("public"),dest:"#public"},{name:f.get("library"),dest:"#library"},{name:f.get("brainstorm"),dest:"#brainstorm"},{name:f.get("connect"),dest:"#connect"},{name:f.get("dashboard"),dest:"#dashboard"}],c=[{name:f.get("everymin"),value:6e4},{name:f.get("everyfive"),value:3e5},{name:f.get("everyfifteen"),value:9e5},{name:f.get("never"),value:864e5}],h=new s({screens:l,timers:c,pwd:"",pwdbis:"",lang:[],pwdchange:""}),p=new s,d=i.get("transport"),v=i.get("user");return a.plugins.addAll({label:new n(f),options:new n(h,{setLang:function(e){var t,n,r="";for(t=0,n=e.length;t<n;t++)r+="<option>"+e[t]+"</option>";this.innerHTML=r,this.selectedIndex=e.indexOf(v.get("lang"))},setStartupScreen:function(e){var t,n,r="",i,s;for(t=0,n=e.length;t<n;t++)r+="<option>"+e[t].name+"</option>",e[t].dest===v.get("settings").startupScreen&&(s=t);this.innerHTML=r,this.selectedIndex=s},setPollingInterval:function(e){var t,n,r="",i,s;for(t=0,n=e.length;t<n;t++)r+="<option>"+e[t].name+"</option>",e[t].value===v.get("settings").polling_interval&&(s=t);this.innerHTML=r,this.selectedIndex=s}}),settings:new n(p),settingsevent:new r(a)}),a.template='<div id="dashboard-settings"><div class="header blue-dark"><span data-label="bind:innerHTML, settingslbl"></span></div><div class="settingscontent"><div class="settingmodule"><legend data-label="bind:innerHTML, userpref"></legend><ul><li><span data-label="bind:innerHTML, setlang"></span><select data-options="bind:setLang, lang" data-settingsevent="listen: change, updateLang"></select></li><li class="startupscreen"><span data-label="bind: innerHTML, choosestartup"></span><select data-options="bind:setStartupScreen, screens" data-settingsevent="listen: change, updateStartup"></select></li><li class="startupscreen"><span data-label="bind: innerHTML, choosepolling"></span><select data-options="bind:setPollingInterval, timers" data-settingsevent="listen: change, updatePollingInterval"></select></li><li class="setting-input"><input type="checkbox" data-settings="bind: checked, showTips" data-settingsevent="listen: change, showTips"><label data-label="bind:innerHTML, showtips"></label></li><li class="setting-input"><input type="checkbox" data-settings="bind: checked, notifyPopup" data-settingsevent="listen: change, showNotif"><label data-label="bind:innerHTML, shownotif"></label></li><li class="setting-input"><input type="checkbox" data-settings="bind: checked, useascharacter" data-settingsevent="listen: change, useAsChar"><label data-label="bind:innerHTML, usechar"></label></li><li><span data-label="bind: innerHTML, changepwd"></span><input class="input" type="password" data-label="bind:placeholder, passwordplaceholder" data-options="bind: value, pwd" data-settingsevent="listen: input, clearOK"><input class="input" type="password" data-label="bind:placeholder, repeatpasswordplaceholder" data-options="bind: value, pwdbis" data-settingsevent="listen: input, clearOK"><span class="changeok" data-options="bind: innerHTML, pwdchange"></span><div class="next-button" data-label="bind:innerHTML, changelbl" data-settingsevent="listen: touchstart, press; listen:touchend, changePWD"></div></li></ul></div><div class="settingmodule invisible"><legend data-label="bind:innerHTML, brainstormsettings"></legend><ul><li>Select deck</li><li>Set timers</li><li>Automatic card draws</li></ul></div></div></div>',a.place(t.get("dashboard-settings")),a.updateLang=function(t,n){n.value!==v.get("lang")&&o.updateLabels(n.value).then(function(){v.set("lang",n.value),v.upload(),h.set("timers",[{name:f.get("everymin"),value:6e4},{name:f.get("everyfive"),value:3e5},{name:f.get("everyfifteen"),value:9e5},{name:f.get("never"),value:864e5}]),h.set("screens",[{name:f.get("public"),dest:"#public"},{name:f.get("library"),dest:"#library"},{name:f.get("brainstorm"),dest:"#brainstorm"},{name:f.get("connect"),dest:"#connect"},{name:f.get("dashboard"),dest:"#dahsboard"}])})},a.updateStartup=function(t,n){var r=n.selectedIndex,i=v.get("settings");i.startupScreen=l[r].dest,v.set("settings",i),v.upload()},a.updatePollingInterval=function(t,n){var r=n.selectedIndex,i=v.get("settings");i.polling_interval=c[r].value,v.set("settings",i),v.upload()},a.showTips=function(e,t){var n=v.get("settings");n.showTips=t.checked,v.set("settings",n),v.upload().then(function(){console.log("upload successful")})},a.showNotif=function(e,t){var n=v.get("settings");n.showNotif=t.checked,v.set("settings",n),v.upload()},a.useAsChar=function(e,t){var n=v.get("settings");n.useascharacter=t.checked,v.set("settings",n),v.upload()},a.press=function(e,t){t.classList.add("pressed")},a.clearOK=function(e,t){h.set("pwdchange","")},a.changePWD=function(e,t){t.classList.remove("pressed"),h.get("pwd")!==h.get("pwdbis")?h.set("pwdbis",""):d.request("ChangePWD",{userid:v.get("_id"),pwd:h.get("pwd")},function(e){e==="ok"&&h.set("pwdchange","&#10003;")})},p.reset(v.get("settings")),v.watchValue("settings",function(e){p.reset(v.get("settings"))}),d.request("GetLanguages",{},function(e){h.set("lang",e)}),a}}),define("dashboard/about/aboutideafy",["Olives/OObject","service/config","Olives/Model-plugin","Store"],function(e,t,n,r){return function(){var s=new e,o=t.get("labels"),u=new r([{name:o.get("solene"),contrib:o.get("contribsolene")},{name:o.get("oliviers"),contrib:o.get("contribscherrer")},{name:o.get("olivierw"),contrib:o.get("contribwietrich")},{name:o.get("vincent"),contrib:o.get("contribvincent")}]);return s.plugins.addAll({labels:new n(o),credits:new n(u)}),s.template='<div class="aboutcontent"><legend data-labels="bind:innerHTML, aboutlbl"></legend><p data-labels="bind:innerHTML, ideafydesc"></p><legend data-labels="bind:innerHTML, about-taiaut"></legend><p data-labels="bind:innerHTML, taiautdesc"></p><legend data-labels="bind: innerHTML, credits"></legend><p><ul data-credits="foreach"><li><span class="contributor" data-credits="bind:innerHTML, name"></span><span class="contribution" data-credits="bind:innerHTML, contrib"></span></li></ul></p></div>',s}}),define("dashboard/about/faq",["Olives/OObject","service/config","CouchDBStore","Olives/Model-plugin","Olives/Event-plugin","Store"],function(e,t,n,r,i,s){return function(){var u=new e,a=new n,f=t.get("user");return faqlist=new s([]),u.plugins.addAll({faq:new r(faqlist),faqevent:new i(u)}),u.template='<div class="aboutcontent"><ul data-faq="foreach"><li><legend data-faq="bind:innerHTML, question"></legend><p data-faq="bind: innerHTML, response"></p></li></ul></div>',a.setTransport(t.get("transport")),u.fetch=function(n){a.unsync(),a.reset([]),faqlist.reset([]),a.sync(t.get("db"),"about","_view/faq").then(function(){a.loop(function(e,t){e.value.default_lang===n||!e.value.translations[n]?faqlist.alter("push",e.value):faqlist.alter("push",e.value.translations[n])})})},u.fetch(f.get("lang")),f.watchValue("lang",function(){u.fetch(f.get("lang"))}),u}}),define("dashboard/about/userguide",["Olives/OObject","service/config","CouchDBStore","Olives/Model-plugin","Olives/Event-plugin","Store"],function(e,t,n,r,i,s){return function(){var u=new e,a=new n,f=t.get("user"),l=t.get("labels"),c=new s([]);return u.plugins.addAll({label:new r(l),howto:new r(c),howtoevent:new i(u)}),u.template='<div class="aboutcontent"><div id="userguidetoc"><legend data-label="bind:innerHTML, toc"></legend><ul data-howto="foreach"><li><span data-howto="bind: innerHTML, title" data-howtoevent="listen: touchstart, press; listen:touchend, goto"></span></li></ul></div><br/><ul data-howto="foreach"><li data-howto="bind:id, _id"><legend data-howto="bind:innerHTML, title"></legend><p data-howto="bind: innerHTML, body"></p><span class="backtotop" data-label="bind:innerHTML, backtotop" data-howtoevent="listen: touchstart, backToTop"></span></li></ul></div>',u.press=function(e,t){t.setAttribute("style","font-weight: bold;")},u.goto=function(e,t){var n=t.getAttribute("data-howto_id"),r=c.get(n)._id;t.setAttribute("style","font-weight: normal;"),document.getElementById(r).scrollIntoView()},u.backToTop=function(e,t){document.getElementById("userguidetoc").scrollIntoView()},a.setTransport(t.get("transport")),u.fetch=function(n){a.unsync(),a.reset([]),c.reset([]),a.sync(t.get("db"),"about","_view/howto").then(function(){a.loop(function(e,t){e.value.default_lang===n||!e.value.translations[n]?c.alter("push",e.value):c.alter("push",e.value.translations[n])})})},u.fetch(f.get("lang")),f.watchValue("lang",function(){u.fetch(f.get("lang"))}),u}}),define("dashboard/about/tutorials",["Olives/OObject","service/config","Olives/Model-plugin","Store"],function(e,t,n,r){return function(){var s=new e,o=t.get("labels"),u=[{name:"brainstormtutorial",src:"http://37.153.96.26:1664/tuto04.m4v"}],a=new r(u);return s.plugins.addAll({labels:new n(o),tuto:new n(a,{setName:function(e){this.innerHTML=o.get(e)}})}),s.template='<div class="aboutcontent"><ul data-tuto="foreach"><li><legend data-tuto="bind: setName, name"></legend><div class="videocontent"><video width = "640" height="480" controls="controls"><source data-tuto="bind:src,src" type="video/mp4" /></video></div></li></ul></div>',s}}),define("dashboard/about/support",["Olives/OObject","service/config","Olives/Model-plugin","Olives/Event-plugin","Store"],function(e,t,n,r,i){return function(){var o=new e,u=t.get("labels"),a=new i({body:"",result:""});return o.plugins.addAll({labels:new n(u),support:new n(a),supportevent:new r(o)}),o.template='<div class="aboutcontent"><legend class="support" data-labels="bind:innerHTML, supportlegend"></legend><textarea class="input" data-labels="bind:placeholder, supportplaceholder" data-support="bind: value, body"></textarea><span data-support="bind:innerHTML, result"></span><div class="cancel" data-labels="bind: innerHTML, cancellbl" data-supportevent="listen: touchstart, press; listen: touchend, cancel"></div><div class="send" data-labels="bind: innerHTML, sendlbl" data-supportevent="listen: touchstart, press; listen: touchend, send"></div><div class="supportus"><legend data-labels="bind: innerHTML, twoway"></legend><p data-labels="bind: innerHTML, supportusintro"><ul><li><h4 data-labels="bind: innerHTML, asanideafyer"></h4><p data-labels="bind: innerHTML, ideafyerhelp"></p></li><li><h4 data-labels="bind: innerHTML, asanexec"></h4><p data-labels="bind: innerHTML, exechelp"></p></li><li><h4 data-labels="bind: innerHTML, asadev"></h4><p data-labels="bind: innerHTML, devhelp"></p></li><li><h4 data-labels="bind: innerHTML, asaninvest"></h4><p data-labels="bind: innerHTML, investhelp"></p></li></ul></p></div></div>',o.send=function(e,t){t.classList.remove("pressed"),o.sendRequest(a.get("body")),a.set("body","")},o.cancel=function(e,t){t.classList.remove("pressed"),a.set("body","")},o.press=function(e,t){t.classList.add("pressed")},o.sendRequest=function(n){var r={},i=new Date;r.request=n,r.date=i.getTime(),r.userid=t.get("user").get("_id"),t.get("transport").request("Support",r,function(e){e==="ok"?a.set("result",u.get("requestsent")):a.set("result",e),setTimeout(function(){a.set("result","")},3e3)})},o}}),define("dashboard/about/eula",["Olives/OObject","service/config","Olives/Model-plugin","CouchDBStore","Store"],function(e,t,n,r,i){return function(){var o=new e,u=t.get("user"),a=new i;return o.plugins.add("eula",new n(a)),o.template='<div class="aboutcontent"><h4 data-eula = "bind:innerHTML, title"></h4><div data-eula="bind:innerHTML, body"></div></div>',o.fetch=function(n){var i=new r;i.setTransport(t.get("transport")),i.sync(t.get("db"),"EULA").then(function(){i.get("default_lang")===n||!i.get("translations")[n]?(a.set("title",i.get("title")),a.set("body",i.get("body"))):(a.set("title",i.get("translations")[n].title),a.set("body",i.get("translations")[n].body))})},o.fetch(u.get("lang")),u.watchValue("lang",function(){o.fetch(u.get("lang"))}),o}}),define("dashboard/about/about",["Olives/OObject","service/map","Olives/Model-plugin","Olives/Event-plugin","Amy/Stack-plugin","service/config","Store","./aboutideafy","./faq","./userguide","./tutorials","./support","./eula"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){return function(){var d=new e,v=new i,m=s.get("labels"),g=[{name:"#about",label:m.get("aboutIdeafy"),currentUI:!1},{name:"#faq",label:m.get("faq"),currentUI:!1},{name:"#userguide",label:m.get("userguide"),currentUI:!1},{name:"#tutorials",label:m.get("tutorials"),currentUI:!1},{name:"#support",label:m.get("support"),currentUI:!1},{name:"#eula",label:m.get("eula"),currentUI:!1}],y=new o(g);return d.plugins.addAll({label:new n(m),aboutmenu:new n(y,{setCurrent:function(e){e?this.classList.add("pressed"):this.classList.remove("pressed")}}),aboutstack:v,aboutevent:new r(d)}),d.template='<div id="dashboard-about"><div class="header blue-dark"><span data-label="bind:innerHTML, aboutlbl"></span></div><div class = "progressbar"><ul id = "aboutmenu" class="steplist" data-aboutmenu="foreach"><li class="step" data-aboutmenu="bind: innerHTML, label; bind:setCurrent, currentUI" data-aboutevent="listen: touchstart, changeDisplay"></li></ul></div><div id="aboutstack" data-aboutstack="destination"></div></div>',d.place(t.get("dashboard-about")),d.changeDisplay=function(t,n){var r=n.getAttribute("data-aboutmenu_id");d.show(y.get(r).name)},d.show=function(t){var n;y.loop(function(e,r){y.update(r,"currentUI",!1),e.name===t&&(n=r)}),y.update(n,"currentUI",!0),v.getStack().show(y.get(n).name)},v.getStack().add("#about",new u),v.getStack().add("#faq",new a),v.getStack().add("#userguide",new f),v.getStack().add("#tutorials",new l),v.getStack().add("#support",new c),v.getStack().add("#eula",new h),v.getStack().show("#about"),y.update(0,"currentUI",!0),d}}),define("dashboard/dashboard",["Olives/OObject","service/map","service/submenu","Amy/Stack-plugin","./profile/profile","./settings/settings","./about/about","service/config"],function(e,t,n,r,i,s,o,u){return function(){var f=new e,l=new r,c=u.get("observer"),h=function(t){l.getStack().show(t)},p=new n(t.get("dashboard-menu"),h);return f.plugins.add("dashboardstack",l),f.alive(t.get("dashboard")),f.showMenu=function(){p.toggleActive(!0)},f.hideMenu=function(){p.toggleActive(!1)},p.toggleActive(!1),l.getStack().add("#profile",new i),l.getStack().add("#settings",new s),l.getStack().add("#about",new o),l.getStack().show("#profile"),u.get("observer").watch("display-tutorials",function(){l.getStack().getCurrentName()!=="#about"&&l.getStack().show("#about"),l.getStack().get("#about").show("#tutorials")}),f}}),define("notify",["Olives/OObject","service/config","service/map","Store","Olives/Model-plugin","Olives/Event-plugin","service/avatar"],function(e,t,n,r,s,o,u){return function(){var f=new e,c=new e,h=n.get("notify"),p=n.get("notify-popup"),d=t.get("user"),v=t.get("observer"),m=t.get("labels"),g=0,y=0,b=!0,w=new r({unread:0,newmsg:!1}),E=new r([]);return f.plugins.addAll({notif:new s(w,{flashNew:function(e){var t,n=this;e&&(t=setInterval(function(){n.classList.contains("orange")?n.classList.remove("orange"):n.classList.add("orange")},600),setTimeout(function(){clearInterval(t),n.classList.remove("orange"),w.set("newmsg",!1)},3e3))}}),notifevent:new o(f)}),f.template='<div><div class = "notif-bubble" data-notif="bind:innerHTML, unread"></div><div class="deedee" data-notif="bind:flashNew, newmsg" data-notifevent="listen: touchstart, press; listen:touchend, showPopup"></div></div>',f.place(h),f.getUnread=function(){var t=d.get("notifications"),n=0;for(i=0,l=t.length;i<l;i++)t[i].status==="unread"&&n++;return n},f.press=function(e,t){t.classList.add("orange")},f.showPopup=function(e,t){t.classList.remove("orange"),p.classList.add("show-notify")},c.plugins.addAll({labels:new s(m),notify:new s(E,{setObject:function(e){var t=this.getAttribute("data-notify_id");switch(e){case"CXR":this.innerHTML=E.get(t).username+m.get("CXRobject");break;case"CXRaccept":this.innerHTML=E.get(t).username+m.get("acceptedCXR");break;case"CXRreject":this.innerHTML=E.get(t).username+m.get("rejectedCXR");break;case"CXCancel":this.innerHTML=E.get(t).username+m.get("canceledCX");break;case"DOC":this.innerHTML=E.get(t).username+m.get("sentdocmsg");break;case"2Q+":this.innerHTML=E.get(t).username+m.get("askednew");break;case"2C+":this.innerHTML=E.get(t).username+m.get("senttc");break;default:this.innerHTML=E.get(t).object}},setStyle:function(e){e==="unread"?this.setAttribute("style","font-weight: bold;"):this.setAttribute("style","font-weight: normal;")},setAvatar:function(e){var t=document.createDocumentFragment(),n=new u([e]);n.place(t),this.hasChildNodes()?this.replaceChild(t,this.firstChild):this.appendChild(t)}}),notifyevent:new o(c)}),c.template='<div><div class="notify-header" data-labels="bind:innerHTML, notificationlbl" data-notifyevent="listen:touchstart, closePopup"></div><ul class="notify-list" data-notify="foreach: messages, 0, 7"><li data-notify="bind: setStyle, status" data-notifyevent="listen:touchstart, displayComCenter"><div data-notify="bind:setAvatar, author"></div><p><span class="notify-name" data-notify="bind:innerHTML, firstname"></span> : <span class="notify-body" data-notify="bind:setObject, type"></span></p></li></ul></div>',c.closePopup=function(t,n){p.classList.remove("show-notify")},c.displayComCenter=function(t,n){var r=n.getAttribute("data-notify_id");v.notify("display-message",r),c.closePopup()},f.init=function(){y=f.getUnread(),w.set("unread",y),w.set("newmsg",!1),E.reset(d.get("notifications")),c.place(p)},d.watchValue("notifications",function(){var e=f.getUnread();e>y?(w.set("newmsg",!0),w.set("unread",e),y=e,d.get("settings")&&d.get("settings").notifyPopup&&p.classList.add("show-notify")):e<y&&(w.set("unread",e),y=e),E.reset(d.get("notifications"))}),f}}),define("service/newidea",["Olives/OObject","service/map","Olives/Model-plugin","Olives/Event-plugin","service/config","CouchDBStore"],function(e,t,n,r,i,s){return function(){var u=new e,a=new s(i.get("ideaTemplate")),f=i.get("user"),l=i.get("labels"),c=new s({error:""}),h=!1;return a.setTransport(i.get("transport")),u.plugins.addAll({newidea:new n(a,{setVisibility:function(e){e==="public"?(this.innerHTML=l.get("publicidealbl"),this.setAttribute("style","background-image:url('img/brainstorm/publicforslider.png'); background-position: 135px center; background-repeat:no-repeat; background-size: 30px;")):(this.innerHTML=l.get("privateidealbl"),this.setAttribute("style","background-image:url('img/brainstorm/privateforslider.png'); background-position: 15px center; background-repeat:no-repeat; background-size: 20px;"))},setWarning:function(e){e==="public"?this.classList.remove("invisible"):this.classList.add("invisible")}}),labels:new n(l),errormsg:new n(c,{setError:function(e){switch(e){case"notitle":this.innerHTML=l.get("titlefield")+l.get("emptyfielderror");break;case"nodesc":this.innerHTML=l.get("descriptionfield")+l.get("emptyfielderror");break;case"nosol":this.innerHTML=l.get("solutionfield")+l.get("emptyfielderror");break;default:this.innerHTML=e}}}),newideaevent:new r(u)}),u.template='<div><div class = "header blue-dark"><span data-labels="bind: innerHTML, createidealbl"></span><div class="close-popup" data-newideaevent="listen:touchstart, cancel"></div></div><form class="form"><p><input maxlength=40 type="text" class="input newideatitle" data-labels="bind:placeholder, ideatitleplaceholder" data-newidea="bind: value, title"></p><p><textarea class="description input" data-labels="bind:placeholder, ideadescplaceholder" data-newidea="bind: value, description"></textarea></p><p><textarea class="solution input" data-labels="bind:placeholder, ideasolplaceholder" data-newidea="bind: value, solution" data-newideaevent="listen: input, resetError"></textarea></p><div class="visibility-input"><input class="visibility-slider" type="range" min="0" max="1" value ="1" data-newideaevent="listen:change, toggleVisibility" data-wbtools="bind:setReadonly, readonly"><div class="private" data-newidea="bind: setVisibility, visibility"></div></div><div class="newidea-footer"><div class="publicwarning invisible" data-labels="bind: innerHTML, publicwarning" data-newidea="bind: setWarning, visibility"></div><span class="errormsg" data-errormsg="bind:setError, error"></span><div class="sendmail" data-newideaevent="listen:touchstart, press; listen:touchend, upload" data-labels="bind:innerHTML, publishlbl">Publish</div></div></form></div>',u.render(),u.place(t.get("newidea-popup")),u.toggleVisibility=function(e,t){var n=a.get("visibility");t.classList.remove("pressed"),n==="public"?a.set("visibility","private"):a.set("visibility","public")},u.press=function(e,t){t.classList.add("pressed"),document.querySelector(".publicwarning").classList.add("invisible")},u.closePopup=function(){document.getElementById("newidea-popup").classList.remove("appear"),document.getElementById("cache").classList.remove("appear"),a.unsync(),a.reset(i.get("ideaTemplate")),c.reset({error:""}),document.querySelector(".visibility-slider").value=1},u.resetError=function(e,t){var n;t.classList.contains("description")?n="nodesc":t.classList.contains("solution")?n="nosol":n="notitle",c.get("error")===n&&t.value&&c.set("error","")},u.cancel=function(e,t){u.closePopup()},u.upload=function(e,t){var n=new Date,r="I:"+n.getTime(),s;t.classList.remove("pressed"),a.get("title")?a.get("description")?a.get("solution")||c.set("error","nosol"):c.set("error","nodesc"):c.set("error","notitle"),!c.get("error")&&!a.get("_id")&&!h?(h=!0,s=setInterval(function(){c.get("error")===l.get("uploadinprogress")?c.set("error",l.get("uploadinprogress")+"..."):c.set("error",l.get("uploadinprogress"))},100),a.set("authors",[f.get("_id")]),a.set("authornames",f.get("username")),a.set("creation_date",[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()]),a.set("lang",f.get("lang")),a.sync(i.get("db"),r),setTimeout(function(){a.upload(),a.get("visibility")==="public"?i.get("transport").request("UpdateUIP",{userid:f.get("_id"),type:a.get("type"),docId:r,docTitle:a.get("title")},function(e){e!=="ok"&&console.log(e),u.closePopup(),clearInterval(s)}):(u.closePopup(),clearInterval(s))},500)):t.classList.remove("pressed")},u}}),define("service/new2q",["Olives/OObject","service/map","Olives/Model-plugin","Olives/Event-plugin","service/config","CouchDBStore"],function(e,t,n,r,i,s){return function(){var u=new e,a=new s(i.get("TQTemplate")),f=i.get("user"),l=i.get("labels"),c=140,h=!1,p=new s({error:""});return a.setTransport(i.get("transport")),u.plugins.addAll({new2q:new n(a,{setLength:function(e){e===10&&this.setAttribute("maxlength",c)}}),labels:new n(l),errormsg:new n(p,{setError:function(e){switch(e){case"noquestion":this.innerHTML=l.get("noquestion");break;case"lengthexceeded":this.innerHTML=l.get("lengthexceeded")+" ("+c+l.get("characters")+")";break;default:this.innerHTML=e}}}),new2qevent:new r(u)}),u.template='<div><div class = "header blue-dark"><span data-labels="bind: innerHTML, createquestion"></span><div class="close-popup" data-new2qevent="listen:touchstart, cancel"></div></div><form class="form"><p><textarea class="description input" data-labels="bind:placeholder, questionplaceholder" data-new2q="bind: value, question; bind: setLength, type" data-new2qevent="listen:input, checkLength"></textarea></p><div><span class="errormsg" data-errormsg="bind:setError, error"></span><div class="sendmail" data-new2qevent="listen:touchstart, press; listen:touchend, upload" data-labels="bind:innerHTML, publishlbl">Publish</div></div></form></div>',u.render(),u.place(t.get("new2q-popup")),u.press=function(e,t){t.classList.add("pressed")},u.closePopup=function(){document.getElementById("new2q-popup").classList.remove("appear"),document.getElementById("cache").classList.remove("appear"),a.unsync(),a.reset(i.get("TQTemplate")),p.reset({error:""})},u.cancel=function(e,t){u.closePopup()},u.upload=function(e,t){var n=new Date,r,s="Q:"+n.getTime();a.get("question")||p.set("error","noquestion"),!p.get("error")&&!a.get("_id")&&!h?(h=!0,r=setInterval(function(){p.get("error")===l.get("uploadinprogress")?p.set("error",l.get("uploadinprogress")+"..."):p.set("error",l.get("uploadinprogress"))},150),a.set("author",f.get("_id")),a.set("username",f.get("username")),a.set("creation_date",[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()]),a.set("lang",f.get("lang")),a.sync(i.get("db"),s),setTimeout(function(){a.upload(),i.get("transport").request("UpdateUIP",{userid:f.get("_id"),type:a.get("type"),docId:s,question:a.get("question")},function(e){var t,o=f.get("connections"),c=o.length,h=[],d={type:"2Q+",docId:s,status:"unread",date:[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()],author:f.get("_id"),username:f.get("username"),firstname:f.get("firstname"),toList:"",ccList:"",object:f.get("username")+l.get("askednew"),body:a.get("question"),signature:""};e!=="ok"&&console.log(e),u.closePopup(),clearInterval(r),r=setInterval(function(){p.get("error")===l.get("notifyingcontacts")?p.set("error",l.get("notifyingcontacts")+"..."):p.set("error",l.get("notifyingcontacts"))},150);for(t=0;t<c;t++)o[t].type==="user"&&h.push(o[t].userid);d.dest=h,i.get("transport").request("Notify",d,function(e){var e=JSON.parse(e);console.log(e)})})},500)):t.classList.remove("pressed")},u.checkLength=function(e,t){t.value.length>=c?p.set("error","lengthexceeded"):p.set("error","")},u}}),define("service/tips",["Olives/OObject","service/map","Olives/Model-plugin","Olives/Event-plugin","service/config","Store","CouchDBStore"],function(e,t,n,r,i,s,o){return function(){var a=new e,f=i.get("labels"),l=new o([]),c=i.get("user"),h=[],p=new s([]),d=new s({});return l.setTransport(i.get("transport")),a.plugins.addAll({labels:new n(f),tip:new n(d,{setTitle:function(e){e==="TIP:0"?this.innerHTML=f.get("signupwelcomeobject"):this.innerHTML=f.get("dyknow")}}),tipevent:new r(a)}),a.template='<div><div class="help-doctor"></div><div class="close-tip" data-tipevent="listen:touchstart, close"></div><div class="tip-screen"><legend data-tip="bind:setTitle, id"></legend><p data-tip = "bind: innerHTML, body"></p><div class="next-button" data-labels = "bind: innerHTML, nextbutton" data-tipevent="listen: touchstart, press; listen:touchend, next"></div></div><div class="tip-footer"><input type="checkbox" data-tipevent="listen: change, doNotShow"><label data-labels="bind: innerHTML, notips"></label></div></div>',a.init=function(n){l.sync(i.get("db"),"about","_view/tip").then(function(){var e=c.get("lang");l.loop(function(t,n){var r=t.value;r.default_lang===e||!r.translations[e]?p.alter("push",{id:r._id,title:r.title,body:r.body}):p.alter("push",{id:r._id,title:r.translations[e].title,body:r.translations[e].body})}),n?d.reset(p.get(0)):(p.alter("splice",0,1),a.getRandomTip()),a.place(t.get("tip-popup")),document.getElementById("tip-popup").classList.add("visible"),document.getElementById("cache").classList.add("visible")})},a.getRandomTip=function(){var t=p.getNbItems(),n=Math.floor(Math.random()*t);t===0?a.close():(d.reset(p.get(n)),p.alter("splice",n,1))},a.press=function(e,t){t.classList.add("pressed")},a.next=function(e,t){t.classList.remove("pressed"),a.getRandomTip()},a.close=function(e,t){document.getElementById("tip-popup").classList.remove("visible"),document.getElementById("cache").classList.remove("visible")},a.doNotShow=function(e,t){var n;t.setAttribute("readonly","readonly"),t.checked===c.get("settings").showTips&&(n=c.get("settings"),n.showTips=!t.checked,c.set("settings",n),c.upload().then(function(){t.removeAttribute("readonly")}))},a}}),define("dock",["Olives/OObject","Amy/Stack-plugin","Amy/Control-plugin","public/public","library/library","brainstorm/brainstorm","connect/connect","dashboard/dashboard","service/map","service/config","./notify","service/newidea","service/help","service/new2q","service/new2c","service/tips"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){return function(){var d=new e,m,g,y,b=new n(this),w=f.get("observer"),E=f.get("user"),S=new t;return d.plugins.addAll({dockstack:S,dockcontrol:b}),d.alive(a.get("dock")),d.init=function(t){var n=new l;S.getStack().add("#public",new r),S.getStack().add("#library",new i),S.getStack().add("#brainstorm",new s),S.getStack().add("#connect",new o),S.getStack().add("#dashboard",new u),n.init(),m=new c,g=new p},d.start=function(t){var n=document.querySelector('a[href="#public"]'),r=document.querySelector('a[href="'+E.get("settings").startupScreen+'"]');E.get("settings").startupScreen?(b.radioClass(r,n,"selected"),b.init(r),S.getStack().show(E.get("settings").startupScreen)):S.getStack().show("#public");if(t||E.get("settings").showTips!==!1)y=new v,y.init(t)},d.reset=function(){S=new t,d.init()},this.setCurrentWidget=function(e){var t=e.target.getAttribute("href"),n=3e3;t!==S.getStack().getCurrentName()?(S.getStack().getCurrentScreen().hideMenu(),S.getStack().show(t),S.getStack().getCurrentScreen().showMenu(),setTimeout(function(){S.getStack().getCurrentScreen().hideMenu()},n)):S.getStack().getCurrentScreen().showMenu()},w.watch("replay-session",function(e,t){var n=document.querySelector(".dock-item.selected"),r=document.querySelector(".dock-item[href='#brainstorm']");S.getStack().show("#brainstorm"),b.radioClass(r,n,"selected"),b.init(r)}),w.watch("display-doc",function(){var e=document.querySelector(".dock-item.selected"),t=document.querySelector(".dock-item[href='#library']");S.getStack().show("#library"),b.radioClass(t,e,"selected"),b.init(t)}),w.watch("display-message",function(e){var t=document.querySelector(".dock-item.selected"),n=document.querySelector(".dock-item[href='#connect']");S.getStack().show("#connect"),b.radioClass(n,t,"selected"),b.init(n)}),w.watch("display-tutorials",function(e){var t=document.querySelector(".dock-item.selected"),n=document.querySelector(".dock-item[href='#dashboard']");S.getStack().show("#dashboard"),b.radioClass(n,t,"selected"),b.init(n)}),d}}),define("login",["Olives/OObject","Amy/Stack-plugin","service/map","Amy/Delegate-plugin","service/config","Olives/Model-plugin"],function(e,t,n,r,i,s){return function(){var u=new e,a=new e,f=new e,l=new e,c=new e,h=new e,p=new t;return a.alive(n.get("login-form")),f.alive(n.get("signup-form")),l.alive(n.get("loading")),c.alive(n.get("serverdown")),h.alive(n.get("nointernet")),u.plugins.addAll({loginstack:p,label:new s(i.get("labels")),loginevent:new r(this)}),u.alive(n.get("login")),p.getStack().add("#login-screen",a),p.getStack().add("#signup-screen",f),p.getStack().add("#loading-screen",l),p.getStack().add("#maintenance-screen",c),p.getStack().add("#nointernet",h),p.getStack().setCurrentScreen(a),u.setScreen=function(e){p.getStack().show(e)},u}}),require(["Olives/OObject","Olives/LocalStore","Store","service/map","Amy/Stack-plugin","Olives/Model-plugin","Amy/Delegate-plugin","./dock","./login","service/config","CouchDBStore","service/utils","Promise"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=new e,d=null,v=new i({"#login":d}),m=new u,g=new t,y=new n({email:"",firstname:"",lastname:"","confirm-password":"",password:"",error:""}),b=c.updateLabels,w=c.checkServerStatus,E=f.get("labels"),S=f.get("db"),x=f.get("transport"),T=f.get("user"),N=document.getElementById("login-form"),C=document.getElementById("signup-form");p.plugins.addAll({event:new o(p),loginmodel:new s(y),label:new s(E),stack:v}),p.alive(r.get("body")),d=new a,navigator.connection.type==="none"?(g.get("labels")?E.reset(g.get("labels")):E.reset(f.get("defaultLabels")),d.setScreen("#nointernet"),v.getStack().setCurrentScreen(d),document.getElementById("nointernet").classList.remove("invisible")):(d.setScreen("#loading-screen"),v.getStack().setCurrentScreen(d),document.getElementById("loading").classList.remove("invisible"),g.sync("ideafy-data"),w().then(function(e){g.get("labels")?E.reset(g.get("labels")):b(navigator.language),C.classList.remove("invisible"),N.classList.remove("invisible"),d.setScreen("#loading-screen");var t=g.get("currentLogin")||0;t?x.request("CheckLogin",{id:t},function(e){e.authenticated?p.init():d.setScreen("#login-screen")}):d.setScreen("#signup-screen"),v.getStack().add("#dock",m)},function(e){g.get("labels")?E.reset(g.get("labels")):E.reset(f.get("defaultLabels")),d.setScreen("#maintenance-screen"),document.getElementById("serverdown").classList.remove("invisible")})),p.login=function(){var e=y.get("email").toLowerCase(),t=y.get("password");e&&t&&x.request("Login",{name:e,password:t},function(t){t.login==="ok"?(f.set("uid",'"'+e+'"'),t.db&&f.set("db",t.db),g.set("currentLogin",e),x.request("GetAvatar",{id:e},function(e){e.error||(g.set("userAvatar",e),g.sync("ideafy-data"),f.set("avatar",e)),g.sync("ideafy-data"),p.init()})):y.set("error",E.get("invalidlogin"))})},p.signup=function(){var e=y.get("email"),t=y.get("password"),n=y.get("confirm-password"),r=y.get("firstname"),i=y.get("lastname"),s=new h,o=new l;if(e==="")y.set("error",E.get("signupmissingemail"));else if(t==="")y.set("error",E.get("signupmissingpwd"));else if(n==="")y.set("error",E.get("signupmissingpwdok"));else if(r==="")y.set("error",E.get("signupmissingfn"));else if(i==="")y.set("error",E.get("signupmissingln"));else{var u=e.toLowerCase(),a=/^[a-z0-9._-]+@[a-z0-9.-]+\.[a-z]{2,4}$/;a.test(u)?t!==n?y.set("error",E.get("signuppwdnomatch")):x.request("Signup",{name:u,password:t,lang:f.get("language")},function(e){if(e.signup==="ok"){d.setScreen("#loading-screen"),o.reset(f.get("userTemplate")),o.set("fistname",r),o.set("lastname",i),o.set("username",r+" "+i),o.set("lang",f.get("language"));var t=new Date;o.set("notifications",[{type:"MSG",toList:r+" "+i,date:[t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()],object:E.get("signupwelcomeobject"),status:"unread",author:"IDEAFY",firstname:"DeeDee",signature:"-- Ideas made easy!",username:"Ideafy",body:E.get("signupwelcomebody")}]),x.request("Welcome",{userid:u,language:o.get("lang")},function(e){console.log(e)}),e.db&&f.set("db",e.db),o.setTransport(x),o.sync(e.db,u),setTimeout(function(){o.upload(),g.set("currentLogin",u),g.set("userAvatar",o.get("picture_file")),g.sync("ideafy-data"),f.set("uid",'"'+u+'"'),s.resolve()},250),s.then(function(){o.unsync(),setTimeout(function(){p.init(!0)},250)})}else y.set("error","error : "+e.message),y.set("email","")},this):y.set("error",E.get("signupinvalidemail"))}},p.resetError=function(e,t){y.set("error","")},p.enterlogin=function(e,t){e.keyCode===13&&(e.target.blur(),p.login())},p.entersignup=function(e,t){e.keyCode===13&&(e.target.blur(),p.signup())},p.press=function(e){e.target.classList.add("pressed")},p.release=function(e){e.target.classList.remove("pressed")},p.forceLandscape=function(e,t){var n=.98046875,r=768/748;window.orientation===90||window.orientation===-90?t.setAttribute("style","-webkit-transform-origin:0;-webkit-transform:0;"):window.orientation>0?t.setAttribute("style","-webkit-transform-origin: 384px 374px; -webkit-transform:rotate(-90deg) scale("+n+","+r+"); -webkit-transition: all 1s ease-in-out;"):t.setAttribute("style","-webkit-transform-origin:384px 374px;-webkit-transform:rotate(90deg) scale("+n+","+r+"); -webkit-transition: all 0.25s ease-in-out;")},p.init=function(e){T.sync(S,g.get("currentLogin")).then(function(){var t=!1;f.set("uid",'"'+T.get("_id")+'"'),T.get("lang")!==f.get("lang")&&(t=!0),t&&T.get("picture_file").search("img/avatars/deedee")>-1?(f.set("avatar",T.get("picture_file")),b(T.get("lang")).then(function(){t=!1,m.init(),v.getStack().show("#dock"),m.start(e)})):T.get("picture_file").search("img/avatars/deedee")>-1?(f.set("avatar",T.get("picture_file")),m.init(),v.getStack().show("#dock"),m.start(e)):(t&&b(T.get("lang")).then(function(){t=!1}),x.request("GetFile",{sid:"avatars",filename:T.get("_id")+"_@v@t@r"},function(t){t.error||(f.set("avatar",t),m.init(),v.getStack().show("#dock"),m.start(e))}))}),f.watchValue("uid",function(e){e===""})}}),define("body",function(){})